
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DSCI 563: Unsupervised Learning &#8212; CPSC 330 Applied Machine Learning</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e8e5499552300ddf5d7adccae7cc3b70.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/UBC-CS-logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">CPSC 330 Applied Machine Learning</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <p class="caption">
 <span class="caption-text">
  Things you should know
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../docs/README.html">
   CPSC 330 Documents
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Lectures
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01_intro.html">
   Lecture 1: Course Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_decision-trees.html">
   Lecture 2: Terminology, Baselines, Decision Trees
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_ml-fundamentals.html">
   Lecture 3: Machine Learning Fundamentals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_kNNs-SVM-RBF.html">
   Lecture 4:
   <span class="math notranslate nohighlight">
    \(k\)
   </span>
   -Nearest Neighbours and SVM RBFs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_preprocessing-pipelines.html">
   Lecture 5: Preprocessing and
   <code class="docutils literal notranslate">
    <span class="pre">
     sklearn
    </span>
   </code>
   pipelines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_column-transformer-text-feats.html">
   Lecture 6:
   <code class="docutils literal notranslate">
    <span class="pre">
     sklearn
    </span>
   </code>
   <code class="docutils literal notranslate">
    <span class="pre">
     ColumnTransformer
    </span>
   </code>
   and Text Features
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_linear-models.html">
   Lecture 7: Linear Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08_hyperparameter-optimization.html">
   Lecture 8: Hyperparameter Optimization and Optimization Bias
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_classification-metrics.html">
   Lecture 9: Classification Metrics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="10_regression-metrics.html">
   Lecture 10: Regression Evaluation Metrics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="11_ensembles.html">
   Lecture 11: Ensembles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="13_feature-engineering-selection.html">
   Lecture 13: Feature engineering and feature selection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="14_k-means-clustering.html">
   Lecture 14: Clustering
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Attribution
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../attribution.html">
   Attributions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../LICENSE.html">
   LICENSE
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Varada Kolhatkar, CPSC 330 2021-22<br>Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/lectures/15_recommender-systems2.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/UBC-CS/cpsc330/master?urlpath=tree/lectures/15_recommender-systems2.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lecture-8-recommender-systems-part-2">
   Lecture 8: Recommender Systems Part 2
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#imports">
     Imports
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#table-of-contents">
   Table of contents
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#learning-outcomes-a-name-lo-a">
   Learning outcomes
   <a name="lo">
   </a>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#video-1-recap-and-motivation-a-name-1-a">
   Video 1: Recap and Motivation
   <a name="1">
   </a>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#recap-recommender-systems-problem">
     Recap: Recommender systems problem
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#collaborative-filtering-approach">
     Collaborative filtering approach
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#collaborative-filtering">
     Collaborative filtering
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#content-based-filtering">
     Content-based filtering
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#video-2-content-based-filtering-a-name-2-a">
   Video 2: Content-based filtering
   <a name="2">
   </a>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#item-and-user-features">
     Item and user features
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#toy-example-movie-recommendation">
     Toy example: Movie recommendation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ratings-data">
     Ratings data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#utility-matrix">
     Utility matrix
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Utility matrix
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#movie-features">
     Movie features
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#overall-idea">
     Overall idea
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pat-s-ratings">
     Pat’s ratings
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#supervised-approach-to-rating-prediction">
     Supervised approach to rating prediction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     Supervised approach to rating prediction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#let-s-build-user-profiles">
     Let’s build user profiles
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#examine-user-profiles">
     Examine user profiles
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pat-s-profile">
     Pat’s profile
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ryan-s-profile">
     Ryan’s profile
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#regression-models-for-users">
     Regression models for users
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#regression-model-for-pat">
     Regression model for Pat
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#predictions-for-pat">
     Predictions for Pat
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#regression-model-for-ryan">
     Regression model for Ryan
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#predictions-for-ryan">
     Predictions for Ryan
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#content-based-vs-collaborative-filtering">
     Content-based vs. collaborative filtering
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#more-comments-on-content-based-filtering">
     More comments on content-based filtering
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#advantages-of-content-based-filtering">
     Advantages of content-based filtering
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#disadvantages-of-content-based-filtering">
     Disadvantages of content-based filtering
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#video-3-hybrid-approaches-a-name-3-a">
   Video 3: Hybrid approaches
   <a name="3">
   </a>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#general-idea">
     General idea
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#netflix-hybrid-approach">
     Netflix hybrid approach
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hybrid-approach">
     Hybrid approach
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#video-4-sparse-utility-matrix-a-name-4-a">
   Video 4: Sparse utility matrix
   <a name="4">
   </a>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#let-s-try-surprise-package-on-this">
     Let’s try
     <code class="docutils literal notranslate">
      <span class="pre">
       surprise
      </span>
     </code>
     package on this
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#displaying-product-urls">
     Displaying product urls
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#video-4-final-comments-and-summary-a-name-5-a">
     Video 4: Final comments and summary
     <a name="5">
     </a>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-did-we-cover">
     What did we cover?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#beyond-error-rate-in-recommendation-systems">
     Beyond error rate in recommendation systems
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#other-issues-important-in-recommender-systems">
     Other issues important in recommender systems
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     Other issues important in recommender systems
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#types-of-data">
     Types of data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reminder">
     Reminder
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#course-roadmap">
   Course roadmap
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#questions-for-class-discussion-a-name-questions-a">
     Questions for class Discussion
     <a name="questions">
     </a>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#true-false-questions">
     True/False questions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#questions-to-discuss-in-the-breakout-rooms">
     Questions to discuss in the breakout rooms
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     True/False questions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#questions-to-discuss-in-the-breakout-room">
     Questions to discuss in the breakout room
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optional-practice-exercises-for-you">
     (Optional) Practice exercises for you
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="dsci-563-unsupervised-learning">
<h1>DSCI 563: Unsupervised Learning<a class="headerlink" href="#dsci-563-unsupervised-learning" title="Permalink to this headline">¶</a></h1>
<div class="section" id="lecture-8-recommender-systems-part-2">
<h2>Lecture 8: Recommender Systems Part 2<a class="headerlink" href="#lecture-8-recommender-systems-part-2" title="Permalink to this headline">¶</a></h2>
<p>UBC Master of Data Science program, 2020-21</p>
<p>Instructor: Varada Kolhatkar</p>
<div class="section" id="imports">
<h3>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;code/.&quot;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span><span class="p">,</span> <span class="n">train_test_split</span>

<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_colwidth&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><br><br></p>
</div>
</div>
<div class="section" id="table-of-contents">
<h2>Table of contents<a class="headerlink" href="#table-of-contents" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="#lo">Learning outcomes</a></p></li>
<li><p><a class="reference external" href="#1">Video 1: Motivation</a></p></li>
<li><p><a class="reference external" href="#2">Video 2: Content-based filtering</a></p></li>
<li><p><a class="reference external" href="#3">Video 3: Hybrid approaches</a></p></li>
<li><p><a class="reference external" href="#4">Video 4: Sparse utility matrix</a></p></li>
<li><p><a class="reference external" href="#5">Video 5: Final comments and summary</a></p></li>
<li><p><a class="reference external" href="#questions">Questions for class discussion</a></p></li>
</ul>
<p><br><br></p>
</div>
<div class="section" id="learning-outcomes-a-name-lo-a">
<h2>Learning outcomes <a name="lo"></a><a class="headerlink" href="#learning-outcomes-a-name-lo-a" title="Permalink to this headline">¶</a></h2>
<p>From this lecture, students are expected to be able to:</p>
<ul class="simple">
<li><p>Formulate the rating prediction problem as a supervised machine learning problem.</p></li>
<li><p>Create a content-based filter given ratings data and item features to predict missing ratings in the utility.</p></li>
<li><p>Discuss differences, advantages and disadvantages between content-based filtering and collaborative filtering.</p></li>
<li><p>Explain the idea of hybrid approaches at a high level.</p></li>
<li><p>Create and work with a sparse utility matrix for datasets with large number of items and users.</p></li>
<li><p>Name different kinds of data which occur in the context of recommendation systems.</p></li>
<li><p>Discuss important considerations in recommendation systems beyond error rate.</p></li>
</ul>
</div>
<div class="section" id="video-1-recap-and-motivation-a-name-1-a">
<h2>Video 1: Recap and Motivation <a name="1"></a><a class="headerlink" href="#video-1-recap-and-motivation-a-name-1-a" title="Permalink to this headline">¶</a></h2>
<div class="section" id="recap-recommender-systems-problem">
<h3>Recap: Recommender systems problem<a class="headerlink" href="#recap-recommender-systems-problem" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>We are usually given ratings data.</p></li>
<li><p>We use this data to create <strong>utility matrix</strong> which encodes interactions between users and items.</p></li>
<li><p>The utility matrix has many missing entries.</p></li>
<li><p>We defined recommendation systems problem as <strong>matrix completion problem</strong>.</p></li>
</ul>
</div>
<div class="section" id="collaborative-filtering-approach">
<h3>Collaborative filtering approach<a class="headerlink" href="#collaborative-filtering-approach" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>We use PCA-like approach to learn the latent features of users and items.</p></li>
<li><p>The key idea is that the loss function only includes the available ratings.</p></li>
<li><p>So instead of using the regular PCA or <code class="docutils literal notranslate"><span class="pre">TruncatedSVD</span></code>, we used SVD implementation in the <code class="docutils literal notranslate"><span class="pre">surprise</span></code> package, which only considers available ratings in the loss function.</p></li>
</ul>
</div>
<div class="section" id="collaborative-filtering">
<h3>Collaborative filtering<a class="headerlink" href="#collaborative-filtering" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>“Unsupervised” learning</p>
<ul>
<li><p>We only have labels <span class="math notranslate nohighlight">\(Y\)</span> (ratings <span class="math notranslate nohighlight">\(y_{ij}\)</span> for user <span class="math notranslate nohighlight">\(i\)</span> and item <span class="math notranslate nohighlight">\(j\)</span>) but no features.</p></li>
</ul>
</li>
<li><p>What if a new item shows up?</p>
<ul>
<li><p>You won’t have any ratings information for that item.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="content-based-filtering">
<h3>Content-based filtering<a class="headerlink" href="#content-based-filtering" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Supervised machine learning approach</p></li>
<li><p>Content-based filtering is suitable to predict ratings for new items.</p></li>
</ul>
<p><br><br><br><br></p>
</div>
</div>
<div class="section" id="video-2-content-based-filtering-a-name-2-a">
<h2>Video 2: Content-based filtering <a name="2"></a><a class="headerlink" href="#video-2-content-based-filtering-a-name-2-a" title="Permalink to this headline">¶</a></h2>
<div class="section" id="item-and-user-features">
<h3>Item and user features<a class="headerlink" href="#item-and-user-features" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>In collaborative filtering we assumed that we only have ratings data.</p></li>
<li><p>Usually there is some information on items and users available.</p></li>
<li><p>Examples</p>
<ul>
<li><p>Netflix can describe movies as action, romance, comedy, documentaries.</p></li>
<li><p>Amazon could describe books according to topics: math, languages, history.</p></li>
<li><p>Tinder could describe people according to age, location, employment.</p></li>
</ul>
</li>
<li><p>Can we use this information to predict ratings in the utility matrix?</p>
<ul>
<li><p>Yes!</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="toy-example-movie-recommendation">
<h3>Toy example: Movie recommendation<a class="headerlink" href="#toy-example-movie-recommendation" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Let’s consider movie recommendation problem with the following toy data. (Toy example inspired by Trevor 🙂!)</p></li>
</ul>
</div>
<div class="section" id="ratings-data">
<h3>Ratings data<a class="headerlink" href="#ratings-data" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">toy_ratings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/toy_ratings.csv&quot;</span><span class="p">)</span>
<span class="n">toy_ratings</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">80</span><span class="o">/</span><span class="n">kr9rkqfj4w78h49djkz8yy9r0000gp</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_20355</span><span class="o">/</span><span class="mf">1081887712.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">toy_ratings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/toy_ratings.csv&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">toy_ratings</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/pandas/util/_decorators.py</span> in <span class="ni">wrapper</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">309</span>                     <span class="n">stacklevel</span><span class="o">=</span><span class="n">stacklevel</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">310</span>                 <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">311</span>             <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">312</span> 
<span class="g g-Whitespace">    </span><span class="mi">313</span>         <span class="k">return</span> <span class="n">wrapper</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">read_csv</span><span class="nt">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, squeeze, prefix, mangle_dupe_cols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, error_bad_lines, warn_bad_lines, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">584</span>     <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds_defaults</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">585</span> 
<span class="ne">--&gt; </span><span class="mi">586</span>     <span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">587</span> 
<span class="g g-Whitespace">    </span><span class="mi">588</span> 

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">_read</span><span class="nt">(filepath_or_buffer, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">480</span> 
<span class="g g-Whitespace">    </span><span class="mi">481</span>     <span class="c1"># Create the parser.</span>
<span class="ne">--&gt; </span><span class="mi">482</span>     <span class="n">parser</span> <span class="o">=</span> <span class="n">TextFileReader</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">483</span> 
<span class="g g-Whitespace">    </span><span class="mi">484</span>     <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">or</span> <span class="n">iterator</span><span class="p">:</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">__init__</span><span class="nt">(self, f, engine, **kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">809</span>             <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">810</span> 
<span class="ne">--&gt; </span><span class="mi">811</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_engine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">812</span> 
<span class="g g-Whitespace">    </span><span class="mi">813</span>     <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">_make_engine</span><span class="nt">(self, engine)</span>
<span class="g g-Whitespace">   </span><span class="mi">1038</span>             <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1039</span>         <span class="c1"># error: Too many arguments for &quot;ParserBase&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1040</span>         <span class="k">return</span> <span class="n">mapping</span><span class="p">[</span><span class="n">engine</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>  <span class="c1"># type: ignore[call-arg]</span>
<span class="g g-Whitespace">   </span><span class="mi">1041</span> 
<span class="g g-Whitespace">   </span><span class="mi">1042</span>     <span class="k">def</span> <span class="nf">_failover_to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/pandas/io/parsers/c_parser_wrapper.py</span> in <span class="ni">__init__</span><span class="nt">(self, src, **kwds)</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span> 
<span class="g g-Whitespace">     </span><span class="mi">50</span>         <span class="c1"># open handles</span>
<span class="ne">---&gt; </span><span class="mi">51</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_open_handles</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">52</span>         <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">     </span><span class="mi">53</span> 

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/pandas/io/parsers/base_parser.py</span> in <span class="ni">_open_handles</span><span class="nt">(self, src, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">220</span>         <span class="n">Let</span> <span class="n">the</span> <span class="n">readers</span> <span class="nb">open</span> <span class="n">IOHandles</span> <span class="n">after</span> <span class="n">they</span> <span class="n">are</span> <span class="n">done</span> <span class="k">with</span> <span class="n">their</span> <span class="n">potential</span> <span class="n">raises</span><span class="o">.</span>
<span class="g g-Whitespace">    </span><span class="mi">221</span>         <span class="s2">&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">222</span><span class="s2">         self.handles = get_handle(</span>
<span class="g g-Whitespace">    </span><span class="mi">223</span><span class="s2">             src,</span>
<span class="g g-Whitespace">    </span><span class="mi">224</span><span class="s2">             &quot;r&quot;,</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/pandas/io/common.py</span> in <span class="ni">get_handle</span><span class="nt">(path_or_buf, mode, encoding, compression, memory_map, is_text, errors, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">699</span><span class="s2">         if ioargs.encoding and &quot;b&quot; not in ioargs.mode:</span>
<span class="g g-Whitespace">    </span><span class="mi">700</span><span class="s2">             # Encoding</span>
<span class="ne">--&gt; </span><span class="mi">701</span><span class="s2">             handle = open(</span>
<span class="g g-Whitespace">    </span><span class="mi">702</span><span class="s2">                 handle,</span>
<span class="g g-Whitespace">    </span><span class="mi">703</span><span class="s2">                 ioargs.mode,</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;data/toy_ratings.csv&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">toy_ratings</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]))</span>
<span class="n">M</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">toy_ratings</span><span class="p">[</span><span class="s2">&quot;movie_id&quot;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of users (N)                : </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">N</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of movies (M)               : </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">M</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of users (N)                : 4
Number of movies (M)               : 10
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_key</span> <span class="o">=</span> <span class="s2">&quot;user_id&quot;</span>
<span class="n">item_key</span> <span class="o">=</span> <span class="s2">&quot;movie_id&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_mapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">toy_ratings</span><span class="p">[</span><span class="n">user_key</span><span class="p">]),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">))))</span>
<span class="n">item_mapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">toy_ratings</span><span class="p">[</span><span class="n">item_key</span><span class="p">]),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">))))</span>
<span class="n">user_inverse_mapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">toy_ratings</span><span class="p">[</span><span class="n">user_key</span><span class="p">])))</span>
<span class="n">item_inverse_mapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">toy_ratings</span><span class="p">[</span><span class="n">item_key</span><span class="p">])))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="utility-matrix">
<h3>Utility matrix<a class="headerlink" href="#utility-matrix" title="Permalink to this headline">¶</a></h3>
<p>Let’s create a utility matrix for our toy dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_Y_from_ratings</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">))</span>
    <span class="n">Y</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">user_mapper</span><span class="p">[</span><span class="n">val</span><span class="p">[</span><span class="n">user_key</span><span class="p">]]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">item_mapper</span><span class="p">[</span><span class="n">val</span><span class="p">[</span><span class="n">item_key</span><span class="p">]]</span>
        <span class="n">Y</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="s2">&quot;rating&quot;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">Y</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id1">
<h3>Utility matrix<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Y</span> <span class="o">=</span> <span class="n">create_Y_from_ratings</span><span class="p">(</span><span class="n">toy_ratings</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
<span class="n">utility_mat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">item_mapper</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">user_mapper</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">utility_mat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A Beautiful Mind</th>
      <th>Bambi</th>
      <th>Cast Away</th>
      <th>Inception</th>
      <th>Jerry Maguire</th>
      <th>Lion King</th>
      <th>Malcolm x</th>
      <th>Roman Holidays</th>
      <th>The Social Dilemma</th>
      <th>Titanic</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Jim</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>Pat</th>
      <td>3.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Ryan</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>Sam</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">avg_n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">avg_n</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">avg_n</span><span class="p">)]</span> <span class="o">=</span> <span class="n">avg</span>
<span class="n">avg_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">avg_m</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">avg_m</span><span class="p">)]</span> <span class="o">=</span> <span class="n">avg</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">reconstruct_svd</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">avg_n</span><span class="p">,</span> <span class="n">avg_m</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">U</span> <span class="o">@</span> <span class="n">V</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">avg_n</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">avg_m</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Goal</strong>: Predict missing entries in the utility matrix.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span><span class="p">,</span> <span class="n">TruncatedSVD</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">utility_mat</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">data_svd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">TruncatedSVD</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_svd</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TruncatedSVD(n_components=4)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">U</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data_svd</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">user_mapper</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Jim</th>
      <td>5.196491</td>
      <td>5.005060</td>
      <td>1.072715</td>
      <td>-2.791978</td>
    </tr>
    <tr>
      <th>Pat</th>
      <td>7.908308</td>
      <td>-3.118076</td>
      <td>-3.425183</td>
      <td>-0.066244</td>
    </tr>
    <tr>
      <th>Ryan</th>
      <td>2.477745</td>
      <td>5.233368</td>
      <td>-0.858441</td>
      <td>3.276541</td>
    </tr>
    <tr>
      <th>Sam</th>
      <td>5.411752</td>
      <td>-2.645537</td>
      <td>4.368280</td>
      <td>1.277578</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">V</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">components_</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">item_mapper</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A Beautiful Mind</th>
      <th>Bambi</th>
      <th>Cast Away</th>
      <th>Inception</th>
      <th>Jerry Maguire</th>
      <th>Lion King</th>
      <th>Malcolm x</th>
      <th>Roman Holidays</th>
      <th>The Social Dilemma</th>
      <th>Titanic</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.189843</td>
      <td>0.253124</td>
      <td>0.189843</td>
      <td>0.079306</td>
      <td>0.489621</td>
      <td>0.592666</td>
      <td>0.166326</td>
      <td>0.216520</td>
      <td>0.307040</td>
      <td>0.312659</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.135255</td>
      <td>-0.180340</td>
      <td>-0.135255</td>
      <td>0.302682</td>
      <td>-0.378434</td>
      <td>-0.043872</td>
      <td>0.289477</td>
      <td>-0.191262</td>
      <td>0.740198</td>
      <td>0.160825</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.314224</td>
      <td>-0.418965</td>
      <td>-0.314224</td>
      <td>-0.105004</td>
      <td>0.010617</td>
      <td>0.246572</td>
      <td>0.131213</td>
      <td>0.667904</td>
      <td>0.032762</td>
      <td>-0.301119</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.009854</td>
      <td>-0.013139</td>
      <td>-0.009854</td>
      <td>0.649867</td>
      <td>0.236970</td>
      <td>-0.313504</td>
      <td>-0.553759</td>
      <td>0.316742</td>
      <td>0.120135</td>
      <td>0.038200</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_recon</span> <span class="o">=</span> <span class="n">reconstruct_svd</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">avg_n</span><span class="p">,</span> <span class="n">avg_m</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_recon</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">user_mapper</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Jim</th>
      <td>3.375000</td>
      <td>3.875000</td>
      <td>3.375000</td>
      <td>3.875000</td>
      <td>4.125000</td>
      <td>7.875000</td>
      <td>7.875000</td>
      <td>4.375000</td>
      <td>9.375000</td>
      <td>5.041667</td>
    </tr>
    <tr>
      <th>Pat</th>
      <td>6.333333</td>
      <td>7.833333</td>
      <td>6.333333</td>
      <td>3.833333</td>
      <td>9.083333</td>
      <td>7.833333</td>
      <td>3.833333</td>
      <td>4.333333</td>
      <td>4.333333</td>
      <td>6.000000</td>
    </tr>
    <tr>
      <th>Ryan</th>
      <td>3.333333</td>
      <td>3.833333</td>
      <td>3.333333</td>
      <td>7.833333</td>
      <td>4.083333</td>
      <td>3.833333</td>
      <td>3.833333</td>
      <td>4.333333</td>
      <td>9.333333</td>
      <td>5.000000</td>
    </tr>
    <tr>
      <th>Sam</th>
      <td>3.666667</td>
      <td>4.166667</td>
      <td>3.666667</td>
      <td>4.166667</td>
      <td>8.416667</td>
      <td>8.166667</td>
      <td>4.166667</td>
      <td>9.666667</td>
      <td>4.666667</td>
      <td>3.333333</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Z</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="nd">@W</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.8145207558717402e-15
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="movie-features">
<h3>Movie features<a class="headerlink" href="#movie-features" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Suppose we also have movie features.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">movie_feats_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/toy_movie_feats.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">movie_feats_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Action</th>
      <th>Romance</th>
      <th>Drama</th>
      <th>Comedy</th>
      <th>Children</th>
      <th>Documentary</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A Beautiful Mind</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Bambi</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Cast Away</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Inception</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Jerry Maguire</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Lion King</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Malcolm x</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>Roman Holidays</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>The Social Dilemma</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>Titanic</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Z</span> <span class="o">=</span> <span class="n">movie_feats_df</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">Z</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(10, 6)
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>How can we use these features to predict missing ratings?</p></li>
</ul>
</div>
<div class="section" id="overall-idea">
<h3>Overall idea<a class="headerlink" href="#overall-idea" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Using the ratings data and movie features, we’ll build <strong>profiles for different users</strong>.</p></li>
<li><p>Let’s consider an example user <strong>Pat</strong>.</p></li>
</ul>
</div>
<div class="section" id="pat-s-ratings">
<h3>Pat’s ratings<a class="headerlink" href="#pat-s-ratings" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>We don’t know anything about Pat but we know her ratings to movies.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">utility_mat</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Pat&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A Beautiful Mind      3.0
Bambi                 4.0
Cast Away             3.0
Inception            NaN 
Jerry Maguire         5.0
Lion King             4.0
Malcolm x            NaN 
Roman Holidays       NaN 
The Social Dilemma   NaN 
Titanic               3.0
Name: Pat, dtype: float64
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>We also know about movies and their features.</p></li>
<li><p>If Pat gave a high rating to <em>Lion King</em>, it means that she liked the features of the movie.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">movie_feats_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Lion King&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Action         0
Romance        0
Drama          1
Comedy         0
Children       1
Documentary    0
Name: Lion King, dtype: int64
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Can we build a profile for users based on what features they like and what features they don’t like and predict ratings for movies using this information?</p></li>
</ul>
</div>
<div class="section" id="supervised-approach-to-rating-prediction">
<h3>Supervised approach to rating prediction<a class="headerlink" href="#supervised-approach-to-rating-prediction" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>We treat ratings prediction problem as a set of regression problems.</p></li>
<li><p>Given movie information, we create user profile for each user.</p></li>
<li><p>Build regression model for each user and learn regression weights for each user.</p></li>
</ul>
</div>
<div class="section" id="id2">
<h3>Supervised approach to rating prediction<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>For each user <span class="math notranslate nohighlight">\(i\)</span> create a user profile as follows.</p>
<ul class="simple">
<li><p>Consider all movies rated by <span class="math notranslate nohighlight">\(i\)</span> and create <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> for the user:</p>
<ul>
<li><p>Each row in <code class="docutils literal notranslate"><span class="pre">X</span></code> contains the movie features of movie <span class="math notranslate nohighlight">\(j\)</span> rated by <span class="math notranslate nohighlight">\(i\)</span>.</p></li>
<li><p>Each value in <code class="docutils literal notranslate"><span class="pre">y</span></code> is the corresponding rating given to the movie <span class="math notranslate nohighlight">\(j\)</span> by user <span class="math notranslate nohighlight">\(i\)</span>.</p></li>
</ul>
</li>
<li><p>Fit a regression model using <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p></li>
<li><p>Apply the model to predict ratings for new items!</p></li>
</ul>
</div>
<div class="section" id="let-s-build-user-profiles">
<h3>Let’s build user profiles<a class="headerlink" href="#let-s-build-user-profiles" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Build <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> for all users.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>


<span class="k">def</span> <span class="nf">get_lr_data_per_user</span><span class="p">(</span><span class="n">ratings_df</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="n">lr_y</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">lr_X</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">lr_items</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">ratings_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">user_mapper</span><span class="p">[</span><span class="n">val</span><span class="p">[</span><span class="n">user_key</span><span class="p">]]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">item_mapper</span><span class="p">[</span><span class="n">val</span><span class="p">[</span><span class="n">item_key</span><span class="p">]]</span>
        <span class="n">lr_X</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="n">m</span><span class="p">])</span>
        <span class="n">lr_y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s2">&quot;rating&quot;</span><span class="p">])</span>
        <span class="n">lr_items</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">lr_X</span><span class="p">:</span>
        <span class="n">lr_X</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lr_X</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
        <span class="n">lr_y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lr_y</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">lr_X</span><span class="p">,</span> <span class="n">lr_y</span><span class="p">,</span> <span class="n">lr_items</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="n">movie_feats_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">X_train_usr</span><span class="p">,</span> <span class="n">y_train_usr</span><span class="p">,</span> <span class="n">rated_items</span> <span class="o">=</span> <span class="n">get_lr_data_per_user</span><span class="p">(</span><span class="n">toy_ratings</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>What’s going is be shape of each <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code>?</p></li>
</ul>
</div>
<div class="section" id="examine-user-profiles">
<h3>Examine user profiles<a class="headerlink" href="#examine-user-profiles" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Let’s examine some user profiles.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_user_profile</span><span class="p">(</span><span class="n">user_name</span><span class="p">):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">X_train_usr</span><span class="p">[</span><span class="n">user_mapper</span><span class="p">[</span><span class="n">user_name</span><span class="p">]]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y_train_usr</span><span class="p">[</span><span class="n">user_mapper</span><span class="p">[</span><span class="n">user_name</span><span class="p">]]</span>
    <span class="n">items</span> <span class="o">=</span> <span class="n">rated_items</span><span class="p">[</span><span class="n">user_mapper</span><span class="p">[</span><span class="n">user_name</span><span class="p">]]</span>
    <span class="n">movie_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">item_inverse_mapper</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Profile for user: &quot;</span><span class="p">,</span> <span class="n">user_name</span><span class="p">)</span>
    <span class="n">profile_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">movie_names</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">movie_feats_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">profile_df</span><span class="p">[</span><span class="s2">&quot;ratings&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
    <span class="k">return</span> <span class="n">profile_df</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="pat-s-profile">
<h3>Pat’s profile<a class="headerlink" href="#pat-s-profile" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">get_user_profile</span><span class="p">(</span><span class="s2">&quot;Pat&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Profile for user:  Pat
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Action</th>
      <th>Romance</th>
      <th>Drama</th>
      <th>Comedy</th>
      <th>Children</th>
      <th>Documentary</th>
      <th>ratings</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Titanic</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>Lion King</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>4</td>
    </tr>
    <tr>
      <th>Bambi</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>4</td>
    </tr>
    <tr>
      <th>Cast Away</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>Jerry Maguire</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>A Beautiful Mind</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Pat seems to like Children’s movies and movies with Comedy.</p></li>
<li><p>Seems like she’s not so much into romantic movies.</p></li>
</ul>
</div>
<div class="section" id="ryan-s-profile">
<h3>Ryan’s profile<a class="headerlink" href="#ryan-s-profile" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">get_user_profile</span><span class="p">(</span><span class="s2">&quot;Ryan&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Profile for user:  Ryan
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Action</th>
      <th>Romance</th>
      <th>Drama</th>
      <th>Comedy</th>
      <th>Children</th>
      <th>Documentary</th>
      <th>ratings</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Titanic</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>Inception</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
    </tr>
    <tr>
      <th>The Social Dilemma</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Ryan hasn’t rated many movies. There are not many rows.</p></li>
<li><p>Ryan seems to like documentaries and action movies.</p></li>
<li><p>Seems like he’s not so much into romantic movies.</p></li>
</ul>
</div>
<div class="section" id="regression-models-for-users">
<h3>Regression models for users<a class="headerlink" href="#regression-models-for-users" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span>


<span class="k">def</span> <span class="nf">train_for_usr</span><span class="p">(</span><span class="n">user_name</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">Ridge</span><span class="p">()):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">X_train_usr</span><span class="p">[</span><span class="n">user_mapper</span><span class="p">[</span><span class="n">user_name</span><span class="p">]]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y_train_usr</span><span class="p">[</span><span class="n">user_mapper</span><span class="p">[</span><span class="n">user_name</span><span class="p">]]</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>


<span class="k">def</span> <span class="nf">predict_for_usr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">movie_names</span><span class="p">):</span>
    <span class="n">feat_vecs</span> <span class="o">=</span> <span class="n">movie_feats_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">movie_names</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">feat_vecs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">preds</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="regression-model-for-pat">
<h3>Regression model for Pat<a class="headerlink" href="#regression-model-for-pat" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>What are the regression weights learned for Pat?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_name</span> <span class="o">=</span> <span class="s2">&quot;Pat&quot;</span>
<span class="n">pat_model</span> <span class="o">=</span> <span class="n">train_for_usr</span><span class="p">(</span><span class="n">user_name</span><span class="p">)</span>
<span class="n">col</span> <span class="o">=</span> <span class="s2">&quot;Coefficients for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">user_name</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pat_model</span><span class="o">.</span><span class="n">coef_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">movie_feats_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Coefficients for Pat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Action</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Romance</th>
      <td>-0.256410</td>
    </tr>
    <tr>
      <th>Drama</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Comedy</th>
      <td>0.820513</td>
    </tr>
    <tr>
      <th>Children</th>
      <td>0.256410</td>
    </tr>
    <tr>
      <th>Documentary</th>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="predictions-for-pat">
<h3>Predictions for Pat<a class="headerlink" href="#predictions-for-pat" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>How would Pat rate some movies she hasn’t seen?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">movies_to_pred</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Roman Holidays&quot;</span><span class="p">,</span> <span class="s2">&quot;Malcolm x&quot;</span><span class="p">]</span>
<span class="n">pred_df</span> <span class="o">=</span> <span class="n">movie_feats_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">movies_to_pred</span><span class="p">]</span>
<span class="n">pred_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Action</th>
      <th>Romance</th>
      <th>Drama</th>
      <th>Comedy</th>
      <th>Children</th>
      <th>Documentary</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Roman Holidays</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Malcolm x</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_name</span> <span class="o">=</span> <span class="s2">&quot;Pat&quot;</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">predict_for_usr</span><span class="p">(</span><span class="n">pat_model</span><span class="p">,</span> <span class="n">movies_to_pred</span><span class="p">)</span>
<span class="n">pred_df</span><span class="p">[</span><span class="n">user_name</span> <span class="o">+</span> <span class="s2">&quot;&#39;s predicted ratings&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preds</span>
<span class="n">pred_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Action</th>
      <th>Romance</th>
      <th>Drama</th>
      <th>Comedy</th>
      <th>Children</th>
      <th>Documentary</th>
      <th>Pat's predicted ratings</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Roman Holidays</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>4.179487</td>
    </tr>
    <tr>
      <th>Malcolm x</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3.615385</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="regression-model-for-ryan">
<h3>Regression model for Ryan<a class="headerlink" href="#regression-model-for-ryan" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>What are the regression weights learned for Ryan?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_name</span> <span class="o">=</span> <span class="s2">&quot;Ryan&quot;</span>
<span class="n">ryan_model</span> <span class="o">=</span> <span class="n">train_for_usr</span><span class="p">(</span><span class="n">user_name</span><span class="p">)</span>
<span class="n">col</span> <span class="o">=</span> <span class="s2">&quot;Coefficients for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">user_name</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ryan_model</span><span class="o">.</span><span class="n">coef_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">movie_feats_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Coefficients for Ryan</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Action</th>
      <td>0.25</td>
    </tr>
    <tr>
      <th>Romance</th>
      <td>-0.75</td>
    </tr>
    <tr>
      <th>Drama</th>
      <td>-0.50</td>
    </tr>
    <tr>
      <th>Comedy</th>
      <td>0.00</td>
    </tr>
    <tr>
      <th>Children</th>
      <td>0.00</td>
    </tr>
    <tr>
      <th>Documentary</th>
      <td>0.50</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="predictions-for-ryan">
<h3>Predictions for Ryan<a class="headerlink" href="#predictions-for-ryan" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>What are the predicted ratings for Ryan for a list of movies?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_name</span> <span class="o">=</span> <span class="s2">&quot;Ryan&quot;</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">predict_for_usr</span><span class="p">(</span><span class="n">ryan_model</span><span class="p">,</span> <span class="n">movies_to_pred</span><span class="p">)</span>
<span class="n">pred_df</span><span class="p">[</span><span class="n">user_name</span> <span class="o">+</span> <span class="s2">&quot;&#39;s predicted ratings&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preds</span>
<span class="n">pred_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Action</th>
      <th>Romance</th>
      <th>Drama</th>
      <th>Comedy</th>
      <th>Children</th>
      <th>Documentary</th>
      <th>Pat's predicted ratings</th>
      <th>Ryan's predicted ratings</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Roman Holidays</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>4.179487</td>
      <td>2.75</td>
    </tr>
    <tr>
      <th>Malcolm x</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3.615385</td>
      <td>4.50</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="content-based-vs-collaborative-filtering">
<h3>Content-based vs. collaborative filtering<a class="headerlink" href="#content-based-vs-collaborative-filtering" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Latent-factor approach to collaborative filtering, where we reconstruct rating for user <span class="math notranslate nohighlight">\(i\)</span> and item <span class="math notranslate nohighlight">\(j\)</span> as:
$<span class="math notranslate nohighlight">\(\hat{y}_{ij} = w_j^T z_{i}\)</span>$</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(w_j^T\)</span> are “hidden” features of item <span class="math notranslate nohighlight">\(j\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(z_i\)</span> are “hidden” features of user <span class="math notranslate nohighlight">\(i\)</span></p></li>
</ul>
</li>
<li><p>A linear model approach to content-based filtering, where we reconstruct rating for user <span class="math notranslate nohighlight">\(i\)</span> and item <span class="math notranslate nohighlight">\(j\)</span> as:<br />
$<span class="math notranslate nohighlight">\(\hat{y}_{ij} = w^T x_{ij}\)</span>$</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(x_{ij}\)</span> is a feature vector for user <span class="math notranslate nohighlight">\(i\)</span> and item <span class="math notranslate nohighlight">\(j\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(w\)</span> are the feature vectors for user <span class="math notranslate nohighlight">\(i\)</span></p></li>
<li><p>Our usual supervised learning setup for linear regression.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="more-comments-on-content-based-filtering">
<h3>More comments on content-based filtering<a class="headerlink" href="#more-comments-on-content-based-filtering" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Using predictions per user, we can fill in missing entries in the utility matrix.</p></li>
<li><p>The feature matrix for movies can contain different types of features.</p>
<ul>
<li><p>Example: Plot of the movie (text features), actors (categorical features), year of the movie, budget and revenue of the movie (numerical features).</p></li>
<li><p>You’ll apply our usual preprocessing techniques to these features.</p></li>
</ul>
</li>
<li><p>If you have enough data, you could also carry out hyperparameter tuning with cross-validation for each model.</p></li>
<li><p>Finally, although we have been talking about linear models above, you can use any regression model of your choice.</p></li>
</ul>
</div>
<div class="section" id="advantages-of-content-based-filtering">
<h3>Advantages of content-based filtering<a class="headerlink" href="#advantages-of-content-based-filtering" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>We don’t need many users to provide ratings for an item.</p></li>
<li><p>Each user is modeled separately, so you might be able to capture uniqueness of taste.</p></li>
<li><p>Since you can obtain the features of the items, you can immediately recommend new items.</p>
<ul>
<li><p>This would not have been possible with collaborative filtering.</p></li>
</ul>
</li>
<li><p>Recommendations are interpretable.</p>
<ul>
<li><p>You can explain to the user why you are recommending an item because you have learned weights.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="disadvantages-of-content-based-filtering">
<h3>Disadvantages of content-based filtering<a class="headerlink" href="#disadvantages-of-content-based-filtering" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Feature acquisition and feature engineering</p>
<ul>
<li><p>What features should we use to explain the difference in ratings?</p></li>
<li><p>Obtaining those features for each item might be very expensive.</p></li>
</ul>
</li>
<li><p>Less diversity: hardly recommend an item outside the user’s profile.</p></li>
<li><p>Cold start: When a new user shows up, you don’t have any information about them.</p></li>
</ul>
<p><br><br><br><br></p>
</div>
</div>
<div class="section" id="video-3-hybrid-approaches-a-name-3-a">
<h2>Video 3: Hybrid approaches <a name="3"></a><a class="headerlink" href="#video-3-hybrid-approaches-a-name-3-a" title="Permalink to this headline">¶</a></h2>
<hr><div class="section" id="general-idea">
<h3>General idea<a class="headerlink" href="#general-idea" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Both collaborative filtering and content-based filtering suffer from shortcomings.</p></li>
<li><p>Collaborative filtering does not predict well for new movies/users.</p>
<ul>
<li><p>New movies don’t yet have ratings, and new users haven’t rated anything.</p></li>
</ul>
</li>
<li><p>Content-based approaches are less diverse.</p></li>
<li><p>We are not exploiting information about similarity between users.</p></li>
<li><p>Most of the recommenders used in practice are hybrid recommenders which combine the best of the two worlds.</p></li>
</ul>
</div>
<div class="section" id="netflix-hybrid-approach">
<h3>Netflix hybrid approach<a class="headerlink" href="#netflix-hybrid-approach" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>MORE LIKE THIS: Netflix employs content-based techniques when it shows you similar movies to a movie you’re watching.</p></li>
<li><p>Top Picks for XXX: It employs collaborative filtering to identify similar users and recommend movies they have liked.</p></li>
</ul>
</div>
<div class="section" id="hybrid-approach">
<h3>Hybrid approach<a class="headerlink" href="#hybrid-approach" title="Permalink to this headline">¶</a></h3>
<p>Hybrid approaches combine content-based and collaborative filtering: <a class="reference external" href="https://www.jmlr.org/papers/v13/chen12a.html">SVDfeature</a> (won “KDD Cup” in 2011 and 2012).</p>
<div class="math notranslate nohighlight">
\[\hat{y}_{ij} = \beta + \beta_i + \beta_j + w^TX_{ij} + w_j^Tz_i\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\beta\)</span> is average rating across all users/movies</p></li>
<li><p><span class="math notranslate nohighlight">\(\beta_i\)</span> is average rating for user <span class="math notranslate nohighlight">\(i\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\beta_j\)</span> average rating for movie <span class="math notranslate nohighlight">\(j\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(w^TX_{ij}\)</span> is our linear model based on user/movie features <span class="math notranslate nohighlight">\(x_{ij}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(w_j^Tz_i\)</span> factors learned by our collaboative filtering model.</p></li>
<li><p>Note that <span class="math notranslate nohighlight">\(x_{ij}\)</span> is a feature vector for user <span class="math notranslate nohighlight">\(i\)</span> and movie <span class="math notranslate nohighlight">\(j\)</span>.</p></li>
<li><p>Also, <span class="math notranslate nohighlight">\(w\)</span> and <span class="math notranslate nohighlight">\(w_j\)</span> are different parameters.</p></li>
<li><p>Supervised learning can predict for new movies!</p></li>
</ul>
<p>In my quick search, I didn’t find an easy-to-use package for this.</p>
<p><br><br><br><br></p>
</div>
</div>
<div class="section" id="video-4-sparse-utility-matrix-a-name-4-a">
<h2>Video 4: Sparse utility matrix <a name="4"></a><a class="headerlink" href="#video-4-sparse-utility-matrix-a-name-4-a" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Recommender systems work best when there is a large amount of data.</p></li>
<li><p>So far we’ve been working with small datasets.</p></li>
</ul>
<p>Let’s using the <a class="reference external" href="http://jmcauley.ucsd.edu/data/amazon/">Amazon product data set</a>. The authors of the data set have asked for the following citations:</p>
<blockquote>
<div><p>Ups and downs: Modeling the visual evolution of fashion trends with one-class collaborative filtering.
R. He, J. McAuley.
WWW, 2016.</p>
<p>Image-based recommendations on styles and substitutes.
J. McAuley, C. Targett, J. Shi, A. van den Hengel.
SIGIR, 2015.</p>
</div></blockquote>
<p>We will focus on the Patio, Lawn, and Garden section. You can download the <a class="reference external" href="http://snap.stanford.edu/data/amazon/productGraph/categoryFiles/ratings_Patio_Lawn_and_Garden.csv">ratings here</a>.</p>
<p>Let’s load the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;ratings_Patio_Lawn_and_Garden.csv&quot;</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">ratings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">,</span> <span class="s2">&quot;rating&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">))</span>
<span class="n">ratings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user</th>
      <th>item</th>
      <th>rating</th>
      <th>timestamp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A2VNYWOPJ13AFP</td>
      <td>0981850006</td>
      <td>5.0</td>
      <td>1259798400</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A20DWVV8HML3AW</td>
      <td>0981850006</td>
      <td>5.0</td>
      <td>1371081600</td>
    </tr>
    <tr>
      <th>2</th>
      <td>A3RVP3YBYYOPRH</td>
      <td>0981850006</td>
      <td>5.0</td>
      <td>1257984000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>A28XY55TP3Q90O</td>
      <td>0981850006</td>
      <td>5.0</td>
      <td>1314144000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>A3VZW1BGUQO0V3</td>
      <td>0981850006</td>
      <td>5.0</td>
      <td>1308268800</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratings</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 993490 entries, 0 to 993489
Data columns (total 4 columns):
 #   Column     Non-Null Count   Dtype  
---  ------     --------------   -----  
 0   user       993490 non-null  object 
 1   item       993490 non-null  object 
 2   rating     993490 non-null  float64
 3   timestamp  993490 non-null  int64  
dtypes: float64(1), int64(1), object(2)
memory usage: 30.3+ MB
</pre></div>
</div>
</div>
</div>
<p>We’d like to construct the utility matrix <code class="docutils literal notranslate"><span class="pre">Y</span></code>. However, let’s see how big it would be:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_stats</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">item_key</span><span class="o">=</span><span class="s2">&quot;item&quot;</span><span class="p">,</span> <span class="n">user_key</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of ratings:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ratings</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The average rating:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="s2">&quot;rating&quot;</span><span class="p">]))</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="n">user_key</span><span class="p">]))</span>
    <span class="n">M</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="n">item_key</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of users:&quot;</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of items:&quot;</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fraction nonzero:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ratings</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span> <span class="o">*</span> <span class="n">M</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Size of full Y matrix (GB):&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">N</span> <span class="o">*</span> <span class="n">M</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">/</span> <span class="mf">1e9</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span>


<span class="n">N</span><span class="p">,</span> <span class="n">M</span> <span class="o">=</span> <span class="n">get_stats</span><span class="p">(</span><span class="n">ratings</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of ratings: 993490
The average rating: 4.006400668350965
Number of users: 714791
Number of items: 105984
Fraction nonzero: 1.3114269915944552e-05
Size of full Y matrix (GB): 606.051274752
</pre></div>
</div>
</div>
</div>
<p>606 GB! That is way too big. We don’t want to create that matrix! On the other hand, we see that we only have about 1 million ratings, which would be 8 MB or so (<span class="math notranslate nohighlight">\(10^6\)</span> numbers <span class="math notranslate nohighlight">\(\times\)</span> 8 bytes per number). Much more manageable!</p>
<p>Let’s create a sparse representation of our utility matrix <span class="math notranslate nohighlight">\(Y\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">csr_matrix</span> <span class="k">as</span> <span class="n">sparse_matrix</span>

<span class="n">user_key</span> <span class="o">=</span> <span class="s2">&quot;user&quot;</span>
<span class="n">item_key</span> <span class="o">=</span> <span class="s2">&quot;item&quot;</span>
<span class="n">user_mapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="n">user_key</span><span class="p">]),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">))))</span>
<span class="n">item_mapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="n">item_key</span><span class="p">]),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">))))</span>

<span class="n">user_inverse_mapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="n">user_key</span><span class="p">])))</span>
<span class="n">item_inverse_mapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="n">item_key</span><span class="p">])))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_Y</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">user_key</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">item_key</span><span class="o">=</span><span class="s2">&quot;item&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a sparse matrix using scipy.csr_matrix and mappers to relate indexes to items&#39; id.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    ratings: pd.DataFrame</span>
<span class="sd">        the ratings to be stored in the matrix;</span>
<span class="sd">    N: int</span>
<span class="sd">        the number of users</span>
<span class="sd">    M: int</span>
<span class="sd">        the number of items</span>
<span class="sd">    user_key: string</span>
<span class="sd">        the column in ratings that contains the users id</span>
<span class="sd">    item_key: string</span>
<span class="sd">        the column in ratings that contains the items id</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    Y: np.sparse</span>
<span class="sd">        the sparse matrix containing the ratings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">user_ind</span> <span class="o">=</span> <span class="p">[</span><span class="n">user_mapper</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ratings</span><span class="p">[</span><span class="n">user_key</span><span class="p">]]</span>
    <span class="n">item_ind</span> <span class="o">=</span> <span class="p">[</span><span class="n">item_mapper</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ratings</span><span class="p">[</span><span class="n">item_key</span><span class="p">]]</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">sparse_matrix</span><span class="p">((</span><span class="n">ratings</span><span class="p">[</span><span class="s2">&quot;rating&quot;</span><span class="p">],</span> <span class="p">(</span><span class="n">user_ind</span><span class="p">,</span> <span class="n">item_ind</span><span class="p">)),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">Y</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Y</span> <span class="o">=</span> <span class="n">create_Y</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
<span class="n">Y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;714791x105984 sparse matrix of type &#39;&lt;class &#39;numpy.float64&#39;&gt;&#39;
	with 993490 stored elements in Compressed Sparse Row format&gt;
</pre></div>
</div>
</div>
</div>
<p>Note the shape of <code class="docutils literal notranslate"><span class="pre">Y</span></code>: our rows are the users, and the columns are products.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># sanity check</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># should be number of items by number of users</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">nnz</span><span class="p">)</span>  <span class="c1"># number of nonzero elements -- should equal number of ratings</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using sparse matrix data structure, the size of X is: </span><span class="si">{</span><span class="n">Y</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">nbytes</span><span class="o">/</span><span class="mf">1e6</span><span class="si">}</span><span class="s2">mb&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(714791, 105984)
993490
Using sparse matrix data structure, the size of X is: 7.94792mb
</pre></div>
</div>
</div>
</div>
<div class="section" id="let-s-try-surprise-package-on-this">
<h3>Let’s try <code class="docutils literal notranslate"><span class="pre">surprise</span></code> package on this<a class="headerlink" href="#let-s-try-surprise-package-on-this" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratings</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">surprise</span>
<span class="kn">from</span> <span class="nn">surprise</span> <span class="kn">import</span> <span class="n">SVD</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">Reader</span>
<span class="kn">from</span> <span class="nn">surprise.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span>

<span class="n">reader</span> <span class="o">=</span> <span class="n">Reader</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">load_from_df</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">reader</span><span class="p">)</span>  <span class="c1"># Load the data</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">algo</span> <span class="o">=</span> <span class="n">SVD</span><span class="p">(</span><span class="n">n_factors</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">cross_validate</span><span class="p">(</span><span class="n">algo</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">measures</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;RMSE&quot;</span><span class="p">,</span> <span class="s2">&quot;MAE&quot;</span><span class="p">],</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating RMSE, MAE of algorithm SVD on 5 split(s).

                  Fold 1  Fold 2  Fold 3  Fold 4  Fold 5  Mean    Std     
RMSE (testset)    1.2928  1.2903  1.2925  1.2891  1.2905  1.2910  0.0014  
MAE (testset)     1.0204  1.0191  1.0221  1.0187  1.0206  1.0202  0.0012  
Fit time          11.81   11.91   11.80   11.95   12.07   11.91   0.10    
Test time         1.29    1.15    1.19    1.18    0.91    1.14    0.12    
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;test_rmse&#39;: array([1.29275852, 1.29026753, 1.29248648, 1.28913228, 1.29054284]),
 &#39;test_mae&#39;: array([1.02038521, 1.01914696, 1.02207026, 1.01868075, 1.02059237]),
 &#39;fit_time&#39;: (11.81141996383667,
  11.911198139190674,
  11.800252199172974,
  11.94942593574524,
  12.068403959274292),
 &#39;test_time&#39;: (1.285412073135376,
  1.1535170078277588,
  1.1907069683074951,
  1.175961971282959,
  0.9121360778808594)}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="displaying-product-urls">
<h3>Displaying product urls<a class="headerlink" href="#displaying-product-urls" title="Permalink to this headline">¶</a></h3>
<p>Let’s consider the following product.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.amazon.com/dp/B00IJB5MCS">Mr Grill - 18” Luxury Oak Barbecue Spatula / Turner</a>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">HTML</span><span class="p">,</span> <span class="n">display</span>

<span class="n">url_amazon</span> <span class="o">=</span> <span class="s2">&quot;https://www.amazon.com/dp/</span><span class="si">%s</span><span class="s2">&quot;</span>


<span class="k">def</span> <span class="nf">disp_url</span><span class="p">(</span><span class="n">item_id</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">url_amazon</span> <span class="o">%</span> <span class="n">item_id</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s1">&#39;&lt;a href=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/a&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">url</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grill_spatula</span> <span class="o">=</span> <span class="s2">&quot;B00IJB5MCS&quot;</span>
<span class="n">grill_spatula_ind</span> <span class="o">=</span> <span class="n">item_mapper</span><span class="p">[</span><span class="n">grill_spatula</span><span class="p">]</span>
<span class="n">grill_spatula_vec</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">grill_spatula_ind</span><span class="p">]</span>
<span class="n">disp_url</span><span class="p">(</span><span class="n">grill_spatula</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><a href="https://www.amazon.com/dp/B00IJB5MCS">https://www.amazon.com/dp/B00IJB5MCS</a></div></div>
</div>
<p><br><br><br><br></p>
</div>
<div class="section" id="video-4-final-comments-and-summary-a-name-5-a">
<h3>Video 4: Final comments and summary <a name="5"></a><a class="headerlink" href="#video-4-final-comments-and-summary-a-name-5-a" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="what-did-we-cover">
<h3>What did we cover?<a class="headerlink" href="#what-did-we-cover" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>There is a big world of recommendation systems out there. We talked about some basic approaches to recommender systems.</p>
<ul>
<li><p>collaborative filtering</p></li>
<li><p>content-based filtering</p></li>
<li><p>hybrid approaches</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="beyond-error-rate-in-recommendation-systems">
<h3>Beyond error rate in recommendation systems<a class="headerlink" href="#beyond-error-rate-in-recommendation-systems" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>If a system gives the best RMSE it doesn’t necessarily mean that it’s going to give best recommendations.</p></li>
<li><p>In recommendation systems we do not have ground truth.</p></li>
<li><p>Just training your model and evaluating it offline is not ideal.</p></li>
<li><p>Other aspects such as simplicity, interpretation, code maintainability are equally (if not more) important than best validation error.</p></li>
<li><p>Winning system of Netflix Challenge was never adopted.</p>
<ul>
<li><p>Big mess of ensembles was not really maintainable</p></li>
</ul>
</li>
<li><p>There are other considerations.</p></li>
</ul>
</div>
<div class="section" id="other-issues-important-in-recommender-systems">
<h3>Other issues important in recommender systems<a class="headerlink" href="#other-issues-important-in-recommender-systems" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><strong>Diversity</strong>: how different are the recommendations?</p>
<ul>
<li><p>Even if you really really like Star Wars, you might want non-Star-Wars suggestions.</p></li>
</ul>
</li>
<li><p><strong>Freshness</strong>: people tend to get more excited about new/surprising things.</p></li>
<li><p><strong>Trust</strong>: tell user why you made a recommendation.</p>
<ul>
<li><p>Quora gives explanations for recommendations.</p></li>
</ul>
</li>
<li><p><strong>Persistence</strong>: how long should recommendations last?</p>
<ul>
<li><p>If you keep not clicking on a recommendation, should it remain a recommendation?</p></li>
</ul>
</li>
<li><p><strong>Social recommendation</strong>: what did your friends watch?</p></li>
</ul>
</div>
<div class="section" id="id3">
<h3>Other issues important in recommender systems<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Many recommenders	are	now	connected to social	networks.</p></li>
<li><p>“Login using you Facebook	account”.</p></li>
<li><p>Often, people	like similar movies	to their friends.</p></li>
<li><p>If we get a new user, then recommendations are based on friend’s preferences.</p></li>
</ul>
</div>
<div class="section" id="types-of-data">
<h3>Types of data<a class="headerlink" href="#types-of-data" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Explicit data: ratings, thumbs up, etc.</p></li>
<li><p>Implicit data: collected from the users’ behaviour (e.g., mouse clicks, purchases, time spent doing something)</p></li>
<li><p>Trust implicit data that costs something, like time or even money.</p>
<ul>
<li><p>this makes it harder to fraud</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="reminder">
<h3>Reminder<a class="headerlink" href="#reminder" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Recommendation systems can have terrible consequences.</p></li>
<li><p>Ask hard and uncomfortable questions to yourself (and to your employer if possible) before implementing and deploying a recommendation system.</p></li>
</ul>
</div>
</div>
<div class="section" id="course-roadmap">
<h2>Course roadmap<a class="headerlink" href="#course-roadmap" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Week 1 ✅</p>
<ul>
<li><p>Clustering</p></li>
</ul>
</li>
<li><p>Week 2 ✅</p>
<ul>
<li><p>Dimensionality reduction</p></li>
</ul>
</li>
<li><p>Week 3 ✅</p>
<ul>
<li><p>Word embeddings</p></li>
</ul>
</li>
<li><p>Week 4 ✅</p>
<ul>
<li><p>Recommendation systems</p></li>
</ul>
</li>
</ul>
<p>That’s all for this course, folks! It was fun teaching you this material. Thanks for your support, feedback, and great questions ❤️!</p>
<p>I would love to hear your thought on this course. When you get a chance, it’ll be great if you fill in the evaluation survey for this course on <a class="reference external" href="https://canvas.ubc.ca/courses/30777/external_tools/6073">Canvas</a>.</p>
<p>The evaluation closing date is: <strong>March 24, 2021</strong></p>
<p><br><br><br><br></p>
<div class="section" id="questions-for-class-discussion-a-name-questions-a">
<h3>Questions for class Discussion <a name="questions"></a><a class="headerlink" href="#questions-for-class-discussion-a-name-questions-a" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="true-false-questions">
<h3>True/False questions<a class="headerlink" href="#true-false-questions" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>In content-based filtering we leverage available item features in addition to similarity between users.</p></li>
</ul>
<blockquote>
<div><p>False. We do not incorporate similarity between users. Each user has a separate regression model.</p>
</div></blockquote>
<ul class="simple">
<li><p>In content-based filtering you represent each user in terms of <strong>known</strong> features of items whereas in collaborative filtering each user is represented with <strong>latent</strong> features of items.</p></li>
</ul>
<blockquote>
<div><p>True.</p>
</div></blockquote>
<ul class="simple">
<li><p>In the set up of content-based filtering we discussed, if you have a new movie, you would have problems predicting ratings for that movie.</p></li>
</ul>
<blockquote>
<div><p>False. A new movie comes with a set of features and given the learned weights of regressor and the movie feature vector we can right away predict the rating for the movie.</p>
</div></blockquote>
<ul class="simple">
<li><p>Interpretation of recommendations might be easier with content-based filtering compared to collaborative filtering.</p></li>
</ul>
<blockquote>
<div><p>True. In collaborative filtering we do not know the actual features.</p>
</div></blockquote>
<p><br><br><br><br></p>
</div>
<div class="section" id="questions-to-discuss-in-the-breakout-rooms">
<h3>Questions to discuss in the breakout rooms<a class="headerlink" href="#questions-to-discuss-in-the-breakout-rooms" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>We have been ignoring the timestamp column in ratings datasets. How you might use this information when making recommendations?</p></li>
<li><p>Discuss similarities and differences between the Word2Vec style recommender we saw last week and the recommender systems we learned this week.</p></li>
</ul>
<p><br><br><br><br></p>
</div>
<div class="section" id="id4">
<h3>True/False questions<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SVDFeature</span></code> hybrid model creates separate rating prediction models with content-based and collaborative filtering.</p></li>
</ul>
<blockquote>
<div><p>V’s answer: False</p>
</div></blockquote>
<ul class="simple">
<li><p>If you have a large number of users and items, it would be a problem to evaluate the reconstructed matrix against train and validation sets.</p></li>
</ul>
<blockquote>
<div><p>V’s answer: False</p>
</div></blockquote>
<ul class="simple">
<li><p>A user views 1 minute of a 10 minute YouTube video. What kind of input is this?</p>
<ul>
<li><p>Implicit (V’s answer)</p></li>
<li><p>Explicit</p></li>
<li><p>Utility matrix</p></li>
<li><p>indication that the user dislikes the video.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="questions-to-discuss-in-the-breakout-room">
<h3>Questions to discuss in the breakout room<a class="headerlink" href="#questions-to-discuss-in-the-breakout-room" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Discuss memory-related problems that may cause when dealing with large number of users and items.</p></li>
</ul>
</div>
<div class="section" id="optional-practice-exercises-for-you">
<h3>(Optional) Practice exercises for you<a class="headerlink" href="#optional-practice-exercises-for-you" title="Permalink to this headline">¶</a></h3>
<p>Use scikit-learn’s <a class="reference external" href="http://scikit-learn.org/stable/modules/generated/sklearn.neighbors.NearestNeighbors.html">NearestNeighbors</a> object (which uses Euclidean distance by default) to find the 10 most similar items to <a class="reference external" href="https://www.amazon.com/dp/B00IJB5MCS">Mr Grill - 18” Luxury Oak Barbecue Spatula / Turner</a> using Euclidean distance and cosine distance. Which distance metric is giving you better recommendations?</p>
<blockquote>
<div><p>Try it out on your own or with your friends. I might not get a chance to post solutions for these questions.</p>
</div></blockquote>
<p><br><br></p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "conda-env-cpsc330-py"
        },
        kernelOptions: {
            kernelName: "conda-env-cpsc330-py",
            path: "./lectures"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'conda-env-cpsc330-py'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Varada Kolhatkar<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>