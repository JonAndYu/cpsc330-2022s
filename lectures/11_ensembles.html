
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lecture 11: Ensembles &#8212; CPSC 330 Applied Machine Learning</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e8e5499552300ddf5d7adccae7cc3b70.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lecture 13: Feature engineering and feature selection" href="13_feature-engineering-selection.html" />
    <link rel="prev" title="Lecture 10: Regression Evaluation Metrics" href="10_regression-metrics.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/UBC-CS-logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">CPSC 330 Applied Machine Learning</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <p class="caption">
 <span class="caption-text">
  Things you should know
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../docs/README.html">
   CPSC 330 Documents
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Lectures
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01_intro.html">
   Lecture 1: Course Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_decision-trees.html">
   Lecture 2: Terminology, Baselines, Decision Trees
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_ml-fundamentals.html">
   Lecture 3: Machine Learning Fundamentals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_kNNs-SVM-RBF.html">
   Lecture 4:
   <span class="math notranslate nohighlight">
    \(k\)
   </span>
   -Nearest Neighbours and SVM RBFs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_preprocessing-pipelines.html">
   Lecture 5: Preprocessing and
   <code class="docutils literal notranslate">
    <span class="pre">
     sklearn
    </span>
   </code>
   pipelines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_column-transformer-text-feats.html">
   Lecture 6:
   <code class="docutils literal notranslate">
    <span class="pre">
     sklearn
    </span>
   </code>
   <code class="docutils literal notranslate">
    <span class="pre">
     ColumnTransformer
    </span>
   </code>
   and Text Features
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_linear-models.html">
   Lecture 7: Linear Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08_hyperparameter-optimization.html">
   Lecture 8: Hyperparameter Optimization and Optimization Bias
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_classification-metrics.html">
   Lecture 9: Classification Metrics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="10_regression-metrics.html">
   Lecture 10: Regression Evaluation Metrics
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Lecture 11: Ensembles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="13_feature-engineering-selection.html">
   Lecture 13: Feature engineering and feature selection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="14_k-means-clustering.html">
   Lecture 14: Clustering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="15_recommender-systems.html">
   Lecture 15: DBSCAN and Recommender Systems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="16_natural-language-processing.html">
   Lecture 16: Introduction to natural language processing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="17_intro_to_computer-vision.html">
   Lecture 17: Multi-class classification and introduction to computer vision
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="18_time-series.html">
   Lecture 18: Time series
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="19_survival-analysis.html">
   Lecture 19: Survival analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="20_ethics.html">
   Lecture 20: Ethics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="21_communication.html">
   Lecture 21: Communication
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Attribution
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../attribution.html">
   Attributions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../LICENSE.html">
   LICENSE
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Varada Kolhatkar, CPSC 330 2021-22<br>Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/lectures/11_ensembles.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/UBC-CS/cpsc330/master?urlpath=tree/lectures/11_ensembles.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports">
   Imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lecture-plan">
   Lecture plan
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#announcements">
     Announcements
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lecture-learning-objectives">
   Lecture learning objectives
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#motivation">
   Motivation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-netflix-prize">
     The Netflix prize
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tree-based-ensemble-models">
     Tree-based ensemble models
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tree-based-models">
     Tree-based models
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data">
     Data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#do-we-have-class-imbalance">
     Do we have class imbalance?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#baselines">
     Baselines
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#dummyclassifier-baseline">
       <code class="docutils literal notranslate">
        <span class="pre">
         DummyClassifier
        </span>
       </code>
       baseline
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#decisiontreeclassifier-baseline">
       <code class="docutils literal notranslate">
        <span class="pre">
         DecisionTreeClassifier
        </span>
       </code>
       baseline
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#random-forests">
   Random forests
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#general-idea">
     General idea
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#randomforestclassifier">
     <code class="docutils literal notranslate">
      <span class="pre">
       RandomForestClassifier
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-do-they-work">
     How do they work?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#inject-randomness-in-the-classifier-construction">
     Inject randomness in the classifier construction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-random-forests-classifier">
     The random forests classifier
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example">
     Example
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#some-important-hyperparameters">
     Some important hyperparameters:
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#random-forests-number-of-trees-n-estimators-and-the-fundamental-tradeoff">
     Random forests: number of trees (
     <code class="docutils literal notranslate">
      <span class="pre">
       n_estimators
      </span>
     </code>
     ) and the fundamental tradeoff
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#number-of-trees-and-fundamental-trade-off">
       Number of trees and fundamental trade-off
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#strengths-and-weaknesses">
     Strengths and weaknesses
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#weaknesses">
     Weaknesses
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#gradient-boosted-trees">
   Gradient boosted trees
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#important-hyperparameters">
     Important hyperparameters
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#xgboost">
     XGBoost
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#lightgbm">
     LightGBM
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#catboost">
     CatBoost
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-classifier-should-i-use">
     What classifier should I use?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#averaging">
   Averaging
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-kind-of-estimators-can-we-combine">
     What kind of estimators can we combine?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#stacking">
   Stacking
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#an-effective-strategy">
     An effective strategy
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   Summary
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#relevant-papers">
     Relevant papers
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#true-or-false-questions-on-random-forests-class-discussion">
   True or False questions on Random Forests (Class discussion)
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <p><img alt="" src="../_images/330-banner.png" /></p>
<div class="section" id="lecture-11-ensembles">
<h1>Lecture 11: Ensembles<a class="headerlink" href="#lecture-11-ensembles" title="Permalink to this headline">¶</a></h1>
<p>UBC 2020-21</p>
<p>Instructor: Varada Kolhatkar</p>
<blockquote>
The interests of truth require a diversity of opinions.    
<p>by John Stuart Mill</p>
</blockquote>
<div class="section" id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;code/.&quot;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">plotting_functions</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span><span class="p">,</span> <span class="n">make_column_transformer</span>
<span class="kn">from</span> <span class="nn">sklearn.dummy</span> <span class="kn">import</span> <span class="n">DummyClassifier</span><span class="p">,</span> <span class="n">DummyRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span><span class="p">,</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">GridSearchCV</span><span class="p">,</span>
    <span class="n">RandomizedSearchCV</span><span class="p">,</span>
    <span class="n">cross_val_score</span><span class="p">,</span>
    <span class="n">cross_validate</span><span class="p">,</span>
    <span class="n">train_test_split</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span><span class="p">,</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">OrdinalEncoder</span><span class="p">,</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span><span class="p">,</span> <span class="n">SVR</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="lecture-plan">
<h2>Lecture plan<a class="headerlink" href="#lecture-plan" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>A reminder to start recording.</strong></p></li>
<li><p>Announcements (~2 mins)</p></li>
<li><p>Live lecturing: Random forests (~20 mins)</p></li>
<li><p>Poll: Random forests (~10 mins)</p></li>
<li><p>Break (~5 mins)</p></li>
<li><p>Live lecturing: Averaging (~15 mins)</p></li>
<li><p>Live lecturing: Stacking (~15 mins)</p></li>
<li><p>Summary and wrap up (~2 mins)</p></li>
</ul>
<div class="section" id="announcements">
<h3>Announcements<a class="headerlink" href="#announcements" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Midterm coming up soon!</p></li>
<li><p>All homework solutions (except hw5) are available on Canvas.</p></li>
<li><p>Make use of office hours and tutorials.</p></li>
</ul>
</div>
</div>
<div class="section" id="lecture-learning-objectives">
<h2>Lecture learning objectives<a class="headerlink" href="#lecture-learning-objectives" title="Permalink to this headline">¶</a></h2>
<p>From this lecture, you will be able to</p>
<ul class="simple">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>’s <code class="docutils literal notranslate"><span class="pre">RandomForestClassifier</span></code> and explain its main hyperparameters.</p></li>
<li><p>Explain randomness in random forest algorithm.</p></li>
<li><p>Use other tree-based models such as as <code class="docutils literal notranslate"><span class="pre">XGBoost</span></code> and <code class="docutils literal notranslate"><span class="pre">LGBM</span></code>.</p></li>
<li><p>Employ ensemble classifier approaches, in particular model averaging and stacking.</p></li>
<li><p>Explain voting and stacking and the differences between them.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code> implementations of these ensemble methods.</p></li>
</ul>
</div>
<div class="section" id="motivation">
<h2>Motivation<a class="headerlink" href="#motivation" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>Ensembles</strong> are models that combine multiple machine learning models to create more powerful models.</p></li>
</ul>
<div class="section" id="the-netflix-prize">
<h3>The Netflix prize<a class="headerlink" href="#the-netflix-prize" title="Permalink to this headline">¶</a></h3>
<p><img alt="image.png" src="lectures/attachment:image.png" /></p>
<p><a class="reference external" href="https://netflixtechblog.com/netflix-recommendations-beyond-the-5-stars-part-1-55838468f429">Source</a></p>
<ul class="simple">
<li><p>Most of the winning solutions for Kaggle competitions involve some kind of ensembling. For example:</p></li>
</ul>
<center>
<img src="img/fraud_detection_kaggle.png" width="600" height="600">
</center>    <p>Key idea: Groups can often make better decisions than individuals, especially when group members are diverse enough.</p>
<p><a class="reference external" href="http://wisdomofcrowds.blogspot.com/2009/12/introduction-part-i.html">The Wisdom of Crowds</a></p>
<center>
<img src="img/wisdom_of_crowds.jpg" width="300" height="300">
</center>    </div>
<div class="section" id="tree-based-ensemble-models">
<h3>Tree-based ensemble models<a class="headerlink" href="#tree-based-ensemble-models" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>A number of ensemble models in ML literature.</p></li>
<li><p>Most successful ones on a variety of datasets are tree-based models.</p></li>
<li><p>We’ll briefly talk about two such models:</p>
<ul>
<li><p>Random forests</p></li>
<li><p>Gradient boosted trees</p></li>
</ul>
</li>
<li><p>We’ll also talk about averaging and stacking.</p></li>
</ul>
</div>
<div class="section" id="tree-based-models">
<h3>Tree-based models<a class="headerlink" href="#tree-based-models" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Decision trees models are</p>
<ul>
<li><p>Interpretable</p></li>
<li><p>They can capture non-linear relationships</p></li>
<li><p>They don’t require scaling of the data and theoretically can work with categorical features.</p></li>
</ul>
</li>
<li><p>But with a single decision trees are likely to overfit.</p></li>
</ul>
<ul class="simple">
<li><p>Key idea: Combine multiple trees to build stronger models.</p></li>
<li><p>These kinds of models are extremely popular in industry and machine learning competitions</p></li>
</ul>
</div>
<div class="section" id="data">
<h3>Data<a class="headerlink" href="#data" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Let’s work with <a class="reference external" href="https://www.kaggle.com/uciml/adult-census-income">the adult census data set</a>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adult_df_large</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/adult.csv&quot;</span><span class="p">)</span>
<span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">adult_df_large</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">train_df_nan</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>
<span class="n">test_df_nan</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>
<span class="n">train_df_nan</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>workclass</th>
      <th>fnlwgt</th>
      <th>education</th>
      <th>education.num</th>
      <th>marital.status</th>
      <th>occupation</th>
      <th>relationship</th>
      <th>race</th>
      <th>sex</th>
      <th>capital.gain</th>
      <th>capital.loss</th>
      <th>hours.per.week</th>
      <th>native.country</th>
      <th>income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5514</th>
      <td>26</td>
      <td>Private</td>
      <td>256263</td>
      <td>HS-grad</td>
      <td>9</td>
      <td>Never-married</td>
      <td>Craft-repair</td>
      <td>Not-in-family</td>
      <td>White</td>
      <td>Male</td>
      <td>0</td>
      <td>0</td>
      <td>25</td>
      <td>United-States</td>
      <td>&lt;=50K</td>
    </tr>
    <tr>
      <th>19777</th>
      <td>24</td>
      <td>Private</td>
      <td>170277</td>
      <td>HS-grad</td>
      <td>9</td>
      <td>Never-married</td>
      <td>Other-service</td>
      <td>Not-in-family</td>
      <td>White</td>
      <td>Female</td>
      <td>0</td>
      <td>0</td>
      <td>35</td>
      <td>United-States</td>
      <td>&lt;=50K</td>
    </tr>
    <tr>
      <th>10781</th>
      <td>36</td>
      <td>Private</td>
      <td>75826</td>
      <td>Bachelors</td>
      <td>13</td>
      <td>Divorced</td>
      <td>Adm-clerical</td>
      <td>Unmarried</td>
      <td>White</td>
      <td>Female</td>
      <td>0</td>
      <td>0</td>
      <td>40</td>
      <td>United-States</td>
      <td>&lt;=50K</td>
    </tr>
    <tr>
      <th>32240</th>
      <td>22</td>
      <td>State-gov</td>
      <td>24395</td>
      <td>Some-college</td>
      <td>10</td>
      <td>Married-civ-spouse</td>
      <td>Adm-clerical</td>
      <td>Wife</td>
      <td>White</td>
      <td>Female</td>
      <td>0</td>
      <td>0</td>
      <td>20</td>
      <td>United-States</td>
      <td>&lt;=50K</td>
    </tr>
    <tr>
      <th>9876</th>
      <td>31</td>
      <td>Local-gov</td>
      <td>356689</td>
      <td>Bachelors</td>
      <td>13</td>
      <td>Married-civ-spouse</td>
      <td>Prof-specialty</td>
      <td>Husband</td>
      <td>White</td>
      <td>Male</td>
      <td>0</td>
      <td>0</td>
      <td>40</td>
      <td>United-States</td>
      <td>&lt;=50K</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numeric_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="s2">&quot;fnlwgt&quot;</span><span class="p">,</span> <span class="s2">&quot;capital.gain&quot;</span><span class="p">,</span> <span class="s2">&quot;capital.loss&quot;</span><span class="p">,</span> <span class="s2">&quot;hours.per.week&quot;</span><span class="p">]</span>
<span class="n">categorical_features</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;workclass&quot;</span><span class="p">,</span>
    <span class="s2">&quot;marital.status&quot;</span><span class="p">,</span>
    <span class="s2">&quot;occupation&quot;</span><span class="p">,</span>
    <span class="s2">&quot;relationship&quot;</span><span class="p">,</span>
    <span class="s2">&quot;native.country&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">ordinal_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;education&quot;</span><span class="p">]</span>
<span class="n">binary_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">]</span>
<span class="n">drop_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;race&quot;</span><span class="p">,</span> <span class="s2">&quot;education.num&quot;</span><span class="p">]</span>
<span class="n">target_column</span> <span class="o">=</span> <span class="s2">&quot;income&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">education_levels</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Preschool&quot;</span><span class="p">,</span>
    <span class="s2">&quot;1st-4th&quot;</span><span class="p">,</span>
    <span class="s2">&quot;5th-6th&quot;</span><span class="p">,</span>
    <span class="s2">&quot;7th-8th&quot;</span><span class="p">,</span>
    <span class="s2">&quot;9th&quot;</span><span class="p">,</span>
    <span class="s2">&quot;10th&quot;</span><span class="p">,</span>
    <span class="s2">&quot;11th&quot;</span><span class="p">,</span>
    <span class="s2">&quot;12th&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HS-grad&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Prof-school&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Assoc-voc&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Assoc-acdm&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Some-college&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Bachelors&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Masters&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Doctorate&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">education_levels</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;education&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numeric_transformer</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">())</span>

<span class="n">ordinal_transformer</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">OrdinalEncoder</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="n">education_levels</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>

<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;missing&quot;</span><span class="p">),</span>
    <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">binary_transformer</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;missing&quot;</span><span class="p">),</span>
    <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="s2">&quot;if_binary&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span><span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">numeric_features</span><span class="p">),</span>
    <span class="p">(</span><span class="n">ordinal_transformer</span><span class="p">,</span> <span class="n">ordinal_features</span><span class="p">),</span>
    <span class="p">(</span><span class="n">binary_transformer</span><span class="p">,</span> <span class="n">binary_features</span><span class="p">),</span>
    <span class="p">(</span><span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;drop&quot;</span><span class="p">,</span> <span class="n">drop_features</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span> <span class="o">=</span> <span class="n">train_df_nan</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">target_column</span><span class="p">])</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">train_df_nan</span><span class="p">[</span><span class="n">target_column</span><span class="p">]</span>

<span class="n">X_test</span> <span class="o">=</span> <span class="n">test_df_nan</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">target_column</span><span class="p">])</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">test_df_nan</span><span class="p">[</span><span class="n">target_column</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="do-we-have-class-imbalance">
<h3>Do we have class imbalance?<a class="headerlink" href="#do-we-have-class-imbalance" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>There is class imbalance. But without any context, both classes seem equally important.</p></li>
<li><p>Let’s use accuracy as our metric.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df_nan</span><span class="p">[</span><span class="s2">&quot;income&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;=50K    0.757985
&gt;50K     0.242015
Name: income, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scoring_metric</span> <span class="o">=</span> <span class="s2">&quot;accuracy&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s store all the results in a dictionary called <code class="docutils literal notranslate"><span class="pre">results</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="baselines">
<h3>Baselines<a class="headerlink" href="#baselines" title="Permalink to this headline">¶</a></h3>
<div class="section" id="dummyclassifier-baseline">
<h4><code class="docutils literal notranslate"><span class="pre">DummyClassifier</span></code> baseline<a class="headerlink" href="#dummyclassifier-baseline" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dummy</span> <span class="o">=</span> <span class="n">DummyClassifier</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;stratified&quot;</span><span class="p">)</span>
<span class="n">results</span><span class="p">[</span><span class="s2">&quot;Dummy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">dummy</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring_metric</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="decisiontreeclassifier-baseline">
<h4><code class="docutils literal notranslate"><span class="pre">DecisionTreeClassifier</span></code> baseline<a class="headerlink" href="#decisiontreeclassifier-baseline" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Let’s try decision tree classifier on our data.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_dt</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">))</span>
<span class="n">results</span><span class="p">[</span><span class="s2">&quot;Decision tree&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">pipe_dt</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring_metric</span>
<span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Dummy</th>
      <td>0.007 (+/- 0.000)</td>
      <td>0.005 (+/- 0.000)</td>
      <td>0.631 (+/- 0.004)</td>
      <td>0.635 (+/- 0.003)</td>
    </tr>
    <tr>
      <th>Decision tree</th>
      <td>0.173 (+/- 0.003)</td>
      <td>0.019 (+/- 0.001)</td>
      <td>0.813 (+/- 0.003)</td>
      <td>1.000 (+/- 0.000)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Decision tree is clearly overfitting.</p>
<p><br><br><br><br></p>
</div>
</div>
</div>
<div class="section" id="random-forests">
<h2>Random forests<a class="headerlink" href="#random-forests" title="Permalink to this headline">¶</a></h2>
<div class="section" id="general-idea">
<h3>General idea<a class="headerlink" href="#general-idea" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>A single decision tree is likely to overfit</p></li>
<li><p>Use a collection of diverse decision trees</p></li>
<li><p>Each tree overfits on some part of the data but we can reduce overfitting by averaging the results</p>
<ul>
<li><p>can be shown mathematically</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="randomforestclassifier">
<h3><code class="docutils literal notranslate"><span class="pre">RandomForestClassifier</span></code><a class="headerlink" href="#randomforestclassifier" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Before understanding the details let’s first try it out.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="n">pipe_rf</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">results</span><span class="p">[</span><span class="s2">&quot;Random forests&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">pipe_rf</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring_metric</span>
<span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Dummy</th>
      <td>0.007 (+/- 0.000)</td>
      <td>0.005 (+/- 0.000)</td>
      <td>0.631 (+/- 0.004)</td>
      <td>0.635 (+/- 0.003)</td>
    </tr>
    <tr>
      <th>Decision tree</th>
      <td>0.173 (+/- 0.003)</td>
      <td>0.019 (+/- 0.001)</td>
      <td>0.813 (+/- 0.003)</td>
      <td>1.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>Random forests</th>
      <td>0.881 (+/- 0.605)</td>
      <td>0.046 (+/- 0.004)</td>
      <td>0.857 (+/- 0.004)</td>
      <td>1.000 (+/- 0.000)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The validation scores are better although it seems likes we are still overfitting.</p>
</div>
<div class="section" id="how-do-they-work">
<h3>How do they work?<a class="headerlink" href="#how-do-they-work" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Decide how many decision trees we want to build</p>
<ul>
<li><p>can control with <code class="docutils literal notranslate"><span class="pre">n_estimators</span></code> hyperparameter</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">fit</span></code> a diverse set of that many decision trees by <strong>injecting randomness</strong> in the classifier construction</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">predict</span></code> by voting (classification) or averaging (regression) of predictions given by individual models</p></li>
</ul>
</div>
<div class="section" id="inject-randomness-in-the-classifier-construction">
<h3>Inject randomness in the classifier construction<a class="headerlink" href="#inject-randomness-in-the-classifier-construction" title="Permalink to this headline">¶</a></h3>
<p>To ensure that the trees in the random forest are different we inject randomness in two ways:</p>
<ol class="simple">
<li><p>Data: <strong>Build each tree on a bootstrap sample</strong> (i.e., a sample drawn <strong>with replacement</strong> from the training set)</p></li>
<li><p>Features: <strong>At each node, select a random subset of features</strong> (controlled by <code class="docutils literal notranslate"><span class="pre">max_features</span></code> in <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>) and look for the best possible test involving one of these features</p></li>
</ol>
<p>An example of a bootstrap samples
Suppose this is your original dataset: [1,2,3,4]</p>
<ul class="simple">
<li><p>a sample drawn with replacement: [1,1,3,4]</p></li>
<li><p>a sample drawn with replacement: [3,2,2,2]</p></li>
<li><p>a sample drawn with replacement: [1,2,4,4]</p></li>
<li><p>…</p></li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>There is also something called <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.ExtraTreesClassifier.html"><code class="docutils literal notranslate"><span class="pre">ExtraTreesClassifier</span></code></a>, where we add more randomness by consider a random subset of features at each split and <strong>random threshold</strong>.</p>
</div>
</div>
<div class="section" id="the-random-forests-classifier">
<h3>The random forests classifier<a class="headerlink" href="#the-random-forests-classifier" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Create a collection (ensemble) of trees. Grow each tree on an independent bootstrap sample from the data.</p></li>
<li><p>At each node:</p>
<ul>
<li><p>Randomly select a subset of features out of all features (independently for each node).</p></li>
<li><p>Find the best split on the selected features.</p></li>
<li><p>Grow the trees to maximum depth.</p></li>
</ul>
</li>
<li><p>Prediction time</p>
<ul>
<li><p>Vote the trees to get predictions for new example.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Let’s create a random forest with 3 estimators.</p></li>
<li><p>I’m using <code class="docutils literal notranslate"><span class="pre">max_depth=2</span></code> for easy visualization.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_rf_demo</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="p">)</span> 
<span class="n">pipe_rf_demo</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Let’s get the feature names of transformed features.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">feature_names</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">numeric_features</span>
    <span class="o">+</span> <span class="n">ordinal_features</span>
    <span class="o">+</span> <span class="n">binary_features</span>
    <span class="o">+</span> <span class="nb">list</span><span class="p">(</span>
        <span class="n">pipe_rf_demo</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;columntransformer&quot;</span><span class="p">]</span>
        <span class="o">.</span><span class="n">named_transformers_</span><span class="p">[</span><span class="s2">&quot;pipeline-4&quot;</span><span class="p">]</span>
        <span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;onehotencoder&quot;</span><span class="p">]</span>
        <span class="o">.</span><span class="n">get_feature_names</span><span class="p">()</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">feature_names</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;age&#39;,
 &#39;fnlwgt&#39;,
 &#39;capital.gain&#39;,
 &#39;capital.loss&#39;,
 &#39;hours.per.week&#39;,
 &#39;education&#39;,
 &#39;sex&#39;,
 &#39;x0_Federal-gov&#39;,
 &#39;x0_Local-gov&#39;,
 &#39;x0_Never-worked&#39;]
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Let’s sample a test example.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_example</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Classes: &quot;</span><span class="p">,</span> <span class="n">pipe_rf_demo</span><span class="o">.</span><span class="n">classes_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Prediction by random forest: &quot;</span><span class="p">,</span> <span class="n">pipe_rf_demo</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_example</span><span class="p">))</span>
<span class="n">transformed_example</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_example</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">transformed_example</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">feature_names</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Classes:  [&#39;&lt;=50K&#39; &#39;&gt;50K&#39;]
Prediction by random forest:  [&#39;&lt;=50K&#39;]
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>age</th>
      <td>-1.069150</td>
    </tr>
    <tr>
      <th>fnlwgt</th>
      <td>-0.400933</td>
    </tr>
    <tr>
      <th>capital.gain</th>
      <td>-0.147166</td>
    </tr>
    <tr>
      <th>capital.loss</th>
      <td>-0.217680</td>
    </tr>
    <tr>
      <th>hours.per.week</th>
      <td>-1.663822</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>x4_Trinadad&amp;Tobago</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>x4_United-States</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>x4_Vietnam</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>x4_Yugoslavia</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>x4_missing</th>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
<p>86 rows × 1 columns</p>
</div></div></div>
</div>
<ul class="simple">
<li><p>We can look at different trees created by random forest.</p></li>
<li><p>Note that each tree looks at different set of features and slightly different data.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tree</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
    <span class="n">pipe_rf_demo</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;randomforestclassifier&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">estimators_</span>
<span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Tree&quot;</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">display_tree</span><span class="p">(</span><span class="n">feature_names</span><span class="p">,</span> <span class="n">tree</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;prediction&quot;</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">preprocessor</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_example</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tree 1
</pre></div>
</div>
<img alt="../_images/11_ensembles_52_1.svg" src="../_images/11_ensembles_52_1.svg" /><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>prediction [0.]


Tree 2
</pre></div>
</div>
<img alt="../_images/11_ensembles_52_3.svg" src="../_images/11_ensembles_52_3.svg" /><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>prediction [0.]


Tree 3
</pre></div>
</div>
<img alt="../_images/11_ensembles_52_5.svg" src="../_images/11_ensembles_52_5.svg" /><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>prediction [0.]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="some-important-hyperparameters">
<h3>Some important hyperparameters:<a class="headerlink" href="#some-important-hyperparameters" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">n_estimators</span></code>: number of decision trees (higher = more complexity)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_depth</span></code>: max depth of each decision tree (higher = more complexity)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_features</span></code>: the number of features you get to look at each split (higher = more complexity)</p></li>
</ul>
</div>
<div class="section" id="random-forests-number-of-trees-n-estimators-and-the-fundamental-tradeoff">
<h3>Random forests: number of trees (<code class="docutils literal notranslate"><span class="pre">n_estimators</span></code>) and the fundamental tradeoff<a class="headerlink" href="#random-forests-number-of-trees-n-estimators-and-the-fundamental-tradeoff" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">make_num_tree_plot</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">80</span><span class="o">/</span><span class="n">kr9rkqfj4w78h49djkz8yy9r0000gp</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_74603</span><span class="o">/</span><span class="mf">2496901075.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">make_num_tree_plot</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="n">preprocessor</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="p">)</span>

<span class="nn">~/CS/2021-22/330/cpsc330/lectures/code/./plotting_functions.py</span> in <span class="ni">make_num_tree_plot</span><span class="nt">(preprocessor, X_train, y_train, X_test, y_test, num_trees, scoring_metric)</span>
<span class="g g-Whitespace">    </span><span class="mi">390</span>     <span class="k">for</span> <span class="n">ntree</span> <span class="ow">in</span> <span class="n">num_trees</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">391</span>         <span class="n">model</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">ntree</span><span class="p">))</span>
<span class="ne">--&gt; </span><span class="mi">392</span>         <span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">393</span>             <span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring_metric</span>
<span class="g g-Whitespace">    </span><span class="mi">394</span>         <span class="p">)</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/utils/validation.py</span> in <span class="ni">inner_f</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">61</span>             <span class="n">extra_args</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_args</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">62</span>             <span class="k">if</span> <span class="n">extra_args</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">63</span>                 <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">64</span> 
<span class="g g-Whitespace">     </span><span class="mi">65</span>             <span class="c1"># extra_args &gt; 0</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/model_selection/_validation.py</span> in <span class="ni">cross_validate</span><span class="nt">(estimator, X, y, groups, scoring, cv, n_jobs, verbose, fit_params, pre_dispatch, return_train_score, return_estimator, error_score)</span>
<span class="g g-Whitespace">    </span><span class="mi">248</span>     <span class="n">parallel</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">249</span>                         <span class="n">pre_dispatch</span><span class="o">=</span><span class="n">pre_dispatch</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">250</span>     <span class="n">results</span> <span class="o">=</span> <span class="n">parallel</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">251</span>         <span class="n">delayed</span><span class="p">(</span><span class="n">_fit_and_score</span><span class="p">)(</span>
<span class="g g-Whitespace">    </span><span class="mi">252</span>             <span class="n">clone</span><span class="p">(</span><span class="n">estimator</span><span class="p">),</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">scorers</span><span class="p">,</span> <span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/joblib/parallel.py</span> in <span class="ni">__call__</span><span class="nt">(self, iterable)</span>
<span class="g g-Whitespace">   </span><span class="mi">1044</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">_iterating</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_iterator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">   </span><span class="mi">1045</span> 
<span class="ne">-&gt; </span><span class="mi">1046</span>             <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_one_batch</span><span class="p">(</span><span class="n">iterator</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1047</span>                 <span class="k">pass</span>
<span class="g g-Whitespace">   </span><span class="mi">1048</span> 

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/joblib/parallel.py</span> in <span class="ni">dispatch_one_batch</span><span class="nt">(self, iterator)</span>
<span class="g g-Whitespace">    </span><span class="mi">859</span>                 <span class="k">return</span> <span class="kc">False</span>
<span class="g g-Whitespace">    </span><span class="mi">860</span>             <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">861</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span>                 <span class="k">return</span> <span class="kc">True</span>
<span class="g g-Whitespace">    </span><span class="mi">863</span> 

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/joblib/parallel.py</span> in <span class="ni">_dispatch</span><span class="nt">(self, batch)</span>
<span class="g g-Whitespace">    </span><span class="mi">777</span>         <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">778</span>             <span class="n">job_idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">779</span>             <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">cb</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">780</span>             <span class="c1"># A job can complete so quickly than its callback is</span>
<span class="g g-Whitespace">    </span><span class="mi">781</span>             <span class="c1"># called before we get here, causing self._jobs to</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/joblib/_parallel_backends.py</span> in <span class="ni">apply_async</span><span class="nt">(self, func, callback)</span>
<span class="g g-Whitespace">    </span><span class="mi">206</span>     <span class="k">def</span> <span class="nf">apply_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">207</span>         <span class="sd">&quot;&quot;&quot;Schedule a func to be run&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">208</span>         <span class="n">result</span> <span class="o">=</span> <span class="n">ImmediateResult</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">209</span>         <span class="k">if</span> <span class="n">callback</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">210</span>             <span class="n">callback</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/joblib/_parallel_backends.py</span> in <span class="ni">__init__</span><span class="nt">(self, batch)</span>
<span class="g g-Whitespace">    </span><span class="mi">570</span>         <span class="c1"># Don&#39;t delay the application, to avoid keeping the input</span>
<span class="g g-Whitespace">    </span><span class="mi">571</span>         <span class="c1"># arguments in memory</span>
<span class="ne">--&gt; </span><span class="mi">572</span>         <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">batch</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">573</span> 
<span class="g g-Whitespace">    </span><span class="mi">574</span>     <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/joblib/parallel.py</span> in <span class="ni">__call__</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">260</span>         <span class="c1"># change the default number of processes to -1</span>
<span class="g g-Whitespace">    </span><span class="mi">261</span>         <span class="k">with</span> <span class="n">parallel_backend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_jobs</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">262</span>             <span class="k">return</span> <span class="p">[</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">263</span>                     <span class="k">for</span> <span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">264</span> 

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/joblib/parallel.py</span> in <span class="ni">&lt;listcomp&gt;</span><span class="nt">(.0)</span>
<span class="g g-Whitespace">    </span><span class="mi">260</span>         <span class="c1"># change the default number of processes to -1</span>
<span class="g g-Whitespace">    </span><span class="mi">261</span>         <span class="k">with</span> <span class="n">parallel_backend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_jobs</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">262</span>             <span class="k">return</span> <span class="p">[</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">263</span>                     <span class="k">for</span> <span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">264</span> 

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/utils/fixes.py</span> in <span class="ni">__call__</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">220</span>     <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">221</span>         <span class="k">with</span> <span class="n">config_context</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">222</span>             <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/model_selection/_validation.py</span> in <span class="ni">_fit_and_score</span><span class="nt">(estimator, X, y, scorer, train, test, verbose, parameters, fit_params, return_train_score, return_parameters, return_n_test_samples, return_times, return_estimator, split_progress, candidate_progress, error_score)</span>
<span class="g g-Whitespace">    </span><span class="mi">596</span>             <span class="n">estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">597</span>         <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">598</span>             <span class="n">estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">599</span> 
<span class="g g-Whitespace">    </span><span class="mi">600</span>     <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/pipeline.py</span> in <span class="ni">fit</span><span class="nt">(self, X, y, **fit_params)</span>
<span class="g g-Whitespace">    </span><span class="mi">344</span>             <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_final_estimator</span> <span class="o">!=</span> <span class="s1">&#39;passthrough&#39;</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">345</span>                 <span class="n">fit_params_last_step</span> <span class="o">=</span> <span class="n">fit_params_steps</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<span class="ne">--&gt; </span><span class="mi">346</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">_final_estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xt</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params_last_step</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">347</span> 
<span class="g g-Whitespace">    </span><span class="mi">348</span>         <span class="k">return</span> <span class="bp">self</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/ensemble/_forest.py</span> in <span class="ni">fit</span><span class="nt">(self, X, y, sample_weight)</span>
<span class="g g-Whitespace">    </span><span class="mi">385</span>             <span class="c1"># parallel_backend contexts set at a higher level,</span>
<span class="g g-Whitespace">    </span><span class="mi">386</span>             <span class="c1"># since correctness does not rely on using threads.</span>
<span class="ne">--&gt; </span><span class="mi">387</span>             <span class="n">trees</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_jobs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">388</span>                              <span class="o">**</span><span class="n">_joblib_parallel_args</span><span class="p">(</span><span class="n">prefer</span><span class="o">=</span><span class="s1">&#39;threads&#39;</span><span class="p">))(</span>
<span class="g g-Whitespace">    </span><span class="mi">389</span>                 <span class="n">delayed</span><span class="p">(</span><span class="n">_parallel_build_trees</span><span class="p">)(</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/joblib/parallel.py</span> in <span class="ni">__call__</span><span class="nt">(self, iterable)</span>
<span class="g g-Whitespace">   </span><span class="mi">1044</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">_iterating</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_iterator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">   </span><span class="mi">1045</span> 
<span class="ne">-&gt; </span><span class="mi">1046</span>             <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_one_batch</span><span class="p">(</span><span class="n">iterator</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1047</span>                 <span class="k">pass</span>
<span class="g g-Whitespace">   </span><span class="mi">1048</span> 

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/joblib/parallel.py</span> in <span class="ni">dispatch_one_batch</span><span class="nt">(self, iterator)</span>
<span class="g g-Whitespace">    </span><span class="mi">859</span>                 <span class="k">return</span> <span class="kc">False</span>
<span class="g g-Whitespace">    </span><span class="mi">860</span>             <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">861</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span>                 <span class="k">return</span> <span class="kc">True</span>
<span class="g g-Whitespace">    </span><span class="mi">863</span> 

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/joblib/parallel.py</span> in <span class="ni">_dispatch</span><span class="nt">(self, batch)</span>
<span class="g g-Whitespace">    </span><span class="mi">777</span>         <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">778</span>             <span class="n">job_idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">779</span>             <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">cb</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">780</span>             <span class="c1"># A job can complete so quickly than its callback is</span>
<span class="g g-Whitespace">    </span><span class="mi">781</span>             <span class="c1"># called before we get here, causing self._jobs to</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/joblib/_parallel_backends.py</span> in <span class="ni">apply_async</span><span class="nt">(self, func, callback)</span>
<span class="g g-Whitespace">    </span><span class="mi">206</span>     <span class="k">def</span> <span class="nf">apply_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">207</span>         <span class="sd">&quot;&quot;&quot;Schedule a func to be run&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">208</span>         <span class="n">result</span> <span class="o">=</span> <span class="n">ImmediateResult</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">209</span>         <span class="k">if</span> <span class="n">callback</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">210</span>             <span class="n">callback</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/joblib/_parallel_backends.py</span> in <span class="ni">__init__</span><span class="nt">(self, batch)</span>
<span class="g g-Whitespace">    </span><span class="mi">570</span>         <span class="c1"># Don&#39;t delay the application, to avoid keeping the input</span>
<span class="g g-Whitespace">    </span><span class="mi">571</span>         <span class="c1"># arguments in memory</span>
<span class="ne">--&gt; </span><span class="mi">572</span>         <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">batch</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">573</span> 
<span class="g g-Whitespace">    </span><span class="mi">574</span>     <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/joblib/parallel.py</span> in <span class="ni">__call__</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">260</span>         <span class="c1"># change the default number of processes to -1</span>
<span class="g g-Whitespace">    </span><span class="mi">261</span>         <span class="k">with</span> <span class="n">parallel_backend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_jobs</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">262</span>             <span class="k">return</span> <span class="p">[</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">263</span>                     <span class="k">for</span> <span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">264</span> 

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/joblib/parallel.py</span> in <span class="ni">&lt;listcomp&gt;</span><span class="nt">(.0)</span>
<span class="g g-Whitespace">    </span><span class="mi">260</span>         <span class="c1"># change the default number of processes to -1</span>
<span class="g g-Whitespace">    </span><span class="mi">261</span>         <span class="k">with</span> <span class="n">parallel_backend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_jobs</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">262</span>             <span class="k">return</span> <span class="p">[</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">263</span>                     <span class="k">for</span> <span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">264</span> 

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/utils/fixes.py</span> in <span class="ni">__call__</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">220</span>     <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">221</span>         <span class="k">with</span> <span class="n">config_context</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">222</span>             <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/ensemble/_forest.py</span> in <span class="ni">_parallel_build_trees</span><span class="nt">(tree, forest, X, y, sample_weight, tree_idx, n_trees, verbose, class_weight, n_samples_bootstrap)</span>
<span class="g g-Whitespace">    </span><span class="mi">167</span>                                                         <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">168</span> 
<span class="ne">--&gt; </span><span class="mi">169</span>         <span class="n">tree</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">curr_sample_weight</span><span class="p">,</span> <span class="n">check_input</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">170</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">171</span>         <span class="n">tree</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">sample_weight</span><span class="p">,</span> <span class="n">check_input</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/tree/_classes.py</span> in <span class="ni">fit</span><span class="nt">(self, X, y, sample_weight, check_input, X_idx_sorted)</span>
<span class="g g-Whitespace">    </span><span class="mi">901</span>         <span class="s2">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">902</span><span class="s2"> </span>
<span class="ne">--&gt; </span><span class="mi">903</span><span class="s2">         super().fit(</span>
<span class="g g-Whitespace">    </span><span class="mi">904</span><span class="s2">             X, y,</span>
<span class="g g-Whitespace">    </span><span class="mi">905</span><span class="s2">             sample_weight=sample_weight,</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/tree/_classes.py</span> in <span class="ni">fit</span><span class="nt">(self, X, y, sample_weight, check_input, X_idx_sorted)</span>
<span class="g g-Whitespace">    </span><span class="mi">392</span><span class="s2">                                            min_impurity_split)</span>
<span class="g g-Whitespace">    </span><span class="mi">393</span><span class="s2"> </span>
<span class="ne">--&gt; </span><span class="mi">394</span><span class="s2">         builder.build(self.tree_, X, y, sample_weight)</span>
<span class="g g-Whitespace">    </span><span class="mi">395</span><span class="s2"> </span>
<span class="g g-Whitespace">    </span><span class="mi">396</span><span class="s2">         if self.n_outputs_ == 1 and is_classifier(self):</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<div class="section" id="number-of-trees-and-fundamental-trade-off">
<h4>Number of trees and fundamental trade-off<a class="headerlink" href="#number-of-trees-and-fundamental-trade-off" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Above: seems like we’re beating the fundamental “tradeoff” by increasing training score and not decreasing validation score much.</p></li>
<li><p>This is the promise of ensembles, though it’s not guaranteed to work so nicely.</p></li>
</ul>
<p>More trees are always better! We pick less trees for speed.</p>
</div>
</div>
<div class="section" id="strengths-and-weaknesses">
<h3>Strengths and weaknesses<a class="headerlink" href="#strengths-and-weaknesses" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Usually one of the best performing off-the-shelf classifiers without heavy tuning of hyperparameters</p></li>
<li><p>Don’t require scaling of data</p></li>
<li><p>Less likely to overfit</p></li>
<li><p>Slower than decision trees because we are fitting multiple trees but can easily parallelize training because all trees are independent of each other</p></li>
<li><p>In general, able to capture a much broader picture of the data compared to a single decision tree.</p></li>
</ul>
</div>
<div class="section" id="weaknesses">
<h3>Weaknesses<a class="headerlink" href="#weaknesses" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Require more memory</p></li>
<li><p>Hard to interpret</p></li>
<li><p>Tend not to perform well on high dimensional sparse data such as text data</p></li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Make sure to set the <code class="docutils literal notranslate"><span class="pre">random_state</span></code> for reproducibility. Changing the <code class="docutils literal notranslate"><span class="pre">random_state</span></code> can have a big impact on the model and the results due to the random nature of these models. Having more trees can get you a more robust estimate.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://www.stat.berkeley.edu/~breiman/randomforest2001.pdf">The original random forests paper</a> by Leo Breiman.</p>
</div>
<p><br><br><br><br></p>
</div>
</div>
<div class="section" id="gradient-boosted-trees">
<h2>Gradient boosted trees<a class="headerlink" href="#gradient-boosted-trees" title="Permalink to this headline">¶</a></h2>
<p>Another popular and effective class of tree-based models is gradient boosted trees.</p>
<ul class="simple">
<li><p>No randomization.</p></li>
<li><p>The key idea is combining many simple models called weak learners to create a strong learner.</p></li>
<li><p>They combine multiple shallow (depth 1 to 5) decision trees</p></li>
<li><p>They build trees in a serial manner, where each tree tries to correct the mistakes of the previous one.</p></li>
</ul>
<div class="section" id="important-hyperparameters">
<h3>Important hyperparameters<a class="headerlink" href="#important-hyperparameters" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">n_estimators</span></code></p>
<ul>
<li><p>control the number of trees to build</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">learning_rate</span></code></p>
<ul>
<li><p>controls how strongly each tree tries to correct the mistakes of the previous trees</p></li>
<li><p>higher learning rate means each tree can make stronger corrections, which means more complex model</p></li>
</ul>
</li>
</ul>
<p>We’ll not go into the details. We’ll look at brief examples of using the following three gradient boosted tree models.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://xgboost.readthedocs.io/en/latest/">XGBoost</a></p></li>
<li><p><a class="reference external" href="https://lightgbm.readthedocs.io/en/latest/Python-Intro.html">LightGBM</a></p></li>
<li><p><a class="reference external" href="https://catboost.ai/docs/concepts/python-quickstart.html">CatBoost</a></p></li>
</ul>
</div>
<div class="section" id="xgboost">
<h3><a class="reference external" href="https://xgboost.ai/about">XGBoost</a><a class="headerlink" href="#xgboost" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Not part of <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> but has similar interface.</p></li>
<li><p>Install it in your conda environment: <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">-c</span> <span class="pre">conda-forge</span> <span class="pre">xgboost</span></code></p></li>
<li><p>Supports missing values</p></li>
<li><p>GPU training, networked parallel training</p></li>
<li><p>Supports sparse data</p></li>
<li><p>Typically better scores than random forests</p></li>
</ul>
</div>
<div class="section" id="lightgbm">
<h3><a class="reference external" href="https://lightgbm.readthedocs.io/">LightGBM</a><a class="headerlink" href="#lightgbm" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Not part of <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> but has similar interface.</p></li>
<li><p>Install it in your conda environment: <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">-c</span> <span class="pre">conda-forge</span> <span class="pre">lightgbm</span></code></p></li>
<li><p>Small model size</p></li>
<li><p>Faster</p></li>
<li><p>Typically better scores than random forests</p></li>
</ul>
</div>
<div class="section" id="catboost">
<h3><a class="reference external" href="https://catboost.ai/">CatBoost</a><a class="headerlink" href="#catboost" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Not part of <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> but has similar interface.</p></li>
<li><p>Install it in your conda environment: <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">-c</span> <span class="pre">conda-forge</span> <span class="pre">catboost</span></code></p></li>
<li><p>Usually better scores but slower compared to <code class="docutils literal notranslate"><span class="pre">XGBoost</span></code> and <code class="docutils literal notranslate"><span class="pre">LightGBM</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">catboost</span> <span class="kn">import</span> <span class="n">CatBoostClassifier</span>
<span class="kn">from</span> <span class="nn">lightgbm.sklearn</span> <span class="kn">import</span> <span class="n">LGBMClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>

<span class="n">pipe_lr</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">pipe_dt</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">))</span>
<span class="n">pipe_rf</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">))</span>
<span class="n">pipe_xgb</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">eval_metric</span><span class="o">=</span><span class="s2">&quot;logloss&quot;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">pipe_lgbm</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">LGBMClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">))</span>
<span class="n">pipe_catboost</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span> <span class="n">CatBoostClassifier</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">classifiers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;logistic regression&quot;</span><span class="p">:</span> <span class="n">pipe_lr</span><span class="p">,</span>
    <span class="s2">&quot;decision tree&quot;</span><span class="p">:</span> <span class="n">pipe_dt</span><span class="p">,</span>
    <span class="s2">&quot;random forest&quot;</span><span class="p">:</span> <span class="n">pipe_rf</span><span class="p">,</span>
    <span class="s2">&quot;XGBoost&quot;</span><span class="p">:</span> <span class="n">pipe_xgb</span><span class="p">,</span>
    <span class="s2">&quot;LightGBM&quot;</span><span class="p">:</span> <span class="n">pipe_lgbm</span><span class="p">,</span>
    <span class="s2">&quot;CatBoost&quot;</span><span class="p">:</span> <span class="n">pipe_catboost</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dummy</span> <span class="o">=</span> <span class="n">DummyClassifier</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;stratified&quot;</span><span class="p">)</span>
<span class="n">results</span><span class="p">[</span><span class="s2">&quot;Dummy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">dummy</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring_metric</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span> <span class="ow">in</span> <span class="n">classifiers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">results</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
        <span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring_metric</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Dummy</th>
      <td>0.007 (+/- 0.000)</td>
      <td>0.005 (+/- 0.000)</td>
      <td>0.636 (+/- 0.007)</td>
      <td>0.633 (+/- 0.004)</td>
    </tr>
    <tr>
      <th>logistic regression</th>
      <td>0.748 (+/- 0.036)</td>
      <td>0.019 (+/- 0.000)</td>
      <td>0.850 (+/- 0.006)</td>
      <td>0.851 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>decision tree</th>
      <td>0.169 (+/- 0.002)</td>
      <td>0.019 (+/- 0.001)</td>
      <td>0.813 (+/- 0.003)</td>
      <td>1.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>random forest</th>
      <td>1.438 (+/- 0.016)</td>
      <td>0.093 (+/- 0.001)</td>
      <td>0.857 (+/- 0.004)</td>
      <td>1.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>XGBoost</th>
      <td>1.002 (+/- 0.034)</td>
      <td>0.028 (+/- 0.000)</td>
      <td>0.870 (+/- 0.003)</td>
      <td>0.909 (+/- 0.002)</td>
    </tr>
    <tr>
      <th>LightGBM</th>
      <td>0.181 (+/- 0.009)</td>
      <td>0.026 (+/- 0.001)</td>
      <td>0.871 (+/- 0.004)</td>
      <td>0.892 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>CatBoost</th>
      <td>5.945 (+/- 0.088)</td>
      <td>0.094 (+/- 0.001)</td>
      <td>0.872 (+/- 0.003)</td>
      <td>0.900 (+/- 0.001)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Some observations</strong></p>
<ul class="simple">
<li><p>Keep in mind all these results are with default hyperparameters</p></li>
<li><p>Ideally we would carry out hyperparameter optimization for all of them and then compare the results.</p></li>
<li><p>We are using a particular scoring metric (accuracy in this case)</p></li>
<li><p>We are scaling numeric features but it shouldn’t matter for these tree-based models.</p></li>
<li><p>Look at the std. Doesn’t look very high.</p>
<ul>
<li><p>The scores look more or less stable.</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Dummy</th>
      <td>0.007 (+/- 0.000)</td>
      <td>0.005 (+/- 0.000)</td>
      <td>0.636 (+/- 0.007)</td>
      <td>0.633 (+/- 0.004)</td>
    </tr>
    <tr>
      <th>logistic regression</th>
      <td>0.748 (+/- 0.036)</td>
      <td>0.019 (+/- 0.000)</td>
      <td>0.850 (+/- 0.006)</td>
      <td>0.851 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>decision tree</th>
      <td>0.169 (+/- 0.002)</td>
      <td>0.019 (+/- 0.001)</td>
      <td>0.813 (+/- 0.003)</td>
      <td>1.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>random forest</th>
      <td>1.438 (+/- 0.016)</td>
      <td>0.093 (+/- 0.001)</td>
      <td>0.857 (+/- 0.004)</td>
      <td>1.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>XGBoost</th>
      <td>1.002 (+/- 0.034)</td>
      <td>0.028 (+/- 0.000)</td>
      <td>0.870 (+/- 0.003)</td>
      <td>0.909 (+/- 0.002)</td>
    </tr>
    <tr>
      <th>LightGBM</th>
      <td>0.181 (+/- 0.009)</td>
      <td>0.026 (+/- 0.001)</td>
      <td>0.871 (+/- 0.004)</td>
      <td>0.892 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>CatBoost</th>
      <td>5.945 (+/- 0.088)</td>
      <td>0.094 (+/- 0.001)</td>
      <td>0.872 (+/- 0.003)</td>
      <td>0.900 (+/- 0.001)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Decision trees and random forests overfit</p>
<ul>
<li><p>Other models do not seem to overfit much.</p></li>
</ul>
</li>
<li><p>Fit times</p>
<ul>
<li><p>Decision trees are fast but not very accurate</p></li>
<li><p>LightGBM is faster than decision trees and more accurate!</p></li>
<li><p>CatBoost fit time is highest followed by random forests.</p></li>
<li><p>There is not much difference between the validation scores of XGBoost, LightGBM, and CatBoost but it is about 48x slower than LightGBM!</p></li>
<li><p>XGBoost and LightGBM are faster and more accurate than random forest!</p></li>
</ul>
</li>
<li><p>Scores times</p>
<ul>
<li><p>Prediction times are much smaller in all cases.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="what-classifier-should-i-use">
<h3>What classifier should I use?<a class="headerlink" href="#what-classifier-should-i-use" title="Permalink to this headline">¶</a></h3>
<p><strong>Simple answer</strong></p>
<ul class="simple">
<li><p>Whichever gets the highest CV score making sure that you’re not overusing the validation set.</p></li>
</ul>
<p><strong>Interpretability</strong></p>
<ul class="simple">
<li><p>This is an area of growing interest and concern in ML.</p></li>
<li><p>How important is interpretability for you?</p></li>
<li><p>In the next class we’ll talk about interpretability of non-linear models.</p></li>
</ul>
<p><strong>Speed/code maintenance</strong></p>
<ul class="simple">
<li><p>Other considerations could be speed (fit and/or predict), maintainability of the code.</p></li>
</ul>
<p>Finally, you could use all of them!</p>
<p><br><br><br><br></p>
</div>
</div>
<div class="section" id="averaging">
<h2>Averaging<a class="headerlink" href="#averaging" title="Permalink to this headline">¶</a></h2>
<p>Earlier we looked at a bunch of classifiers:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">classifiers</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_keys([&#39;logistic regression&#39;, &#39;decision tree&#39;, &#39;random forest&#39;, &#39;XGBoost&#39;, &#39;LightGBM&#39;, &#39;CatBoost&#39;])
</pre></div>
</div>
</div>
</div>
<p>What if we use all these models and let them vote during prediction time?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">VotingClassifier</span>

<span class="n">averaging_model</span> <span class="o">=</span> <span class="n">VotingClassifier</span><span class="p">(</span>
    <span class="nb">list</span><span class="p">(</span><span class="n">classifiers</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="n">voting</span><span class="o">=</span><span class="s2">&quot;soft&quot;</span>
<span class="p">)</span>  <span class="c1"># need the list() here for cross_val to work!</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">set_config</span>

<span class="n">set_config</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="s2">&quot;diagram&quot;</span><span class="p">)</span> <span class="c1"># global setting </span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">averaging_model</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-9726f09c-4e47-4038-9db5-dcda00f30639 {color: black;background-color: white;}#sk-9726f09c-4e47-4038-9db5-dcda00f30639 pre{padding: 0;}#sk-9726f09c-4e47-4038-9db5-dcda00f30639 div.sk-toggleable {background-color: white;}#sk-9726f09c-4e47-4038-9db5-dcda00f30639 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}#sk-9726f09c-4e47-4038-9db5-dcda00f30639 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-9726f09c-4e47-4038-9db5-dcda00f30639 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-9726f09c-4e47-4038-9db5-dcda00f30639 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-9726f09c-4e47-4038-9db5-dcda00f30639 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-9726f09c-4e47-4038-9db5-dcda00f30639 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-9726f09c-4e47-4038-9db5-dcda00f30639 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-9726f09c-4e47-4038-9db5-dcda00f30639 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}#sk-9726f09c-4e47-4038-9db5-dcda00f30639 div.sk-estimator:hover {background-color: #d4ebff;}#sk-9726f09c-4e47-4038-9db5-dcda00f30639 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-9726f09c-4e47-4038-9db5-dcda00f30639 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-9726f09c-4e47-4038-9db5-dcda00f30639 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-9726f09c-4e47-4038-9db5-dcda00f30639 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}#sk-9726f09c-4e47-4038-9db5-dcda00f30639 div.sk-item {z-index: 1;}#sk-9726f09c-4e47-4038-9db5-dcda00f30639 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-9726f09c-4e47-4038-9db5-dcda00f30639 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-9726f09c-4e47-4038-9db5-dcda00f30639 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-9726f09c-4e47-4038-9db5-dcda00f30639 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-9726f09c-4e47-4038-9db5-dcda00f30639 div.sk-parallel-item:only-child::after {width: 0;}#sk-9726f09c-4e47-4038-9db5-dcda00f30639 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}#sk-9726f09c-4e47-4038-9db5-dcda00f30639 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-9726f09c-4e47-4038-9db5-dcda00f30639 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-9726f09c-4e47-4038-9db5-dcda00f30639 div.sk-container {display: inline-block;position: relative;}</style><div id="sk-9726f09c-4e47-4038-9db5-dcda00f30639" class"sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="1e9f5652-7dca-4aa3-9f7b-1327548a9ce0" type="checkbox" ><label class="sk-toggleable__label" for="1e9f5652-7dca-4aa3-9f7b-1327548a9ce0">VotingClassifier</label><div class="sk-toggleable__content"><pre>VotingClassifier(estimators=[('logistic regression',
                              Pipeline(steps=[('columntransformer',
                                               ColumnTransformer(transformers=[('pipeline-1',
                                                                                Pipeline(steps=[('standardscaler',
                                                                                                 StandardScaler())]),
                                                                                ['age',
                                                                                 'fnlwgt',
                                                                                 'capital.gain',
                                                                                 'capital.loss',
                                                                                 'hours.per.week']),
                                                                               ('pipeline-2',
                                                                                Pipeline(steps=[('ordinalencoder',
                                                                                                 OrdinalEncoder(categories=[['Preschool',
                                                                                                                             '1st-4th'...
                                                                                Pipeline(steps=[('simpleimputer',
                                                                                                 SimpleImputer(fill_value='missing',
                                                                                                               strategy='constant')),
                                                                                                ('onehotencoder',
                                                                                                 OneHotEncoder(handle_unknown='ignore',
                                                                                                               sparse=False))]),
                                                                                ['workclass',
                                                                                 'marital.status',
                                                                                 'occupation',
                                                                                 'relationship',
                                                                                 'native.country']),
                                                                               ('drop',
                                                                                'drop',
                                                                                ['race',
                                                                                 'education.num'])])),
                                              ('catboostclassifier',
                                               <catboost.core.CatBoostClassifier object at 0x13a1f8bb0>)]))],
                 voting='soft')</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><label>logistic regression</label></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="eeedb803-05a9-484e-ad32-1bf9cccb52f1" type="checkbox" ><label class="sk-toggleable__label" for="eeedb803-05a9-484e-ad32-1bf9cccb52f1">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline-1',
                                 Pipeline(steps=[('standardscaler',
                                                  StandardScaler())]),
                                 ['age', 'fnlwgt', 'capital.gain',
                                  'capital.loss', 'hours.per.week']),
                                ('pipeline-2',
                                 Pipeline(steps=[('ordinalencoder',
                                                  OrdinalEncoder(categories=[['Preschool',
                                                                              '1st-4th',
                                                                              '5th-6th',
                                                                              '7th-8th',
                                                                              '9th',
                                                                              '10th',
                                                                              '11th',
                                                                              '12th',
                                                                              'HS-grad',
                                                                              'Prof-school',
                                                                              'Assoc-voc',
                                                                              'Ass...
                                                  OneHotEncoder(drop='if_binary',
                                                                dtype=<class 'int'>))]),
                                 ['sex']),
                                ('pipeline-4',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder(handle_unknown='ignore',
                                                                sparse=False))]),
                                 ['workclass', 'marital.status', 'occupation',
                                  'relationship', 'native.country']),
                                ('drop', 'drop', ['race', 'education.num'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="afab47fb-a0c4-45f3-b298-ef5c16d43e8e" type="checkbox" ><label class="sk-toggleable__label" for="afab47fb-a0c4-45f3-b298-ef5c16d43e8e">pipeline-1</label><div class="sk-toggleable__content"><pre>['age', 'fnlwgt', 'capital.gain', 'capital.loss', 'hours.per.week']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="498a1ded-7f96-49ad-b656-6b19362e2202" type="checkbox" ><label class="sk-toggleable__label" for="498a1ded-7f96-49ad-b656-6b19362e2202">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b1407517-011a-4622-b927-bebbfa12f3d2" type="checkbox" ><label class="sk-toggleable__label" for="b1407517-011a-4622-b927-bebbfa12f3d2">pipeline-2</label><div class="sk-toggleable__content"><pre>['education']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8a117de8-b37a-4e32-98b0-633237b42ce2" type="checkbox" ><label class="sk-toggleable__label" for="8a117de8-b37a-4e32-98b0-633237b42ce2">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(categories=[['Preschool', '1st-4th', '5th-6th', '7th-8th', '9th',
                            '10th', '11th', '12th', 'HS-grad', 'Prof-school',
                            'Assoc-voc', 'Assoc-acdm', 'Some-college',
                            'Bachelors', 'Masters', 'Doctorate']],
               dtype=<class 'int'>)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="44d7be3c-6565-4f1f-9458-24e9866296d5" type="checkbox" ><label class="sk-toggleable__label" for="44d7be3c-6565-4f1f-9458-24e9866296d5">pipeline-3</label><div class="sk-toggleable__content"><pre>['sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="aabf1ef3-9650-4e01-bbd3-aee8a5ca97df" type="checkbox" ><label class="sk-toggleable__label" for="aabf1ef3-9650-4e01-bbd3-aee8a5ca97df">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="92d038c7-dc62-4fc2-8927-ca9ea33c89fa" type="checkbox" ><label class="sk-toggleable__label" for="92d038c7-dc62-4fc2-8927-ca9ea33c89fa">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(drop='if_binary', dtype=<class 'int'>)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a0b647ab-0ea9-4859-8368-eb3c8b8d20d2" type="checkbox" ><label class="sk-toggleable__label" for="a0b647ab-0ea9-4859-8368-eb3c8b8d20d2">pipeline-4</label><div class="sk-toggleable__content"><pre>['workclass', 'marital.status', 'occupation', 'relationship', 'native.country']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="efb51fb2-6fd5-4b1d-a43d-53ad5445acd5" type="checkbox" ><label class="sk-toggleable__label" for="efb51fb2-6fd5-4b1d-a43d-53ad5445acd5">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="15dc5327-402a-4679-aa76-5f91999fd2f5" type="checkbox" ><label class="sk-toggleable__label" for="15dc5327-402a-4679-aa76-5f91999fd2f5">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown='ignore', sparse=False)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="615acc56-7889-461f-ab19-cdca777fe49c" type="checkbox" ><label class="sk-toggleable__label" for="615acc56-7889-461f-ab19-cdca777fe49c">drop</label><div class="sk-toggleable__content"><pre>['race', 'education.num']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a13de9c6-052b-48d6-ab3b-52250bcc40ad" type="checkbox" ><label class="sk-toggleable__label" for="a13de9c6-052b-48d6-ab3b-52250bcc40ad">drop</label><div class="sk-toggleable__content"><pre>drop</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="9e65f1c9-8945-4011-8ada-33a686756add" type="checkbox" ><label class="sk-toggleable__label" for="9e65f1c9-8945-4011-8ada-33a686756add">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(max_iter=2000, random_state=123)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><label>decision tree</label></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b1318430-14df-47df-94fd-fd7541f90906" type="checkbox" ><label class="sk-toggleable__label" for="b1318430-14df-47df-94fd-fd7541f90906">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline-1',
                                 Pipeline(steps=[('standardscaler',
                                                  StandardScaler())]),
                                 ['age', 'fnlwgt', 'capital.gain',
                                  'capital.loss', 'hours.per.week']),
                                ('pipeline-2',
                                 Pipeline(steps=[('ordinalencoder',
                                                  OrdinalEncoder(categories=[['Preschool',
                                                                              '1st-4th',
                                                                              '5th-6th',
                                                                              '7th-8th',
                                                                              '9th',
                                                                              '10th',
                                                                              '11th',
                                                                              '12th',
                                                                              'HS-grad',
                                                                              'Prof-school',
                                                                              'Assoc-voc',
                                                                              'Ass...
                                                  OneHotEncoder(drop='if_binary',
                                                                dtype=<class 'int'>))]),
                                 ['sex']),
                                ('pipeline-4',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder(handle_unknown='ignore',
                                                                sparse=False))]),
                                 ['workclass', 'marital.status', 'occupation',
                                  'relationship', 'native.country']),
                                ('drop', 'drop', ['race', 'education.num'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="774da959-5890-4786-98fa-f690959d0366" type="checkbox" ><label class="sk-toggleable__label" for="774da959-5890-4786-98fa-f690959d0366">pipeline-1</label><div class="sk-toggleable__content"><pre>['age', 'fnlwgt', 'capital.gain', 'capital.loss', 'hours.per.week']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="05744f6d-98ed-4999-92a3-a9bf58edd5a0" type="checkbox" ><label class="sk-toggleable__label" for="05744f6d-98ed-4999-92a3-a9bf58edd5a0">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="7f0346ad-0447-4859-9eda-121f4c9ca08c" type="checkbox" ><label class="sk-toggleable__label" for="7f0346ad-0447-4859-9eda-121f4c9ca08c">pipeline-2</label><div class="sk-toggleable__content"><pre>['education']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="cbcb1d6d-105e-49f6-a401-c65aa026698e" type="checkbox" ><label class="sk-toggleable__label" for="cbcb1d6d-105e-49f6-a401-c65aa026698e">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(categories=[['Preschool', '1st-4th', '5th-6th', '7th-8th', '9th',
                            '10th', '11th', '12th', 'HS-grad', 'Prof-school',
                            'Assoc-voc', 'Assoc-acdm', 'Some-college',
                            'Bachelors', 'Masters', 'Doctorate']],
               dtype=<class 'int'>)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="dbf9dcfc-05c8-47f6-af5f-d8f44619f2cb" type="checkbox" ><label class="sk-toggleable__label" for="dbf9dcfc-05c8-47f6-af5f-d8f44619f2cb">pipeline-3</label><div class="sk-toggleable__content"><pre>['sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="27aa54ee-1286-41a5-b245-da92667dc0f0" type="checkbox" ><label class="sk-toggleable__label" for="27aa54ee-1286-41a5-b245-da92667dc0f0">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="4a857f06-3a79-4335-8029-12687a851641" type="checkbox" ><label class="sk-toggleable__label" for="4a857f06-3a79-4335-8029-12687a851641">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(drop='if_binary', dtype=<class 'int'>)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a0389606-e1c4-47d7-85cd-205ac8155893" type="checkbox" ><label class="sk-toggleable__label" for="a0389606-e1c4-47d7-85cd-205ac8155893">pipeline-4</label><div class="sk-toggleable__content"><pre>['workclass', 'marital.status', 'occupation', 'relationship', 'native.country']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="10e8d963-4fbe-436c-8111-99c11201f586" type="checkbox" ><label class="sk-toggleable__label" for="10e8d963-4fbe-436c-8111-99c11201f586">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8d482952-6092-4073-9d01-f02d336488ed" type="checkbox" ><label class="sk-toggleable__label" for="8d482952-6092-4073-9d01-f02d336488ed">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown='ignore', sparse=False)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="cadbac48-a9bb-4037-851a-ea9ee5d8ab08" type="checkbox" ><label class="sk-toggleable__label" for="cadbac48-a9bb-4037-851a-ea9ee5d8ab08">drop</label><div class="sk-toggleable__content"><pre>['race', 'education.num']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="614cb345-edf6-4982-a96c-62e8862b1722" type="checkbox" ><label class="sk-toggleable__label" for="614cb345-edf6-4982-a96c-62e8862b1722">drop</label><div class="sk-toggleable__content"><pre>drop</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="84acb081-9659-4575-bc40-c9e822ab3dad" type="checkbox" ><label class="sk-toggleable__label" for="84acb081-9659-4575-bc40-c9e822ab3dad">DecisionTreeClassifier</label><div class="sk-toggleable__content"><pre>DecisionTreeClassifier(random_state=123)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><label>random forest</label></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f6b6f0fd-d9e1-4ebd-9a8b-4f814cfe8115" type="checkbox" ><label class="sk-toggleable__label" for="f6b6f0fd-d9e1-4ebd-9a8b-4f814cfe8115">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline-1',
                                 Pipeline(steps=[('standardscaler',
                                                  StandardScaler())]),
                                 ['age', 'fnlwgt', 'capital.gain',
                                  'capital.loss', 'hours.per.week']),
                                ('pipeline-2',
                                 Pipeline(steps=[('ordinalencoder',
                                                  OrdinalEncoder(categories=[['Preschool',
                                                                              '1st-4th',
                                                                              '5th-6th',
                                                                              '7th-8th',
                                                                              '9th',
                                                                              '10th',
                                                                              '11th',
                                                                              '12th',
                                                                              'HS-grad',
                                                                              'Prof-school',
                                                                              'Assoc-voc',
                                                                              'Ass...
                                                  OneHotEncoder(drop='if_binary',
                                                                dtype=<class 'int'>))]),
                                 ['sex']),
                                ('pipeline-4',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder(handle_unknown='ignore',
                                                                sparse=False))]),
                                 ['workclass', 'marital.status', 'occupation',
                                  'relationship', 'native.country']),
                                ('drop', 'drop', ['race', 'education.num'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="627ab5b8-16af-46b2-87b1-7af0c014e311" type="checkbox" ><label class="sk-toggleable__label" for="627ab5b8-16af-46b2-87b1-7af0c014e311">pipeline-1</label><div class="sk-toggleable__content"><pre>['age', 'fnlwgt', 'capital.gain', 'capital.loss', 'hours.per.week']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="37b71e89-9114-4981-b9d0-ced553dd9a37" type="checkbox" ><label class="sk-toggleable__label" for="37b71e89-9114-4981-b9d0-ced553dd9a37">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="bb6c38c8-2c27-4481-a60e-0322b3355959" type="checkbox" ><label class="sk-toggleable__label" for="bb6c38c8-2c27-4481-a60e-0322b3355959">pipeline-2</label><div class="sk-toggleable__content"><pre>['education']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="773ed62d-2d55-488c-bbdb-a238a3e82873" type="checkbox" ><label class="sk-toggleable__label" for="773ed62d-2d55-488c-bbdb-a238a3e82873">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(categories=[['Preschool', '1st-4th', '5th-6th', '7th-8th', '9th',
                            '10th', '11th', '12th', 'HS-grad', 'Prof-school',
                            'Assoc-voc', 'Assoc-acdm', 'Some-college',
                            'Bachelors', 'Masters', 'Doctorate']],
               dtype=<class 'int'>)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="5af363d6-bf78-4d3d-a5ef-5027b3a97193" type="checkbox" ><label class="sk-toggleable__label" for="5af363d6-bf78-4d3d-a5ef-5027b3a97193">pipeline-3</label><div class="sk-toggleable__content"><pre>['sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6997038b-67b8-48db-a2b0-c1390645923b" type="checkbox" ><label class="sk-toggleable__label" for="6997038b-67b8-48db-a2b0-c1390645923b">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d4698b79-deb7-460f-9283-c7834fc8d606" type="checkbox" ><label class="sk-toggleable__label" for="d4698b79-deb7-460f-9283-c7834fc8d606">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(drop='if_binary', dtype=<class 'int'>)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="63fb5688-24ca-458a-a349-526c53b99569" type="checkbox" ><label class="sk-toggleable__label" for="63fb5688-24ca-458a-a349-526c53b99569">pipeline-4</label><div class="sk-toggleable__content"><pre>['workclass', 'marital.status', 'occupation', 'relationship', 'native.country']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b8c1380a-d15d-4a44-9c6b-c5147d6a537c" type="checkbox" ><label class="sk-toggleable__label" for="b8c1380a-d15d-4a44-9c6b-c5147d6a537c">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="4d4bb833-2fe5-4393-8a64-6ceef1e32b1c" type="checkbox" ><label class="sk-toggleable__label" for="4d4bb833-2fe5-4393-8a64-6ceef1e32b1c">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown='ignore', sparse=False)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f1c8c780-2905-48b9-8038-dde91d36a4b1" type="checkbox" ><label class="sk-toggleable__label" for="f1c8c780-2905-48b9-8038-dde91d36a4b1">drop</label><div class="sk-toggleable__content"><pre>['race', 'education.num']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d9e9d292-9ba0-478f-ba5e-43479f0e45f7" type="checkbox" ><label class="sk-toggleable__label" for="d9e9d292-9ba0-478f-ba5e-43479f0e45f7">drop</label><div class="sk-toggleable__content"><pre>drop</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="dfb917d3-c882-42d2-8897-ebb1fd585979" type="checkbox" ><label class="sk-toggleable__label" for="dfb917d3-c882-42d2-8897-ebb1fd585979">RandomForestClassifier</label><div class="sk-toggleable__content"><pre>RandomForestClassifier(random_state=123)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><label>XGBoost</label></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f4133551-9801-48c1-9ce6-565c60938bd5" type="checkbox" ><label class="sk-toggleable__label" for="f4133551-9801-48c1-9ce6-565c60938bd5">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline-1',
                                 Pipeline(steps=[('standardscaler',
                                                  StandardScaler())]),
                                 ['age', 'fnlwgt', 'capital.gain',
                                  'capital.loss', 'hours.per.week']),
                                ('pipeline-2',
                                 Pipeline(steps=[('ordinalencoder',
                                                  OrdinalEncoder(categories=[['Preschool',
                                                                              '1st-4th',
                                                                              '5th-6th',
                                                                              '7th-8th',
                                                                              '9th',
                                                                              '10th',
                                                                              '11th',
                                                                              '12th',
                                                                              'HS-grad',
                                                                              'Prof-school',
                                                                              'Assoc-voc',
                                                                              'Ass...
                                                  OneHotEncoder(drop='if_binary',
                                                                dtype=<class 'int'>))]),
                                 ['sex']),
                                ('pipeline-4',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder(handle_unknown='ignore',
                                                                sparse=False))]),
                                 ['workclass', 'marital.status', 'occupation',
                                  'relationship', 'native.country']),
                                ('drop', 'drop', ['race', 'education.num'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="e0df5ba8-d621-4d1f-8507-4140dbaa2903" type="checkbox" ><label class="sk-toggleable__label" for="e0df5ba8-d621-4d1f-8507-4140dbaa2903">pipeline-1</label><div class="sk-toggleable__content"><pre>['age', 'fnlwgt', 'capital.gain', 'capital.loss', 'hours.per.week']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="387a1a3b-4f45-4a90-9e5e-38879421db9f" type="checkbox" ><label class="sk-toggleable__label" for="387a1a3b-4f45-4a90-9e5e-38879421db9f">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8136ae35-6bc4-4ade-947c-0b7e772dcb40" type="checkbox" ><label class="sk-toggleable__label" for="8136ae35-6bc4-4ade-947c-0b7e772dcb40">pipeline-2</label><div class="sk-toggleable__content"><pre>['education']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="463e1d13-86c7-4f14-92fd-2816786f77bb" type="checkbox" ><label class="sk-toggleable__label" for="463e1d13-86c7-4f14-92fd-2816786f77bb">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(categories=[['Preschool', '1st-4th', '5th-6th', '7th-8th', '9th',
                            '10th', '11th', '12th', 'HS-grad', 'Prof-school',
                            'Assoc-voc', 'Assoc-acdm', 'Some-college',
                            'Bachelors', 'Masters', 'Doctorate']],
               dtype=<class 'int'>)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="307db3f5-e710-4abd-96cf-62f9265bf031" type="checkbox" ><label class="sk-toggleable__label" for="307db3f5-e710-4abd-96cf-62f9265bf031">pipeline-3</label><div class="sk-toggleable__content"><pre>['sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="9c7541e8-e692-479e-b9fd-4d15f979899d" type="checkbox" ><label class="sk-toggleable__label" for="9c7541e8-e692-479e-b9fd-4d15f979899d">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="147d65a9-496a-4076-811a-925332d2db24" type="checkbox" ><label class="sk-toggleable__label" for="147d65a9-496a-4076-811a-925332d2db24">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(drop='if_binary', dtype=<class 'int'>)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="9663042a-f2ff-4aeb-9003-11a8c30f13a5" type="checkbox" ><label class="sk-toggleable__label" for="9663042a-f2ff-4aeb-9003-11a8c30f13a5">pipeline-4</label><div class="sk-toggleable__content"><pre>['workclass', 'marital.status', 'occupation', 'relationship', 'native.country']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="831b1992-6747-403d-a90e-7c56d2348685" type="checkbox" ><label class="sk-toggleable__label" for="831b1992-6747-403d-a90e-7c56d2348685">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="2115686a-6891-406d-88f3-6941c2467790" type="checkbox" ><label class="sk-toggleable__label" for="2115686a-6891-406d-88f3-6941c2467790">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown='ignore', sparse=False)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="1e3c06e7-94cc-4ae4-852a-96172de0289d" type="checkbox" ><label class="sk-toggleable__label" for="1e3c06e7-94cc-4ae4-852a-96172de0289d">drop</label><div class="sk-toggleable__content"><pre>['race', 'education.num']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c936852e-7240-4bd8-bde4-f703c4222fc8" type="checkbox" ><label class="sk-toggleable__label" for="c936852e-7240-4bd8-bde4-f703c4222fc8">drop</label><div class="sk-toggleable__content"><pre>drop</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6291a26b-9933-4c30-8569-bb1c4b79a6d5" type="checkbox" ><label class="sk-toggleable__label" for="6291a26b-9933-4c30-8569-bb1c4b79a6d5">XGBClassifier</label><div class="sk-toggleable__content"><pre>XGBClassifier(base_score=None, booster=None, colsample_bylevel=None,
              colsample_bynode=None, colsample_bytree=None,
              eval_metric='logloss', gamma=None, gpu_id=None,
              importance_type='gain', interaction_constraints=None,
              learning_rate=None, max_delta_step=None, max_depth=None,
              min_child_weight=None, missing=nan, monotone_constraints=None,
              n_estimators=100, n_jobs=None, num_parallel_tree=None,
              random_state=123, reg_alpha=None, reg_lambda=None,
              scale_pos_weight=None, subsample=None, tree_method=None,
              validate_parameters=None, verbosity=0)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><label>LightGBM</label></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="79720cd3-1ad8-469b-81b1-c43b43baf850" type="checkbox" ><label class="sk-toggleable__label" for="79720cd3-1ad8-469b-81b1-c43b43baf850">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline-1',
                                 Pipeline(steps=[('standardscaler',
                                                  StandardScaler())]),
                                 ['age', 'fnlwgt', 'capital.gain',
                                  'capital.loss', 'hours.per.week']),
                                ('pipeline-2',
                                 Pipeline(steps=[('ordinalencoder',
                                                  OrdinalEncoder(categories=[['Preschool',
                                                                              '1st-4th',
                                                                              '5th-6th',
                                                                              '7th-8th',
                                                                              '9th',
                                                                              '10th',
                                                                              '11th',
                                                                              '12th',
                                                                              'HS-grad',
                                                                              'Prof-school',
                                                                              'Assoc-voc',
                                                                              'Ass...
                                                  OneHotEncoder(drop='if_binary',
                                                                dtype=<class 'int'>))]),
                                 ['sex']),
                                ('pipeline-4',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder(handle_unknown='ignore',
                                                                sparse=False))]),
                                 ['workclass', 'marital.status', 'occupation',
                                  'relationship', 'native.country']),
                                ('drop', 'drop', ['race', 'education.num'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="4e5994e7-4784-4afc-ace0-8b549136647a" type="checkbox" ><label class="sk-toggleable__label" for="4e5994e7-4784-4afc-ace0-8b549136647a">pipeline-1</label><div class="sk-toggleable__content"><pre>['age', 'fnlwgt', 'capital.gain', 'capital.loss', 'hours.per.week']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="35a3b012-ccaa-4992-b7b5-028eb66d5969" type="checkbox" ><label class="sk-toggleable__label" for="35a3b012-ccaa-4992-b7b5-028eb66d5969">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="82fbea03-42e2-4abc-88c0-91cf387590b6" type="checkbox" ><label class="sk-toggleable__label" for="82fbea03-42e2-4abc-88c0-91cf387590b6">pipeline-2</label><div class="sk-toggleable__content"><pre>['education']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6bf2e15d-3c99-4ab2-ae95-adb7aa8f0868" type="checkbox" ><label class="sk-toggleable__label" for="6bf2e15d-3c99-4ab2-ae95-adb7aa8f0868">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(categories=[['Preschool', '1st-4th', '5th-6th', '7th-8th', '9th',
                            '10th', '11th', '12th', 'HS-grad', 'Prof-school',
                            'Assoc-voc', 'Assoc-acdm', 'Some-college',
                            'Bachelors', 'Masters', 'Doctorate']],
               dtype=<class 'int'>)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6f8b9c51-d525-4f4c-bd32-fe3e5c14e03d" type="checkbox" ><label class="sk-toggleable__label" for="6f8b9c51-d525-4f4c-bd32-fe3e5c14e03d">pipeline-3</label><div class="sk-toggleable__content"><pre>['sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="bc9a7ba5-cd8f-42e5-858a-0ae48d8c0752" type="checkbox" ><label class="sk-toggleable__label" for="bc9a7ba5-cd8f-42e5-858a-0ae48d8c0752">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="cabf93c1-f972-40ca-872d-d013f395e91c" type="checkbox" ><label class="sk-toggleable__label" for="cabf93c1-f972-40ca-872d-d013f395e91c">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(drop='if_binary', dtype=<class 'int'>)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="02fc4d50-ea7a-4390-97b4-31b24594f2dc" type="checkbox" ><label class="sk-toggleable__label" for="02fc4d50-ea7a-4390-97b4-31b24594f2dc">pipeline-4</label><div class="sk-toggleable__content"><pre>['workclass', 'marital.status', 'occupation', 'relationship', 'native.country']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="38a22a95-0b8e-4c1c-867e-f45c0f2a8643" type="checkbox" ><label class="sk-toggleable__label" for="38a22a95-0b8e-4c1c-867e-f45c0f2a8643">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="fa49ae25-1fe4-4962-9cdd-551ea65ec206" type="checkbox" ><label class="sk-toggleable__label" for="fa49ae25-1fe4-4962-9cdd-551ea65ec206">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown='ignore', sparse=False)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="66de0296-dfbb-47cd-bb36-3500046539c8" type="checkbox" ><label class="sk-toggleable__label" for="66de0296-dfbb-47cd-bb36-3500046539c8">drop</label><div class="sk-toggleable__content"><pre>['race', 'education.num']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6bcd135d-0054-4607-987f-7958beef6dcb" type="checkbox" ><label class="sk-toggleable__label" for="6bcd135d-0054-4607-987f-7958beef6dcb">drop</label><div class="sk-toggleable__content"><pre>drop</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6dc56887-11be-4d52-879a-f4bcf804d3c3" type="checkbox" ><label class="sk-toggleable__label" for="6dc56887-11be-4d52-879a-f4bcf804d3c3">LGBMClassifier</label><div class="sk-toggleable__content"><pre>LGBMClassifier(random_state=123)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><label>CatBoost</label></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="0d16f422-ba6b-443a-998f-3e8767d85886" type="checkbox" ><label class="sk-toggleable__label" for="0d16f422-ba6b-443a-998f-3e8767d85886">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline-1',
                                 Pipeline(steps=[('standardscaler',
                                                  StandardScaler())]),
                                 ['age', 'fnlwgt', 'capital.gain',
                                  'capital.loss', 'hours.per.week']),
                                ('pipeline-2',
                                 Pipeline(steps=[('ordinalencoder',
                                                  OrdinalEncoder(categories=[['Preschool',
                                                                              '1st-4th',
                                                                              '5th-6th',
                                                                              '7th-8th',
                                                                              '9th',
                                                                              '10th',
                                                                              '11th',
                                                                              '12th',
                                                                              'HS-grad',
                                                                              'Prof-school',
                                                                              'Assoc-voc',
                                                                              'Ass...
                                                  OneHotEncoder(drop='if_binary',
                                                                dtype=<class 'int'>))]),
                                 ['sex']),
                                ('pipeline-4',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder(handle_unknown='ignore',
                                                                sparse=False))]),
                                 ['workclass', 'marital.status', 'occupation',
                                  'relationship', 'native.country']),
                                ('drop', 'drop', ['race', 'education.num'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="51d2941f-0f8d-4c8c-986d-be88c94da4e0" type="checkbox" ><label class="sk-toggleable__label" for="51d2941f-0f8d-4c8c-986d-be88c94da4e0">pipeline-1</label><div class="sk-toggleable__content"><pre>['age', 'fnlwgt', 'capital.gain', 'capital.loss', 'hours.per.week']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="0b02c7dd-774b-4938-80fd-8cdddc0c1c41" type="checkbox" ><label class="sk-toggleable__label" for="0b02c7dd-774b-4938-80fd-8cdddc0c1c41">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="2a2906ca-c81d-4eb5-87e2-69074a7a611c" type="checkbox" ><label class="sk-toggleable__label" for="2a2906ca-c81d-4eb5-87e2-69074a7a611c">pipeline-2</label><div class="sk-toggleable__content"><pre>['education']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="fcc686cd-b2dd-4417-9227-de94e988c1ce" type="checkbox" ><label class="sk-toggleable__label" for="fcc686cd-b2dd-4417-9227-de94e988c1ce">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(categories=[['Preschool', '1st-4th', '5th-6th', '7th-8th', '9th',
                            '10th', '11th', '12th', 'HS-grad', 'Prof-school',
                            'Assoc-voc', 'Assoc-acdm', 'Some-college',
                            'Bachelors', 'Masters', 'Doctorate']],
               dtype=<class 'int'>)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="31c75162-1546-4bdd-a35e-d64fba0ac657" type="checkbox" ><label class="sk-toggleable__label" for="31c75162-1546-4bdd-a35e-d64fba0ac657">pipeline-3</label><div class="sk-toggleable__content"><pre>['sex']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="161bc220-7b2d-4e19-81d8-8a24cafc0e30" type="checkbox" ><label class="sk-toggleable__label" for="161bc220-7b2d-4e19-81d8-8a24cafc0e30">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="bb48e596-9a5d-4fbf-b55a-ccdb0a16b361" type="checkbox" ><label class="sk-toggleable__label" for="bb48e596-9a5d-4fbf-b55a-ccdb0a16b361">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(drop='if_binary', dtype=<class 'int'>)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="54f66458-1250-40f8-89f7-2fd9daf83a23" type="checkbox" ><label class="sk-toggleable__label" for="54f66458-1250-40f8-89f7-2fd9daf83a23">pipeline-4</label><div class="sk-toggleable__content"><pre>['workclass', 'marital.status', 'occupation', 'relationship', 'native.country']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a58b18de-6ec4-48a1-9c58-46a6cac190ec" type="checkbox" ><label class="sk-toggleable__label" for="a58b18de-6ec4-48a1-9c58-46a6cac190ec">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a9dbbaa3-0688-493e-a6d2-4cad565fac2c" type="checkbox" ><label class="sk-toggleable__label" for="a9dbbaa3-0688-493e-a6d2-4cad565fac2c">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown='ignore', sparse=False)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="161b4589-4412-4ed5-a984-8124d702e30b" type="checkbox" ><label class="sk-toggleable__label" for="161b4589-4412-4ed5-a984-8124d702e30b">drop</label><div class="sk-toggleable__content"><pre>['race', 'education.num']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="7c4c3247-55de-4b0f-9a52-40fa8e503b70" type="checkbox" ><label class="sk-toggleable__label" for="7c4c3247-55de-4b0f-9a52-40fa8e503b70">drop</label><div class="sk-toggleable__content"><pre>drop</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="052c8edb-3470-4d97-855e-62fa5ad8d552" type="checkbox" ><label class="sk-toggleable__label" for="052c8edb-3470-4d97-855e-62fa5ad8d552">CatBoostClassifier</label><div class="sk-toggleable__content"><pre><catboost.core.CatBoostClassifier object at 0x13a1f8bb0></pre></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">VotingClassifier</span></code> will take a <em>vote</em> using the predictions of the constituent classifier pipelines.</p>
<p>Main parameter: <code class="docutils literal notranslate"><span class="pre">voting</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">voting='hard'</span></code></p>
<ul>
<li><p>it uses the output of <code class="docutils literal notranslate"><span class="pre">predict</span></code> and actually votes.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">voting='soft'</span></code></p>
<ul>
<li><p>with <code class="docutils literal notranslate"><span class="pre">voting='soft'</span></code> it averages the output of <code class="docutils literal notranslate"><span class="pre">predict_proba</span></code> and then thresholds / takes the larger.</p></li>
</ul>
</li>
</ul>
<ul class="simple">
<li><p>The choice depends on whether you trust <code class="docutils literal notranslate"><span class="pre">predict_proba</span></code> from your base classifiers - if so, it’s nice to access that information.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">averaging_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>What happens when you <code class="docutils literal notranslate"><span class="pre">fit</span></code> a <code class="docutils literal notranslate"><span class="pre">VotingClassifier</span></code>?</p>
<ul>
<li><p>It will fit all constituent models.</p></li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It seems sklearn requires us to actually call <code class="docutils literal notranslate"><span class="pre">fit</span></code> on the <code class="docutils literal notranslate"><span class="pre">VotingClassifier</span></code>, instead of passing in pre-fit models. This is an implementation choice rather than a conceptual limitation.</p>
</div>
<p>Let’s look at particular test examples where <code class="docutils literal notranslate"><span class="pre">income</span></code> is “&gt;50k” (y=1):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_g50k</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">test_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;income == &#39;&gt;50K&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;income&quot;</span><span class="p">])</span>
<span class="p">)</span>
<span class="n">test_l50k</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">test_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;income == &#39;&lt;=50K&#39;&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;income&quot;</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">averaging_model</span><span class="o">.</span><span class="n">classes_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;&lt;=50K&#39;, &#39;&gt;50K&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Voting classifier&quot;</span><span class="p">:</span> <span class="n">averaging_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_g50k</span><span class="p">)}</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Voting classifier</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>&gt;50K</td>
    </tr>
    <tr>
      <th>1</th>
      <td>&gt;50K</td>
    </tr>
    <tr>
      <th>2</th>
      <td>&gt;50K</td>
    </tr>
    <tr>
      <th>3</th>
      <td>&lt;=50K</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>For hard voting, these are the votes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r1</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_g50k</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">classifier</span> <span class="ow">in</span> <span class="n">averaging_model</span><span class="o">.</span><span class="n">named_estimators_</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="p">}</span>
<span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">r1</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Voting classifier</th>
      <th>logistic regression</th>
      <th>decision tree</th>
      <th>random forest</th>
      <th>XGBoost</th>
      <th>LightGBM</th>
      <th>CatBoost</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>&gt;50K</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>&gt;50K</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>&gt;50K</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>&lt;=50K</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>For soft voting, these are the scores:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r1</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">classifier</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">test_g50k</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">classifier</span> <span class="ow">in</span> <span class="n">averaging_model</span><span class="o">.</span><span class="n">named_estimators_</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="p">}</span>
<span class="n">r1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;logistic regression&#39;: array([[2.30926389e-14, 1.00000000e+00],
        [4.18858309e-01, 5.81141691e-01],
        [4.96765232e-01, 5.03234768e-01],
        [8.87453869e-01, 1.12546131e-01]]),
 &#39;decision tree&#39;: array([[0., 1.],
        [0., 1.],
        [1., 0.],
        [1., 0.]]),
 &#39;random forest&#39;: array([[0.  , 1.  ],
        [0.31, 0.69],
        [0.37, 0.63],
        [0.57, 0.43]]),
 &#39;XGBoost&#39;: array([[0.00168145, 0.99831855],
        [0.30067134, 0.69932866],
        [0.31893963, 0.6810604 ],
        [0.78900903, 0.21099098]], dtype=float32),
 &#39;LightGBM&#39;: array([[0.00187645, 0.99812355],
        [0.28722892, 0.71277108],
        [0.28457261, 0.71542739],
        [0.8095596 , 0.1904404 ]]),
 &#39;CatBoost&#39;: array([[0.00151693, 0.99848307],
        [0.28344311, 0.71655689],
        [0.32029146, 0.67970854],
        [0.81534647, 0.18465353]])}
</pre></div>
</div>
</div>
</div>
<p>(Aside: the probability scores from <code class="docutils literal notranslate"><span class="pre">DecisionTreeClassifier</span></code> are pretty bad)</p>
<p>Let’s see how well this model performs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;Voting&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span><span class="n">averaging_model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Dummy</th>
      <td>0.007 (+/- 0.000)</td>
      <td>0.005 (+/- 0.000)</td>
      <td>0.636 (+/- 0.007)</td>
      <td>0.633 (+/- 0.004)</td>
    </tr>
    <tr>
      <th>logistic regression</th>
      <td>0.748 (+/- 0.036)</td>
      <td>0.019 (+/- 0.000)</td>
      <td>0.850 (+/- 0.006)</td>
      <td>0.851 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>decision tree</th>
      <td>0.169 (+/- 0.002)</td>
      <td>0.019 (+/- 0.001)</td>
      <td>0.813 (+/- 0.003)</td>
      <td>1.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>random forest</th>
      <td>1.438 (+/- 0.016)</td>
      <td>0.093 (+/- 0.001)</td>
      <td>0.857 (+/- 0.004)</td>
      <td>1.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>XGBoost</th>
      <td>1.002 (+/- 0.034)</td>
      <td>0.028 (+/- 0.000)</td>
      <td>0.870 (+/- 0.003)</td>
      <td>0.909 (+/- 0.002)</td>
    </tr>
    <tr>
      <th>LightGBM</th>
      <td>0.181 (+/- 0.009)</td>
      <td>0.026 (+/- 0.001)</td>
      <td>0.871 (+/- 0.004)</td>
      <td>0.892 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>CatBoost</th>
      <td>5.945 (+/- 0.088)</td>
      <td>0.094 (+/- 0.001)</td>
      <td>0.872 (+/- 0.003)</td>
      <td>0.900 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>Voting</th>
      <td>9.624 (+/- 0.063)</td>
      <td>0.278 (+/- 0.011)</td>
      <td>0.868 (+/- 0.003)</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>It appears that here we didn’t do much better than our best classifier :(.</p>
<p>Let’s try removing decision tree classifier.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">classifiers_ndt</span> <span class="o">=</span> <span class="n">classifiers</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="k">del</span> <span class="n">classifiers_ndt</span><span class="p">[</span><span class="s2">&quot;decision tree&quot;</span><span class="p">]</span>
<span class="n">averaging_model_ndt</span> <span class="o">=</span> <span class="n">VotingClassifier</span><span class="p">(</span>
    <span class="nb">list</span><span class="p">(</span><span class="n">classifiers_ndt</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="n">voting</span><span class="o">=</span><span class="s2">&quot;soft&quot;</span>
<span class="p">)</span>  <span class="c1"># need the list() here for cross_val to work!</span>

<span class="n">results</span><span class="p">[</span><span class="s2">&quot;Voting_ndt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">averaging_model_ndt</span><span class="p">,</span>
    <span class="n">X_train</span><span class="p">,</span>
    <span class="n">y_train</span><span class="p">,</span>
    <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="n">scoring_metric</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Dummy</th>
      <td>0.007 (+/- 0.000)</td>
      <td>0.005 (+/- 0.000)</td>
      <td>0.636 (+/- 0.007)</td>
      <td>0.633 (+/- 0.004)</td>
    </tr>
    <tr>
      <th>logistic regression</th>
      <td>0.748 (+/- 0.036)</td>
      <td>0.019 (+/- 0.000)</td>
      <td>0.850 (+/- 0.006)</td>
      <td>0.851 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>decision tree</th>
      <td>0.169 (+/- 0.002)</td>
      <td>0.019 (+/- 0.001)</td>
      <td>0.813 (+/- 0.003)</td>
      <td>1.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>random forest</th>
      <td>1.438 (+/- 0.016)</td>
      <td>0.093 (+/- 0.001)</td>
      <td>0.857 (+/- 0.004)</td>
      <td>1.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>XGBoost</th>
      <td>1.002 (+/- 0.034)</td>
      <td>0.028 (+/- 0.000)</td>
      <td>0.870 (+/- 0.003)</td>
      <td>0.909 (+/- 0.002)</td>
    </tr>
    <tr>
      <th>LightGBM</th>
      <td>0.181 (+/- 0.009)</td>
      <td>0.026 (+/- 0.001)</td>
      <td>0.871 (+/- 0.004)</td>
      <td>0.892 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>CatBoost</th>
      <td>5.945 (+/- 0.088)</td>
      <td>0.094 (+/- 0.001)</td>
      <td>0.872 (+/- 0.003)</td>
      <td>0.900 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>Voting</th>
      <td>9.624 (+/- 0.063)</td>
      <td>0.278 (+/- 0.011)</td>
      <td>0.868 (+/- 0.003)</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Voting_ndt</th>
      <td>9.599 (+/- 0.114)</td>
      <td>0.278 (+/- 0.011)</td>
      <td>0.872 (+/- 0.003)</td>
      <td>0.922 (+/- 0.001)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Still the results are not better than the best performing model.</p>
<ul class="simple">
<li><p>It didn’t happen here but how could the average do better than the best model???</p>
<ul>
<li><p>From the perspective of the best estimator (in this case CatBoost), why are you adding on worse estimators??</p></li>
</ul>
</li>
</ul>
<p>Here’s how this can work:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Example</p></th>
<th class="head"><p>log reg</p></th>
<th class="head"><p>rand forest</p></th>
<th class="head"><p>cat boost</p></th>
<th class="head"><p>Averaged model</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>✅</p></td>
<td><p>✅</p></td>
<td><p>❌</p></td>
<td><p>✅✅❌=&gt;✅</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>✅</p></td>
<td><p>❌</p></td>
<td><p>✅</p></td>
<td><p>✅❌✅=&gt;✅</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>❌</p></td>
<td><p>✅</p></td>
<td><p>✅</p></td>
<td><p>❌✅✅=&gt;✅</p></td>
</tr>
</tbody>
</table>
<p>In short, as long as the different models make different mistakes, this can work.</p>
<p>Why not always do this?</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fit</span></code>/<code class="docutils literal notranslate"><span class="pre">predict</span></code> time.</p></li>
<li><p>Reduction in interpretability.</p></li>
<li><p>Reduction in code maintainability (e.g. Netflix prize).</p></li>
</ol>
<div class="section" id="what-kind-of-estimators-can-we-combine">
<h3>What kind of estimators can we combine?<a class="headerlink" href="#what-kind-of-estimators-can-we-combine" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>You can combine</p>
<ul>
<li><p>completely different estimators, or similar estimators.</p></li>
<li><p>estimators trained on different samples.</p></li>
<li><p>estimators with different hyperparameter values.</p></li>
</ul>
</li>
</ul>
<p><br><br><br><br></p>
</div>
</div>
<div class="section" id="stacking">
<h2>Stacking<a class="headerlink" href="#stacking" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Another type of ensemble is stacking.</p></li>
<li><p>Instead of averaging the outputs of each estimator, instead use their outputs as <em>inputs to another model</em>.</p></li>
<li><p>By default for classification, it uses logistic regression.</p>
<ul>
<li><p>We don’t need a complex model here necessarily, more of a weighted average.</p></li>
<li><p>The features going into the logistic regression are the classifier outputs, <em>not</em> the original features!</p></li>
<li><p>So the number of coefficients = the number of base estimators!</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">StackingClassifier</span>
</pre></div>
</div>
</div>
</div>
<p>The code starts to get too slow here; so we’ll remove CatBoost.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">classifiers_nocat</span> <span class="o">=</span> <span class="n">classifiers</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="k">del</span> <span class="n">classifiers_nocat</span><span class="p">[</span><span class="s2">&quot;CatBoost&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stacking_model</span> <span class="o">=</span> <span class="n">StackingClassifier</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">classifiers_nocat</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stacking_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>What’s going on in here?</p>
<ul class="simple">
<li><p>It is doing cross-validation by itself by default (see <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.StackingClassifier.html">documentation</a>)</p>
<ul>
<li><p>It is fitting the base estimators on the training fold</p></li>
<li><p>And the predicting on the validation fold</p></li>
<li><p>And then fitting the meta-estimator on that output (on the validation fold)</p></li>
</ul>
</li>
</ul>
<blockquote>
<div><p>Note that estimators_ are fitted on the full X while final_estimator_ is trained using cross-validated predictions of the base estimators using cross_val_predict.</p>
</div></blockquote>
<p>Here is the input features (X) to the meta-model:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">valid_sample</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;income&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r3</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">pipe</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">valid_sample</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">pipe</span><span class="p">)</span> <span class="ow">in</span> <span class="n">stacking_model</span><span class="o">.</span><span class="n">named_estimators_</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="p">}</span>
<span class="n">r3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;logistic regression&#39;: array([[4.33660433e-01, 5.66339567e-01],
        [9.99011083e-01, 9.88916715e-04],
        [8.60521628e-01, 1.39478372e-01],
        [9.95291894e-01, 4.70810637e-03]]),
 &#39;decision tree&#39;: array([[1., 0.],
        [1., 0.],
        [1., 0.],
        [1., 0.]]),
 &#39;random forest&#39;: array([[0.88, 0.12],
        [1.  , 0.  ],
        [0.95, 0.05],
        [1.  , 0.  ]]),
 &#39;XGBoost&#39;: array([[0.75072813, 0.24927188],
        [0.99450225, 0.00549777],
        [0.95364463, 0.04635534],
        [0.9975675 , 0.00243254]], dtype=float32),
 &#39;LightGBM&#39;: array([[0.56629894, 0.43370106],
        [0.99263965, 0.00736035],
        [0.91995188, 0.08004812],
        [0.99629847, 0.00370153]])}
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Our meta-model is logistic regression (which it is by default).</p></li>
<li><p>Let’s look at the learned coefficients.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">stacking_model</span><span class="o">.</span><span class="n">final_estimator_</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">index</span><span class="o">=</span><span class="n">classifiers_nocat</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Coefficient&quot;</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Coefficient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>logistic regression</th>
      <td>0.763374</td>
    </tr>
    <tr>
      <th>decision tree</th>
      <td>-0.011341</td>
    </tr>
    <tr>
      <th>random forest</th>
      <td>0.218904</td>
    </tr>
    <tr>
      <th>XGBoost</th>
      <td>2.022811</td>
    </tr>
    <tr>
      <th>LightGBM</th>
      <td>3.684297</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stacking_model</span><span class="o">.</span><span class="n">final_estimator_</span><span class="o">.</span><span class="n">intercept_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-3.31969265])
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>It seems that the LightGBM is being trusted the most.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stacking_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_g50k</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;&gt;50K&#39;, &#39;&gt;50K&#39;, &#39;&gt;50K&#39;, &#39;&lt;=50K&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stacking_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">test_g50k</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0.03395944, 0.96604056],
       [0.21344064, 0.78655936],
       [0.22866283, 0.77133717],
       [0.88196957, 0.11803043]])
</pre></div>
</div>
</div>
</div>
<p>(This is the <code class="docutils literal notranslate"><span class="pre">predict_proba</span></code> from logistic regression)</p>
<p>Let’s see how well this model performs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;Stacking_nocat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">stacking_model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring_metric</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Dummy</th>
      <td>0.007 (+/- 0.000)</td>
      <td>0.005 (+/- 0.000)</td>
      <td>0.636 (+/- 0.007)</td>
      <td>0.633 (+/- 0.004)</td>
    </tr>
    <tr>
      <th>logistic regression</th>
      <td>0.748 (+/- 0.036)</td>
      <td>0.019 (+/- 0.000)</td>
      <td>0.850 (+/- 0.006)</td>
      <td>0.851 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>decision tree</th>
      <td>0.169 (+/- 0.002)</td>
      <td>0.019 (+/- 0.001)</td>
      <td>0.813 (+/- 0.003)</td>
      <td>1.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>random forest</th>
      <td>1.438 (+/- 0.016)</td>
      <td>0.093 (+/- 0.001)</td>
      <td>0.857 (+/- 0.004)</td>
      <td>1.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>XGBoost</th>
      <td>1.002 (+/- 0.034)</td>
      <td>0.028 (+/- 0.000)</td>
      <td>0.870 (+/- 0.003)</td>
      <td>0.909 (+/- 0.002)</td>
    </tr>
    <tr>
      <th>LightGBM</th>
      <td>0.181 (+/- 0.009)</td>
      <td>0.026 (+/- 0.001)</td>
      <td>0.871 (+/- 0.004)</td>
      <td>0.892 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>CatBoost</th>
      <td>5.945 (+/- 0.088)</td>
      <td>0.094 (+/- 0.001)</td>
      <td>0.872 (+/- 0.003)</td>
      <td>0.900 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>Voting</th>
      <td>9.624 (+/- 0.063)</td>
      <td>0.278 (+/- 0.011)</td>
      <td>0.868 (+/- 0.003)</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Voting_ndt</th>
      <td>9.599 (+/- 0.114)</td>
      <td>0.278 (+/- 0.011)</td>
      <td>0.872 (+/- 0.003)</td>
      <td>0.922 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>Stacking_nocat</th>
      <td>18.902 (+/- 0.195)</td>
      <td>0.174 (+/- 0.003)</td>
      <td>0.872 (+/- 0.004)</td>
      <td>0.900 (+/- 0.007)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>The situation here is a bit mind-boggling.</p></li>
<li><p>On each fold of cross-validation it is doing cross-validation.</p></li>
<li><p>This is really loops within loops within loops within loops…</p></li>
</ul>
<ul class="simple">
<li><p>We can also try a different final estimator:</p></li>
<li><p>Let’s <code class="docutils literal notranslate"><span class="pre">DecisionTreeClassifier</span></code> as a final estimator.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stacking_model_tree</span> <span class="o">=</span> <span class="n">StackingClassifier</span><span class="p">(</span>
    <span class="nb">list</span><span class="p">(</span><span class="n">classifiers_nocat</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="n">final_estimator</span><span class="o">=</span><span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The results are not very good. But we can look at the tree:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stacking_model_tree</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display_tree</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">classifiers_nocat</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">stacking_model_tree</span><span class="o">.</span><span class="n">final_estimator_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/11_ensembles_147_0.svg" src="../_images/11_ensembles_147_0.svg" /></div>
</div>
<div class="section" id="an-effective-strategy">
<h3>An effective strategy<a class="headerlink" href="#an-effective-strategy" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Randomly generate a bunch of models with different hyperparameter configurations, and then stack all the models.</p></li>
</ul>
<ul class="simple">
<li><p>What is an advantage of ensembling multiple models as opposed to just choosing one of them?</p>
<ul>
<li><p>You may get a better score.</p></li>
</ul>
</li>
<li><p>What is an disadvantage of ensembling multiple models as opposed to just choosing one of them?</p>
<ul>
<li><p>Slower, more code maintenance issues.</p></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>You have a number of models in your toolbox now.</p></li>
<li><p>Ensembles are usually pretty effective.</p>
<ul>
<li><p>Tree-based classifiers are particularly popular and effective on a wide range of problems.</p></li>
<li><p>But they trade off code complexity and speed for prediction accuracy.</p></li>
<li><p>Don’t forget that hyperparameter optimization multiplies the slowness of the code!</p></li>
</ul>
</li>
<li><p>Stacking is a bit slower than voting, but generally higher accuracy.</p>
<ul>
<li><p>As a bonus, you get to see the coefficients for each base classifier.</p></li>
</ul>
</li>
<li><p>All the above models have equivalent regression models.</p></li>
</ul>
<div class="section" id="relevant-papers">
<h3>Relevant papers<a class="headerlink" href="#relevant-papers" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="http://jmlr.org/papers/volume15/delgado14a/delgado14a.pdf">Fernandez-Delgado et al. 2014</a> compared 179 classifiers on 121 datasets:</p>
<ul>
<li><p>First best class of methods was Random Forest and second best class of methods was (RBF) SVMs.</p></li>
</ul>
</li>
<li><p>If you like to read original papers <a class="reference external" href="https://www.stat.berkeley.edu/~breiman/randomforest2001.pdf">here</a> is the original paper on Random Forests by Leo Breiman.</p></li>
</ul>
</div>
</div>
<div class="section" id="true-or-false-questions-on-random-forests-class-discussion">
<h2>True or False questions on Random Forests (Class discussion)<a class="headerlink" href="#true-or-false-questions-on-random-forests-class-discussion" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Every tree in a random forest uses a different bootstrap sample of the training set.</p></li>
<li><p>To train a tree in a random forest, we first randomly select a subset of features. The tree is then restricted to only using those features.</p></li>
<li><p>A reasonable implementation of <code class="docutils literal notranslate"><span class="pre">predict_proba</span></code> for random forests would be for each tree to “vote” and then normalize these vote counts into probabilities.</p></li>
<li><p>Increasing the hyperparameter max_features (the number of features to consider for a split) makes the model more complex and moves the fundamental tradeoff toward lower training error.</p></li>
<li><p>A random forest with only one tree is likely to get a higher training error than a decision tree of the same depth.</p></li>
</ol>
<p>How would you carry out “soft voting” with <code class="docutils literal notranslate"><span class="pre">predict_proba</span></code> output instead of hard voting for random forests?</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "conda-env-cpsc330-py"
        },
        kernelOptions: {
            kernelName: "conda-env-cpsc330-py",
            path: "./lectures"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'conda-env-cpsc330-py'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="10_regression-metrics.html" title="previous page">Lecture 10: Regression Evaluation Metrics</a>
    <a class='right-next' id="next-link" href="13_feature-engineering-selection.html" title="next page">Lecture 13: Feature engineering and feature selection</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Varada Kolhatkar<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>