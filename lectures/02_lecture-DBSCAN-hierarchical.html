
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DSCI 563: Unsupervised Learning &#8212; CPSC 330 Applied Machine Learning</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e8e5499552300ddf5d7adccae7cc3b70.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/UBC-CS-logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">CPSC 330 Applied Machine Learning</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <p class="caption">
 <span class="caption-text">
  Things you should know
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../docs/README.html">
   CPSC 330 Documents
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Lectures
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01_intro.html">
   Lecture 1: Course Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_decision-trees.html">
   Lecture 2: Terminology, Baselines, Decision Trees
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_ml-fundamentals.html">
   Lecture 3: Machine Learning Fundamentals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_kNNs-SVM-RBF.html">
   Lecture 4:
   <span class="math notranslate nohighlight">
    \(k\)
   </span>
   -Nearest Neighbours and SVM RBFs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_preprocessing-pipelines.html">
   Lecture 5: Preprocessing and
   <code class="docutils literal notranslate">
    <span class="pre">
     sklearn
    </span>
   </code>
   pipelines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_column-transformer-text-feats.html">
   Lecture 6:
   <code class="docutils literal notranslate">
    <span class="pre">
     sklearn
    </span>
   </code>
   <code class="docutils literal notranslate">
    <span class="pre">
     ColumnTransformer
    </span>
   </code>
   and Text Features
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_linear-models.html">
   Lecture 7: Linear Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08_hyperparameter-optimization.html">
   Lecture 8: Hyperparameter Optimization and Optimization Bias
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_classification-metrics.html">
   Lecture 9: Classification Metrics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="10_regression-metrics.html">
   Lecture 10: Regression Evaluation Metrics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="11_ensembles.html">
   Lecture 11: Ensembles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="13_feature-engineering-selection.html">
   Lecture 13: Feature engineering and feature selection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="14_k-means-clustering.html">
   Lecture 14: Clustering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="15_recommender-systems.html">
   Lecture 15: DBSCAN and Recommender Systems
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Attribution
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../attribution.html">
   Attributions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../LICENSE.html">
   LICENSE
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Varada Kolhatkar, CPSC 330 2021-22<br>Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/lectures/02_lecture-DBSCAN-hierarchical.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/UBC-CS/cpsc330/master?urlpath=tree/lectures/02_lecture-DBSCAN-hierarchical.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lecture-2-dbscan-and-hierarchical-clustering">
   Lecture 2: DBSCAN and Hierarchical Clustering
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#imports">
     Imports
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#table-of-contents">
   Table of contents
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#learning-outcomes-a-name-lo-a">
   Learning outcomes
   <a name="lo">
   </a>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#video-1-recap-and-motivation-a-name-1-a">
   Video 1: Recap and motivation
   <a name="1">
   </a>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#k-means-recap">
     K-Means recap
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#k-means-limitations">
     K-Means limitations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#k-means-limitations-shape-of-k-means-clusters">
     K-Means limitations: Shape of K-Means clusters
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#k-means-failure-case-1">
     K-Means: failure case 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#k-means-failure-case-2">
     K-Means: failure case 2
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#k-means-failure-case-3">
     K-Means: failure case 3
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#video-2-dbscan-a-name-2-a">
   Video 2: DBSCAN
   <a name="2">
   </a>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dbscan-introduction">
     DBSCAN introduction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-does-it-work">
     How does it work?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#two-main-hyperparameters">
     Two main hyperparameters
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#effect-of-eps-hyperparameter">
     Effect of
     <code class="docutils literal notranslate">
      <span class="pre">
       eps
      </span>
     </code>
     hyperparameter
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#effect-of-min-samples-hyperparameter">
     Effect of
     <code class="docutils literal notranslate">
      <span class="pre">
       min_samples
      </span>
     </code>
     hyperparameter
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#more-details-on-dbscan">
     More details on DBSCAN
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dbscan-algorithm">
     DBSCAN algorithm
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#k-means-vs-dbscan">
     K-Means vs. DBSCAN
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#illustration-of-hyperparameters-eps-and-min-samples">
     Illustration of hyperparameters
     <code class="docutils literal notranslate">
      <span class="pre">
       eps
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       min_samples
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#observations">
     Observations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#question-for-you">
     Question for you
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#evaluating-dbscan-clusters">
     Evaluating DBSCAN clusters
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#summary-pros-and-cons">
     Summary: Pros and cons
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dbscan-failure-cases">
     DBSCAN: failure cases
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     DBSCAN: failure cases
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#video-3-hierarchical-clustering-a-name-2-a">
   Video 3: Hierarchical clustering
   <a name="2">
   </a>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#motivation">
     Motivation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#main-idea">
     Main idea
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualizing-hierarchical-clustering">
     Visualizing hierarchical clustering
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hierarchical-clustering-input-and-output">
     Hierarchical clustering input and output
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dendrogram">
     Dendrogram
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-do-we-mean-by-distance-between-clusters">
     What do we mean by distance between clusters?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#single-linkage">
     <code class="docutils literal notranslate">
      <span class="pre">
       single
      </span>
     </code>
     linkage
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#creating-dendrogram-with-single-linkage">
     Creating dendrogram with
     <code class="docutils literal notranslate">
      <span class="pre">
       single
      </span>
     </code>
     linkage
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#average-linkage">
     <code class="docutils literal notranslate">
      <span class="pre">
       average
      </span>
     </code>
     linkage
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#complete-linkage">
     <code class="docutils literal notranslate">
      <span class="pre">
       complete
      </span>
     </code>
     linkage
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ward-linkage">
     <code class="docutils literal notranslate">
      <span class="pre">
       ward
      </span>
     </code>
     linkage
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hierarchical-clustering-on-un-subvotes-dataset">
     Hierarchical clustering on UN Subvotes dataset
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#truncation">
     Truncation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     Truncation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#flat-cluster">
     Flat cluster
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#video-4-applying-clustering-on-face-images-a-name-1-a">
   Video 4: Applying clustering on face images
   <a name="1">
   </a>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-images-from-the-dataset">
     Example images from the dataset
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#representation-of-images">
     Representation of images
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#clustering-faces-with-k-means">
     Clustering faces with K-Means
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#let-s-examine-cluster-centers">
     Let’s examine cluster centers
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#examining-images-for-different-centers">
     Examining images for different centers
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#let-s-try-dbscan-to-cluster-faces">
     Let’s try DBSCAN to cluster faces
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tuning-eps">
     Tuning
     <code class="docutils literal notranslate">
      <span class="pre">
       eps
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-are-noise-images">
     What are noise images?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#examining-dbscan-clusters">
     Examining DBSCAN clusters
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#video-5-final-comments-and-summary-a-name-1-a">
   Video 5: Final comments and summary
   <a name="1">
   </a>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#take-home-message">
     Take-home message
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-few-comments-on-clustering-evaluation">
     A few comments on clustering evaluation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     A few comments on clustering evaluation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     A few comments on clustering evaluation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#resources">
   Resources
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#questions-for-class-discussion-a-name-questions-a">
   Questions for class discussion
   <a name="questions">
   </a>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dbscan-true-false-questions">
     DBSCAN: True/False questions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#true-false-questions">
     True/False questions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#time-permitting">
     Time permitting
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="dsci-563-unsupervised-learning">
<h1>DSCI 563: Unsupervised Learning<a class="headerlink" href="#dsci-563-unsupervised-learning" title="Permalink to this headline">¶</a></h1>
<div class="section" id="lecture-2-dbscan-and-hierarchical-clustering">
<h2>Lecture 2: DBSCAN and Hierarchical Clustering<a class="headerlink" href="#lecture-2-dbscan-and-hierarchical-clustering" title="Permalink to this headline">¶</a></h2>
<p>UBC Master of Data Science program, 2020-21</p>
<p>Instructor: Varada Kolhatkar</p>
<p><br><br></p>
<div class="section" id="imports">
<h3>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;code/.&quot;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">mglearn</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interactive</span>
<span class="kn">from</span> <span class="nn">plotting_functions</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">scipy.cluster.hierarchy</span> <span class="kn">import</span> <span class="n">dendrogram</span><span class="p">,</span> <span class="n">fcluster</span><span class="p">,</span> <span class="n">linkage</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">metrics</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">DBSCAN</span><span class="p">,</span> <span class="n">AgglomerativeClustering</span><span class="p">,</span> <span class="n">KMeans</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_blobs</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics.pairwise</span> <span class="kn">import</span> <span class="n">euclidean_distances</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">support_functions</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">yellowbrick.cluster</span> <span class="kn">import</span> <span class="n">SilhouetteVisualizer</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;font.size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16</span>
<span class="c1"># plt.style.use(&quot;seaborn&quot;)</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_colwidth&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">80</span><span class="o">/</span><span class="n">kr9rkqfj4w78h49djkz8yy9r0000gp</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_19254</span><span class="o">/</span><span class="mf">2842264530.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span> <span class="kn">from</span> <span class="nn">sklearn.metrics.pairwise</span> <span class="kn">import</span> <span class="n">euclidean_distances</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span> <span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="ne">---&gt; </span><span class="mi">21</span> <span class="kn">from</span> <span class="nn">support_functions</span> <span class="kn">import</span> <span class="o">*</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span> <span class="kn">from</span> <span class="nn">yellowbrick.cluster</span> <span class="kn">import</span> <span class="n">SilhouetteVisualizer</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span> 

<span class="ne">ModuleNotFoundError</span>: No module named &#39;support_functions&#39;
</pre></div>
</div>
</div>
</div>
<p><br><br></p>
</div>
</div>
<div class="section" id="table-of-contents">
<h2>Table of contents<a class="headerlink" href="#table-of-contents" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="#lo">Learning outcomes</a></p></li>
<li><p><a class="reference external" href="#1">Video 1: Recap and motivation</a></p></li>
<li><p><a class="reference external" href="#2">Video 2: DBSCAN</a></p></li>
<li><p><a class="reference external" href="#3">Video 3: Hierarchical clustering</a></p></li>
<li><p><a class="reference external" href="#4">Video 4: Clustering on Faces in the Wild (LFW) people dataset</a></p></li>
<li><p><a class="reference external" href="#5">Video 5: Final comments and summary</a></p></li>
<li><p><a class="reference external" href="#questions">Questions for class discussion</a></p></li>
</ul>
<p><br><br></p>
</div>
<div class="section" id="learning-outcomes-a-name-lo-a">
<h2>Learning outcomes <a name="lo"></a><a class="headerlink" href="#learning-outcomes-a-name-lo-a" title="Permalink to this headline">¶</a></h2>
<p>From this lecture, students are expected to be able to:</p>
<ul class="simple">
<li><p>Identify limitations of K-Means.</p></li>
<li><p>Explain how DBSCAN works at a high level.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> to apply DBSCAN.</p></li>
<li><p>Explain the effect of epsilon and minimum samples hyperparameters in DBSCAN.</p></li>
<li><p>Identify DBSCAN limitations.</p></li>
<li><p>Explain the idea of hierarchical clustering.</p></li>
<li><p>Visualize dendrograms using <code class="docutils literal notranslate"><span class="pre">scipy.cluster.hierarchy.dendrogram</span></code>.</p></li>
<li><p>Explain the advantages and disadvantages of different clustering methods.</p></li>
<li><p>Apply clustering algorithms on image datasets and interpret clusters.</p></li>
<li><p>Recognize the impact of distance measure and representation in clustering methods.</p></li>
</ul>
<p><br><br><br><br></p>
</div>
<div class="section" id="video-1-recap-and-motivation-a-name-1-a">
<h2>Video 1: Recap and motivation <a name="1"></a><a class="headerlink" href="#video-1-recap-and-motivation-a-name-1-a" title="Permalink to this headline">¶</a></h2>
<div class="section" id="k-means-recap">
<h3>K-Means recap<a class="headerlink" href="#k-means-recap" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>We discussed K-Means clustering in the previous lecture.</p></li>
<li><p>Each cluster is represented by a center.</p></li>
<li><p>Given a new point, you can assign it to a cluster by computing the distances to all cluster centers and picking the cluster with the smallest distance.</p></li>
<li><p>It’s a popular algorithm because</p>
<ul>
<li><p>It’s easy to understand and implement.</p></li>
<li><p>Runs relatively quickly and scales well to large datasets.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sklearn</span></code> has a more scalable variant called <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.cluster.MiniBatchKMeans.html"><code class="docutils literal notranslate"><span class="pre">MiniBatchKMeans</span></code></a> which can handle very large datasets.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="k-means-limitations">
<h3>K-Means limitations<a class="headerlink" href="#k-means-limitations" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Relies on random initialization and so the outcome may change depending upon this initialization.</p></li>
<li><p>K-Means clustering requires to specify the number of clusters in advance.</p></li>
<li><p>Very often you do not know the centers in advance. The elbow method or the silhouette method to find the optimal number of clusters are not always easy to interpret.</p></li>
<li><p>Each point has to have a cluster assignment.</p></li>
</ul>
</div>
<div class="section" id="k-means-limitations-shape-of-k-means-clusters">
<h3>K-Means limitations: Shape of K-Means clusters<a class="headerlink" href="#k-means-limitations-shape-of-k-means-clusters" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>K-Means partitions the space based on the closest mean.</p></li>
<li><p>Each cluster is defined solely by its center and so it can only capture relatively simple shapes.</p></li>
<li><p>So the boundaries between clusters are linear; It fails to identify clusters with complex shapes.</p></li>
</ul>
<center>
<img src="img/kmeans_boundaries.png" alt="" height="500" width="500"> 
</center>    
<p><a class="reference external" href="https://scikit-learn.org/stable/auto_examples/cluster/plot_kmeans_digits.html">Source</a></p>
</div>
<div class="section" id="k-means-failure-case-1">
<h3>K-Means: failure case 1<a class="headerlink" href="#k-means-failure-case-1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>K-Means performs poorly if the clusters have more complex shapes (e.g., two moons data below).</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_moons</span>

<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_moons</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">plot_X_k_means</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="k-means-failure-case-2">
<h3>K-Means: failure case 2<a class="headerlink" href="#k-means-failure-case-2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>It assumes that all directions are equally important for each cluster and fails to identify non-spherical clusters.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># generate some random cluster data</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_blobs</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">170</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">74</span><span class="p">)</span>
<span class="n">transformation</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">transformation</span><span class="p">)</span>
<span class="n">plot_X_k_means</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="k-means-failure-case-3">
<h3>K-Means: failure case 3<a class="headerlink" href="#k-means-failure-case-3" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Again, K-Means is unable to capture complex cluster shapes.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">make_circles</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">plot_X_k_means</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Can we do better than this?</p></li>
<li><p>Another clustering algorithm called DBSCAN is able to tackle some of these cases.</p></li>
</ul>
<p><br><br><br><br><br><br></p>
</div>
</div>
<div class="section" id="video-2-dbscan-a-name-2-a">
<h2>Video 2: DBSCAN <a name="2"></a><a class="headerlink" href="#video-2-dbscan-a-name-2-a" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>D</strong>ensity-<strong>B</strong>ased <strong>S</strong>patial <strong>C</strong>lustering of <strong>A</strong>pplications with <strong>N</strong>oise</p></li>
</ul>
<div class="section" id="dbscan-introduction">
<h3>DBSCAN introduction<a class="headerlink" href="#dbscan-introduction" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>DBSCAN is a density-based clustering algorithm.</p></li>
<li><p>Intuitively, it’s based on the idea that clusters form dense regions in the data and so it works by identifying “crowded” regions in the feature space.</p></li>
<li><p>It can address some of the limitations of K-Means we saw above.</p>
<ul>
<li><p>It does not require the user to specify the number of clusters in advance.</p></li>
<li><p>It can identify points that are not part of any clusters.</p></li>
<li><p>It can capture clusters of complex shapes.</p></li>
</ul>
</li>
</ul>
<p>Let’s try <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>’s DBSCAN.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_moons</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">dbscan</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">dbscan</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">plot_X_dbscan</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">dbscan</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dbscan</span><span class="o">.</span><span class="n">labels_</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>DBSCAN is able to capture half moons shape</p></li>
<li><p>We don’t not have to specify the number of clusters.</p>
<ul>
<li><p>That said, it has two other non-trivial hyperparameters to tune.</p></li>
</ul>
</li>
<li><p>There are two examples which have not been assigned any label (noise examples).</p></li>
</ul>
<p>One more example of DBSCAN clusters capturing complex cluster shapes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">make_circles</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">dbscan</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">dbscan</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">plot_X_dbscan</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">dbscan</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="how-does-it-work">
<h3>How does it work?<a class="headerlink" href="#how-does-it-work" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Iterative algorithm.</p></li>
<li><p>Based on the idea that clusters form dense regions in the data.</p></li>
</ul>
<center>
<img src="img/DBSCAN_search.gif" alt="" height="900" width="900"> 
</center>
<p><a class="reference external" href="https://dashee87.github.io/data%20science/general/Clustering-with-Scikit-with-GIFs/">Source</a></p>
</div>
<div class="section" id="two-main-hyperparameters">
<h3>Two main hyperparameters<a class="headerlink" href="#two-main-hyperparameters" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">eps</span></code>: determines what it means for points to be “close”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">min_samples</span></code>: determines the number of <strong>neighboring points</strong> we require to consider in order for a point to be part of a cluster</p></li>
</ul>
</div>
<div class="section" id="effect-of-eps-hyperparameter">
<h3>Effect of <code class="docutils literal notranslate"><span class="pre">eps</span></code> hyperparameter<a class="headerlink" href="#effect-of-eps-hyperparameter" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interactive</span><span class="p">(</span><span class="k">lambda</span> <span class="n">eps</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">eps</span><span class="p">),</span> <span class="n">eps</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_blobs</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">centers</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">interactive</span><span class="p">(</span><span class="k">lambda</span> <span class="n">eps</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span> <span class="n">plot_dbscan_with_labels</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">eps</span><span class="p">),</span> <span class="n">eps</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">euclidean_distances</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">X</span><span class="p">))</span><span class="o">.</span><span class="n">round</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="effect-of-min-samples-hyperparameter">
<h3>Effect of <code class="docutils literal notranslate"><span class="pre">min_samples</span></code> hyperparameter<a class="headerlink" href="#effect-of-min-samples-hyperparameter" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interactive</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">min_samples</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span> <span class="n">plot_dbscan_with_labels</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="n">min_samples</span><span class="p">),</span>
    <span class="n">min_samples</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="more-details-on-dbscan">
<h3>More details on DBSCAN<a class="headerlink" href="#more-details-on-dbscan" title="Permalink to this headline">¶</a></h3>
<p>There are three kinds of points.</p>
<ul class="simple">
<li><p><strong>Core points</strong> are the points that have at least <code class="docutils literal notranslate"><span class="pre">min_samples</span></code> points in the neighborhood.</p></li>
<li><p><strong>Border points</strong> are the points with fewer than <code class="docutils literal notranslate"><span class="pre">min_samples</span></code> points in the neighborhood, but are connected to a core point.</p></li>
<li><p><strong>Noise points</strong> are the points which do not belong to any cluster. In other words, the points which have less that <code class="docutils literal notranslate"><span class="pre">min_samples</span></code> point within distance <code class="docutils literal notranslate"><span class="pre">eps</span></code> of the starting point are noise points.</p></li>
</ul>
</div>
<div class="section" id="dbscan-algorithm">
<h3>DBSCAN algorithm<a class="headerlink" href="#dbscan-algorithm" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Pick a point <span class="math notranslate nohighlight">\(p\)</span> at random.</p></li>
<li><p>Check whether <span class="math notranslate nohighlight">\(p\)</span> is a “core” point or not. You can check this by looking at the number of neighbours within epsilon distance if they have at least <code class="docutils literal notranslate"><span class="pre">min_samples</span></code> points in the neighbourhood</p></li>
<li><p>If <span class="math notranslate nohighlight">\(p\)</span> is a core point, give it a colour (label).</p></li>
<li><p>Spread the colour of <span class="math notranslate nohighlight">\(p\)</span> to all of its neighbours.</p></li>
<li><p>Check if any of the neighbours that received the colour is a core point, if yes, spread the colour to its neighbors as well.</p></li>
<li><p>Once there are no more core points left to spread the colour, pick a new unlabeled point <span class="math notranslate nohighlight">\(p\)</span> and repeat the process.</p></li>
</ul>
</div>
<div class="section" id="k-means-vs-dbscan">
<h3>K-Means vs. DBSCAN<a class="headerlink" href="#k-means-vs-dbscan" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>In DBSCAN, you do not have to specify the number of clusters!</p>
<ul>
<li><p>Instead, you have to tune <code class="docutils literal notranslate"><span class="pre">eps</span></code> and <code class="docutils literal notranslate"><span class="pre">min_samples</span></code>.</p></li>
</ul>
</li>
<li><p>Unlike K-Means, DBSCAN doesn’t have to assign all points to clusters.</p>
<ul>
<li><p>The label is -1 if a point is unassigned.</p></li>
</ul>
</li>
<li><p>Unlike K-Means, there is no <code class="docutils literal notranslate"><span class="pre">predict</span></code> method.</p>
<ul>
<li><p>DBSCAN only really clusters the points you have, not “new” or “test” points.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="illustration-of-hyperparameters-eps-and-min-samples">
<h3>Illustration of hyperparameters <code class="docutils literal notranslate"><span class="pre">eps</span></code> and <code class="docutils literal notranslate"><span class="pre">min_samples</span></code><a class="headerlink" href="#illustration-of-hyperparameters-eps-and-min-samples" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_blobs</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">mglearn</span><span class="o">.</span><span class="n">discrete_scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dbscan</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">()</span>
<span class="n">clusters</span> <span class="o">=</span> <span class="n">dbscan</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cluster memberships:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">clusters</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Default values for hyperparameters don’t work well on toy datasets.</p></li>
<li><p>All points have been marked as noise with the default values for <code class="docutils literal notranslate"><span class="pre">eps</span></code> and <code class="docutils literal notranslate"><span class="pre">min_samples</span></code></p></li>
<li><p>Let’s examine the effect of changing these hyperparameters.</p>
<ul>
<li><p>noise points: shown in white</p></li>
<li><p>core points: bigger</p></li>
<li><p>border points: smaller</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mglearn</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">plot_dbscan</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="observations">
<h3>Observations<a class="headerlink" href="#observations" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Increasing <code class="docutils literal notranslate"><span class="pre">eps</span></code> (<span class="math notranslate nohighlight">\(\uparrow\)</span>) (left to right in the plot above) means more points will be included in a cluster.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">eps</span></code> = 1.0 either creates more clusters or more noise points, whereas eps=3.0 puts all points in one cluster with no noise points.</p></li>
</ul>
</li>
<li><p>Increasing <code class="docutils literal notranslate"><span class="pre">min_samples</span></code> (<span class="math notranslate nohighlight">\(\uparrow\)</span>) (top to bottom in the plot above) means points in less dense regions will either be labeled as their own cluster or noise.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">min_samples=2</span></code>, for instance, has none or only a fewer noise points whereas <code class="docutils literal notranslate"><span class="pre">min_samples=5</span></code> has several noise points.</p></li>
</ul>
</li>
<li><p>Here <code class="docutils literal notranslate"><span class="pre">min_samples</span></code> = 2.0 or 3.0 and <code class="docutils literal notranslate"><span class="pre">eps</span></code> = 1.5 is giving us the best results.</p></li>
<li><p>In general, it’s not trivial to tune these hyperparameters.</p></li>
</ul>
</div>
<div class="section" id="question-for-you">
<h3>Question for you<a class="headerlink" href="#question-for-you" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Does the order that you pick the points matter in DBSCAN?
<br><br><br><br></p></li>
</ul>
<blockquote>
<div><p>No. Any of the cluster’s core points is able to fully identify the cluster, with no randomness involved. The only possible conflict you might get is that if two clusters have the same border point. In this case the assignment will be implementation dependent, but usually the border point will be assigned to the first cluster that “finds” it.</p>
</div></blockquote>
</div>
<div class="section" id="evaluating-dbscan-clusters">
<h3>Evaluating DBSCAN clusters<a class="headerlink" href="#evaluating-dbscan-clusters" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>We cannot use the elbow method to examine the goodness of clusters created with DBSCAN.</p></li>
<li><p>But we can use the silhouette method because it’s not dependent on the idea of cluster centers.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_blobs</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">centers</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">dbscan</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">dbscan</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">plot_X_dbscan</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">dbscan</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_lecture-DBSCAN-hierarchical_49_0.png" src="../_images/02_lecture-DBSCAN-hierarchical_49_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Yellowbrick is designed to work with K-Means and not with DBSCAN.</span>
<span class="c1"># So it needs the number of clusters stored in n_clusters</span>
<span class="c1"># It also needs `predict` method to be implemented.</span>
<span class="c1"># So I&#39;m implementing it here so that we can use Yellowbrick to show Silhouette plots.</span>
<span class="n">n_clusters</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dbscan</span><span class="o">.</span><span class="n">labels_</span><span class="p">))</span>
<span class="n">dbscan</span><span class="o">.</span><span class="n">n_clusters</span> <span class="o">=</span> <span class="n">n_clusters</span>
<span class="n">dbscan</span><span class="o">.</span><span class="n">predict</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">dbscan</span><span class="o">.</span><span class="n">labels_</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visualizer</span> <span class="o">=</span> <span class="n">SilhouetteVisualizer</span><span class="p">(</span><span class="n">dbscan</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s2">&quot;yellowbrick&quot;</span><span class="p">)</span>
<span class="n">visualizer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>  <span class="c1"># Fit the data to the visualizer</span>
<span class="n">visualizer</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_lecture-DBSCAN-hierarchical_51_0.png" src="../_images/02_lecture-DBSCAN-hierarchical_51_0.png" />
</div>
</div>
</div>
<div class="section" id="summary-pros-and-cons">
<h3>Summary: Pros and cons<a class="headerlink" href="#summary-pros-and-cons" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Pros</p>
<ul>
<li><p>Can learn arbitrary cluster shapes</p></li>
<li><p>Can detect outliers</p></li>
</ul>
</li>
<li><p>Cons</p>
<ul>
<li><p>Cannot <code class="docutils literal notranslate"><span class="pre">predict</span></code> on new examples.</p></li>
<li><p>Needs tuning of two non-obvious hyperparameters</p></li>
</ul>
</li>
</ul>
<p>There is an improved version of DBSCAN called <a class="reference external" href="https://github.com/scikit-learn-contrib/hdbscan"><code class="docutils literal notranslate"><span class="pre">HDBSCAN</span></code> (hierarchical DBSCAN)</a>.</p>
</div>
<div class="section" id="dbscan-failure-cases">
<h3>DBSCAN: failure cases<a class="headerlink" href="#dbscan-failure-cases" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>DBSCAN is able to capture complex clusters. But this doesn’t mean that <code class="docutils literal notranslate"><span class="pre">DBSCAN</span></code> always works better. It has its own problems!</p></li>
<li><p>DBSCAN doesn’t do well when we have clusters with different densities.</p>
<ul>
<li><p>You can play with the hyperparameters but it’s not likely to help much.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id1">
<h3>DBSCAN: failure cases<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Let’s consider this dataset with three clusters of varying densities.</p></li>
<li><p>K-Means performs better compared to DBSCAN. But it has the benefit of knowing the value of <span class="math notranslate nohighlight">\(K\)</span> in advance.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_varied</span><span class="p">,</span> <span class="n">y_varied</span> <span class="o">=</span> <span class="n">make_blobs</span><span class="p">(</span>
    <span class="n">n_samples</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">cluster_std</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>
<span class="n">plot_k_means_dbscan_comparison</span><span class="p">(</span><span class="n">X_varied</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_lecture-DBSCAN-hierarchical_55_0.png" src="../_images/02_lecture-DBSCAN-hierarchical_55_0.png" />
</div>
</div>
<p><br><br><br><br></p>
</div>
</div>
<div class="section" id="video-3-hierarchical-clustering-a-name-2-a">
<h2>Video 3: Hierarchical clustering  <a name="2"></a><a class="headerlink" href="#video-3-hierarchical-clustering-a-name-2-a" title="Permalink to this headline">¶</a></h2>
<div class="section" id="motivation">
<h3>Motivation<a class="headerlink" href="#motivation" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Deciding how many clusters we want is a hard problem.</p></li>
<li><p>Often, it’s useful to get a complete picture of similarity between points in our data before picking the number of clusters.</p></li>
<li><p>Hierarchical clustering is helpful in these scenarios.</p></li>
</ul>
</div>
<div class="section" id="main-idea">
<h3>Main idea<a class="headerlink" href="#main-idea" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p>Start with each point in its own cluster.</p></li>
<li><p>Greedily merge most similar <em>clusters</em>.</p></li>
<li><p>Repeat Step 2 until you obtain only one cluster (<span class="math notranslate nohighlight">\(n-1\)</span> times).</p></li>
</ol>
</div>
<div class="section" id="visualizing-hierarchical-clustering">
<h3>Visualizing hierarchical clustering<a class="headerlink" href="#visualizing-hierarchical-clustering" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Hierarchical clustering can be visualized using a tool called <strong>a dendrogram</strong>.</p></li>
<li><p>Unfortunately, <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> cannot do it so we will use the package <code class="docutils literal notranslate"><span class="pre">scipy.cluster.hierarchy</span></code> for hierarchical clustering.</p></li>
</ul>
</div>
<div class="section" id="hierarchical-clustering-input-and-output">
<h3>Hierarchical clustering input and output<a class="headerlink" href="#hierarchical-clustering-input-and-output" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_blobs</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">linkage_array</span> <span class="o">=</span> <span class="n">ward</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">plot_X_dendrogram</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">linkage_array</span><span class="p">,</span> <span class="n">label_n_clusters</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_lecture-DBSCAN-hierarchical_62_0.png" src="../_images/02_lecture-DBSCAN-hierarchical_62_0.png" />
</div>
</div>
<ul class="simple">
<li><p>Every point goes through the journey of being on its own (its own cluster) and getting merged with some other bigger clusters.</p></li>
<li><p>The intermediate steps in the process provide us clustering with different number of clusters.</p></li>
</ul>
</div>
<div class="section" id="dendrogram">
<h3>Dendrogram<a class="headerlink" href="#dendrogram" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Dendrogram is a tree-like plot.</p></li>
<li><p>On the x-axis we have data points.</p></li>
<li><p>On the y-axis we have distances between clusters.</p></li>
<li><p>We start with data points as leaves of the tree.</p></li>
<li><p>New parent node is created for every two clusters that are joined.</p></li>
<li><p>The length of each branch shown how far the merged clusters go.</p>
<ul>
<li><p>In the dendrogram above going from three clusters to two clusters means merging far apart points because the branches between three cluster to two clusters are long.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="what-do-we-mean-by-distance-between-clusters">
<h3>What do we mean by distance between clusters?<a class="headerlink" href="#what-do-we-mean-by-distance-between-clusters" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>We know how to measure distance between points (e.g., using Euclidean distance).</p></li>
<li><p>How do we measure distances between clusters?</p></li>
<li><p>The <strong>linkage criteria</strong> determines how to find similarity between clusters:</p></li>
<li><p>Some example linkage criteria are:</p>
<ul>
<li><p>single linkage (minimum distance)</p></li>
<li><p>average linkage (average distance)</p></li>
<li><p>complete (or maximum) linkage (maximum distance)</p></li>
<li><p>ward linkage</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_X_dendrogram</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">linkage_array</span><span class="p">,</span> <span class="n">label_n_clusters</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_lecture-DBSCAN-hierarchical_66_0.png" src="../_images/02_lecture-DBSCAN-hierarchical_66_0.png" />
</div>
</div>
</div>
<div class="section" id="single-linkage">
<h3><code class="docutils literal notranslate"><span class="pre">single</span></code> linkage<a class="headerlink" href="#single-linkage" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Merges two clusters that have the smallest minimum distance between all their points.</p></li>
<li><p>Let’s use <code class="docutils literal notranslate"><span class="pre">scipy.cluster.hierarchy</span></code>’s <code class="docutils literal notranslate"><span class="pre">single</span></code> to get linkage information.</p></li>
<li><p>This method gives us matrix <code class="docutils literal notranslate"><span class="pre">Z</span></code> with the merging information.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.cluster.hierarchy</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">average</span><span class="p">,</span>
    <span class="n">complete</span><span class="p">,</span>
    <span class="n">dendrogram</span><span class="p">,</span>
    <span class="n">fcluster</span><span class="p">,</span>
    <span class="n">single</span><span class="p">,</span>
    <span class="n">ward</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">Z</span> <span class="o">=</span> <span class="n">single</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;c1&quot;</span><span class="p">,</span> <span class="s2">&quot;c2&quot;</span><span class="p">,</span> <span class="s2">&quot;distance(c1, c2)&quot;</span><span class="p">,</span> <span class="s2">&quot;# observations&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>c1</th>
      <th>c2</th>
      <th>distance(c1, c2)</th>
      <th># observations</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>2.0</td>
      <td>0.332095</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5.0</td>
      <td>9.0</td>
      <td>0.645802</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7.0</td>
      <td>11.0</td>
      <td>0.911272</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3.0</td>
      <td>12.0</td>
      <td>0.989059</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4.0</td>
      <td>13.0</td>
      <td>1.072565</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>The linkage returns a matrix <code class="docutils literal notranslate"><span class="pre">Z</span></code> of shape n-1 by 4:</p></li>
<li><p>The rows represent iterations.</p></li>
<li><p>First and second columns (c1 and c2 above): indexes of the clusters being merged.</p></li>
<li><p>Third column (distance(c1, c2)): the distance between the clusters being merged.</p></li>
<li><p>Fourth column (# observations): the number of examples in the newly formed cluster.</p></li>
</ul>
</div>
<div class="section" id="creating-dendrogram-with-single-linkage">
<h3>Creating dendrogram with <code class="docutils literal notranslate"><span class="pre">single</span></code> linkage<a class="headerlink" href="#creating-dendrogram-with-single-linkage" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dendrogram</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
<span class="c1"># Z is our single linkage matrix</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Dendrogram (Single linkage)&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_lecture-DBSCAN-hierarchical_72_0.png" src="../_images/02_lecture-DBSCAN-hierarchical_72_0.png" />
</div>
</div>
</div>
<div class="section" id="average-linkage">
<h3><code class="docutils literal notranslate"><span class="pre">average</span></code> linkage<a class="headerlink" href="#average-linkage" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Merges two clusters that have the smallest average distance between all their points.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scipy.cluster.hierarchy</span></code>’s <code class="docutils literal notranslate"><span class="pre">average</span></code> method gives us matrix <code class="docutils literal notranslate"><span class="pre">Z</span></code> with the merging information using average linkage.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Z</span> <span class="o">=</span> <span class="n">average</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">dendrogram</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
<span class="c1"># Dendrogram with average linkage</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Dendrogram (Average linkage)&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_lecture-DBSCAN-hierarchical_74_0.png" src="../_images/02_lecture-DBSCAN-hierarchical_74_0.png" />
</div>
</div>
</div>
<div class="section" id="complete-linkage">
<h3><code class="docutils literal notranslate"><span class="pre">complete</span></code> linkage<a class="headerlink" href="#complete-linkage" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Merges two clusters that have the smallest maximum distance between their points.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Z</span> <span class="o">=</span> <span class="n">complete</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">dendrogram</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
<span class="c1"># Dendrogram with complete linkage</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Dendrogram (Complete linkage)&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_lecture-DBSCAN-hierarchical_76_0.png" src="../_images/02_lecture-DBSCAN-hierarchical_76_0.png" />
</div>
</div>
</div>
<div class="section" id="ward-linkage">
<h3><code class="docutils literal notranslate"><span class="pre">ward</span></code> linkage<a class="headerlink" href="#ward-linkage" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Picks two clusters to merge such that the variance within all clusters increases the least.</p></li>
<li><p>Often leads to equally sized clusters.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Z</span> <span class="o">=</span> <span class="n">ward</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">dendrogram</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
<span class="c1"># Dendrogram with ward linkage</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Dendrogram (Ward linkage)&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_lecture-DBSCAN-hierarchical_78_0.png" src="../_images/02_lecture-DBSCAN-hierarchical_78_0.png" />
</div>
</div>
<p><br><br></p>
</div>
<div class="section" id="hierarchical-clustering-on-un-subvotes-dataset">
<h3>Hierarchical clustering on UN Subvotes dataset<a class="headerlink" href="#hierarchical-clustering-on-un-subvotes-dataset" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Let’s use a dataset of votes on UN resolutions:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">votes_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/subvotes.csv&quot;</span><span class="p">)</span>
<span class="n">votes</span> <span class="o">=</span> <span class="n">votes_df</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;country&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;rcid&quot;</span><span class="p">)</span>
<span class="n">votes</span> <span class="o">=</span> <span class="n">votes</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">votes</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">votes</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">votes</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(17, 368)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="21" halign="left">vote</th>
    </tr>
    <tr>
      <th>rcid</th>
      <th>2491</th>
      <th>2492</th>
      <th>2497</th>
      <th>2504</th>
      <th>2510</th>
      <th>2526</th>
      <th>2563</th>
      <th>2610</th>
      <th>2641</th>
      <th>2645</th>
      <th>...</th>
      <th>5321</th>
      <th>5333</th>
      <th>5337</th>
      <th>5358</th>
      <th>5363</th>
      <th>5364</th>
      <th>5365</th>
      <th>5367</th>
      <th>5383</th>
      <th>5385</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Australia</th>
      <td>1.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>...</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Austria</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>...</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Brazil</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>...</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>Colombia</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>...</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>Denmark</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>...</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 368 columns</p>
</div></div></div>
</div>
<ul class="simple">
<li><p>We have 17 countries and 368 votes.</p></li>
<li><p>Let’s cluster countries based on how they vote.</p></li>
</ul>
<ul class="simple">
<li><p>We’ll use <a class="reference external" href="https://en.wikipedia.org/wiki/Hamming_distance">hamming distance</a> here because we are interested in knowing whether the countries agreed or disagreed on resolutions.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_dendrogram</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;average&quot;</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;hamming&quot;</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mi">12</span><span class="p">):</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">linkage</span><span class="p">(</span><span class="n">votes</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">))</span>
    <span class="n">dendrogram</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">votes</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Distance&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_dendrogram</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_lecture-DBSCAN-hierarchical_85_0.png" src="../_images/02_lecture-DBSCAN-hierarchical_85_0.png" />
</div>
</div>
</div>
<div class="section" id="truncation">
<h3>Truncation<a class="headerlink" href="#truncation" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>If you want to truncate the tree in the dendrogram (specially when you have a big <span class="math notranslate nohighlight">\(n\)</span>) you can use the <code class="docutils literal notranslate"><span class="pre">truncate_mode</span></code>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Z</span> <span class="o">=</span> <span class="n">linkage</span><span class="p">(</span><span class="n">votes</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;average&quot;</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;hamming&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">dendrogram</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">truncate_mode</span><span class="o">=</span><span class="s2">&quot;lastp&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">votes</span><span class="o">.</span><span class="n">index</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_lecture-DBSCAN-hierarchical_87_0.png" src="../_images/02_lecture-DBSCAN-hierarchical_87_0.png" />
</div>
</div>
</div>
<div class="section" id="id2">
<h3>Truncation<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Alternatively, you can truncate the tree down to <span class="math notranslate nohighlight">\(x\)</span> levels from the single cluster:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">dendrogram</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">truncate_mode</span><span class="o">=</span><span class="s2">&quot;level&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">votes</span><span class="o">.</span><span class="n">index</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_lecture-DBSCAN-hierarchical_89_0.png" src="../_images/02_lecture-DBSCAN-hierarchical_89_0.png" />
</div>
</div>
</div>
<div class="section" id="flat-cluster">
<h3>Flat cluster<a class="headerlink" href="#flat-cluster" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>To bring the clustering to a “flat” format, we can use <code class="docutils literal notranslate"><span class="pre">fcluster</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.cluster.hierarchy</span> <span class="kn">import</span> <span class="n">fcluster</span>

<span class="n">cluster_labels</span> <span class="o">=</span> <span class="n">fcluster</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s2">&quot;maxclust&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cluster_labels</span><span class="p">,</span> <span class="n">votes</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Australia</th>
      <td>2</td>
    </tr>
    <tr>
      <th>Austria</th>
      <td>1</td>
    </tr>
    <tr>
      <th>Brazil</th>
      <td>5</td>
    </tr>
    <tr>
      <th>Colombia</th>
      <td>4</td>
    </tr>
    <tr>
      <th>Denmark</th>
      <td>1</td>
    </tr>
    <tr>
      <th>Finland</th>
      <td>1</td>
    </tr>
    <tr>
      <th>Italy</th>
      <td>1</td>
    </tr>
    <tr>
      <th>Japan</th>
      <td>1</td>
    </tr>
    <tr>
      <th>Malaysia</th>
      <td>3</td>
    </tr>
    <tr>
      <th>Netherlands</th>
      <td>1</td>
    </tr>
    <tr>
      <th>Norway</th>
      <td>1</td>
    </tr>
    <tr>
      <th>Peru</th>
      <td>4</td>
    </tr>
    <tr>
      <th>Portugal</th>
      <td>1</td>
    </tr>
    <tr>
      <th>Spain</th>
      <td>1</td>
    </tr>
    <tr>
      <th>Sri Lanka</th>
      <td>3</td>
    </tr>
    <tr>
      <th>UK</th>
      <td>1</td>
    </tr>
    <tr>
      <th>USA</th>
      <td>6</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><br><br><br><br></p>
</div>
</div>
<div class="section" id="video-4-applying-clustering-on-face-images-a-name-1-a">
<h2>Video 4: Applying clustering on face images <a name="1"></a><a class="headerlink" href="#video-4-applying-clustering-on-face-images-a-name-1-a" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>We’ll be working with <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>’s <a class="reference external" href="https://scikit-learn.org/0.16/datasets/labeled_faces.html">Labeled Faces in the Wild dataset</a>.</p></li>
<li><p>The dataset has images of celebrities from the early 2000s downloaded from the internet.</p></li>
</ul>
<blockquote>
<div><p>Credit: This example is based on the example from <a class="reference external" href="https://learning.oreilly.com/library/view/introduction-to-machine/9781449369880/ch03.html">here</a>.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_lfw_people</span>

<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">rcParamsDefault</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;image.cmap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;gray&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="example-images-from-the-dataset">
<h3>Example images from the dataset<a class="headerlink" href="#example-images-from-the-dataset" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">people</span> <span class="o">=</span> <span class="n">fetch_lfw_people</span><span class="p">(</span><span class="n">min_faces_per_person</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">resize</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;xticks&quot;</span><span class="p">:</span> <span class="p">(),</span> <span class="s2">&quot;yticks&quot;</span><span class="p">:</span> <span class="p">()})</span>
<span class="k">for</span> <span class="n">target</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">people</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">people</span><span class="o">.</span><span class="n">images</span><span class="p">,</span> <span class="n">axes</span><span class="o">.</span><span class="n">ravel</span><span class="p">()):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">people</span><span class="o">.</span><span class="n">target_names</span><span class="p">[</span><span class="n">target</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_lecture-DBSCAN-hierarchical_98_0.png" src="../_images/02_lecture-DBSCAN-hierarchical_98_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">image_shape</span> <span class="o">=</span> <span class="n">people</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;people.images.shape: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">people</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of classes: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">people</span><span class="o">.</span><span class="n">target_names</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>people.images.shape: (3023, 87, 65)
Number of classes: 62
</pre></div>
</div>
</div>
</div>
<p>There are 3,023 images stored as arrays of 5655 pixels (87 by 65), of 62 different people:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># count how often each target appears</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">people</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">people</span><span class="o">.</span><span class="n">target_names</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>George W Bush</th>
      <td>530</td>
    </tr>
    <tr>
      <th>Colin Powell</th>
      <td>236</td>
    </tr>
    <tr>
      <th>Tony Blair</th>
      <td>144</td>
    </tr>
    <tr>
      <th>Donald Rumsfeld</th>
      <td>121</td>
    </tr>
    <tr>
      <th>Gerhard Schroeder</th>
      <td>109</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>Angelina Jolie</th>
      <td>20</td>
    </tr>
    <tr>
      <th>Jiang Zemin</th>
      <td>20</td>
    </tr>
    <tr>
      <th>Paul Bremer</th>
      <td>20</td>
    </tr>
    <tr>
      <th>Igor Ivanov</th>
      <td>20</td>
    </tr>
    <tr>
      <th>Michael Bloomberg</th>
      <td>20</td>
    </tr>
  </tbody>
</table>
<p>62 rows × 1 columns</p>
</div></div></div>
</div>
<p>Let’s make the data less skewed by taking only 20 images of the each person.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">people</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
<span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">people</span><span class="o">.</span><span class="n">target</span><span class="p">):</span>
    <span class="n">mask</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">people</span><span class="o">.</span><span class="n">target</span> <span class="o">==</span> <span class="n">target</span><span class="p">)[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">20</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">X_people</span> <span class="o">=</span> <span class="n">people</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
<span class="n">y_people</span> <span class="o">=</span> <span class="n">people</span><span class="o">.</span><span class="n">target</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_people</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1240, 5655)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># scale the grayscale values to be between 0 and 1</span>
<span class="c1"># instead of 0 and 255 for better numeric stability</span>
<span class="n">X_people</span> <span class="o">=</span> <span class="n">X_people</span> <span class="o">/</span> <span class="mf">255.0</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="representation-of-images">
<h3>Representation of images<a class="headerlink" href="#representation-of-images" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Representation of input is very important when you cluster examples.</p></li>
<li><p>In this example, we’ll use PCA representation. (We’ll learn about PCA next week.)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>

<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">whiten</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">X_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_people</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="clustering-faces-with-k-means">
<h3>Clustering faces with K-Means<a class="headerlink" href="#clustering-faces-with-k-means" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">km</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">km</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_pca</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>KMeans(n_clusters=10, random_state=10)
</pre></div>
</div>
</div>
</div>
<p>What are the sizes of the clusters?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labels_km</span> <span class="o">=</span> <span class="n">km</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">X_pca</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cluster sizes k-means: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">labels_km</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cluster sizes k-means: [ 36 309  65 108  89  39  98 210 168 118]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="let-s-examine-cluster-centers">
<h3>Let’s examine cluster centers<a class="headerlink" href="#let-s-examine-cluster-centers" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_faces_cluster_centers</span><span class="p">(</span><span class="n">km</span><span class="p">,</span> <span class="n">pca</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_lecture-DBSCAN-hierarchical_113_0.png" src="../_images/02_lecture-DBSCAN-hierarchical_113_0.png" />
</div>
</div>
<ul class="simple">
<li><p>The centers found by K-Means are smooth versions of faces which makes sense.</p></li>
<li><p>Intuitively, they seem to capture some interesting characteristics of faces:</p>
<ul>
<li><p>grumpy faces</p></li>
<li><p>faces somewhat rotated to the left/right</p></li>
<li><p>Smiley faces</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="examining-images-for-different-centers">
<h3>Examining images for different centers<a class="headerlink" href="#examining-images-for-different-centers" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">get_cluster_images</span><span class="p">(</span><span class="n">km</span><span class="p">,</span> <span class="n">X_people</span><span class="p">,</span> <span class="n">y_people</span><span class="p">,</span> <span class="n">people</span><span class="o">.</span><span class="n">target_names</span><span class="p">,</span> <span class="n">pca</span> <span class="o">=</span> <span class="n">pca</span><span class="p">,</span> <span class="n">X_pca</span><span class="o">=</span><span class="n">X_pca</span><span class="p">,</span> <span class="n">cluster</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_lecture-DBSCAN-hierarchical_116_0.png" src="../_images/02_lecture-DBSCAN-hierarchical_116_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">get_cluster_images</span><span class="p">(</span><span class="n">km</span><span class="p">,</span> <span class="n">X_people</span><span class="p">,</span> <span class="n">y_people</span><span class="p">,</span> <span class="n">people</span><span class="o">.</span><span class="n">target_names</span><span class="p">,</span> <span class="n">pca</span> <span class="o">=</span> <span class="n">pca</span><span class="p">,</span> <span class="n">X_pca</span><span class="o">=</span><span class="n">X_pca</span><span class="p">,</span> <span class="n">cluster</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_lecture-DBSCAN-hierarchical_117_0.png" src="../_images/02_lecture-DBSCAN-hierarchical_117_0.png" />
</div>
</div>
</div>
<div class="section" id="let-s-try-dbscan-to-cluster-faces">
<h3>Let’s try DBSCAN to cluster faces<a class="headerlink" href="#let-s-try-dbscan-to-cluster-faces" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dbscan</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">()</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">dbscan</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">X_pca</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unique labels: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Unique labels: [-1]
</pre></div>
</div>
</div>
</div>
<p>With default hyperparameters, we get all points as noise points.</p>
</div>
<div class="section" id="tuning-eps">
<h3>Tuning <code class="docutils literal notranslate"><span class="pre">eps</span></code><a class="headerlink" href="#tuning-eps" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">eps</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">eps=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">eps</span><span class="p">))</span>
    <span class="n">dbscan</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">dbscan</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">X_pca</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of clusters: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels</span><span class="p">))))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cluster sizes: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">labels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>eps=6
Number of clusters: 1
Cluster sizes: [1240]

eps=8
Number of clusters: 5
Cluster sizes: [1100  130    3    4    3]

eps=9
Number of clusters: 4
Cluster sizes: [841 393   3   3]

eps=10
Number of clusters: 2
Cluster sizes: [521 719]

eps=11
Number of clusters: 2
Cluster sizes: [282 958]

eps=12
Number of clusters: 2
Cluster sizes: [ 150 1090]

eps=14
Number of clusters: 2
Cluster sizes: [  45 1195]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="what-are-noise-images">
<h3>What are noise images?<a class="headerlink" href="#what-are-noise-images" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dbscan</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">dbscan</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">X_pca</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unique labels: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Unique labels: [-1  0]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">print_dbscan_noise_images</span><span class="p">(</span><span class="n">dbscan</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">image_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">87</span><span class="p">,</span> <span class="mi">65</span><span class="p">)):</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="n">X_people</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
        <span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;xticks&quot;</span><span class="p">:</span> <span class="p">(),</span> <span class="s2">&quot;yticks&quot;</span><span class="p">:</span> <span class="p">()},</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">image</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">noise</span><span class="p">,</span> <span class="n">axes</span><span class="o">.</span><span class="n">ravel</span><span class="p">()):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">image_shape</span><span class="p">),</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_dbscan_noise_images</span><span class="p">(</span><span class="n">dbscan</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_lecture-DBSCAN-hierarchical_126_0.png" src="../_images/02_lecture-DBSCAN-hierarchical_126_0.png" />
</div>
</div>
<ul class="simple">
<li><p>We can guess why these images are noise images. There are odd angles, cropping, sun glasses, hands near faces etc.</p></li>
</ul>
</div>
<div class="section" id="examining-dbscan-clusters">
<h3>Examining DBSCAN clusters<a class="headerlink" href="#examining-dbscan-clusters" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dbscan</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">(</span><span class="n">min_samples</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">dbscan</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">X_pca</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of clusters: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels</span><span class="p">))))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cluster sizes: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">labels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of clusters: 5
Cluster sizes: [1227    4    3    3    3]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">print_dbscan_clusters</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">image_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">87</span><span class="p">,</span> <span class="mi">65</span><span class="p">)):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">labels</span> <span class="o">==</span> <span class="n">cluster</span>
        <span class="n">n_images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="n">n_images</span><span class="p">,</span>
            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">n_images</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
            <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;xticks&quot;</span><span class="p">:</span> <span class="p">(),</span> <span class="s2">&quot;yticks&quot;</span><span class="p">:</span> <span class="p">()},</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">image</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">X_people</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">y_people</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">axes</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">image_shape</span><span class="p">),</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;cluster </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Some clusters correspond to people with distinct faces and facial expressions.</p></li>
<li><p>It’s also capturing orientation of the face.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_dbscan_clusters</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_lecture-DBSCAN-hierarchical_132_0.png" src="../_images/02_lecture-DBSCAN-hierarchical_132_0.png" />
<img alt="../_images/02_lecture-DBSCAN-hierarchical_132_1.png" src="../_images/02_lecture-DBSCAN-hierarchical_132_1.png" />
<img alt="../_images/02_lecture-DBSCAN-hierarchical_132_2.png" src="../_images/02_lecture-DBSCAN-hierarchical_132_2.png" />
<img alt="../_images/02_lecture-DBSCAN-hierarchical_132_3.png" src="../_images/02_lecture-DBSCAN-hierarchical_132_3.png" />
</div>
</div>
<p><br><br><br><br></p>
</div>
</div>
<div class="section" id="video-5-final-comments-and-summary-a-name-1-a">
<h2>Video 5: Final comments and summary <a name="1"></a><a class="headerlink" href="#video-5-final-comments-and-summary-a-name-1-a" title="Permalink to this headline">¶</a></h2>
<div class="section" id="take-home-message">
<h3>Take-home message<a class="headerlink" href="#take-home-message" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>We saw three methods for clustering: K-Means, DBSCAN, and hierarchical clustering.</p></li>
<li><p>There are many more clustering algorithms out there which we didn’t talk about. For example see <a class="reference external" href="https://scikit-learn.org/stable/modules/clustering.html#overview-of-clustering-methods">this overview of clustering methods</a>.</p></li>
<li><p>Two important aspects of clustering</p>
<ul>
<li><p>Choice of distance metric</p></li>
<li><p>Data representation</p></li>
</ul>
</li>
<li><p>Choosing the appropriate number of clusters for a given problem is quite hard.</p></li>
<li><p>A lot of manual interpretation is involved in clustering.</p></li>
</ul>
</div>
<div class="section" id="a-few-comments-on-clustering-evaluation">
<h3>A few comments on clustering evaluation<a class="headerlink" href="#a-few-comments-on-clustering-evaluation" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>If you know the ground truth, you can use metrics such as <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.adjusted_rand_score.html">adjusted random score</a> or <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.normalized_mutual_info_score.html">normalized mutual information score</a>.</p></li>
<li><p>We can’t we use accuracy scores.</p>
<ul>
<li><p>Because the labels themselves are meaningless in clustering.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id3">
<h3>A few comments on clustering evaluation<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Usually ground truth is not available, and if it is available we would probably go with supervised models.</p></li>
<li><p>The silhouette score works for different clustering methods and it can give us some intuition about the quality of clusters. But it’s not very interpretable on real-world datasets.</p></li>
</ul>
</div>
<div class="section" id="id4">
<h3>A few comments on clustering evaluation<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>One way to evaluate clustering is trying a number of clustering models and checking whether they give us similar clusters.</p></li>
<li><p>That said, even though all clustering models give similar results, the clusters might not capture the aspect you are interested in.</p></li>
<li><p>So you cannot really avoid manual analysis!!</p></li>
</ul>
</div>
</div>
<div class="section" id="resources">
<h2>Resources<a class="headerlink" href="#resources" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Check out this nice comparison of <a class="reference external" href="https://scikit-learn.org/stable/modules/clustering.html#overview-of-clustering-methods">sklearn clustering algorithms</a>.</p></li>
<li><p><a class="reference external" href="https://www.naftaliharris.com/blog/visualizing-dbscan-clustering/">DBSCAN Visualization</a></p></li>
<li><p><a class="reference external" href="https://dashee87.github.io/data%20science/general/Clustering-with-Scikit-with-GIFs/">Clustering with Scikit with GIFs</a></p></li>
</ul>
<p><br><br><br><br></p>
</div>
<div class="section" id="questions-for-class-discussion-a-name-questions-a">
<h2>Questions for class discussion <a name="questions"></a><a class="headerlink" href="#questions-for-class-discussion-a-name-questions-a" title="Permalink to this headline">¶</a></h2>
<div class="section" id="dbscan-true-false-questions">
<h3>DBSCAN: True/False questions<a class="headerlink" href="#dbscan-true-false-questions" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p>With tiny epsilon (<code class="docutils literal notranslate"><span class="pre">eps</span></code> in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>) and min samples=1 (<code class="docutils literal notranslate"><span class="pre">min_samples=1</span></code> in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>) we can end up with each point in its own cluster.</p></li>
</ol>
<blockquote>
<div><p>V’s answer: True.</p>
</div></blockquote>
<ol class="simple">
<li><p>With a smaller value of <code class="docutils literal notranslate"><span class="pre">eps</span></code> and larger number for <code class="docutils literal notranslate"><span class="pre">min_samples</span></code> we would end up with a one big cluster.</p></li>
</ol>
<blockquote>
<div><p>V’s answer: False. In this case, we would end up with many noise points.</p>
</div></blockquote>
<ol class="simple">
<li><p>K-Means is more susceptible to outliers compared to DBSCAN.</p></li>
</ol>
<blockquote>
<div><p>V’s answer: True. DBSCAN is robust to outliers. It just doesn’t assign them to a cluster. In case of K-Means, on the other hand rather, outliers “pull” a cluster mean.</p>
</div></blockquote>
<ol class="simple">
<li><p>In DBSCAN to be part of a cluster, each point must have at least <code class="docutils literal notranslate"><span class="pre">min_samples</span></code> neighbours in a given radius (including itself).</p></li>
</ol>
<blockquote>
<div><p>V’s answer: False. This is not the case with border points.</p>
</div></blockquote>
<p><br><br><br><br></p>
<p><code class="docutils literal notranslate"><span class="pre">n</span></code></p>
</div>
<div class="section" id="true-false-questions">
<h3>True/False questions<a class="headerlink" href="#true-false-questions" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p>Hierarchical clustering can only be applied to smaller datasets because dendrograms are hard to visualize for large datasets.</p></li>
</ol>
<blockquote>
<div><p>V’s answer: False. You can apply it on larger datasets and then visualize truncated dendrograms.</p>
</div></blockquote>
<ol class="simple">
<li><p>In all the three clustering methods we saw (K-Means, DBSCAN, hierarchical clustering), there is a way to decide the granularity of clustering (i.e., how many clusters to pick).</p></li>
</ol>
<blockquote>
<div><p>V’s answer: True. In K-Means we get to decide K, in DBSCAN
In hierarchical clustering we get to decide where to cut the tree.</p>
</div></blockquote>
<ol class="simple">
<li><p>To get robust clustering we can naively ensemble cluster labels (e.g., pick the most popular label) produced by different clustering methods.</p></li>
</ol>
<blockquote>
<div><p>V’s answer: False. This is the label switching issue: the different clusterings might use different labels, so averaging directly would not make sense.</p>
</div></blockquote>
<ol class="simple">
<li><p>If you have a high silhouette score and very robust clustering, it means that it has captured the semantic meaning in the data of our interest.</p></li>
</ol>
<blockquote>
<div><p>V’s answer: False. We might not get what we’re interested in. For example, suppose we are interested in clustering old people vs young people, or people with beards and without beards, we might now be able to do that.</p>
</div></blockquote>
<p><br><br><br><br></p>
</div>
<div class="section" id="time-permitting">
<h3>Time permitting<a class="headerlink" href="#time-permitting" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Discuss advantages and disadvantages of different clustering methods.</p></li>
<li><p>What are the parameters and hyperparameters of K-Means and DBSCAN?
<br><br><br><br></p></li>
</ul>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "conda-env-cpsc330-py"
        },
        kernelOptions: {
            kernelName: "conda-env-cpsc330-py",
            path: "./lectures"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'conda-env-cpsc330-py'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Varada Kolhatkar<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>