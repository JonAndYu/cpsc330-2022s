
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lecture 14: Clustering &#8212; CPSC 330 Applied Machine Learning</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e8e5499552300ddf5d7adccae7cc3b70.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Attributions" href="../attribution.html" />
    <link rel="prev" title="Lecture 13: Feature engineering and feature selection" href="13_feature-engineering-selection.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/UBC-CS-logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">CPSC 330 Applied Machine Learning</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <p class="caption">
 <span class="caption-text">
  Things you should know
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../docs/README.html">
   CPSC 330 Documents
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Lectures
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01_intro.html">
   Lecture 1: Course Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_decision-trees.html">
   Lecture 2: Terminology, Baselines, Decision Trees
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_ml-fundamentals.html">
   Lecture 3: Machine Learning Fundamentals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_kNNs-SVM-RBF.html">
   Lecture 4:
   <span class="math notranslate nohighlight">
    \(k\)
   </span>
   -Nearest Neighbours and SVM RBFs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_preprocessing-pipelines.html">
   Lecture 5: Preprocessing and
   <code class="docutils literal notranslate">
    <span class="pre">
     sklearn
    </span>
   </code>
   pipelines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_column-transformer-text-feats.html">
   Lecture 6:
   <code class="docutils literal notranslate">
    <span class="pre">
     sklearn
    </span>
   </code>
   <code class="docutils literal notranslate">
    <span class="pre">
     ColumnTransformer
    </span>
   </code>
   and Text Features
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_linear-models.html">
   Lecture 7: Linear Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08_hyperparameter-optimization.html">
   Lecture 8: Hyperparameter Optimization and Optimization Bias
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_classification-metrics.html">
   Lecture 9: Classification Metrics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="10_regression-metrics.html">
   Lecture 10: Regression Evaluation Metrics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="11_ensembles.html">
   Lecture 11: Ensembles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="13_feature-engineering-selection.html">
   Lecture 13: Feature engineering and feature selection
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Lecture 14: Clustering
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Attribution
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../attribution.html">
   Attributions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../LICENSE.html">
   LICENSE
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Varada Kolhatkar, CPSC 330 2021-22<br>Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/lectures/14_k-means-clustering.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/UBC-CS/cpsc330/master?urlpath=tree/lectures/14_k-means-clustering.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports">
   Imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#learning-outcomes-a-name-lo-a">
   Learning outcomes
   <a name="lo">
   </a>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#unsupervised-learning">
   Unsupervised learning
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#types-of-machine-learning-from">
     Types of machine learning from
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#supervised-learning">
     Supervised learning
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#labeled-vs-unlabeled-data">
     Labeled vs. Unlabeled data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Unsupervised learning
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-supervised-vs-unsupervised-learning">
     Example: Supervised vs unsupervised learning
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#an-example-with-sklearn-toy-dataset">
     An example with
     <code class="docutils literal notranslate">
      <span class="pre">
       sklearn
      </span>
     </code>
     toy dataset
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#can-we-learn-without-targets">
     Can we learn without targets?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#clustering-motivation">
   Clustering motivation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#why-clustering">
     Why clustering?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#clustering">
     Clustering
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#input-and-possible-output">
     Input and possible output
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#is-there-a-notion-of-correct-grouping">
     Is there a notion of “correct” grouping?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-1">
     Example 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-2">
     Example 2
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#meaningful-groups-in-clustering">
     Meaningful groups in clustering
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#common-applications-data-exploration">
     Common applications: Data exploration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#common-applications-customer-segmentation">
     Common applications: Customer segmentation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#document-clustering">
     Document clustering
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#similarity-and-distances">
     Similarity and distances
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#k-means-clustering-algorithm">
   K-Means clustering algorithm
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#k-means-clustering">
     K-Means clustering
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#k-means-using-sklearn">
     K-Means using
     <code class="docutils literal notranslate">
      <span class="pre">
       sklearn
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#kmeans-fit">
     <code class="docutils literal notranslate">
      <span class="pre">
       KMeans
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       fit
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#predict-of-kmeans">
     <code class="docutils literal notranslate">
      <span class="pre">
       predict
      </span>
     </code>
     of
     <code class="docutils literal notranslate">
      <span class="pre">
       KMeans
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cluster-centers-in-k-means">
     Cluster centers in  K-Means
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#k-means-predictions-on-new-examples">
     K-Means predictions on new examples
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#k-means-algorithm-main-idea">
     K-Means algorithm: Main idea
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     K-Means clustering algorithm
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#initialization">
     Initialization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#iterative-process">
     Iterative process
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-to-find-closest-centers">
     How to find closest centers?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     How to find closest centers?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-to-update-centers">
     How to update centers?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#iteration-1-step-1">
     Iteration 1: Step 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#iteration-1-step-2">
     Iteration 1: Step 2
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#iteration-2-step-1">
     Iteration 2: step 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#iteration-2-step-2">
     Iteration 2: step 2
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#iteration-3-step-1">
     Iteration 3: step 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#iteration-3-step-2">
     Iteration 3: step 2
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#iteration-4-step-1">
     Iteration 4: step 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#iteration-4-step-2">
     Iteration 4: step 2
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#iteration-5-step-1">
     Iteration 5: step 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#iteration-5-step-2">
     Iteration 5: step 2
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#when-to-stop">
     When to stop?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     Example 2
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id5">
       Initialization
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optional-feature-engineering-using-k-means">
     (Optional) Feature engineering using K-Means
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#choosing-k-a-name-3-a">
   Choosing K
   <a name="3">
   </a>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hyperparameter-tuning-for-k">
     Hyperparameter tuning for K
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#method-1-the-elbow-method">
     Method 1: The Elbow method
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#inertia">
     Inertia
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#method-2-the-silhouette-method">
     Method 2: The Silhouette method
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mean-intra-cluster-distance-a">
     Mean intra-cluster distance (
     <span class="math notranslate nohighlight">
      \(a\)
     </span>
     )
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mean-nearest-cluster-distance-b">
     Mean nearest-cluster distance (
     <span class="math notranslate nohighlight">
      \(b\)
     </span>
     )
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#silhouette-distance-for-a-sample">
     Silhouette distance for a sample
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-silhouette-scores-to-select-the-number-of-clusters">
     Using Silhouette scores to select the number of clusters
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-to-look-for-in-these-plots">
     What to look for in these plots?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#comments-on-silhouette-scores">
     Comments on Silhouette scores
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#k-means-true-false-questions">
     K-Means: True/False questions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id6">
     K-Means: True/False questions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#break-5-min">
   Break (5 min)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#k-means-case-study-customer-segmentation">
   K-Means case study: Customer segmentation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-is-customer-segmentation">
     What is customer segmentation?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#business-problem">
     Business problem
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data">
     Data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#information-of-the-dataset">
     Information of the dataset
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#preliminary-eda">
     Preliminary EDA
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#practice-exercises-for-you">
     Practice exercises for you
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mini-exercises-for-you-answers">
     Mini exercises for you (Answers)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#feature-types-and-preprocessing">
     Feature types and preprocessing
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tuning-the-hyperparameter-n-clusters">
     Tuning the hyperparameter
     <code class="docutils literal notranslate">
      <span class="pre">
       n_clusters
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cluster-interpretation">
     Cluster interpretation
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#transactors">
       Transactors
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#revolvers">
       Revolvers
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#vip-prime">
       VIP/Prime
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#low-activity">
       Low activity
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#more-on-interpretation-of-clusters">
     More on interpretation of clusters
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#practice-exercise-for-you">
     Practice exercise for you
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#final-comments-and-summary">
   Final comments and summary
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-comment-on-initialization">
     A comment on initialization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-bad-initialization">
     Example: Bad initialization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-better-initialization">
     Example: Better initialization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-can-we-do-about-it">
     What can we do about it?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#important-points-to-remember">
     Important points to remember
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id7">
     Important points to remember
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id8">
     Important points to remember
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#resources">
   Resources
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#questions-for-class-discussion-a-name-questions-a">
   Questions for class Discussion
   <a name="questions">
   </a>
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <p><img alt="" src="../_images/330-banner.png" /></p>
<div class="section" id="lecture-14-clustering">
<h1>Lecture 14: Clustering<a class="headerlink" href="#lecture-14-clustering" title="Permalink to this headline">¶</a></h1>
<p>UBC 2020-21</p>
<p>Instructor: Varada Kolhatkar</p>
<div class="section" id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;code/.&quot;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">mglearn</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">plotting_functions</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">plotting_functions_unsup</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">metrics</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span><span class="p">,</span> <span class="n">make_column_transformer</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_blobs</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span><span class="p">,</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">yellowbrick.cluster</span> <span class="kn">import</span> <span class="n">KElbowVisualizer</span><span class="p">,</span> <span class="n">SilhouetteVisualizer</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;seaborn&quot;</span><span class="p">)</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="learning-outcomes-a-name-lo-a">
<h2>Learning outcomes <a name="lo"></a><a class="headerlink" href="#learning-outcomes-a-name-lo-a" title="Permalink to this headline">¶</a></h2>
<p>From this lecture, students are expected to be able to:</p>
<ul class="simple">
<li><p>Explain the motivation and potential applications of clustering.</p></li>
<li><p>Define the clustering problem.</p></li>
<li><p>Explain the K-Means algorithm.</p></li>
<li><p>Apply <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>’s <code class="docutils literal notranslate"><span class="pre">KMeans</span></code> algorithm.</p></li>
<li><p>Apply the Elbow method and Silhouette method to choose the number of clusters.</p></li>
<li><p>Use clustering for customer segmentation problem.</p></li>
<li><p>Interpret the clusters discovered by K-Means.</p></li>
</ul>
</div>
<div class="section" id="unsupervised-learning">
<h2>Unsupervised learning<a class="headerlink" href="#unsupervised-learning" title="Permalink to this headline">¶</a></h2>
<div class="section" id="types-of-machine-learning-from">
<h3>Types of machine learning from<a class="headerlink" href="#types-of-machine-learning-from" title="Permalink to this headline">¶</a></h3>
<p>Recall the typical learning problems we discussed at the beginning of the course.</p>
<ul class="simple">
<li><p>Supervised learning (<a class="reference external" href="https://support.google.com/a/answer/2368132?hl=en">Gmail spam filtering</a>)</p>
<ul>
<li><p>Training a model from input data and its corresponding targets to predict targets for new examples. (571, 572, 573)</p></li>
</ul>
</li>
<li><p><strong>Unsupervised learning</strong> (this course) (<a class="reference external" href="https://news.google.com/">Google News</a>)</p>
<ul>
<li><p>Training a model to find patterns in a dataset, typically an unlabeled dataset.</p></li>
</ul>
</li>
<li><p>Reinforcement learning (<a class="reference external" href="https://deepmind.com/research/case-studies/alphago-the-story-so-far">AlphaGo</a>)</p>
<ul>
<li><p>A family of algorithms for finding suitable actions to take in a given situation in order to maximize a reward.</p></li>
</ul>
</li>
<li><p><strong>Recommendation systems</strong> (<a class="reference external" href="https://www.cs.umd.edu/~samir/498/Amazon-Recommendations.pdf">Amazon item recommendation system</a>)</p>
<ul>
<li><p>Predict the “rating” or “preference” a user would give to an item.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="supervised-learning">
<h3>Supervised learning<a class="headerlink" href="#supervised-learning" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Training data comprises a set of observations (<span class="math notranslate nohighlight">\(X\)</span>) and their corresponding targets (<span class="math notranslate nohighlight">\(y\)</span>).</p></li>
<li><p>We wish to find a model function <span class="math notranslate nohighlight">\(f\)</span> that relates <span class="math notranslate nohighlight">\(X\)</span> to <span class="math notranslate nohighlight">\(y\)</span>.</p></li>
<li><p>Then use that model function to predict the targets of new examples.</p></li>
<li><p>We have been working with this set up so far.</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/sup-learning.png"><img alt="../_images/sup-learning.png" src="../_images/sup-learning.png" style="width: 1000px; height: 1000px;" /></a>
</div>
<div class="section" id="labeled-vs-unlabeled-data">
<h3>Labeled vs. Unlabeled data<a class="headerlink" href="#labeled-vs-unlabeled-data" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>If you have access to labeled training data, you’re in the “supervised” setting.</p></li>
<li><p>You know what to do in that case.</p></li>
<li><p>Unfortunately, getting large amount of labeled training data is often difficult, expensive, or simply impossible in some cases.</p></li>
<li><p>Can you still make sense of the data even though you do not have the labels?</p></li>
<li><p>Yes! At least to a certain extent!</p></li>
</ul>
</div>
<div class="section" id="id1">
<h3>Unsupervised learning<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Training data consists of observations (<span class="math notranslate nohighlight">\(X\)</span>) without any corresponding targets.</p></li>
<li><p>Unsupervised learning could be used to group similar things together in <span class="math notranslate nohighlight">\(X\)</span>.</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/unsup-learning.png"><img alt="" src="../_images/unsup-learning.png" style="width: 900px; height: 900px;" /></a>
</div>
<div class="section" id="example-supervised-vs-unsupervised-learning">
<h3>Example: Supervised vs unsupervised learning<a class="headerlink" href="#example-supervised-vs-unsupervised-learning" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>In supervised learning, we are given features <span class="math notranslate nohighlight">\(X\)</span> and target <span class="math notranslate nohighlight">\(y\)</span>.</p></li>
</ul>
<table>
<tr style="background-color:white;">
    <td>
        <table>
            <tr>
                <td colspan="2" style="text-align:center;"> <b>Dataset 1</b> </td>
                <td></td>
            </tr>
            <tr>
                <td>$x_1$</td>
                <td>$y$</td>
            </tr>
            <tr>
                <td> 101.0
                <td> Sick
            </tr>
            <tr>
                <td> 98.5 
                <td> Not Sick
            </tr>
            <tr>
                <td> 93.8 
                <td> Sick
            </tr>
            <tr>
                <td> 104.3
                <td> Sick
            </tr>
            <tr>
                <td> 98.6 
                <td> Not Sick
            </tr>
        </table>
    </td>
    <td>
       <table>
            <tr>
                <td colspan="3" style="text-align:center;"> <b>Dataset2</b> </td>
                <td></td>
            </tr>
            <tr>
                <td>$x_1$</td>
                <td>$x_2$</td>
                <td>$y$</td>
            </tr>
            <tr>
                <td> -2.68
                <td> 0.32 
                <td>class 1
            </tr>
            <tr>
                <td> -2.71
                <td> -0.18
                <td> class 1
            </tr>
            <tr>
                <td> 1.28  
                <td> 0.69    
                <td> class 2
            </tr>
            <tr>
                <td> 0.93  
                <td> 0.32   
                <td> class 2
            </tr>
            <tr>
                <td> 1.39
                <td> -0.28 
                <td> class 3
            </tr>
        </table>
    </td>
</tr>
</table><ul class="simple">
<li><p>In unsupervised learning, we are only given features <span class="math notranslate nohighlight">\(X\)</span>.</p></li>
</ul>
<table>
<tr style="background-color:white;">
    <td>
        <table>
            <tr>
                <td colspan="2" style="text-align:center;"> <b>Dataset 1</b> </td>
                <td></td>
            </tr>
            <tr>
                <td>$x_1$</td>
            </tr>
            <tr>
                <td> 101.0
            </tr>
            <tr>
                <td> 98.5 
            </tr>
            <tr>
                <td> 93.8 
            </tr>
            <tr>
                <td> 104.3
            </tr>
            <tr>
                <td> 98.6 
            </tr>
        </table>
    </td>
    <td>
       <table>
            <tr>
                <td colspan="3" style="text-align:center;"> <b>Dataset 2</b> </td>
                <td></td>
            </tr>
            <tr>
                <td>$x_1$</td>
                <td>$x_2$</td>
            </tr>
            <tr>
                <td> -2.68
                <td> 0.32 
            </tr>
            <tr>
                <td> -2.71
                <td> -0.18
            </tr>
            <tr>
                <td> 1.28  
                <td> 0.69    
            </tr>
            <tr>
                <td> 0.93  
                <td> 0.32   
            </tr>
            <tr>
                <td> 1.39
                <td> -0.28 
            </tr>
        </table>
    </td>
</tr>
</table></div>
<div class="section" id="an-example-with-sklearn-toy-dataset">
<h3>An example with <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> toy dataset<a class="headerlink" href="#an-example-with-sklearn-toy-dataset" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Iris dataset</span>
<span class="n">iris</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">load_iris</span><span class="p">()</span>  <span class="c1"># loading the iris dataset</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>  <span class="c1"># only consider two features for visualization</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">target_names</span><span class="p">[</span>
    <span class="n">iris</span><span class="o">.</span><span class="n">target</span>
<span class="p">]</span>  <span class="c1"># get the targets, in this case the types of the Iris flower</span>

<span class="n">iris_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">iris</span><span class="o">.</span><span class="n">feature_names</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
<span class="n">iris_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>petal length (cm)</th>
      <th>petal width (cm)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.4</td>
      <td>0.2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.4</td>
      <td>0.2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.3</td>
      <td>0.2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.5</td>
      <td>0.2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.4</td>
      <td>0.2</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;setosa&#39;, &#39;versicolor&#39;, &#39;virginica&#39;], dtype=&#39;&lt;U10&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">iris_df</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span>
<span class="n">plot_sup_x_unsup</span><span class="p">(</span><span class="n">iris_df</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_17_0.png" src="../_images/14_k-means-clustering_17_0.png" />
</div>
</div>
<ul class="simple">
<li><p>In case of supervised learning, we’re given <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(y\)</span> (showed with different colours in the plot above).</p></li>
<li><p>In case of unsupervised learning, we’re only given <span class="math notranslate nohighlight">\(X\)</span> and the goal is to identify the underlying structure in data.</p></li>
</ul>
</div>
<div class="section" id="can-we-learn-without-targets">
<h3>Can we learn without targets?<a class="headerlink" href="#can-we-learn-without-targets" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Yes, but the learning will be focused on finding the underlying structures of the inputs themselves (rather than finding the function <span class="math notranslate nohighlight">\(f\)</span> between input and output like we did in supervised learning models).</p></li>
<li><p>Examples:</p>
<ul>
<li><p>Clustering</p></li>
<li><p>Dimensionality Reduction (we won’t cover it in this course)</p></li>
</ul>
</li>
</ul>
<p><br><br></p>
</div>
</div>
<div class="section" id="clustering-motivation">
<h2>Clustering motivation<a class="headerlink" href="#clustering-motivation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="why-clustering">
<h3>Why clustering?<a class="headerlink" href="#why-clustering" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Most of the data out there is unlabeled.</p></li>
<li><p>Getting labeled training data is often difficult, expensive, or simply impossible in some cases.</p></li>
<li><p>Can we extract some useful information from unlabeled data?</p></li>
<li><p>The most intuitive way is to group similar examples together to get some insight into the data even though we do not have the targets.</p></li>
</ul>
</div>
<div class="section" id="clustering">
<h3>Clustering<a class="headerlink" href="#clustering" title="Permalink to this headline">¶</a></h3>
<p><strong>Clustering</strong> is the task of partitioning the dataset into groups called clusters.</p>
<p>The goal of clustering is to discover underlying groups in a given dataset such that:</p>
<ul class="simple">
<li><p>examples in the same group are as similar as possible;</p></li>
<li><p>examples in different groups are as different as possible.</p></li>
</ul>
</div>
<div class="section" id="input-and-possible-output">
<h3>Input and possible output<a class="headerlink" href="#input-and-possible-output" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_blobs</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">centers</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">n_features</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">mglearn</span><span class="o">.</span><span class="n">discrete_scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">markers</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">mglearn</span><span class="o">.</span><span class="n">discrete_scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="n">markers</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_26_0.png" src="../_images/14_k-means-clustering_26_0.png" />
</div>
</div>
<p>Think of clustering as colouring the points (e.g., blue, red, green) such that points with the same color are close to each other.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mglearn</span><span class="o">.</span><span class="n">discrete_scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="n">markers</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_28_0.png" src="../_images/14_k-means-clustering_28_0.png" />
</div>
</div>
<ul class="simple">
<li><p>Usually the clusters are identified by a <strong>cluster label</strong>.</p></li>
<li><p>These labels are arbitrary, and relabeling the points (label switching) does not make a difference.</p></li>
<li><p>What we care about is which points have the same labels and which ones have different labels.</p></li>
</ul>
</div>
<div class="section" id="is-there-a-notion-of-correct-grouping">
<h3>Is there a notion of “correct” grouping?<a class="headerlink" href="#is-there-a-notion-of-correct-grouping" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Very often we do not know how many clusters are there in the data or if there are any clusters at all. In real-world data, clusters are rarely as clear as in our toy example above.</p></li>
<li><p>There is a notion of coherent and optimal (in some sense) clusters but there is no absolute truth here.</p></li>
</ul>
</div>
<div class="section" id="example-1">
<h3>Example 1<a class="headerlink" href="#example-1" title="Permalink to this headline">¶</a></h3>
<p>Which of the following grouping of emoticons is the “correct” grouping?</p>
<a class="reference internal image-reference" href="../_images/emoticon_clustering_example.png"><img alt="../_images/emoticon_clustering_example.png" src="../_images/emoticon_clustering_example.png" style="width: 800px; height: 800px;" /></a>
<p>Both seem reasonable!</p>
</div>
<div class="section" id="example-2">
<h3>Example 2<a class="headerlink" href="#example-2" title="Permalink to this headline">¶</a></h3>
<p>How would you group a deck of cards?</p>
<ul class="simple">
<li><p>In a deck of cards:</p>
<ol class="simple">
<li><p>We have two colors: black and <font color="red">red</font>;</p></li>
<li><p>We have four suits: Clubs, Spades, <font color="red">Hearts</font>, and <font color="red">Diamonds</font>;</p></li>
<li><p>We have 13 values: <span class="math notranslate nohighlight">\(\left\{A,2,3,4,5,6,7,8,9,10,J,Q,K\right\}\)</span>.</p></li>
</ol>
</li>
<li><p>What are the “true” clusters here?</p></li>
</ul>
<p>Should we cluster by suits: Clubs, Spades, <font color="red">Hearts</font>, and <font color="red">Diamonds</font>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_deck</span><span class="p">(</span><span class="n">group_by</span><span class="o">=</span><span class="s2">&quot;suits&quot;</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_35_0.png" src="../_images/14_k-means-clustering_35_0.png" />
</div>
</div>
<p>Should we cluster by colors?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_deck</span><span class="p">(</span><span class="n">group_by</span><span class="o">=</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_37_0.png" src="../_images/14_k-means-clustering_37_0.png" />
</div>
</div>
<p>Should we cluster by value?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_deck</span><span class="p">(</span><span class="n">group_by</span><span class="o">=</span><span class="s2">&quot;cards&quot;</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_39_0.png" src="../_images/14_k-means-clustering_39_0.png" />
</div>
</div>
<ul class="simple">
<li><p>All these options seem reasonable.</p></li>
</ul>
</div>
<div class="section" id="meaningful-groups-in-clustering">
<h3>Meaningful groups in clustering<a class="headerlink" href="#meaningful-groups-in-clustering" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>In clustering, meaningful groups are dependent on the <strong>application</strong>.</p></li>
<li><p>It usually helps if we have some prior knowledge about the data and the problem.</p></li>
<li><p>This makes it hard for us to objectively measure the quality of a clustering algorithm (or think about “true” clusters).</p></li>
</ul>
</div>
<div class="section" id="common-applications-data-exploration">
<h3>Common applications: Data exploration<a class="headerlink" href="#common-applications-data-exploration" title="Permalink to this headline">¶</a></h3>
<p>Although there is no notion of the “right” answer, we might still get something useful out of clustering. There are a number of common applications for clustering.</p>
<ul class="simple">
<li><p>Summarize or compress data.</p></li>
<li><p>Partition the data into groups before further processing.</p></li>
<li><p>For instance, you could use it in supervised learning setting as follows. Carry out clustering and examine performance of your model on individual clusters. If the performance is lower on a particular cluster, you could either try building a separate model for that cluster and improve the overall performance of your supervised model.</p></li>
</ul>
</div>
<div class="section" id="common-applications-customer-segmentation">
<h3>Common applications: Customer segmentation<a class="headerlink" href="#common-applications-customer-segmentation" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Understand landscape of the market in businesses and craft targeted business or marketing strategies tailored for each group.</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/customer-segmentation.png"><img alt="../_images/customer-segmentation.png" src="../_images/customer-segmentation.png" style="width: 600px; height: 600px;" /></a>
<p><a class="reference external" href="https://www.youtube.com/watch?v=zPJtDohab-g&amp;t=134s">source</a></p>
</div>
<div class="section" id="document-clustering">
<h3>Document clustering<a class="headerlink" href="#document-clustering" title="Permalink to this headline">¶</a></h3>
<p>Grouping articles on different topics from different news sources. For example, <a class="reference external" href="https://news.google.com">Google News</a>.</p>
<a class="reference internal image-reference" href="../_images/google_news.png"><img alt="" src="../_images/google_news.png" style="width: 1200px; height: 1200px;" /></a>
</div>
<div class="section" id="similarity-and-distances">
<h3>Similarity and distances<a class="headerlink" href="#similarity-and-distances" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Clustering is based on the notion of similarity or distances between points.</p></li>
<li><p>How do we determine similarity between points in a multi-dimensional space?</p></li>
<li><p>Can we use something like <span class="math notranslate nohighlight">\(k\)</span>-neighbours for similarity?</p>
<ul>
<li><p>Yes! That’s a good start!</p></li>
<li><p>With <span class="math notranslate nohighlight">\(k\)</span>-neighbours we used Euclidean distances to find nearby points.</p></li>
<li><p>We can use the same idea for clustering!</p></li>
</ul>
</li>
</ul>
<p><br><br><br><br><br><br></p>
</div>
</div>
<div class="section" id="k-means-clustering-algorithm">
<h2>K-Means clustering algorithm<a class="headerlink" href="#k-means-clustering-algorithm" title="Permalink to this headline">¶</a></h2>
<div class="section" id="k-means-clustering">
<h3>K-Means clustering<a class="headerlink" href="#k-means-clustering" title="Permalink to this headline">¶</a></h3>
<p>One of the most commonly used clustering algorithm.</p>
<p><strong>Input</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">X</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> a set of data points</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">K</span></code> (or <span class="math notranslate nohighlight">\(k\)</span> or <code class="docutils literal notranslate"><span class="pre">n_clusters</span></code>) <span class="math notranslate nohighlight">\(\rightarrow\)</span> number of clusters</p></li>
</ul>
<p><strong>Output</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">K</span></code> clusters (groups) of the data points</p></li>
</ul>
</div>
<div class="section" id="k-means-using-sklearn">
<h3>K-Means using <code class="docutils literal notranslate"><span class="pre">sklearn</span></code><a class="headerlink" href="#k-means-using-sklearn" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Before understanding the algorithm, let’s try it with <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>.</p></li>
<li><p>Consider the toy dataset above.</p></li>
<li><p>For this toy dataset, the three clusters are pretty clear.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_blobs</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">centers</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">n_features</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">mglearn</span><span class="o">.</span><span class="n">discrete_scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">markers</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_50_0.png" src="../_images/14_k-means-clustering_50_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[  5.69192445,  -9.47641249],
       [  1.70789903,   6.00435173],
       [  0.23621041,  -3.11909976],
       [  2.90159483,   5.42121526],
       [  5.85943906,  -8.38192364],
       [  6.04774884, -10.30504657],
       [ -2.00758803,  -7.24743939],
       [  1.45467725,  -6.58387198],
       [  1.53636249,   5.11121453],
       [  5.4307043 ,  -9.75956122]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">toy_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;feat1&quot;</span><span class="p">,</span> <span class="s2">&quot;feat2&quot;</span><span class="p">])</span>
<span class="n">toy_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feat1</th>
      <th>feat2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.691924</td>
      <td>-9.476412</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.707899</td>
      <td>6.004352</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.236210</td>
      <td>-3.119100</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2.901595</td>
      <td>5.421215</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.859439</td>
      <td>-8.381924</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6.047749</td>
      <td>-10.305047</td>
    </tr>
    <tr>
      <th>6</th>
      <td>-2.007588</td>
      <td>-7.247439</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1.454677</td>
      <td>-6.583872</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1.536362</td>
      <td>5.111215</td>
    </tr>
    <tr>
      <th>9</th>
      <td>5.430704</td>
      <td>-9.759561</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="kmeans-fit">
<h3><code class="docutils literal notranslate"><span class="pre">KMeans</span></code> <code class="docutils literal notranslate"><span class="pre">fit</span></code><a class="headerlink" href="#kmeans-fit" title="Permalink to this headline">¶</a></h3>
<p>Let’s try <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>’s <code class="docutils literal notranslate"><span class="pre">KMeans</span></code> algorithm on this dataset.</p>
<ul class="simple">
<li><p>We need to decide how many clusters we want. Here we are passing 3.</p></li>
<li><p>We are only passing <code class="docutils literal notranslate"><span class="pre">X</span></code> because this is unsupervised learning; we do not have labels.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>

<span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">kmeans</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="c1"># We are only passing X because this is unsupervised learning</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>KMeans(n_clusters=3)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="predict-of-kmeans">
<h3><code class="docutils literal notranslate"><span class="pre">predict</span></code> of <code class="docutils literal notranslate"><span class="pre">KMeans</span></code><a class="headerlink" href="#predict-of-kmeans" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The output of <code class="docutils literal notranslate"><span class="pre">KMeans</span></code> is <span class="math notranslate nohighlight">\(K\)</span> clusters (groups) of the data points.</p></li>
<li><p>Calling <code class="docutils literal notranslate"><span class="pre">predict</span></code> will give us the cluster assignment for each data point.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kmeans</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0, 1, 2, 1, 0, 0, 2, 2, 1, 0], dtype=int32)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">toy_df_cl</span> <span class="o">=</span> <span class="n">toy_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">toy_df_cl</span><span class="p">[</span><span class="s2">&quot;cluster&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">toy_df</span><span class="p">)</span>
<span class="n">toy_df_cl</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feat1</th>
      <th>feat2</th>
      <th>cluster</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.691924</td>
      <td>-9.476412</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.707899</td>
      <td>6.004352</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.236210</td>
      <td>-3.119100</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2.901595</td>
      <td>5.421215</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.859439</td>
      <td>-8.381924</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6.047749</td>
      <td>-10.305047</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>-2.007588</td>
      <td>-7.247439</td>
      <td>2</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1.454677</td>
      <td>-6.583872</td>
      <td>2</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1.536362</td>
      <td>5.111215</td>
      <td>1</td>
    </tr>
    <tr>
      <th>9</th>
      <td>5.430704</td>
      <td>-9.759561</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="cluster-centers-in-k-means">
<h3>Cluster centers in  K-Means<a class="headerlink" href="#cluster-centers-in-k-means" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>In K-Means each cluster is represented by its cluster center.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kmeans</span><span class="o">.</span><span class="n">cluster_centers_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 5.75745416, -9.48073598],
       [ 2.04861878,  5.51226051],
       [-0.10556679, -5.65013704]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mglearn</span><span class="o">.</span><span class="n">discrete_scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">labels_</span><span class="p">,</span> <span class="n">markers</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">mglearn</span><span class="o">.</span><span class="n">discrete_scatter</span><span class="p">(</span>
    <span class="n">kmeans</span><span class="o">.</span><span class="n">cluster_centers_</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">cluster_centers_</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">markers</span><span class="o">=</span><span class="s2">&quot;*&quot;</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_60_0.png" src="../_images/14_k-means-clustering_60_0.png" />
</div>
</div>
</div>
<div class="section" id="k-means-predictions-on-new-examples">
<h3>K-Means predictions on new examples<a class="headerlink" href="#k-means-predictions-on-new-examples" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>We can also use <code class="docutils literal notranslate"><span class="pre">predict</span></code> on unseen examples!</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">new_examples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">]])</span>
<span class="n">kmeans</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">new_examples</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([2, 1], dtype=int32)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mglearn</span><span class="o">.</span><span class="n">discrete_scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">labels_</span><span class="p">,</span> <span class="n">markers</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">mglearn</span><span class="o">.</span><span class="n">discrete_scatter</span><span class="p">(</span><span class="n">new_examples</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">new_examples</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">markers</span><span class="o">=</span><span class="s2">&quot;^&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">mglearn</span><span class="o">.</span><span class="n">discrete_scatter</span><span class="p">(</span>
    <span class="n">kmeans</span><span class="o">.</span><span class="n">cluster_centers_</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">cluster_centers_</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">markers</span><span class="o">=</span><span class="s2">&quot;*&quot;</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_63_0.png" src="../_images/14_k-means-clustering_63_0.png" />
</div>
</div>
</div>
<div class="section" id="k-means-algorithm-main-idea">
<h3>K-Means algorithm: Main idea<a class="headerlink" href="#k-means-algorithm-main-idea" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Represent each cluster by its cluster center and assign a cluster membership to each data point.</p></li>
</ul>
<p><strong>Chicken-and-egg problem!</strong></p>
<ul class="simple">
<li><p>If we knew cluster centers, we can simply assign each point to its nearest center.</p></li>
<li><p>Similarly, if we knew assignments, we can calculate cluster centers.</p></li>
<li><p>But we do not know either 😟.</p></li>
</ul>
<p>A usual computer science answer to such problems is iterations!!</p>
</div>
<div class="section" id="id2">
<h3>K-Means clustering algorithm<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p><strong>Input</strong>: Data points X and the number of clusters K</p>
<p><strong>Initialization</strong>: K initial centers for the clusters</p>
<p><strong>Iterative process</strong>:</p>
<p>repeat</p>
<ul class="simple">
<li><p>Assign each example to the closest center.</p></li>
<li><p>Estimate new centers as <em>average</em> of observations in a cluster.</p></li>
</ul>
<p>until <strong>centers stop changing</strong> or <strong>maximum iterations have reached</strong>.</p>
<p>Let’s execute K-Means algorithm on our toy example.</p>
<p><strong>Input</strong></p>
<ul class="simple">
<li><p>The data points <code class="docutils literal notranslate"><span class="pre">X</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_examples</span> <span class="o">=</span> <span class="n">toy_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of examples: &quot;</span><span class="p">,</span> <span class="n">n_examples</span><span class="p">)</span>
<span class="n">X</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of examples:  10
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[  5.69192445,  -9.47641249],
       [  1.70789903,   6.00435173],
       [  0.23621041,  -3.11909976],
       [  2.90159483,   5.42121526],
       [  5.85943906,  -8.38192364],
       [  6.04774884, -10.30504657],
       [ -2.00758803,  -7.24743939],
       [  1.45467725,  -6.58387198],
       [  1.53636249,   5.11121453],
       [  5.4307043 ,  -9.75956122]])
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Let K (number of clusters) be 3.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">k</span> <span class="o">=</span> <span class="mi">3</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="initialization">
<h3>Initialization<a class="headerlink" href="#initialization" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Random initialization for K initial centers of the clusters.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">centers_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_examples</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
<span class="n">centers_df</span> <span class="o">=</span> <span class="n">toy_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">centers_idx</span><span class="p">]</span>
<span class="n">centers</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">centers_idx</span><span class="p">]</span>
<span class="n">colours</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">centers</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">centers</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">colours</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Initial centers&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_72_0.png" src="../_images/14_k-means-clustering_72_0.png" />
</div>
</div>
</div>
<div class="section" id="iterative-process">
<h3>Iterative process<a class="headerlink" href="#iterative-process" title="Permalink to this headline">¶</a></h3>
<p>repeat</p>
<ul class="simple">
<li><p>Assign each example to the closest center. (<code class="docutils literal notranslate"><span class="pre">update_Z</span></code>)</p></li>
<li><p>Estimate new centers as <em>average</em> of observations in a cluster. (<code class="docutils literal notranslate"><span class="pre">update_centers</span></code>)</p></li>
</ul>
<p>until <strong>centers stop changing</strong> or <strong>maximum iterations have reached</strong>.</p>
</div>
<div class="section" id="how-to-find-closest-centers">
<h3>How to find closest centers?<a class="headerlink" href="#how-to-find-closest-centers" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>First step in the iterative process is assigning examples to the closest center.</p></li>
<li><p>Let’s consider distance of an example to all centers and assign that example to the closest center.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_example_dist</span><span class="p">(</span><span class="n">toy_df</span><span class="p">,</span> <span class="n">centers_df</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_75_0.png" src="../_images/14_k-means-clustering_75_0.png" />
</div>
</div>
</div>
<div class="section" id="id3">
<h3>How to find closest centers?<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Similarly, we can make cluster assignments for all points by calculating distances of all examples to the centers and assigning it to the cluster with smallest distance.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">euclidean_distances</span>


<span class="k">def</span> <span class="nf">update_Z</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">centers</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns distances and updated cluster assignments</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">euclidean_distances</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">centers</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dist</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="how-to-update-centers">
<h3>How to update centers?<a class="headerlink" href="#how-to-update-centers" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>With the new cluster assignments for our data points, we update cluster centers.</p></li>
<li><p>New cluster centers are means of data points in each cluster.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">update_centers</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">old_centers</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns new centers</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_centers</span> <span class="o">=</span> <span class="n">old_centers</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
        <span class="n">new_centers</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">Z</span> <span class="o">==</span> <span class="n">kk</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_centers</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="iteration-1-step-1">
<h3>Iteration 1: Step 1<a class="headerlink" href="#iteration-1-step-1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Assign each example to the closest cluster center.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dist</span><span class="p">,</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">update_Z</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">centers</span><span class="p">)</span>
<span class="n">Z</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([2, 0, 2, 0, 2, 2, 1, 2, 0, 2])
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>This is the current cluster assignment.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_current_assinment</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">centers</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_84_0.png" src="../_images/14_k-means-clustering_84_0.png" />
</div>
</div>
</div>
<div class="section" id="iteration-1-step-2">
<h3>Iteration 1: Step 2<a class="headerlink" href="#iteration-1-step-2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Estimate new centers as <em>average</em> of observations in a cluster.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">new_centers_it1</span> <span class="o">=</span> <span class="n">update_centers</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">centers</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>This is how the centers moved in this iteration.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_update_centroid</span><span class="p">(</span><span class="n">toy_df</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">new_centers_it1</span><span class="p">,</span> <span class="n">centers</span><span class="p">,</span> <span class="n">dist</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_88_0.png" src="../_images/14_k-means-clustering_88_0.png" />
</div>
</div>
</div>
<div class="section" id="iteration-2-step-1">
<h3>Iteration 2: step 1<a class="headerlink" href="#iteration-2-step-1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Assign each example to the closest cluster center.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dist</span><span class="p">,</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">update_Z</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">new_centers_it1</span><span class="p">)</span>
<span class="n">Z</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([2, 0, 1, 0, 2, 2, 1, 2, 0, 2])
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>This is the current cluster assignment.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_current_assinment</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">new_centers_it1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_93_0.png" src="../_images/14_k-means-clustering_93_0.png" />
</div>
</div>
</div>
<div class="section" id="iteration-2-step-2">
<h3>Iteration 2: step 2<a class="headerlink" href="#iteration-2-step-2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Estimate new centers as <em>average</em> of observations in a cluster.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">new_centers_it2</span> <span class="o">=</span> <span class="n">update_centers</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">new_centers_it1</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>This is how the centers moved in this iteration.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_update_centroid</span><span class="p">(</span><span class="n">toy_df</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">new_centers_it2</span><span class="p">,</span> <span class="n">new_centers_it1</span><span class="p">,</span> <span class="n">dist</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_97_0.png" src="../_images/14_k-means-clustering_97_0.png" />
</div>
</div>
</div>
<div class="section" id="iteration-3-step-1">
<h3>Iteration 3: step 1<a class="headerlink" href="#iteration-3-step-1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Assign each example to the closest cluster center.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dist</span><span class="p">,</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">update_Z</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">new_centers_it2</span><span class="p">)</span>
<span class="n">Z</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([2, 0, 1, 0, 2, 2, 1, 1, 0, 2])
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>This is the current cluster assignment.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_current_assinment</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">new_centers_it2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_102_0.png" src="../_images/14_k-means-clustering_102_0.png" />
</div>
</div>
</div>
<div class="section" id="iteration-3-step-2">
<h3>Iteration 3: step 2<a class="headerlink" href="#iteration-3-step-2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Estimate new centers as <em>average</em> of observations in a cluster.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">new_centers_it3</span> <span class="o">=</span> <span class="n">update_centers</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">new_centers_it2</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>This is how the centers moved in this iteration.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_update_centroid</span><span class="p">(</span><span class="n">toy_df</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">new_centers_it3</span><span class="p">,</span> <span class="n">new_centers_it2</span><span class="p">,</span> <span class="n">dist</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_106_0.png" src="../_images/14_k-means-clustering_106_0.png" />
</div>
</div>
</div>
<div class="section" id="iteration-4-step-1">
<h3>Iteration 4: step 1<a class="headerlink" href="#iteration-4-step-1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Assign each example to the closest cluster center.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dist</span><span class="p">,</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">update_Z</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">new_centers_it3</span><span class="p">)</span>
<span class="n">Z</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([2, 0, 1, 0, 2, 2, 1, 1, 0, 2])
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>This is the current cluster assignment.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_current_assinment</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">new_centers_it3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_111_0.png" src="../_images/14_k-means-clustering_111_0.png" />
</div>
</div>
</div>
<div class="section" id="iteration-4-step-2">
<h3>Iteration 4: step 2<a class="headerlink" href="#iteration-4-step-2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Estimate new centers as <em>average</em> of observations in a cluster.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">new_centers_it4</span> <span class="o">=</span> <span class="n">update_centers</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">new_centers_it3</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>The cluster centers are not moving anymore.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_update_centroid</span><span class="p">(</span><span class="n">toy_df</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">new_centers_it4</span><span class="p">,</span> <span class="n">new_centers_it3</span><span class="p">,</span> <span class="n">dist</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_115_0.png" src="../_images/14_k-means-clustering_115_0.png" />
</div>
</div>
</div>
<div class="section" id="iteration-5-step-1">
<h3>Iteration 5: step 1<a class="headerlink" href="#iteration-5-step-1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Assign each example to the closest cluster center.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dist</span><span class="p">,</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">update_Z</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">new_centers_it4</span><span class="p">)</span>
<span class="n">Z</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([2, 0, 1, 0, 2, 2, 1, 1, 0, 2])
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>This is the current cluster assignment.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_current_assinment</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">new_centers_it4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_120_0.png" src="../_images/14_k-means-clustering_120_0.png" />
</div>
</div>
</div>
<div class="section" id="iteration-5-step-2">
<h3>Iteration 5: step 2<a class="headerlink" href="#iteration-5-step-2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Estimate new centers as <em>average</em> of observations in a cluster.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">new_centers_it5</span> <span class="o">=</span> <span class="n">update_centers</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">new_centers_it4</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>The cluster centers are not moving anymore.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_update_centroid</span><span class="p">(</span><span class="n">toy_df</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">new_centers_it5</span><span class="p">,</span> <span class="n">new_centers_it4</span><span class="p">,</span> <span class="n">dist</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_124_0.png" src="../_images/14_k-means-clustering_124_0.png" />
</div>
</div>
</div>
<div class="section" id="when-to-stop">
<h3>When to stop?<a class="headerlink" href="#when-to-stop" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Seems like our centroids aren’t changing anymore.</p></li>
<li><p>The algorithm has converged. So we stop!</p></li>
<li><p>K-Means always converges. It doesn’t mean it finds the “right” clusters. It can converge to a sub-optimal solution.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_iterative</span><span class="p">(</span><span class="n">toy_df</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">centers</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_126_0.png" src="../_images/14_k-means-clustering_126_0.png" />
</div>
</div>
<p>Initialization is crucial. We’ll talk about it in a bit.</p>
</div>
<div class="section" id="id4">
<h3>Example 2<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Let’s use the K-means on the iris dataset.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Iris dataset</span>
<span class="n">iris</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">load_iris</span><span class="p">()</span>  <span class="c1"># loading the iris dataset</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">data</span>  <span class="c1"># get the input data</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">target_names</span><span class="p">[</span>
    <span class="n">iris</span><span class="o">.</span><span class="n">target</span>
<span class="p">]</span>  <span class="c1"># get the targets, in this case the types of the Iris flower</span>

<span class="n">iris_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">iris</span><span class="o">.</span><span class="n">feature_names</span><span class="p">)</span>
<span class="n">iris_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sepal length (cm)</th>
      <th>sepal width (cm)</th>
      <th>petal length (cm)</th>
      <th>petal width (cm)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.1</td>
      <td>3.5</td>
      <td>1.4</td>
      <td>0.2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4.9</td>
      <td>3.0</td>
      <td>1.4</td>
      <td>0.2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4.7</td>
      <td>3.2</td>
      <td>1.3</td>
      <td>0.2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4.6</td>
      <td>3.1</td>
      <td>1.5</td>
      <td>0.2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>3.6</td>
      <td>1.4</td>
      <td>0.2</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>145</th>
      <td>6.7</td>
      <td>3.0</td>
      <td>5.2</td>
      <td>2.3</td>
    </tr>
    <tr>
      <th>146</th>
      <td>6.3</td>
      <td>2.5</td>
      <td>5.0</td>
      <td>1.9</td>
    </tr>
    <tr>
      <th>147</th>
      <td>6.5</td>
      <td>3.0</td>
      <td>5.2</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>148</th>
      <td>6.2</td>
      <td>3.4</td>
      <td>5.4</td>
      <td>2.3</td>
    </tr>
    <tr>
      <th>149</th>
      <td>5.9</td>
      <td>3.0</td>
      <td>5.1</td>
      <td>1.8</td>
    </tr>
  </tbody>
</table>
<p>150 rows × 4 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;setosa&#39;, &#39;versicolor&#39;, &#39;virginica&#39;], dtype=&#39;&lt;U10&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reducing the dimensionality for plotting purposes</span>
<span class="c1"># (We&#39;re going to learn more about it later in the course)</span>
<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
<span class="n">data_iris</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">features</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;$Z_1$&quot;</span><span class="p">,</span> <span class="s2">&quot;$Z_2$&quot;</span><span class="p">])</span>
<span class="n">data_iris</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_unsup</span><span class="p">(</span><span class="n">data_iris</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;Iris dataset&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_132_0.png" src="../_images/14_k-means-clustering_132_0.png" />
</div>
</div>
<div class="section" id="id5">
<h4>Initialization<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>In this case, we know that <span class="math notranslate nohighlight">\(k=3\)</span>;</p></li>
<li><p>We are going to pick three points at random to use as initial centroids;</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># RANDOM initialization</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">centroids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
<span class="n">centroids</span> <span class="o">=</span> <span class="n">data_iris</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">centroids</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="n">plot_intial_center</span><span class="p">(</span><span class="n">data_iris</span><span class="p">,</span> <span class="n">centroids</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Iris dataset&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_134_0.png" src="../_images/14_k-means-clustering_134_0.png" />
</div>
</div>
<ul class="simple">
<li><p>Next, for each point in the dataset, we calculate the distance to each one of the centroids;</p></li>
<li><p>Let’s do it for one point as example:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_example_dist</span><span class="p">(</span><span class="n">data_iris</span><span class="p">,</span> <span class="n">centroids</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_136_0.png" src="../_images/14_k-means-clustering_136_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dist</span> <span class="o">=</span> <span class="n">distance</span><span class="o">.</span><span class="n">cdist</span><span class="p">(</span><span class="n">data_iris</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">centroids</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>
<span class="n">plot_first_assignment</span><span class="p">(</span><span class="n">data_iris</span><span class="p">,</span> <span class="n">centroids</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_137_0.png" src="../_images/14_k-means-clustering_137_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_iterative</span><span class="p">(</span><span class="n">data_iris</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">centroids</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_138_0.png" src="../_images/14_k-means-clustering_138_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="optional-feature-engineering-using-k-means">
<h3>(Optional) Feature engineering using K-Means<a class="headerlink" href="#optional-feature-engineering-using-k-means" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>K-Means could be used for feature engineering in supervised learning.</p></li>
<li><p>Examples:</p>
<ul>
<li><p>You could add a categorical feature: cluster membership</p></li>
<li><p>You could add a continuous features: distance from each cluster center</p></li>
</ul>
</li>
<li><p>See <a class="reference external" href="http://ai.stanford.edu/~acoates/papers/coatesleeng_aistats_2011.pdf">this paper</a>.</p></li>
</ul>
<p><br><br><br><br></p>
</div>
</div>
<div class="section" id="choosing-k-a-name-3-a">
<h2>Choosing K <a name="3"></a><a class="headerlink" href="#choosing-k-a-name-3-a" title="Permalink to this headline">¶</a></h2>
<div class="section" id="hyperparameter-tuning-for-k">
<h3>Hyperparameter tuning for K<a class="headerlink" href="#hyperparameter-tuning-for-k" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>K-Means takes K (<code class="docutils literal notranslate"><span class="pre">n_clusters</span></code> in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>) as a hyperparameter. How do we pick K?</p></li>
<li><p>In supervised setting we carried out hyperparameter optimization based on cross-validation scores.</p></li>
<li><p>Since in unsupervised learning we do not have the target values, it becomes difficult to objectively measure the effectiveness of the algorithms.</p></li>
<li><p>There is no definitive approach.</p></li>
<li><p>However, some strategies might be useful to help you determine K.</p></li>
</ul>
</div>
<div class="section" id="method-1-the-elbow-method">
<h3>Method 1: The Elbow method<a class="headerlink" href="#method-1-the-elbow-method" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>This method looks at the sum of <strong>intra-cluster distances</strong>, which is also referred to as <strong>inertia</strong>.</p></li>
<li><p>The intra-cluster distance in our toy example above is given as</p></li>
</ul>
<div class="math notranslate nohighlight">
\[ \sum_{P_i \in C_1}  distance(P_i, C_1)^2 + \sum_{P_i \in C_2}  distance(P_i, C_2)^2 + \sum_{P_i \in C_3} distance(P_i, C_3)^2\]</div>
<p>Where</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(C_1, C_2, C_3\)</span> are centroids</p></li>
<li><p><span class="math notranslate nohighlight">\(P_i\)</span>s are points within that cluster</p></li>
<li><p><span class="math notranslate nohighlight">\(distance\)</span> is the usual Euclidean distance.</p></li>
</ul>
</div>
<div class="section" id="inertia">
<h3>Inertia<a class="headerlink" href="#inertia" title="Permalink to this headline">¶</a></h3>
<p>You can access this intra-cluster distance or inertia as follows.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_blobs</span><span class="p">(</span><span class="n">centers</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">n_features</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">mglearn</span><span class="o">.</span><span class="n">discrete_scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">markers</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_145_0.png" src="../_images/14_k-means-clustering_145_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;K&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;inertia&quot;</span><span class="p">:</span> <span class="p">[]}</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;K&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;inertia&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">inertia_</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>K</th>
      <th>inertia</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>4372.460950</td>
    </tr>
    <tr>
      <th>1</th>
      <td>11</td>
      <td>58.474524</td>
    </tr>
    <tr>
      <th>2</th>
      <td>21</td>
      <td>26.900485</td>
    </tr>
    <tr>
      <th>3</th>
      <td>31</td>
      <td>12.770892</td>
    </tr>
    <tr>
      <th>4</th>
      <td>41</td>
      <td>6.421834</td>
    </tr>
    <tr>
      <th>5</th>
      <td>51</td>
      <td>3.593682</td>
    </tr>
    <tr>
      <th>6</th>
      <td>61</td>
      <td>1.961654</td>
    </tr>
    <tr>
      <th>7</th>
      <td>71</td>
      <td>0.945421</td>
    </tr>
    <tr>
      <th>8</th>
      <td>81</td>
      <td>0.322479</td>
    </tr>
    <tr>
      <th>9</th>
      <td>91</td>
      <td>0.053156</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>The inertia decreases as K increases.</p></li>
<li><p>Question: Do we want inertia to be small or large?</p></li>
<li><p>The problem is that we can’t just look for a <span class="math notranslate nohighlight">\(k\)</span> that minimizes inertia because it decreases as <span class="math notranslate nohighlight">\(k\)</span> increases.</p>
<ul>
<li><p>If I have number of clusters = number of examples, each example will have its own cluster and the intra-cluster distance will be 0.</p></li>
</ul>
</li>
<li><p>Instead we evaluate the trade-off: “small k” vs “small intra-cluster distances”.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_elbow</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">inertia_values</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-.&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">inertia_values</span><span class="p">,</span> <span class="s2">&quot;-o&quot;</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="p">(</span><span class="n">w</span> <span class="o">+</span> <span class="n">h</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Inertia&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inertia_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
    <span class="n">inertia_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">toy_df</span><span class="p">)</span><span class="o">.</span><span class="n">inertia_</span><span class="p">)</span>
<span class="n">plot_elbow</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">inertia_values</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_150_0.png" src="../_images/14_k-means-clustering_150_0.png" />
</div>
</div>
<ul class="simple">
<li><p>From the above plot, we could argue that three clusters (the point of inflection on the curve) are enough.</p></li>
<li><p>The inertia decreases when clusters are greater than 3. However it’s not a big improvement and so we prefer K=3.</p></li>
<li><p>In this toy example, it’s the plot is kind of clear and easy to interpret but it can be hard to interpret in real life examples.</p></li>
</ul>
<p>There is a package called <a class="reference external" href="https://www.scikit-yb.org/en/latest/api/cluster/elbow.html"><code class="docutils literal notranslate"><span class="pre">yellowbrick</span></code></a> which can be used to create these plots conveniently.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">districtdatalabs</span> <span class="n">yellowbrick</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">yellowbrick.cluster</span> <span class="kn">import</span> <span class="n">KElbowVisualizer</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">()</span>
<span class="n">visualizer</span> <span class="o">=</span> <span class="n">KElbowVisualizer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">visualizer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>  <span class="c1"># Fit the data to the visualizer</span>
<span class="n">visualizer</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_153_0.png" src="../_images/14_k-means-clustering_153_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visualizer</span> <span class="o">=</span> <span class="n">KElbowVisualizer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">visualizer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>  <span class="c1"># Fit the data to the visualizer</span>
<span class="n">visualizer</span><span class="o">.</span><span class="n">finalize</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_154_0.png" src="../_images/14_k-means-clustering_154_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visualizer</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:title={&#39;center&#39;:&#39;Distortion Score Elbow for KMeans Clustering&#39;}, xlabel=&#39;k&#39;, ylabel=&#39;distortion score&#39;&gt;
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="method-2-the-silhouette-method">
<h3>Method 2: The Silhouette method<a class="headerlink" href="#method-2-the-silhouette-method" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Not dependent on the notion of cluster centers.</p></li>
<li><p>Calculated using the <strong>mean intra-cluster distance</strong> (<span class="math notranslate nohighlight">\(a\)</span>) and the <strong>mean nearest-cluster distance</strong> (<span class="math notranslate nohighlight">\(b\)</span>) for each sample.</p></li>
</ul>
</div>
<div class="section" id="mean-intra-cluster-distance-a">
<h3>Mean intra-cluster distance (<span class="math notranslate nohighlight">\(a\)</span>)<a class="headerlink" href="#mean-intra-cluster-distance-a" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Suppose the green point below is our sample.</p></li>
<li><p>Average of the distances of the green point to the other points in the same cluster.</p>
<ul>
<li><p>These distances are represented by the black lines.</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_silhouette_dist</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_158_0.png" src="../_images/14_k-means-clustering_158_0.png" />
</div>
</div>
</div>
<div class="section" id="mean-nearest-cluster-distance-b">
<h3>Mean nearest-cluster distance (<span class="math notranslate nohighlight">\(b\)</span>)<a class="headerlink" href="#mean-nearest-cluster-distance-b" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Average of the distances of the green point to the blue points is smaller than the average of the distances of the green point to the red points. So the <strong>nearest cluster</strong> is the blue cluster.</p></li>
<li><p>So the mean nearest-cluster distance is the average of the distances of the green point to the blue points.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_silhouette_dist</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_160_0.png" src="../_images/14_k-means-clustering_160_0.png" />
</div>
</div>
</div>
<div class="section" id="silhouette-distance-for-a-sample">
<h3>Silhouette distance for a sample<a class="headerlink" href="#silhouette-distance-for-a-sample" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>the difference between the <strong>the average nearest-cluster distance</strong> (<span class="math notranslate nohighlight">\(b\)</span>) and <strong>average intra-cluster distance</strong> (<span class="math notranslate nohighlight">\(a\)</span>) for each sample, normalized by the maximum value</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\frac{b-a}{max(a,b)}\]</div>
<ul class="simple">
<li><p>The best value is 1.</p></li>
<li><p>The worst value is -1 (samples have been assigned to wrong clusters).</p></li>
<li><p>Value near 0 means overlapping clusters.</p></li>
</ul>
<p>The overall <strong>Silhouette score</strong> is the average of the Silhouette scores for all samples.</p>
</div>
<div class="section" id="using-silhouette-scores-to-select-the-number-of-clusters">
<h3>Using Silhouette scores to select the number of clusters<a class="headerlink" href="#using-silhouette-scores-to-select-the-number-of-clusters" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The plots below show the Silhouette scores for each sample in that cluster.</p></li>
<li><p>Higher values indicate well-separated clusters.</p></li>
<li><p>The size of the Silhouette shows the number of samples and hence shows imbalance of data points in clusters.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">yellowbrick.cluster</span> <span class="kn">import</span> <span class="n">SilhouetteVisualizer</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">visualizer</span> <span class="o">=</span> <span class="n">SilhouetteVisualizer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s2">&quot;yellowbrick&quot;</span><span class="p">)</span>
<span class="n">visualizer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>  <span class="c1"># Fit the data to the visualizer</span>
<span class="n">visualizer</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># Finalize and render the figure</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_164_0.png" src="../_images/14_k-means-clustering_164_0.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:title={&#39;center&#39;:&#39;Silhouette Plot of KMeans Clustering for 100 Samples in 2 Centers&#39;}, xlabel=&#39;silhouette coefficient values&#39;, ylabel=&#39;cluster label&#39;&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">visualizer</span> <span class="o">=</span> <span class="n">SilhouetteVisualizer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s2">&quot;yellowbrick&quot;</span><span class="p">)</span>
<span class="n">visualizer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>  <span class="c1"># Fit the data to the visualizer</span>
<span class="n">visualizer</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># Finalize and render the figure</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_165_0.png" src="../_images/14_k-means-clustering_165_0.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:title={&#39;center&#39;:&#39;Silhouette Plot of KMeans Clustering for 100 Samples in 3 Centers&#39;}, xlabel=&#39;silhouette coefficient values&#39;, ylabel=&#39;cluster label&#39;&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">visualizer</span> <span class="o">=</span> <span class="n">SilhouetteVisualizer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s2">&quot;yellowbrick&quot;</span><span class="p">)</span>
<span class="n">visualizer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>  <span class="c1"># Fit the data to the visualizer</span>
<span class="n">visualizer</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># Finalize and render the figure</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_166_0.png" src="../_images/14_k-means-clustering_166_0.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:title={&#39;center&#39;:&#39;Silhouette Plot of KMeans Clustering for 100 Samples in 5 Centers&#39;}, xlabel=&#39;silhouette coefficient values&#39;, ylabel=&#39;cluster label&#39;&gt;
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="what-to-look-for-in-these-plots">
<h3>What to look for in these plots?<a class="headerlink" href="#what-to-look-for-in-these-plots" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Unlike inertia, larger values are better because they indicate that the point is further away from neighbouring clusters.</p></li>
<li><p>The thickness of each silhouette indicates the cluster size.</p></li>
<li><p>The shape of each silhouette indicates the “goodness” for points in each cluster.</p></li>
<li><p>The length (or area) of each silhouette indicates the goodness of each cluster.</p></li>
<li><p>A slower dropoff (more rectangular) indicates more points are “happy” in their cluster.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">visualizer</span> <span class="o">=</span> <span class="n">SilhouetteVisualizer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s2">&quot;yellowbrick&quot;</span><span class="p">)</span>
<span class="n">visualizer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>  <span class="c1"># Fit the data to the visualizer</span>
<span class="n">visualizer</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># Finalize and render the figure</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_168_0.png" src="../_images/14_k-means-clustering_168_0.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:title={&#39;center&#39;:&#39;Silhouette Plot of KMeans Clustering for 100 Samples in 3 Centers&#39;}, xlabel=&#39;silhouette coefficient values&#39;, ylabel=&#39;cluster label&#39;&gt;
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="comments-on-silhouette-scores">
<h3>Comments on Silhouette scores<a class="headerlink" href="#comments-on-silhouette-scores" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Unlike inertia, larger values are better because they indicate that the point is further away from neighbouring clusters.</p></li>
<li><p>Unlike inertia, the overall silhouette score gets worse as you add more clusters because you end up being closer to neighbouring clusters.</p></li>
<li><p>Thus, as with intertia, you will not see a “peak” value of this metric that indicates the best number of clusters.</p></li>
<li><p>We can visualize the silhouette score for each example individually in a silhouette plot (hence the name), see below.</p></li>
<li><p>We can apply Silhouette method to clustering methods other than K-Means.</p></li>
</ul>
</div>
<div class="section" id="k-means-true-false-questions">
<h3>K-Means: True/False questions<a class="headerlink" href="#k-means-true-false-questions" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The preprocessing methods such as scaling and imputation are unsupervised methods.</p></li>
<li><p>K-Means algorithm always converges to the same solution.</p></li>
<li><p><span class="math notranslate nohighlight">\(K\)</span> in K-Means should always be <span class="math notranslate nohighlight">\(\leq\)</span> # of features.</p></li>
<li><p>In K-Means, it makes sense to have <span class="math notranslate nohighlight">\(K\)</span> <span class="math notranslate nohighlight">\(\leq\)</span> # of examples.</p></li>
</ul>
<p><br><br><br><br></p>
</div>
<div class="section" id="id6">
<h3>K-Means: True/False questions<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>In some iterations some points may be left unassigned.</p></li>
<li><p>K-Means is sensitive to initialization and the solution may change depending upon the initialization.</p></li>
<li><p>K-means terminates when the number of clusters does not increase between iterations.</p></li>
<li><p>K-means terminates when the centroid locations do not change between iterations.</p></li>
</ul>
<p><br><br><br><br></p>
</div>
</div>
<div class="section" id="break-5-min">
<h2>Break (5 min)<a class="headerlink" href="#break-5-min" title="Permalink to this headline">¶</a></h2>
<p><img alt="" src="../_images/eva-coffee.png" /></p>
<p><br><br><br><br></p>
</div>
<div class="section" id="k-means-case-study-customer-segmentation">
<h2>K-Means case study: Customer segmentation<a class="headerlink" href="#k-means-case-study-customer-segmentation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="what-is-customer-segmentation">
<h3>What is customer segmentation?<a class="headerlink" href="#what-is-customer-segmentation" title="Permalink to this headline">¶</a></h3>
<p>Check out <a class="reference external" href="https://www.ted.com/talks/malcolm_gladwell_on_spaghetti_sauce?language=en">this interesting talk by Malcom Gladwell</a>. Humans are diverse and there is no single spaghetti sauce that would make all of them happy!</p>
<p>Often it’s beneficial to businesses to explore the landscape of the market and tailor their services and products offered to each group. This is called <strong>customer segmentation</strong>. It’s usually applied when the dataset contains some of the following features.</p>
<ul class="simple">
<li><p><strong>Demographic information</strong> such as gender, age, marital status, income, education, and occupation</p></li>
<li><p><strong>Geographical information</strong> such as specific towns or counties or a customer’s city, state, or even country of residence (in case of big global companies)</p></li>
<li><p><strong>Psychographics</strong> such as social class, lifestyle, and personality traits</p></li>
<li><p><strong>Behavioral data</strong> such as spending and consumption habits, product/service usage, and desired benefits</p></li>
</ul>
</div>
<div class="section" id="business-problem">
<h3>Business problem<a class="headerlink" href="#business-problem" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Imagine that you are hired as a data scientist at a bank. They provide some data of their credit card customers to you.</p></li>
<li><p>Their goal is to develop customized marketing campaigns and they ask you to group customers based on the given information.</p></li>
<li><p>Now that you know about K-Means clustering, let’s apply it to the dataset to group customers.</p></li>
</ul>
</div>
<div class="section" id="data">
<h3>Data<a class="headerlink" href="#data" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>We will use the <a class="reference external" href="https://www.kaggle.com/arjunbhasin2013/ccdata">Credit Card Dataset for clustering</a> from Kaggle.</p></li>
<li><p>Download the data and save the CSV under the <code class="docutils literal notranslate"><span class="pre">data</span></code> folder.</p></li>
<li><p>I encourage you to work through this case study on your own.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">creditcard_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/CC General.csv&quot;</span><span class="p">)</span>
<span class="n">creditcard_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(8950, 18)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="information-of-the-dataset">
<h3>Information of the dataset<a class="headerlink" href="#information-of-the-dataset" title="Permalink to this headline">¶</a></h3>
<p>We have behavioral data.</p>
<ul class="simple">
<li><p>CUSTID: Identification of Credit Card holder</p></li>
<li><p>BALANCE: Balance amount left in customer’s account to make purchases</p></li>
<li><p>BALANCE_FREQUENCY: How frequently the Balance is updated, score between 0 and 1 (1 = frequently updated, 0 = not frequently updated)</p></li>
<li><p>PURCHASES: Amount of purchases made from account</p></li>
<li><p>ONEOFFPURCHASES: Maximum purchase amount done in one-go</p></li>
<li><p>INSTALLMENTS_PURCHASES: Amount of purchase done in installment</p></li>
<li><p>CASH_ADVANCE: Cash in advance given by the user</p></li>
<li><p>PURCHASES_FREQUENCY: How frequently the Purchases are being made, score between 0 and 1 (1 = frequently purchased, 0 = not frequently purchased)</p></li>
<li><p>ONEOFF_PURCHASES_FREQUENCY: How frequently Purchases are happening in one-go (1 = frequently purchased, 0 = not frequently purchased)</p></li>
<li><p>PURCHASES_INSTALLMENTS_FREQUENCY: How frequently purchases in installments are being done (1 = frequently done, 0 = not frequently done)</p></li>
<li><p>CASH_ADVANCE_FREQUENCY: How frequently the cash in advance being paid</p></li>
<li><p>CASH_ADVANCE_TRX: Number of Transactions made with “Cash in Advance”</p></li>
<li><p>PURCHASES_TRX: Number of purchase transactions made</p></li>
<li><p>CREDIT_LIMIT: Limit of Credit Card for user</p></li>
<li><p>PAYMENTS: Amount of Payment done by user</p></li>
<li><p>MINIMUM_PAYMENTS: Minimum amount of payments made by user</p></li>
<li><p>PRC_FULL_PAYMENT: Percent of full payment paid by user</p></li>
<li><p>TENURE: Tenure of credit card service for user</p></li>
</ul>
</div>
<div class="section" id="preliminary-eda">
<h3>Preliminary EDA<a class="headerlink" href="#preliminary-eda" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">creditcard_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 8950 entries, 0 to 8949
Data columns (total 18 columns):
 #   Column                            Non-Null Count  Dtype  
---  ------                            --------------  -----  
 0   CUST_ID                           8950 non-null   object 
 1   BALANCE                           8950 non-null   float64
 2   BALANCE_FREQUENCY                 8950 non-null   float64
 3   PURCHASES                         8950 non-null   float64
 4   ONEOFF_PURCHASES                  8950 non-null   float64
 5   INSTALLMENTS_PURCHASES            8950 non-null   float64
 6   CASH_ADVANCE                      8950 non-null   float64
 7   PURCHASES_FREQUENCY               8950 non-null   float64
 8   ONEOFF_PURCHASES_FREQUENCY        8950 non-null   float64
 9   PURCHASES_INSTALLMENTS_FREQUENCY  8950 non-null   float64
 10  CASH_ADVANCE_FREQUENCY            8950 non-null   float64
 11  CASH_ADVANCE_TRX                  8950 non-null   int64  
 12  PURCHASES_TRX                     8950 non-null   int64  
 13  CREDIT_LIMIT                      8949 non-null   float64
 14  PAYMENTS                          8950 non-null   float64
 15  MINIMUM_PAYMENTS                  8637 non-null   float64
 16  PRC_FULL_PAYMENT                  8950 non-null   float64
 17  TENURE                            8950 non-null   int64  
dtypes: float64(14), int64(3), object(1)
memory usage: 1.2+ MB
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>All numeric features</p></li>
<li><p>Some missing values</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">creditcard_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>BALANCE</th>
      <th>BALANCE_FREQUENCY</th>
      <th>PURCHASES</th>
      <th>ONEOFF_PURCHASES</th>
      <th>INSTALLMENTS_PURCHASES</th>
      <th>CASH_ADVANCE</th>
      <th>PURCHASES_FREQUENCY</th>
      <th>ONEOFF_PURCHASES_FREQUENCY</th>
      <th>PURCHASES_INSTALLMENTS_FREQUENCY</th>
      <th>CASH_ADVANCE_FREQUENCY</th>
      <th>CASH_ADVANCE_TRX</th>
      <th>PURCHASES_TRX</th>
      <th>CREDIT_LIMIT</th>
      <th>PAYMENTS</th>
      <th>MINIMUM_PAYMENTS</th>
      <th>PRC_FULL_PAYMENT</th>
      <th>TENURE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>8950.000000</td>
      <td>8950.000000</td>
      <td>8950.000000</td>
      <td>8950.000000</td>
      <td>8950.000000</td>
      <td>8950.000000</td>
      <td>8950.000000</td>
      <td>8950.000000</td>
      <td>8950.000000</td>
      <td>8950.000000</td>
      <td>8950.000000</td>
      <td>8950.000000</td>
      <td>8949.000000</td>
      <td>8950.000000</td>
      <td>8637.000000</td>
      <td>8950.000000</td>
      <td>8950.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1564.474828</td>
      <td>0.877271</td>
      <td>1003.204834</td>
      <td>592.437371</td>
      <td>411.067645</td>
      <td>978.871112</td>
      <td>0.490351</td>
      <td>0.202458</td>
      <td>0.364437</td>
      <td>0.135144</td>
      <td>3.248827</td>
      <td>14.709832</td>
      <td>4494.449450</td>
      <td>1733.143852</td>
      <td>864.206542</td>
      <td>0.153715</td>
      <td>11.517318</td>
    </tr>
    <tr>
      <th>std</th>
      <td>2081.531879</td>
      <td>0.236904</td>
      <td>2136.634782</td>
      <td>1659.887917</td>
      <td>904.338115</td>
      <td>2097.163877</td>
      <td>0.401371</td>
      <td>0.298336</td>
      <td>0.397448</td>
      <td>0.200121</td>
      <td>6.824647</td>
      <td>24.857649</td>
      <td>3638.815725</td>
      <td>2895.063757</td>
      <td>2372.446607</td>
      <td>0.292499</td>
      <td>1.338331</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>50.000000</td>
      <td>0.000000</td>
      <td>0.019163</td>
      <td>0.000000</td>
      <td>6.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>128.281915</td>
      <td>0.888889</td>
      <td>39.635000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.083333</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1600.000000</td>
      <td>383.276166</td>
      <td>169.123707</td>
      <td>0.000000</td>
      <td>12.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>873.385231</td>
      <td>1.000000</td>
      <td>361.280000</td>
      <td>38.000000</td>
      <td>89.000000</td>
      <td>0.000000</td>
      <td>0.500000</td>
      <td>0.083333</td>
      <td>0.166667</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>7.000000</td>
      <td>3000.000000</td>
      <td>856.901546</td>
      <td>312.343947</td>
      <td>0.000000</td>
      <td>12.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>2054.140036</td>
      <td>1.000000</td>
      <td>1110.130000</td>
      <td>577.405000</td>
      <td>468.637500</td>
      <td>1113.821139</td>
      <td>0.916667</td>
      <td>0.300000</td>
      <td>0.750000</td>
      <td>0.222222</td>
      <td>4.000000</td>
      <td>17.000000</td>
      <td>6500.000000</td>
      <td>1901.134317</td>
      <td>825.485459</td>
      <td>0.142857</td>
      <td>12.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>19043.138560</td>
      <td>1.000000</td>
      <td>49039.570000</td>
      <td>40761.250000</td>
      <td>22500.000000</td>
      <td>47137.211760</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.500000</td>
      <td>123.000000</td>
      <td>358.000000</td>
      <td>30000.000000</td>
      <td>50721.483360</td>
      <td>76406.207520</td>
      <td>1.000000</td>
      <td>12.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="practice-exercises-for-you">
<h3>Practice exercises for you<a class="headerlink" href="#practice-exercises-for-you" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p>What is the average <code class="docutils literal notranslate"><span class="pre">BALANCE</span></code> amount?</p></li>
<li><p>How often the <code class="docutils literal notranslate"><span class="pre">BALANCE_FREQUENCY</span></code> is updated on average?</p></li>
<li><p>Obtain the row the customer who made the maximum cash advance transaction.</p></li>
</ol>
<p><br><br><br><br></p>
</div>
<div class="section" id="mini-exercises-for-you-answers">
<h3>Mini exercises for you (Answers)<a class="headerlink" href="#mini-exercises-for-you-answers" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p>What is the average <code class="docutils literal notranslate"><span class="pre">BALANCE</span></code> amount? 1564.47</p></li>
<li><p>How often the <code class="docutils literal notranslate"><span class="pre">BALANCE_FREQUENCY</span></code> is updated on average? 0.88 (pretty often)</p></li>
<li><p>Obtain the row of the customer who made the maximum cash advance transaction.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">max_cash_advance</span> <span class="o">=</span> <span class="n">creditcard_df</span><span class="p">[</span><span class="s2">&quot;CASH_ADVANCE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">creditcard_df</span><span class="p">[</span><span class="n">creditcard_df</span><span class="p">[</span><span class="s2">&quot;CASH_ADVANCE&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">max_cash_advance</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CUST_ID</th>
      <th>BALANCE</th>
      <th>BALANCE_FREQUENCY</th>
      <th>PURCHASES</th>
      <th>ONEOFF_PURCHASES</th>
      <th>INSTALLMENTS_PURCHASES</th>
      <th>CASH_ADVANCE</th>
      <th>PURCHASES_FREQUENCY</th>
      <th>ONEOFF_PURCHASES_FREQUENCY</th>
      <th>PURCHASES_INSTALLMENTS_FREQUENCY</th>
      <th>CASH_ADVANCE_FREQUENCY</th>
      <th>CASH_ADVANCE_TRX</th>
      <th>PURCHASES_TRX</th>
      <th>CREDIT_LIMIT</th>
      <th>PAYMENTS</th>
      <th>MINIMUM_PAYMENTS</th>
      <th>PRC_FULL_PAYMENT</th>
      <th>TENURE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2159</th>
      <td>C12226</td>
      <td>10905.05381</td>
      <td>1.0</td>
      <td>431.93</td>
      <td>133.5</td>
      <td>298.43</td>
      <td>47137.21176</td>
      <td>0.583333</td>
      <td>0.25</td>
      <td>0.5</td>
      <td>1.0</td>
      <td>123</td>
      <td>21</td>
      <td>19600.0</td>
      <td>39048.59762</td>
      <td>5394.173671</td>
      <td>0.0</td>
      <td>12</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s examine correlations between features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cor</span> <span class="o">=</span> <span class="n">creditcard_df</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cor</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_190_0.png" src="../_images/14_k-means-clustering_190_0.png" />
</div>
</div>
</div>
<div class="section" id="feature-types-and-preprocessing">
<h3>Feature types and preprocessing<a class="headerlink" href="#feature-types-and-preprocessing" title="Permalink to this headline">¶</a></h3>
<p>Let’s identify different feature types and transformations</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">creditcard_df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;CUST_ID&#39;, &#39;BALANCE&#39;, &#39;BALANCE_FREQUENCY&#39;, &#39;PURCHASES&#39;,
       &#39;ONEOFF_PURCHASES&#39;, &#39;INSTALLMENTS_PURCHASES&#39;, &#39;CASH_ADVANCE&#39;,
       &#39;PURCHASES_FREQUENCY&#39;, &#39;ONEOFF_PURCHASES_FREQUENCY&#39;,
       &#39;PURCHASES_INSTALLMENTS_FREQUENCY&#39;, &#39;CASH_ADVANCE_FREQUENCY&#39;,
       &#39;CASH_ADVANCE_TRX&#39;, &#39;PURCHASES_TRX&#39;, &#39;CREDIT_LIMIT&#39;, &#39;PAYMENTS&#39;,
       &#39;MINIMUM_PAYMENTS&#39;, &#39;PRC_FULL_PAYMENT&#39;, &#39;TENURE&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">drop_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;CUST_ID&quot;</span><span class="p">]</span>
<span class="n">numeric_features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">creditcard_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">drop_features</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>

<span class="n">numeric_transformer</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">SimpleImputer</span><span class="p">(),</span> <span class="n">StandardScaler</span><span class="p">())</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span><span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">numeric_features</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;drop&quot;</span><span class="p">,</span> <span class="n">drop_features</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transformed_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">preprocessor</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">creditcard_df</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">numeric_features</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transformed_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PURCHASES_FREQUENCY</th>
      <th>CASH_ADVANCE</th>
      <th>PURCHASES_INSTALLMENTS_FREQUENCY</th>
      <th>BALANCE_FREQUENCY</th>
      <th>TENURE</th>
      <th>CASH_ADVANCE_FREQUENCY</th>
      <th>INSTALLMENTS_PURCHASES</th>
      <th>BALANCE</th>
      <th>PAYMENTS</th>
      <th>PURCHASES</th>
      <th>CREDIT_LIMIT</th>
      <th>PRC_FULL_PAYMENT</th>
      <th>CASH_ADVANCE_TRX</th>
      <th>PURCHASES_TRX</th>
      <th>ONEOFF_PURCHASES</th>
      <th>ONEOFF_PURCHASES_FREQUENCY</th>
      <th>MINIMUM_PAYMENTS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.806490</td>
      <td>-0.466786</td>
      <td>-0.707313</td>
      <td>-0.249434</td>
      <td>0.360680</td>
      <td>-0.675349</td>
      <td>-0.349079</td>
      <td>-0.731989</td>
      <td>-0.528979</td>
      <td>-0.424900</td>
      <td>-0.960433</td>
      <td>-0.525551</td>
      <td>-0.476070</td>
      <td>-0.511333</td>
      <td>-0.356934</td>
      <td>-0.678661</td>
      <td>-3.109675e-01</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-1.221758</td>
      <td>2.605605</td>
      <td>-0.916995</td>
      <td>0.134325</td>
      <td>0.360680</td>
      <td>0.573963</td>
      <td>-0.454576</td>
      <td>0.786961</td>
      <td>0.818642</td>
      <td>-0.469552</td>
      <td>0.688639</td>
      <td>0.234227</td>
      <td>0.110074</td>
      <td>-0.591796</td>
      <td>-0.356934</td>
      <td>-0.678661</td>
      <td>8.931021e-02</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.269843</td>
      <td>-0.466786</td>
      <td>-0.916995</td>
      <td>0.518084</td>
      <td>0.360680</td>
      <td>-0.675349</td>
      <td>-0.454576</td>
      <td>0.447135</td>
      <td>-0.383805</td>
      <td>-0.107668</td>
      <td>0.826062</td>
      <td>-0.525551</td>
      <td>-0.476070</td>
      <td>-0.109020</td>
      <td>0.108889</td>
      <td>2.673451</td>
      <td>-1.016632e-01</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-1.014125</td>
      <td>-0.368653</td>
      <td>-0.916995</td>
      <td>-1.016953</td>
      <td>0.360680</td>
      <td>-0.258913</td>
      <td>-0.454576</td>
      <td>0.049099</td>
      <td>-0.598688</td>
      <td>0.232058</td>
      <td>0.826062</td>
      <td>-0.525551</td>
      <td>-0.329534</td>
      <td>-0.551565</td>
      <td>0.546189</td>
      <td>-0.399319</td>
      <td>4.878305e-17</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-1.014125</td>
      <td>-0.466786</td>
      <td>-0.916995</td>
      <td>0.518084</td>
      <td>0.360680</td>
      <td>-0.675349</td>
      <td>-0.454576</td>
      <td>-0.358775</td>
      <td>-0.364368</td>
      <td>-0.462063</td>
      <td>-0.905464</td>
      <td>-0.525551</td>
      <td>-0.476070</td>
      <td>-0.551565</td>
      <td>-0.347294</td>
      <td>-0.399319</td>
      <td>-2.657913e-01</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>8945</th>
      <td>1.269843</td>
      <td>-0.466786</td>
      <td>1.179833</td>
      <td>0.518084</td>
      <td>-4.122768</td>
      <td>-0.675349</td>
      <td>-0.132643</td>
      <td>-0.737950</td>
      <td>-0.486217</td>
      <td>-0.333293</td>
      <td>-0.960433</td>
      <td>1.183951</td>
      <td>-0.476070</td>
      <td>-0.350408</td>
      <td>-0.356934</td>
      <td>-0.678661</td>
      <td>-3.498541e-01</td>
    </tr>
    <tr>
      <th>8946</th>
      <td>1.269843</td>
      <td>-0.466786</td>
      <td>1.179833</td>
      <td>0.518084</td>
      <td>-4.122768</td>
      <td>-0.675349</td>
      <td>-0.122823</td>
      <td>-0.742423</td>
      <td>-0.503396</td>
      <td>-0.329136</td>
      <td>-0.960433</td>
      <td>-0.525551</td>
      <td>-0.476070</td>
      <td>-0.350408</td>
      <td>-0.356934</td>
      <td>-0.678661</td>
      <td>4.878305e-17</td>
    </tr>
    <tr>
      <th>8947</th>
      <td>0.854576</td>
      <td>-0.466786</td>
      <td>0.760469</td>
      <td>-0.185477</td>
      <td>-4.122768</td>
      <td>-0.675349</td>
      <td>-0.294893</td>
      <td>-0.740398</td>
      <td>-0.570615</td>
      <td>-0.401965</td>
      <td>-0.960433</td>
      <td>0.329200</td>
      <td>-0.476070</td>
      <td>-0.390639</td>
      <td>-0.356934</td>
      <td>-0.678661</td>
      <td>-3.354655e-01</td>
    </tr>
    <tr>
      <th>8948</th>
      <td>-1.221758</td>
      <td>-0.449352</td>
      <td>-0.916995</td>
      <td>-0.185477</td>
      <td>-4.122768</td>
      <td>0.157527</td>
      <td>-0.454576</td>
      <td>-0.745174</td>
      <td>-0.580536</td>
      <td>-0.469552</td>
      <td>-1.097856</td>
      <td>0.329200</td>
      <td>-0.182998</td>
      <td>-0.591796</td>
      <td>-0.356934</td>
      <td>-0.678661</td>
      <td>-3.469065e-01</td>
    </tr>
    <tr>
      <th>8949</th>
      <td>0.439310</td>
      <td>-0.406205</td>
      <td>-0.916995</td>
      <td>-0.889033</td>
      <td>-4.122768</td>
      <td>0.990398</td>
      <td>-0.454576</td>
      <td>-0.572575</td>
      <td>-0.576869</td>
      <td>0.042146</td>
      <td>-0.905464</td>
      <td>-0.525551</td>
      <td>-0.182998</td>
      <td>0.333524</td>
      <td>0.301732</td>
      <td>1.556082</td>
      <td>-3.329464e-01</td>
    </tr>
  </tbody>
</table>
<p>8950 rows × 17 columns</p>
</div></div></div>
</div>
<p>Now that we have transformed the data, we are ready to run K-Means to cluster credit card customers.</p>
</div>
<div class="section" id="tuning-the-hyperparameter-n-clusters">
<h3>Tuning the hyperparameter <code class="docutils literal notranslate"><span class="pre">n_clusters</span></code><a class="headerlink" href="#tuning-the-hyperparameter-n-clusters" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Let’s first obtain optimal number of clusters using the Elbow method.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">()</span>
<span class="n">visualizer</span> <span class="o">=</span> <span class="n">KElbowVisualizer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>

<span class="n">visualizer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">transformed_df</span><span class="p">)</span>  <span class="c1"># Fit the data to the visualizer</span>
<span class="n">visualizer</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_199_0.png" src="../_images/14_k-means-clustering_199_0.png" />
</div>
</div>
<ul class="simple">
<li><p>The optimal number of clusters is not as clear as it was in our toy example.</p></li>
</ul>
<ul class="simple">
<li><p>Let’s examine Silhouette scores.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">visualizer</span> <span class="o">=</span> <span class="n">SilhouetteVisualizer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s2">&quot;yellowbrick&quot;</span><span class="p">)</span>
<span class="n">visualizer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">transformed_df</span><span class="p">)</span>  <span class="c1"># Fit the data to the visualizer</span>
<span class="n">visualizer</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># Finalize and render the figure</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_202_0.png" src="../_images/14_k-means-clustering_202_0.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:title={&#39;center&#39;:&#39;Silhouette Plot of KMeans Clustering for 8950 Samples in 4 Centers&#39;}, xlabel=&#39;silhouette coefficient values&#39;, ylabel=&#39;cluster label&#39;&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">visualizer</span> <span class="o">=</span> <span class="n">SilhouetteVisualizer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s2">&quot;yellowbrick&quot;</span><span class="p">)</span>
<span class="n">visualizer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">transformed_df</span><span class="p">)</span>  <span class="c1"># Fit the data to the visualizer</span>
<span class="n">visualizer</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># Finalize and render the figure</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_203_0.png" src="../_images/14_k-means-clustering_203_0.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:title={&#39;center&#39;:&#39;Silhouette Plot of KMeans Clustering for 8950 Samples in 5 Centers&#39;}, xlabel=&#39;silhouette coefficient values&#39;, ylabel=&#39;cluster label&#39;&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">visualizer</span> <span class="o">=</span> <span class="n">SilhouetteVisualizer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s2">&quot;yellowbrick&quot;</span><span class="p">)</span>
<span class="n">visualizer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">transformed_df</span><span class="p">)</span>  <span class="c1"># Fit the data to the visualizer</span>
<span class="n">visualizer</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># Finalize and render the figure</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_204_0.png" src="../_images/14_k-means-clustering_204_0.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:title={&#39;center&#39;:&#39;Silhouette Plot of KMeans Clustering for 8950 Samples in 6 Centers&#39;}, xlabel=&#39;silhouette coefficient values&#39;, ylabel=&#39;cluster label&#39;&gt;
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>I’m going to run <code class="docutils literal notranslate"><span class="pre">KMeans</span></code> with <code class="docutils literal notranslate"><span class="pre">n_clusters</span> <span class="pre">=</span> <span class="pre">4</span></code>.</p></li>
<li><p>You can try out <code class="docutils literal notranslate"><span class="pre">n_clusters</span> <span class="pre">=</span> <span class="pre">5</span></code> and <code class="docutils literal notranslate"><span class="pre">n_clusters</span> <span class="pre">=</span> <span class="pre">6</span></code> on your own.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="n">kmeans</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">transformed_df</span><span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">labels_</span>
<span class="n">kmeans</span><span class="o">.</span><span class="n">cluster_centers_</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(4, 17)
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Let’s visualize the clusters in two dimensions using PCA, which is a popular dimensionality reduction technique.</p></li>
<li><p>We won’t be talking about PCA in this course but I’ll be using it for visualization.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Obtain the principal components</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>


<span class="k">def</span> <span class="nf">plot_pca_clusters</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Carries out dimensionality reduction on the data for visualization</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">principal_comp</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">pca_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">principal_comp</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pca1&quot;</span><span class="p">,</span> <span class="s2">&quot;pca2&quot;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">index</span>
    <span class="p">)</span>
    <span class="n">pca_df</span><span class="p">[</span><span class="s2">&quot;cluster&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="s2">&quot;pca1&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;pca2&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;cluster&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">pca_df</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;tab10&quot;</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_pca_clusters</span><span class="p">(</span><span class="n">transformed_df</span><span class="p">,</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">labels_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_209_0.png" src="../_images/14_k-means-clustering_209_0.png" />
</div>
</div>
<ul class="simple">
<li><p>The clusters above look reasonably well separated.</p></li>
<li><p>This might not always be the case.</p></li>
</ul>
</div>
<div class="section" id="cluster-interpretation">
<h3>Cluster interpretation<a class="headerlink" href="#cluster-interpretation" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Let’s examine the cluster centers and identify types of customers.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cluster_centers</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">kmeans</span><span class="o">.</span><span class="n">cluster_centers_</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">transformed_df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">cluster_centers</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>PURCHASES_FREQUENCY</th>
      <th>CASH_ADVANCE</th>
      <th>PURCHASES_INSTALLMENTS_FREQUENCY</th>
      <th>BALANCE_FREQUENCY</th>
      <th>TENURE</th>
      <th>CASH_ADVANCE_FREQUENCY</th>
      <th>INSTALLMENTS_PURCHASES</th>
      <th>BALANCE</th>
      <th>PAYMENTS</th>
      <th>PURCHASES</th>
      <th>CREDIT_LIMIT</th>
      <th>PRC_FULL_PAYMENT</th>
      <th>CASH_ADVANCE_TRX</th>
      <th>PURCHASES_TRX</th>
      <th>ONEOFF_PURCHASES</th>
      <th>ONEOFF_PURCHASES_FREQUENCY</th>
      <th>MINIMUM_PAYMENTS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.136338</td>
      <td>-0.155091</td>
      <td>1.065918</td>
      <td>0.462694</td>
      <td>0.324140</td>
      <td>-0.319096</td>
      <td>2.406470</td>
      <td>0.954485</td>
      <td>1.919096</td>
      <td>3.125845</td>
      <td>1.429882</td>
      <td>0.454703</td>
      <td>-0.170458</td>
      <td>3.003251</td>
      <td>2.713251</td>
      <td>1.798653</td>
      <td>0.477421</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.504848</td>
      <td>1.688972</td>
      <td>-0.450201</td>
      <td>0.384753</td>
      <td>-0.097146</td>
      <td>1.745948</td>
      <td>-0.253747</td>
      <td>1.459578</td>
      <td>0.603821</td>
      <td>-0.234638</td>
      <td>0.838968</td>
      <td>-0.406367</td>
      <td>1.617143</td>
      <td>-0.283580</td>
      <td>-0.163914</td>
      <td>-0.212939</td>
      <td>0.490910</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.797823</td>
      <td>-0.182691</td>
      <td>-0.714246</td>
      <td>-0.368944</td>
      <td>-0.052972</td>
      <td>-0.101500</td>
      <td>-0.387798</td>
      <td>-0.265552</td>
      <td>-0.262060</td>
      <td>-0.343190</td>
      <td>-0.334417</td>
      <td>-0.258866</td>
      <td>-0.164607</td>
      <td>-0.474987</td>
      <td>-0.230500</td>
      <td>-0.389437</td>
      <td>-0.119249</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.983721</td>
      <td>-0.366373</td>
      <td>0.874138</td>
      <td>0.242574</td>
      <td>0.057744</td>
      <td>-0.462599</td>
      <td>0.255904</td>
      <td>-0.321688</td>
      <td>-0.138502</td>
      <td>0.109044</td>
      <td>-0.077298</td>
      <td>0.395041</td>
      <td>-0.360303</td>
      <td>0.296985</td>
      <td>0.000926</td>
      <td>0.317153</td>
      <td>-0.091844</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Recall that we have applied imputation and scaling on the dataset.</p></li>
<li><p>But we would be able to interpret these clusters better if the centers are in the original scale.</p></li>
<li><p>So let’s apply inverse transformations to get the cluster center values in the original scale.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">preprocessor</span><span class="o">.</span><span class="n">named_transformers_</span><span class="p">[</span><span class="s2">&quot;pipeline&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;standardscaler&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">cluster_centers</span><span class="p">[</span><span class="n">numeric_features</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">org_cluster_centers</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">numeric_features</span><span class="p">)</span>
<span class="n">org_cluster_centers</span> <span class="o">=</span> <span class="n">org_cluster_centers</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span>
    <span class="nb">sorted</span><span class="p">(</span><span class="n">org_cluster_centers</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">org_cluster_centers</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>BALANCE</th>
      <th>BALANCE_FREQUENCY</th>
      <th>CASH_ADVANCE</th>
      <th>CASH_ADVANCE_FREQUENCY</th>
      <th>CASH_ADVANCE_TRX</th>
      <th>CREDIT_LIMIT</th>
      <th>INSTALLMENTS_PURCHASES</th>
      <th>MINIMUM_PAYMENTS</th>
      <th>ONEOFF_PURCHASES</th>
      <th>ONEOFF_PURCHASES_FREQUENCY</th>
      <th>PAYMENTS</th>
      <th>PRC_FULL_PAYMENT</th>
      <th>PURCHASES</th>
      <th>PURCHASES_FREQUENCY</th>
      <th>PURCHASES_INSTALLMENTS_FREQUENCY</th>
      <th>PURCHASES_TRX</th>
      <th>TENURE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3551.153761</td>
      <td>0.986879</td>
      <td>653.638891</td>
      <td>0.071290</td>
      <td>2.085575</td>
      <td>9696.943765</td>
      <td>2587.208264</td>
      <td>1976.815179</td>
      <td>5095.878826</td>
      <td>0.739031</td>
      <td>7288.739497</td>
      <td>0.286707</td>
      <td>7681.620098</td>
      <td>0.946418</td>
      <td>0.788060</td>
      <td>89.359413</td>
      <td>11.951100</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4602.462714</td>
      <td>0.968415</td>
      <td>4520.724309</td>
      <td>0.484526</td>
      <td>14.284641</td>
      <td>7546.957050</td>
      <td>181.607404</td>
      <td>2008.251157</td>
      <td>320.373681</td>
      <td>0.138934</td>
      <td>3481.145990</td>
      <td>0.034859</td>
      <td>501.896219</td>
      <td>0.287731</td>
      <td>0.185516</td>
      <td>7.661102</td>
      <td>11.387312</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1011.751528</td>
      <td>0.789871</td>
      <td>595.759339</td>
      <td>0.114833</td>
      <td>2.125503</td>
      <td>3277.703165</td>
      <td>60.386625</td>
      <td>586.301239</td>
      <td>209.853863</td>
      <td>0.086281</td>
      <td>974.505090</td>
      <td>0.078001</td>
      <td>269.973466</td>
      <td>0.170146</td>
      <td>0.080578</td>
      <td>2.903421</td>
      <td>11.446429</td>
    </tr>
    <tr>
      <th>3</th>
      <td>894.907458</td>
      <td>0.934734</td>
      <td>210.570626</td>
      <td>0.042573</td>
      <td>0.790021</td>
      <td>4213.207678</td>
      <td>642.478274</td>
      <td>650.167072</td>
      <td>593.974874</td>
      <td>0.297070</td>
      <td>1332.194205</td>
      <td>0.269258</td>
      <td>1236.178934</td>
      <td>0.885165</td>
      <td>0.711842</td>
      <td>22.091773</td>
      <td>11.594595</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">org_cluster_centers</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>BALANCE</th>
      <th>BALANCE_FREQUENCY</th>
      <th>CASH_ADVANCE</th>
      <th>CASH_ADVANCE_FREQUENCY</th>
      <th>CASH_ADVANCE_TRX</th>
      <th>CREDIT_LIMIT</th>
      <th>INSTALLMENTS_PURCHASES</th>
      <th>MINIMUM_PAYMENTS</th>
      <th>ONEOFF_PURCHASES</th>
      <th>ONEOFF_PURCHASES_FREQUENCY</th>
      <th>PAYMENTS</th>
      <th>PRC_FULL_PAYMENT</th>
      <th>PURCHASES</th>
      <th>PURCHASES_FREQUENCY</th>
      <th>PURCHASES_INSTALLMENTS_FREQUENCY</th>
      <th>PURCHASES_TRX</th>
      <th>TENURE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3551.153761</td>
      <td>0.986879</td>
      <td>653.638891</td>
      <td>0.071290</td>
      <td>2.085575</td>
      <td>9696.943765</td>
      <td>2587.208264</td>
      <td>1976.815179</td>
      <td>5095.878826</td>
      <td>0.739031</td>
      <td>7288.739497</td>
      <td>0.286707</td>
      <td>7681.620098</td>
      <td>0.946418</td>
      <td>0.788060</td>
      <td>89.359413</td>
      <td>11.951100</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4602.462714</td>
      <td>0.968415</td>
      <td>4520.724309</td>
      <td>0.484526</td>
      <td>14.284641</td>
      <td>7546.957050</td>
      <td>181.607404</td>
      <td>2008.251157</td>
      <td>320.373681</td>
      <td>0.138934</td>
      <td>3481.145990</td>
      <td>0.034859</td>
      <td>501.896219</td>
      <td>0.287731</td>
      <td>0.185516</td>
      <td>7.661102</td>
      <td>11.387312</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1011.751528</td>
      <td>0.789871</td>
      <td>595.759339</td>
      <td>0.114833</td>
      <td>2.125503</td>
      <td>3277.703165</td>
      <td>60.386625</td>
      <td>586.301239</td>
      <td>209.853863</td>
      <td>0.086281</td>
      <td>974.505090</td>
      <td>0.078001</td>
      <td>269.973466</td>
      <td>0.170146</td>
      <td>0.080578</td>
      <td>2.903421</td>
      <td>11.446429</td>
    </tr>
    <tr>
      <th>3</th>
      <td>894.907458</td>
      <td>0.934734</td>
      <td>210.570626</td>
      <td>0.042573</td>
      <td>0.790021</td>
      <td>4213.207678</td>
      <td>642.478274</td>
      <td>650.167072</td>
      <td>593.974874</td>
      <td>0.297070</td>
      <td>1332.194205</td>
      <td>0.269258</td>
      <td>1236.178934</td>
      <td>0.885165</td>
      <td>0.711842</td>
      <td>22.091773</td>
      <td>11.594595</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="section" id="transactors">
<h4>Transactors<a class="headerlink" href="#transactors" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Credit card users who pay off their balance every month with least amount of interest charges.</p></li>
<li><p>They are careful with their money.</p></li>
<li><p>They have lowest balance and cash advance</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">org_cluster_centers</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>BALANCE</th>
      <th>BALANCE_FREQUENCY</th>
      <th>CASH_ADVANCE</th>
      <th>CASH_ADVANCE_FREQUENCY</th>
      <th>CASH_ADVANCE_TRX</th>
      <th>CREDIT_LIMIT</th>
      <th>INSTALLMENTS_PURCHASES</th>
      <th>MINIMUM_PAYMENTS</th>
      <th>ONEOFF_PURCHASES</th>
      <th>ONEOFF_PURCHASES_FREQUENCY</th>
      <th>PAYMENTS</th>
      <th>PRC_FULL_PAYMENT</th>
      <th>PURCHASES</th>
      <th>PURCHASES_FREQUENCY</th>
      <th>PURCHASES_INSTALLMENTS_FREQUENCY</th>
      <th>PURCHASES_TRX</th>
      <th>TENURE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3551.153761</td>
      <td>0.986879</td>
      <td>653.638891</td>
      <td>0.071290</td>
      <td>2.085575</td>
      <td>9696.943765</td>
      <td>2587.208264</td>
      <td>1976.815179</td>
      <td>5095.878826</td>
      <td>0.739031</td>
      <td>7288.739497</td>
      <td>0.286707</td>
      <td>7681.620098</td>
      <td>0.946418</td>
      <td>0.788060</td>
      <td>89.359413</td>
      <td>11.951100</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4602.462714</td>
      <td>0.968415</td>
      <td>4520.724309</td>
      <td>0.484526</td>
      <td>14.284641</td>
      <td>7546.957050</td>
      <td>181.607404</td>
      <td>2008.251157</td>
      <td>320.373681</td>
      <td>0.138934</td>
      <td>3481.145990</td>
      <td>0.034859</td>
      <td>501.896219</td>
      <td>0.287731</td>
      <td>0.185516</td>
      <td>7.661102</td>
      <td>11.387312</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1011.751528</td>
      <td>0.789871</td>
      <td>595.759339</td>
      <td>0.114833</td>
      <td>2.125503</td>
      <td>3277.703165</td>
      <td>60.386625</td>
      <td>586.301239</td>
      <td>209.853863</td>
      <td>0.086281</td>
      <td>974.505090</td>
      <td>0.078001</td>
      <td>269.973466</td>
      <td>0.170146</td>
      <td>0.080578</td>
      <td>2.903421</td>
      <td>11.446429</td>
    </tr>
    <tr>
      <th>3</th>
      <td>894.907458</td>
      <td>0.934734</td>
      <td>210.570626</td>
      <td>0.042573</td>
      <td>0.790021</td>
      <td>4213.207678</td>
      <td>642.478274</td>
      <td>650.167072</td>
      <td>593.974874</td>
      <td>0.297070</td>
      <td>1332.194205</td>
      <td>0.269258</td>
      <td>1236.178934</td>
      <td>0.885165</td>
      <td>0.711842</td>
      <td>22.091773</td>
      <td>11.594595</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="revolvers">
<h4>Revolvers<a class="headerlink" href="#revolvers" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Credit card users who pay off only part of their monthly balance . They use credit card as a loan.</p></li>
<li><p>They have highest balance and cash advance, high cash advance frequency, low purchase frequency, high cash advance transactions, low percentage of full payment</p></li>
<li><p>Their credit limit is also high. (Lucrative group for banks 😟.)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">org_cluster_centers</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>BALANCE</th>
      <th>BALANCE_FREQUENCY</th>
      <th>CASH_ADVANCE</th>
      <th>CASH_ADVANCE_FREQUENCY</th>
      <th>CASH_ADVANCE_TRX</th>
      <th>CREDIT_LIMIT</th>
      <th>INSTALLMENTS_PURCHASES</th>
      <th>MINIMUM_PAYMENTS</th>
      <th>ONEOFF_PURCHASES</th>
      <th>ONEOFF_PURCHASES_FREQUENCY</th>
      <th>PAYMENTS</th>
      <th>PRC_FULL_PAYMENT</th>
      <th>PURCHASES</th>
      <th>PURCHASES_FREQUENCY</th>
      <th>PURCHASES_INSTALLMENTS_FREQUENCY</th>
      <th>PURCHASES_TRX</th>
      <th>TENURE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3551.153761</td>
      <td>0.986879</td>
      <td>653.638891</td>
      <td>0.071290</td>
      <td>2.085575</td>
      <td>9696.943765</td>
      <td>2587.208264</td>
      <td>1976.815179</td>
      <td>5095.878826</td>
      <td>0.739031</td>
      <td>7288.739497</td>
      <td>0.286707</td>
      <td>7681.620098</td>
      <td>0.946418</td>
      <td>0.788060</td>
      <td>89.359413</td>
      <td>11.951100</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4602.462714</td>
      <td>0.968415</td>
      <td>4520.724309</td>
      <td>0.484526</td>
      <td>14.284641</td>
      <td>7546.957050</td>
      <td>181.607404</td>
      <td>2008.251157</td>
      <td>320.373681</td>
      <td>0.138934</td>
      <td>3481.145990</td>
      <td>0.034859</td>
      <td>501.896219</td>
      <td>0.287731</td>
      <td>0.185516</td>
      <td>7.661102</td>
      <td>11.387312</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1011.751528</td>
      <td>0.789871</td>
      <td>595.759339</td>
      <td>0.114833</td>
      <td>2.125503</td>
      <td>3277.703165</td>
      <td>60.386625</td>
      <td>586.301239</td>
      <td>209.853863</td>
      <td>0.086281</td>
      <td>974.505090</td>
      <td>0.078001</td>
      <td>269.973466</td>
      <td>0.170146</td>
      <td>0.080578</td>
      <td>2.903421</td>
      <td>11.446429</td>
    </tr>
    <tr>
      <th>3</th>
      <td>894.907458</td>
      <td>0.934734</td>
      <td>210.570626</td>
      <td>0.042573</td>
      <td>0.790021</td>
      <td>4213.207678</td>
      <td>642.478274</td>
      <td>650.167072</td>
      <td>593.974874</td>
      <td>0.297070</td>
      <td>1332.194205</td>
      <td>0.269258</td>
      <td>1236.178934</td>
      <td>0.885165</td>
      <td>0.711842</td>
      <td>22.091773</td>
      <td>11.594595</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="vip-prime">
<h4>VIP/Prime<a class="headerlink" href="#vip-prime" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Credit card users who have high credit limit.</p></li>
<li><p>They have high one-off purchases frequency, high number of purchase transactions.</p></li>
<li><p>They have high balance but they also have relatively higher percentage of full payment, similar to transactors</p></li>
<li><p>Target for increase credit limit (and increase spending habits )</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">org_cluster_centers</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>BALANCE</th>
      <th>BALANCE_FREQUENCY</th>
      <th>CASH_ADVANCE</th>
      <th>CASH_ADVANCE_FREQUENCY</th>
      <th>CASH_ADVANCE_TRX</th>
      <th>CREDIT_LIMIT</th>
      <th>INSTALLMENTS_PURCHASES</th>
      <th>MINIMUM_PAYMENTS</th>
      <th>ONEOFF_PURCHASES</th>
      <th>ONEOFF_PURCHASES_FREQUENCY</th>
      <th>PAYMENTS</th>
      <th>PRC_FULL_PAYMENT</th>
      <th>PURCHASES</th>
      <th>PURCHASES_FREQUENCY</th>
      <th>PURCHASES_INSTALLMENTS_FREQUENCY</th>
      <th>PURCHASES_TRX</th>
      <th>TENURE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3551.153761</td>
      <td>0.986879</td>
      <td>653.638891</td>
      <td>0.071290</td>
      <td>2.085575</td>
      <td>9696.943765</td>
      <td>2587.208264</td>
      <td>1976.815179</td>
      <td>5095.878826</td>
      <td>0.739031</td>
      <td>7288.739497</td>
      <td>0.286707</td>
      <td>7681.620098</td>
      <td>0.946418</td>
      <td>0.788060</td>
      <td>89.359413</td>
      <td>11.951100</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4602.462714</td>
      <td>0.968415</td>
      <td>4520.724309</td>
      <td>0.484526</td>
      <td>14.284641</td>
      <td>7546.957050</td>
      <td>181.607404</td>
      <td>2008.251157</td>
      <td>320.373681</td>
      <td>0.138934</td>
      <td>3481.145990</td>
      <td>0.034859</td>
      <td>501.896219</td>
      <td>0.287731</td>
      <td>0.185516</td>
      <td>7.661102</td>
      <td>11.387312</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1011.751528</td>
      <td>0.789871</td>
      <td>595.759339</td>
      <td>0.114833</td>
      <td>2.125503</td>
      <td>3277.703165</td>
      <td>60.386625</td>
      <td>586.301239</td>
      <td>209.853863</td>
      <td>0.086281</td>
      <td>974.505090</td>
      <td>0.078001</td>
      <td>269.973466</td>
      <td>0.170146</td>
      <td>0.080578</td>
      <td>2.903421</td>
      <td>11.446429</td>
    </tr>
    <tr>
      <th>3</th>
      <td>894.907458</td>
      <td>0.934734</td>
      <td>210.570626</td>
      <td>0.042573</td>
      <td>0.790021</td>
      <td>4213.207678</td>
      <td>642.478274</td>
      <td>650.167072</td>
      <td>593.974874</td>
      <td>0.297070</td>
      <td>1332.194205</td>
      <td>0.269258</td>
      <td>1236.178934</td>
      <td>0.885165</td>
      <td>0.711842</td>
      <td>22.091773</td>
      <td>11.594595</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="low-activity">
<h4>Low activity<a class="headerlink" href="#low-activity" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Credit card users who have low tenure, low credit limit.</p></li>
<li><p>There is not much activity in the account. It has low balance and not many purchases.</p></li>
</ul>
</div>
</div>
<div class="section" id="more-on-interpretation-of-clusters">
<h3>More on interpretation of clusters<a class="headerlink" href="#more-on-interpretation-of-clusters" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>In real life, you’ll look through all features in detail before assigning meaning to clusters.</p></li>
<li><p>This is not always easy, especially when you have a large number of features and clusters.</p></li>
<li><p>One way to approach this would be visualizing the distribution of feature values for each cluster as shown below.</p></li>
<li><p>Some domain knowledge would definitely help at this stage.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># concatenate the cluster labels to our original dataframe</span>
<span class="n">creditcard_df_cluster</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
    <span class="p">[</span><span class="n">creditcard_df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;cluster&quot;</span><span class="p">:</span> <span class="n">labels</span><span class="p">})],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">creditcard_df_cluster</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CUST_ID</th>
      <th>BALANCE</th>
      <th>BALANCE_FREQUENCY</th>
      <th>PURCHASES</th>
      <th>ONEOFF_PURCHASES</th>
      <th>INSTALLMENTS_PURCHASES</th>
      <th>CASH_ADVANCE</th>
      <th>PURCHASES_FREQUENCY</th>
      <th>ONEOFF_PURCHASES_FREQUENCY</th>
      <th>PURCHASES_INSTALLMENTS_FREQUENCY</th>
      <th>CASH_ADVANCE_FREQUENCY</th>
      <th>CASH_ADVANCE_TRX</th>
      <th>PURCHASES_TRX</th>
      <th>CREDIT_LIMIT</th>
      <th>PAYMENTS</th>
      <th>MINIMUM_PAYMENTS</th>
      <th>PRC_FULL_PAYMENT</th>
      <th>TENURE</th>
      <th>cluster</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>C10001</td>
      <td>40.900749</td>
      <td>0.818182</td>
      <td>95.40</td>
      <td>0.00</td>
      <td>95.4</td>
      <td>0.000000</td>
      <td>0.166667</td>
      <td>0.000000</td>
      <td>0.083333</td>
      <td>0.000000</td>
      <td>0</td>
      <td>2</td>
      <td>1000.0</td>
      <td>201.802084</td>
      <td>139.509787</td>
      <td>0.000000</td>
      <td>12</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>C10002</td>
      <td>3202.467416</td>
      <td>0.909091</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.0</td>
      <td>6442.945483</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.250000</td>
      <td>4</td>
      <td>0</td>
      <td>7000.0</td>
      <td>4103.032597</td>
      <td>1072.340217</td>
      <td>0.222222</td>
      <td>12</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>C10003</td>
      <td>2495.148862</td>
      <td>1.000000</td>
      <td>773.17</td>
      <td>773.17</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0</td>
      <td>12</td>
      <td>7500.0</td>
      <td>622.066742</td>
      <td>627.284787</td>
      <td>0.000000</td>
      <td>12</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>C10004</td>
      <td>1666.670542</td>
      <td>0.636364</td>
      <td>1499.00</td>
      <td>1499.00</td>
      <td>0.0</td>
      <td>205.788017</td>
      <td>0.083333</td>
      <td>0.083333</td>
      <td>0.000000</td>
      <td>0.083333</td>
      <td>1</td>
      <td>1</td>
      <td>7500.0</td>
      <td>0.000000</td>
      <td>NaN</td>
      <td>0.000000</td>
      <td>12</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>C10005</td>
      <td>817.714335</td>
      <td>1.000000</td>
      <td>16.00</td>
      <td>16.00</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.083333</td>
      <td>0.083333</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0</td>
      <td>1</td>
      <td>1200.0</td>
      <td>678.334763</td>
      <td>244.791237</td>
      <td>0.000000</td>
      <td>12</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">creditcard_df_cluster</span><span class="p">[</span><span class="s2">&quot;cluster&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([2, 1, 3, 0], dtype=int32)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">creditcard_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(18,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the histogram of various clusters</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">transformed_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">cluster</span> <span class="o">=</span> <span class="n">creditcard_df_cluster</span><span class="p">[</span><span class="n">creditcard_df_cluster</span><span class="p">[</span><span class="s2">&quot;cluster&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span><span class="p">]</span>
        <span class="n">cluster</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">    </span><span class="se">\n</span><span class="s2">Cluster </span><span class="si">{}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_228_0.png" src="../_images/14_k-means-clustering_228_0.png" />
<img alt="../_images/14_k-means-clustering_228_1.png" src="../_images/14_k-means-clustering_228_1.png" />
<img alt="../_images/14_k-means-clustering_228_2.png" src="../_images/14_k-means-clustering_228_2.png" />
<img alt="../_images/14_k-means-clustering_228_3.png" src="../_images/14_k-means-clustering_228_3.png" />
<img alt="../_images/14_k-means-clustering_228_4.png" src="../_images/14_k-means-clustering_228_4.png" />
<img alt="../_images/14_k-means-clustering_228_5.png" src="../_images/14_k-means-clustering_228_5.png" />
<img alt="../_images/14_k-means-clustering_228_6.png" src="../_images/14_k-means-clustering_228_6.png" />
<img alt="../_images/14_k-means-clustering_228_7.png" src="../_images/14_k-means-clustering_228_7.png" />
<img alt="../_images/14_k-means-clustering_228_8.png" src="../_images/14_k-means-clustering_228_8.png" />
<img alt="../_images/14_k-means-clustering_228_9.png" src="../_images/14_k-means-clustering_228_9.png" />
<img alt="../_images/14_k-means-clustering_228_10.png" src="../_images/14_k-means-clustering_228_10.png" />
<img alt="../_images/14_k-means-clustering_228_11.png" src="../_images/14_k-means-clustering_228_11.png" />
<img alt="../_images/14_k-means-clustering_228_12.png" src="../_images/14_k-means-clustering_228_12.png" />
<img alt="../_images/14_k-means-clustering_228_13.png" src="../_images/14_k-means-clustering_228_13.png" />
<img alt="../_images/14_k-means-clustering_228_14.png" src="../_images/14_k-means-clustering_228_14.png" />
<img alt="../_images/14_k-means-clustering_228_15.png" src="../_images/14_k-means-clustering_228_15.png" />
<img alt="../_images/14_k-means-clustering_228_16.png" src="../_images/14_k-means-clustering_228_16.png" />
</div>
</div>
</div>
<div class="section" id="practice-exercise-for-you">
<h3>Practice exercise for you<a class="headerlink" href="#practice-exercise-for-you" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Try out different values for <code class="docutils literal notranslate"><span class="pre">n_clusters</span></code> in <code class="docutils literal notranslate"><span class="pre">KMeans</span></code> and examine the clusters.</p></li>
<li><p>If you are feeling adventurous, you may try customer segmentation on <a class="reference external" href="https://www.kaggle.com/wordsforthewise/lending-club">All Lending Club loan data</a>.</p></li>
</ul>
<p><br><br><br><br></p>
</div>
</div>
<div class="section" id="final-comments-and-summary">
<h2>Final comments and summary<a class="headerlink" href="#final-comments-and-summary" title="Permalink to this headline">¶</a></h2>
<div class="section" id="a-comment-on-initialization">
<h3>A comment on initialization<a class="headerlink" href="#a-comment-on-initialization" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The initialization of K-Means is stochastic, can this affect the results?</p>
<ul>
<li><p>Yes! Big time.</p></li>
</ul>
</li>
<li><p>Let’s  look at an example.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_blobs</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">centers</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">n_features</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">mglearn</span><span class="o">.</span><span class="n">discrete_scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">markers</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_233_0.png" src="../_images/14_k-means-clustering_233_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">k</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">n_examples</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">toy_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;feat1&quot;</span><span class="p">,</span> <span class="s2">&quot;feat2&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="example-bad-initialization">
<h3>Example: Bad initialization<a class="headerlink" href="#example-bad-initialization" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">centroids_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_examples</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
<span class="n">centroids</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">centroids_idx</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_iterative</span><span class="p">(</span><span class="n">toy_df</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">centroids</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_237_0.png" src="../_images/14_k-means-clustering_237_0.png" />
</div>
</div>
</div>
<div class="section" id="example-better-initialization">
<h3>Example: Better initialization<a class="headerlink" href="#example-better-initialization" title="Permalink to this headline">¶</a></h3>
<p>The following initialization seems much better.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">centroids_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_examples</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
<span class="n">centroids</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">centroids_idx</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_iterative</span><span class="p">(</span><span class="n">toy_df</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">centroids</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14_k-means-clustering_240_0.png" src="../_images/14_k-means-clustering_240_0.png" />
</div>
</div>
</div>
<div class="section" id="what-can-we-do-about-it">
<h3>What can we do about it?<a class="headerlink" href="#what-can-we-do-about-it" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>One strategy is to run the algorithm several times.</p>
<ul>
<li><p>Check out <code class="docutils literal notranslate"><span class="pre">n_init</span></code> parameter of <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.cluster.KMeans.html"><code class="docutils literal notranslate"><span class="pre">sklearn</span></code>’s <code class="docutils literal notranslate"><span class="pre">KMeans</span></code></a>.</p></li>
</ul>
</li>
<li><p>Is it possible to pick <code class="docutils literal notranslate"><span class="pre">K</span></code> in a smart way?</p>
<ul>
<li><p>Yes! We can use the so-called <a class="reference external" href="http://ilpubs.stanford.edu:8090/778/1/2006-13.pdf">K-Means++</a>.</p></li>
<li><p>Intuitively, it picks the initial centroids which are far away from each other.</p></li>
<li><p>In other words, K-Means++ gives more chance to select points that are far away from centroids already picked.</p></li>
<li><p>By default <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> uses this strategy for initialization.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="important-points-to-remember">
<h3>Important points to remember<a class="headerlink" href="#important-points-to-remember" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Clustering is a common unsupervised approach to identify underlying structure in data and grouping points based on similarity.</p></li>
<li><p>K-Means is a popular clustering algorithm.</p></li>
</ul>
</div>
<div class="section" id="id7">
<h3>Important points to remember<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p><strong>K-Means</strong></p>
<ul class="simple">
<li><p>It requires us to specify the number of clusters in advance.</p></li>
<li><p>Each example is assigned to one (and only one) cluster.</p></li>
<li><p>The labels provided by the algorithm have no actual meaning.</p></li>
<li><p>The centroids live in the same space as of the dataset but they are <strong>not</strong> actual data points, but instead are average points.</p></li>
<li><p>It always converges. Convergence is dependent upon the initial centers and it may converge to a sub-optimal solution.</p></li>
</ul>
</div>
<div class="section" id="id8">
<h3>Important points to remember<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Two ways to provide insight into how many clusters are reasonable for the give problem are: <strong>the Elbow method</strong> and <strong>the Silhouette method</strong>.</p></li>
<li><p>Some applications of K-Means clustering include data exploration, feature engineering, customer segmentation, and document clustering.</p></li>
<li><p>It takes fair amount of manual effort and domain knowledge to interpret clusters returned by K-Means.</p></li>
</ul>
</div>
</div>
<div class="section" id="resources">
<h2>Resources<a class="headerlink" href="#resources" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://www.ted.com/talks/malcolm_gladwell_on_spaghetti_sauce?language=en">“Spaghetti Sauce” talk by Malcom Gladwell</a></p></li>
<li><p><a class="reference external" href="https://www.naftaliharris.com/blog/visualizing-k-means-clustering/">Visualizing-k-means-clustering</a></p></li>
<li><p><a class="reference external" href="http://tech.nitoyon.com/en/blog/2013/11/07/k-means/">Visualizing K-Means algorithm with D3.js</a></p></li>
<li><p><a class="reference external" href="https://dashee87.github.io/data%20science/general/Clustering-with-Scikit-with-GIFs/">Clustering with Scikit with GIFs</a></p></li>
<li><p><a class="reference external" href="https://scikit-learn.org/stable/modules/clustering.html"><code class="docutils literal notranslate"><span class="pre">sklearn</span></code> clustering documentation</a></p></li>
</ul>
<p><br><br><br><br></p>
</div>
<div class="section" id="questions-for-class-discussion-a-name-questions-a">
<h2>Questions for class Discussion <a name="questions"></a><a class="headerlink" href="#questions-for-class-discussion-a-name-questions-a" title="Permalink to this headline">¶</a></h2>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "conda-env-cpsc330-py"
        },
        kernelOptions: {
            kernelName: "conda-env-cpsc330-py",
            path: "./lectures"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'conda-env-cpsc330-py'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="13_feature-engineering-selection.html" title="previous page">Lecture 13: Feature engineering and feature selection</a>
    <a class='right-next' id="next-link" href="../attribution.html" title="next page">Attributions</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Varada Kolhatkar<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>