
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lecture 6: sklearn ColumnTransformer and Text Features &#8212; CPSC 330 Applied Machine Learning</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lecture 7: Linear Models" href="07_linear-models.html" />
    <link rel="prev" title="Lecture 5: Preprocessing and sklearn pipelines" href="05_preprocessing-pipelines.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/UBC-CS-logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">CPSC 330 Applied Machine Learning</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p class="caption">
 <span class="caption-text">
  Things you should know
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../docs/README.html">
   CPSC 330 Documents
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Lectures
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01_intro.html">
   Lecture 1: Course Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_decision-trees.html">
   Lecture 2: Terminology, Baselines, Decision Trees
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_ml-fundamentals.html">
   Lecture 3: Machine Learning Fundamentals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_kNNs-SVM-RBF.html">
   Lecture 4:
   <span class="math notranslate nohighlight">
    \(k\)
   </span>
   -Nearest Neighbours and SVM RBFs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_preprocessing-pipelines.html">
   Lecture 5: Preprocessing and
   <code class="docutils literal notranslate">
    <span class="pre">
     sklearn
    </span>
   </code>
   pipelines
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Lecture 6:
   <code class="docutils literal notranslate">
    <span class="pre">
     sklearn
    </span>
   </code>
   <code class="docutils literal notranslate">
    <span class="pre">
     ColumnTransformer
    </span>
   </code>
   and Text Features
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_linear-models.html">
   Lecture 7: Linear Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08_hyperparameter-optimization.html">
   Lecture 8: Hyperparameter Optimization and Optimization Bias
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_classification-metrics.html">
   Lecture 9: Classification Metrics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="10_regression-metrics.html">
   Lecture 10: Regression Evaluation Metrics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="11_ensembles.html">
   Lecture 11: Ensembles
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Attribution
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../attribution.html">
   Attributions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../LICENSE.html">
   LICENSE
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Varada Kolhatkar, CPSC 330 2021-22<br>Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/lectures/06_column-transformer-text-feats.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/UBC-CS/cpsc330/master?urlpath=tree/lectures/06_column-transformer-text-feats.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports">
   Imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lecture-plan-for-today">
   Lecture plan for today
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#announcements">
   Announcements
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#learning-outcomes">
   Learning outcomes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sklearn-s-columntransformer">
   sklearn’s
   <code class="docutils literal notranslate">
    <span class="pre">
     ColumnTransformer
    </span>
   </code>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#transformations-on-the-toy-data">
     Transformations on the toy data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#columntransformer-example">
     <code class="docutils literal notranslate">
      <span class="pre">
       ColumnTransformer
      </span>
     </code>
     example
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#data">
       Data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#identify-the-transformations-we-want-to-apply">
       Identify the transformations we want to apply
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#create-a-column-transformer">
       Create a column transformer
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#convenient-make-column-transformer-syntax">
       Convenient
       <code class="docutils literal notranslate">
        <span class="pre">
         make_column_transformer
        </span>
       </code>
       syntax
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#let-s-examine-the-transformed-data">
       Let’s examine the transformed data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#viewing-the-transformed-data-as-a-dataframe">
       Viewing the transformed data as a dataframe
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#columntransformer-transformed-data">
       <code class="docutils literal notranslate">
        <span class="pre">
         ColumnTransformer
        </span>
       </code>
       : Transformed data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#training-models-with-transformed-data">
       Training models with transformed data
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#questions-for-you">
     ❓❓ Questions for you
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#true-false-columntransformer">
       True/False:
       <code class="docutils literal notranslate">
        <span class="pre">
         ColumnTransformer
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#what-transformations-on-what-columns">
       What transformations on what columns?
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#more-on-feature-transformations">
   More on feature transformations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiple-transformations-in-a-transformer">
     Multiple transformations in a transformer
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sklearn-set-config">
     <code class="docutils literal notranslate">
      <span class="pre">
       sklearn
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       set_config
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#incorporating-ordinal-feature-class-attendance">
     Incorporating ordinal feature
     <code class="docutils literal notranslate">
      <span class="pre">
       class_attendance
      </span>
     </code>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#more-than-one-ordinal-columns">
       More than one ordinal columns?
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dealing-with-unknown-categories">
     Dealing with unknown categories
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#cases-where-it-s-ok-to-break-the-golden-rule">
       Cases where it’s OK to break the golden rule
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#categorical-features-with-only-two-possible-categories">
     Categorical features with only two possible categories
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#break-5-min">
   Break (5 min)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#columntransformer-on-the-california-housing-dataset">
   <code class="docutils literal notranslate">
    <span class="pre">
     ColumnTransformer
    </span>
   </code>
   on the California housing dataset
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ohe-with-many-categories">
     OHE with many categories
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#do-we-actually-want-to-use-certain-features-for-prediction">
     Do we actually want to use certain features for prediction?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#preprocessing-the-targets">
     Preprocessing the targets?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     ❓❓ Questions for you
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#true-false-categorical-features">
       True/False: Categorical features
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#encoding-text-data">
   Encoding text data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spam-non-spam-toy-example">
     Spam/non spam toy example
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-if-we-apply-ohe">
     What if we apply OHE?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bag-of-words-bow-representation">
     Bag of words (BOW) representation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#extracting-bow-features-using-scikit-learn">
     Extracting BOW features using
     <code class="docutils literal notranslate">
      <span class="pre">
       scikit-learn
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#why-sparse-matrices">
     Why sparse matrices?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#onehotencoder-and-sparse-features">
     <code class="docutils literal notranslate">
      <span class="pre">
       OneHotEncoder
      </span>
     </code>
     and sparse features
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#important-hyperparameters-of-countvectorizer">
     Important hyperparameters of
     <code class="docutils literal notranslate">
      <span class="pre">
       CountVectorizer
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#preprocessing">
     Preprocessing
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#is-this-a-realistic-representation-of-text-data">
     Is this a realistic representation of text data?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     ❓❓ Questions for you
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#countvectorizer-true-or-false">
       <code class="docutils literal notranslate">
        <span class="pre">
         CountVectorizer
        </span>
       </code>
       : True or False
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#identify-column-transformations">
       Identify column transformations
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-did-we-learn-today">
   What did we learn today?
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <p><img alt="" src="../_images/330-banner.png" /></p>
<div class="section" id="lecture-6-sklearn-columntransformer-and-text-features">
<h1>Lecture 6: <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code> and Text Features<a class="headerlink" href="#lecture-6-sklearn-columntransformer-and-text-features" title="Permalink to this headline">¶</a></h1>
<p>UBC 2021-22</p>
<p>Instructor: Varada Kolhatkar</p>
<div class="section" id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;code/.&quot;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">plotting_functions</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_colwidth&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span><span class="p">,</span> <span class="n">make_column_transformer</span>
<span class="kn">from</span> <span class="nn">sklearn.dummy</span> <span class="kn">import</span> <span class="n">DummyClassifier</span><span class="p">,</span> <span class="n">DummyRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span><span class="p">,</span> <span class="n">cross_validate</span><span class="p">,</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span><span class="p">,</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">OrdinalEncoder</span><span class="p">,</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
</pre></div>
</div>
</div>
</div>
<p><br><br><br><br></p>
</div>
<div class="section" id="lecture-plan-for-today">
<h2>Lecture plan for today<a class="headerlink" href="#lecture-plan-for-today" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Announcements (~2 mins)</p></li>
<li><p>Exercises on pre-watched video 6.1 (~15 mins)</p></li>
<li><p>Live explanation: More on <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code> (~20 mins)</p></li>
<li><p>Break (~5 mins)</p></li>
<li><p>Live explanation: ColumnTransformer on California housing dataset (~10 mins)</p></li>
<li><p>Exercises on pre-watched video 6.2 (~15 mins)</p></li>
<li><p>Summary and wrap up (~2 mins)</p></li>
</ul>
</div>
<div class="section" id="announcements">
<h2>Announcements<a class="headerlink" href="#announcements" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>No class on Thursday.</p></li>
<li><p>Homework 3 is due on Oct 4th.</p></li>
<li><p>Scheduled extra office hours this week.</p>
<ul>
<li><p>Check the <a class="reference external" href="https://htmlpreview.github.io/?https://github.com/UBC-CS/cpsc330/blob/master/docs/calendar.html">Calendar</a>.</p></li>
</ul>
</li>
<li><p>I won’t be posting my solutions in the lecture notebooks anymore because the notebooks are publicly available.</p>
<ul>
<li><p>Start a discussion on Piazza if you are unsure about any of the questions we discuss in class and I’ll be happy to respond there.</p></li>
</ul>
</li>
<li><p>We’re working on Homework 2 grading. The grades will be released in a couple of days.</p></li>
</ul>
</div>
<div class="section" id="learning-outcomes">
<h2>Learning outcomes<a class="headerlink" href="#learning-outcomes" title="Permalink to this headline">¶</a></h2>
<p>From this lecture, you will be able to</p>
<ul class="simple">
<li><p>use <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code> to build all our transformations together into one object and use it with <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> pipelines;</p></li>
<li><p>define <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code> where transformers contain more than one steps;</p></li>
<li><p>explain <code class="docutils literal notranslate"><span class="pre">handle_unknown=&quot;ignore&quot;</span></code> hyperparameter of <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>’s <code class="docutils literal notranslate"><span class="pre">OneHotEncoder</span></code>;</p></li>
<li><p>explain <code class="docutils literal notranslate"><span class="pre">drop=&quot;if_binary&quot;</span></code> argument of <code class="docutils literal notranslate"><span class="pre">OneHotEncoder</span></code>;</p></li>
<li><p>identify when it’s appropriate to apply ordinal encoding vs one-hot encoding;</p></li>
<li><p>explain strategies to deal with categorical variables with too many categories;</p></li>
<li><p>explain why text data needs a different treatment than categorical variables;</p></li>
<li><p>use <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>’s <code class="docutils literal notranslate"><span class="pre">CountVectorizer</span></code> to encode text data;</p></li>
<li><p>explain different hyperparameters of <code class="docutils literal notranslate"><span class="pre">CountVectorizer</span></code>.</p></li>
</ul>
</div>
<div class="section" id="sklearn-s-columntransformer">
<h2>sklearn’s <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.compose.ColumnTransformer.html"><code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code></a><a class="headerlink" href="#sklearn-s-columntransformer" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>In most applications, some features are categorical, some are continuous, some are binary, and some are ordinal.</p></li>
<li><p>When we want to develop supervised machine learning pipelines on real-world datasets, very often we want to apply different transformation on different columns.</p></li>
<li><p>Enter <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>’s <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code>!!</p></li>
</ul>
<ul class="simple">
<li><p>Let’s look at a toy example:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/quiz2-grade-toy-col-transformer.csv&quot;</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>enjoy_course</th>
      <th>ml_experience</th>
      <th>major</th>
      <th>class_attendance</th>
      <th>university_years</th>
      <th>lab1</th>
      <th>lab2</th>
      <th>lab3</th>
      <th>lab4</th>
      <th>quiz1</th>
      <th>quiz2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>yes</td>
      <td>1</td>
      <td>Computer Science</td>
      <td>Excellent</td>
      <td>3</td>
      <td>92</td>
      <td>93.0</td>
      <td>84</td>
      <td>91</td>
      <td>92</td>
      <td>A+</td>
    </tr>
    <tr>
      <th>1</th>
      <td>yes</td>
      <td>1</td>
      <td>Mechanical Engineering</td>
      <td>Average</td>
      <td>2</td>
      <td>94</td>
      <td>90.0</td>
      <td>80</td>
      <td>83</td>
      <td>91</td>
      <td>not A+</td>
    </tr>
    <tr>
      <th>2</th>
      <td>yes</td>
      <td>0</td>
      <td>Mathematics</td>
      <td>Poor</td>
      <td>3</td>
      <td>78</td>
      <td>85.0</td>
      <td>83</td>
      <td>80</td>
      <td>80</td>
      <td>not A+</td>
    </tr>
    <tr>
      <th>3</th>
      <td>no</td>
      <td>0</td>
      <td>Mathematics</td>
      <td>Excellent</td>
      <td>3</td>
      <td>91</td>
      <td>NaN</td>
      <td>92</td>
      <td>91</td>
      <td>89</td>
      <td>A+</td>
    </tr>
    <tr>
      <th>4</th>
      <td>yes</td>
      <td>0</td>
      <td>Psychology</td>
      <td>Good</td>
      <td>4</td>
      <td>77</td>
      <td>83.0</td>
      <td>90</td>
      <td>92</td>
      <td>85</td>
      <td>A+</td>
    </tr>
    <tr>
      <th>5</th>
      <td>no</td>
      <td>1</td>
      <td>Economics</td>
      <td>Good</td>
      <td>5</td>
      <td>70</td>
      <td>73.0</td>
      <td>68</td>
      <td>74</td>
      <td>71</td>
      <td>not A+</td>
    </tr>
    <tr>
      <th>6</th>
      <td>yes</td>
      <td>1</td>
      <td>Computer Science</td>
      <td>Excellent</td>
      <td>4</td>
      <td>80</td>
      <td>88.0</td>
      <td>89</td>
      <td>88</td>
      <td>91</td>
      <td>A+</td>
    </tr>
    <tr>
      <th>7</th>
      <td>no</td>
      <td>0</td>
      <td>Mechanical Engineering</td>
      <td>Poor</td>
      <td>3</td>
      <td>95</td>
      <td>93.0</td>
      <td>69</td>
      <td>79</td>
      <td>75</td>
      <td>not A+</td>
    </tr>
    <tr>
      <th>8</th>
      <td>no</td>
      <td>0</td>
      <td>Linguistics</td>
      <td>Average</td>
      <td>2</td>
      <td>97</td>
      <td>90.0</td>
      <td>94</td>
      <td>82</td>
      <td>80</td>
      <td>not A+</td>
    </tr>
    <tr>
      <th>9</th>
      <td>yes</td>
      <td>1</td>
      <td>Mathematics</td>
      <td>Average</td>
      <td>4</td>
      <td>95</td>
      <td>82.0</td>
      <td>94</td>
      <td>94</td>
      <td>85</td>
      <td>not A+</td>
    </tr>
    <tr>
      <th>10</th>
      <td>yes</td>
      <td>0</td>
      <td>Psychology</td>
      <td>Good</td>
      <td>3</td>
      <td>98</td>
      <td>86.0</td>
      <td>95</td>
      <td>95</td>
      <td>78</td>
      <td>A+</td>
    </tr>
    <tr>
      <th>11</th>
      <td>yes</td>
      <td>1</td>
      <td>Physics</td>
      <td>Average</td>
      <td>1</td>
      <td>95</td>
      <td>88.0</td>
      <td>93</td>
      <td>92</td>
      <td>85</td>
      <td>A+</td>
    </tr>
    <tr>
      <th>12</th>
      <td>yes</td>
      <td>1</td>
      <td>Physics</td>
      <td>Excellent</td>
      <td>2</td>
      <td>98</td>
      <td>96.0</td>
      <td>96</td>
      <td>99</td>
      <td>100</td>
      <td>A+</td>
    </tr>
    <tr>
      <th>13</th>
      <td>yes</td>
      <td>0</td>
      <td>Mechanical Engineering</td>
      <td>Excellent</td>
      <td>4</td>
      <td>95</td>
      <td>94.0</td>
      <td>96</td>
      <td>95</td>
      <td>100</td>
      <td>A+</td>
    </tr>
    <tr>
      <th>14</th>
      <td>no</td>
      <td>0</td>
      <td>Mathematics</td>
      <td>Poor</td>
      <td>3</td>
      <td>95</td>
      <td>90.0</td>
      <td>93</td>
      <td>95</td>
      <td>70</td>
      <td>not A+</td>
    </tr>
    <tr>
      <th>15</th>
      <td>no</td>
      <td>1</td>
      <td>Computer Science</td>
      <td>Good</td>
      <td>3</td>
      <td>92</td>
      <td>85.0</td>
      <td>67</td>
      <td>94</td>
      <td>92</td>
      <td>not A+</td>
    </tr>
    <tr>
      <th>16</th>
      <td>yes</td>
      <td>0</td>
      <td>Computer Science</td>
      <td>Average</td>
      <td>5</td>
      <td>75</td>
      <td>91.0</td>
      <td>93</td>
      <td>86</td>
      <td>85</td>
      <td>A+</td>
    </tr>
    <tr>
      <th>17</th>
      <td>yes</td>
      <td>1</td>
      <td>Economics</td>
      <td>Average</td>
      <td>3</td>
      <td>86</td>
      <td>89.0</td>
      <td>65</td>
      <td>86</td>
      <td>87</td>
      <td>not A+</td>
    </tr>
    <tr>
      <th>18</th>
      <td>no</td>
      <td>1</td>
      <td>Biology</td>
      <td>Good</td>
      <td>2</td>
      <td>91</td>
      <td>NaN</td>
      <td>90</td>
      <td>88</td>
      <td>82</td>
      <td>not A+</td>
    </tr>
    <tr>
      <th>19</th>
      <td>no</td>
      <td>0</td>
      <td>Psychology</td>
      <td>Poor</td>
      <td>2</td>
      <td>77</td>
      <td>94.0</td>
      <td>87</td>
      <td>81</td>
      <td>89</td>
      <td>not A+</td>
    </tr>
    <tr>
      <th>20</th>
      <td>yes</td>
      <td>1</td>
      <td>Linguistics</td>
      <td>Excellent</td>
      <td>4</td>
      <td>96</td>
      <td>92.0</td>
      <td>92</td>
      <td>96</td>
      <td>87</td>
      <td>A+</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 21 entries, 0 to 20
Data columns (total 11 columns):
 #   Column            Non-Null Count  Dtype  
---  ------            --------------  -----  
 0   enjoy_course      21 non-null     object 
 1   ml_experience     21 non-null     int64  
 2   major             21 non-null     object 
 3   class_attendance  21 non-null     object 
 4   university_years  21 non-null     int64  
 5   lab1              21 non-null     int64  
 6   lab2              19 non-null     float64
 7   lab3              21 non-null     int64  
 8   lab4              21 non-null     int64  
 9   quiz1             21 non-null     int64  
 10  quiz2             21 non-null     object 
dtypes: float64(1), int64(6), object(4)
memory usage: 1.9+ KB
</pre></div>
</div>
</div>
</div>
<div class="section" id="transformations-on-the-toy-data">
<h3>Transformations on the toy data<a class="headerlink" href="#transformations-on-the-toy-data" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>enjoy_course</th>
      <th>ml_experience</th>
      <th>major</th>
      <th>class_attendance</th>
      <th>university_years</th>
      <th>lab1</th>
      <th>lab2</th>
      <th>lab3</th>
      <th>lab4</th>
      <th>quiz1</th>
      <th>quiz2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>yes</td>
      <td>1</td>
      <td>Computer Science</td>
      <td>Excellent</td>
      <td>3</td>
      <td>92</td>
      <td>93.0</td>
      <td>84</td>
      <td>91</td>
      <td>92</td>
      <td>A+</td>
    </tr>
    <tr>
      <th>1</th>
      <td>yes</td>
      <td>1</td>
      <td>Mechanical Engineering</td>
      <td>Average</td>
      <td>2</td>
      <td>94</td>
      <td>90.0</td>
      <td>80</td>
      <td>83</td>
      <td>91</td>
      <td>not A+</td>
    </tr>
    <tr>
      <th>2</th>
      <td>yes</td>
      <td>0</td>
      <td>Mathematics</td>
      <td>Poor</td>
      <td>3</td>
      <td>78</td>
      <td>85.0</td>
      <td>83</td>
      <td>80</td>
      <td>80</td>
      <td>not A+</td>
    </tr>
    <tr>
      <th>3</th>
      <td>no</td>
      <td>0</td>
      <td>Mathematics</td>
      <td>Excellent</td>
      <td>3</td>
      <td>91</td>
      <td>NaN</td>
      <td>92</td>
      <td>91</td>
      <td>89</td>
      <td>A+</td>
    </tr>
    <tr>
      <th>4</th>
      <td>yes</td>
      <td>0</td>
      <td>Psychology</td>
      <td>Good</td>
      <td>4</td>
      <td>77</td>
      <td>83.0</td>
      <td>90</td>
      <td>92</td>
      <td>85</td>
      <td>A+</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Scaling on numeric features</p></li>
<li><p>One-hot encoding on the categorical feature <code class="docutils literal notranslate"><span class="pre">major</span></code> and binary feature <code class="docutils literal notranslate"><span class="pre">enjoy_class</span></code></p></li>
<li><p>Ordinal encoding on the ordinal feature <code class="docutils literal notranslate"><span class="pre">class_attendance</span></code></p></li>
<li><p>Imputation on the <code class="docutils literal notranslate"><span class="pre">lab2</span></code> feature</p></li>
<li><p>None on the <code class="docutils literal notranslate"><span class="pre">ml_experience</span></code> feature</p></li>
</ul>
</div>
<div class="section" id="columntransformer-example">
<h3><code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code> example<a class="headerlink" href="#columntransformer-example" title="Permalink to this headline">¶</a></h3>
<div class="section" id="data">
<h4>Data<a class="headerlink" href="#data" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;quiz2&quot;</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;quiz2&quot;</span><span class="p">]</span>
<span class="n">X</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;enjoy_course&#39;, &#39;ml_experience&#39;, &#39;major&#39;, &#39;class_attendance&#39;,
       &#39;university_years&#39;, &#39;lab1&#39;, &#39;lab2&#39;, &#39;lab3&#39;, &#39;lab4&#39;, &#39;quiz1&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="identify-the-transformations-we-want-to-apply">
<h4>Identify the transformations we want to apply<a class="headerlink" href="#identify-the-transformations-we-want-to-apply" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>enjoy_course</th>
      <th>ml_experience</th>
      <th>major</th>
      <th>class_attendance</th>
      <th>university_years</th>
      <th>lab1</th>
      <th>lab2</th>
      <th>lab3</th>
      <th>lab4</th>
      <th>quiz1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>yes</td>
      <td>1</td>
      <td>Computer Science</td>
      <td>Excellent</td>
      <td>3</td>
      <td>92</td>
      <td>93.0</td>
      <td>84</td>
      <td>91</td>
      <td>92</td>
    </tr>
    <tr>
      <th>1</th>
      <td>yes</td>
      <td>1</td>
      <td>Mechanical Engineering</td>
      <td>Average</td>
      <td>2</td>
      <td>94</td>
      <td>90.0</td>
      <td>80</td>
      <td>83</td>
      <td>91</td>
    </tr>
    <tr>
      <th>2</th>
      <td>yes</td>
      <td>0</td>
      <td>Mathematics</td>
      <td>Poor</td>
      <td>3</td>
      <td>78</td>
      <td>85.0</td>
      <td>83</td>
      <td>80</td>
      <td>80</td>
    </tr>
    <tr>
      <th>3</th>
      <td>no</td>
      <td>0</td>
      <td>Mathematics</td>
      <td>Excellent</td>
      <td>3</td>
      <td>91</td>
      <td>NaN</td>
      <td>92</td>
      <td>91</td>
      <td>89</td>
    </tr>
    <tr>
      <th>4</th>
      <td>yes</td>
      <td>0</td>
      <td>Psychology</td>
      <td>Good</td>
      <td>4</td>
      <td>77</td>
      <td>83.0</td>
      <td>90</td>
      <td>92</td>
      <td>85</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numeric_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;university_years&quot;</span><span class="p">,</span> <span class="s2">&quot;lab1&quot;</span><span class="p">,</span> <span class="s2">&quot;lab3&quot;</span><span class="p">,</span> <span class="s2">&quot;lab4&quot;</span><span class="p">,</span> <span class="s2">&quot;quiz1&quot;</span><span class="p">]</span>  <span class="c1"># apply scaling</span>
<span class="n">categorical_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;major&quot;</span><span class="p">]</span>  <span class="c1"># apply one-hot encoding</span>
<span class="n">passthrough_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ml_experience&quot;</span><span class="p">]</span>  <span class="c1"># do not apply any transformation</span>
<span class="n">drop_feats</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;lab2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;class_attendance&quot;</span><span class="p">,</span>
    <span class="s2">&quot;enjoy_course&quot;</span><span class="p">,</span>
<span class="p">]</span>  <span class="c1"># do not include these features in modeling</span>
</pre></div>
</div>
</div>
</div>
<p>For simplicity, let’s only focus on scaling and one-hot encoding first.</p>
</div>
<div class="section" id="create-a-column-transformer">
<h4>Create a column transformer<a class="headerlink" href="#create-a-column-transformer" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Each transformation is specified by a name, a transformer object, and the columns this transformer should be applied to.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ct</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;scaling&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">numeric_feats</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;onehot&quot;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="n">categorical_feats</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="convenient-make-column-transformer-syntax">
<h4>Convenient <code class="docutils literal notranslate"><span class="pre">make_column_transformer</span></code> syntax<a class="headerlink" href="#convenient-make-column-transformer-syntax" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Similar to <code class="docutils literal notranslate"><span class="pre">make_pipeline</span></code> syntax, there is convenient <code class="docutils literal notranslate"><span class="pre">make_column_transformer</span></code> syntax.</p></li>
<li><p>The syntax automatically names each step based on its class.</p></li>
<li><p>We’ll be mostly using this syntax.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">make_column_transformer</span>

<span class="n">ct</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">numeric_feats</span><span class="p">),</span>  <span class="c1"># scaling on numeric features</span>
    <span class="p">(</span><span class="n">OneHotEncoder</span><span class="p">(),</span> <span class="n">categorical_feats</span><span class="p">),</span>  <span class="c1"># OHE on categorical features</span>
    <span class="p">(</span><span class="s2">&quot;passthrough&quot;</span><span class="p">,</span> <span class="n">passthrough_feats</span><span class="p">),</span>  <span class="c1"># no transformations on the binary features</span>
    <span class="p">(</span><span class="s2">&quot;drop&quot;</span><span class="p">,</span> <span class="n">drop_feats</span><span class="p">),</span>  <span class="c1"># drop the drop features</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ct</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ColumnTransformer(transformers=[(&#39;standardscaler&#39;, StandardScaler(),
                                 [&#39;university_years&#39;, &#39;lab1&#39;, &#39;lab3&#39;, &#39;lab4&#39;,
                                  &#39;quiz1&#39;]),
                                (&#39;onehotencoder&#39;, OneHotEncoder(), [&#39;major&#39;]),
                                (&#39;passthrough&#39;, &#39;passthrough&#39;,
                                 [&#39;ml_experience&#39;]),
                                (&#39;drop&#39;, &#39;drop&#39;,
                                 [&#39;lab2&#39;, &#39;class_attendance&#39;, &#39;enjoy_course&#39;])])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transformed</span> <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>When we <code class="docutils literal notranslate"><span class="pre">fit_transform</span></code>, each transformer is applied to the specified columns and the result of the transformations are concatenated horizontally.</p></li>
<li><p>A big advantage here is that we build all our transformations together into one object, and that way we’re sure we do the same operations to all splits of the data.</p></li>
<li><p>Otherwise we might, for example, do the OHE on both train and test but forget to scale the test data.</p></li>
</ul>
</div>
<div class="section" id="let-s-examine-the-transformed-data">
<h4>Let’s examine the transformed data<a class="headerlink" href="#let-s-examine-the-transformed-data" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">transformed</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>numpy.ndarray
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transformed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[-0.09345386,  0.3589134 , -0.21733442,  0.36269995,  0.84002795,
         0.        ,  1.        ,  0.        ,  0.        ,  0.        ,
         0.        ,  0.        ,  0.        ,  1.        ],
       [-1.07471942,  0.59082668, -0.61420598, -0.85597188,  0.71219761,
         0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
         1.        ,  0.        ,  0.        ,  1.        ],
       [-0.09345386, -1.26447953, -0.31655231, -1.31297381, -0.69393613,
         0.        ,  0.        ,  0.        ,  0.        ,  1.        ,
         0.        ,  0.        ,  0.        ,  0.        ],
       [-0.09345386,  0.24295676,  0.57640869,  0.36269995,  0.45653693,
         0.        ,  0.        ,  0.        ,  0.        ,  1.        ,
         0.        ,  0.        ,  0.        ,  0.        ],
       [ 0.8878117 , -1.38043616,  0.37797291,  0.51503393, -0.05478443,
         0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
         0.        ,  0.        ,  1.        ,  0.        ],
       [ 1.86907725, -2.19213263, -1.80482065, -2.22697768, -1.84440919,
         0.        ,  0.        ,  1.        ,  0.        ,  0.        ,
         0.        ,  0.        ,  0.        ,  1.        ],
       [ 0.8878117 , -1.03256625,  0.27875502, -0.09430199,  0.71219761,
         0.        ,  1.        ,  0.        ,  0.        ,  0.        ,
         0.        ,  0.        ,  0.        ,  1.        ],
       [-0.09345386,  0.70678332, -1.70560276, -1.46530779, -1.33308783,
         0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
         1.        ,  0.        ,  0.        ,  0.        ],
       [-1.07471942,  0.93869659,  0.77484447, -1.00830586, -0.69393613,
         0.        ,  0.        ,  0.        ,  1.        ,  0.        ,
         0.        ,  0.        ,  0.        ,  0.        ],
       [ 0.8878117 ,  0.70678332,  0.77484447,  0.81970188, -0.05478443,
         0.        ,  0.        ,  0.        ,  0.        ,  1.        ,
         0.        ,  0.        ,  0.        ,  1.        ],
       [-0.09345386,  1.05465323,  0.87406235,  0.97203586, -0.94959681,
         0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
         0.        ,  0.        ,  1.        ,  0.        ],
       [-2.05598498,  0.70678332,  0.67562658,  0.51503393, -0.05478443,
         0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
         0.        ,  1.        ,  0.        ,  1.        ],
       [-1.07471942,  1.05465323,  0.97328024,  1.58137177,  1.86267067,
         0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
         0.        ,  1.        ,  0.        ,  1.        ],
       [ 0.8878117 ,  0.70678332,  0.97328024,  0.97203586,  1.86267067,
         0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
         1.        ,  0.        ,  0.        ,  0.        ],
       [-0.09345386,  0.70678332,  0.67562658,  0.97203586, -1.97223953,
         0.        ,  0.        ,  0.        ,  0.        ,  1.        ,
         0.        ,  0.        ,  0.        ,  0.        ],
       [-0.09345386,  0.3589134 , -1.90403853,  0.81970188,  0.84002795,
         0.        ,  1.        ,  0.        ,  0.        ,  0.        ,
         0.        ,  0.        ,  0.        ,  1.        ],
       [ 1.86907725, -1.61234944,  0.67562658, -0.39896994, -0.05478443,
         0.        ,  1.        ,  0.        ,  0.        ,  0.        ,
         0.        ,  0.        ,  0.        ,  0.        ],
       [-0.09345386, -0.33682642, -2.10247431, -0.39896994,  0.20087625,
         0.        ,  0.        ,  1.        ,  0.        ,  0.        ,
         0.        ,  0.        ,  0.        ,  1.        ],
       [-1.07471942,  0.24295676,  0.37797291, -0.09430199, -0.43827545,
         1.        ,  0.        ,  0.        ,  0.        ,  0.        ,
         0.        ,  0.        ,  0.        ,  1.        ],
       [-1.07471942, -1.38043616,  0.08031924, -1.16063983,  0.45653693,
         0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
         0.        ,  0.        ,  1.        ,  0.        ],
       [ 0.8878117 ,  0.82273995,  0.57640869,  1.12436984,  0.20087625,
         0.        ,  0.        ,  0.        ,  1.        ,  0.        ,
         0.        ,  0.        ,  0.        ,  1.        ]])
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that the returned object is not a dataframe. So there are no column names.</p>
</div>
</div>
<div class="section" id="viewing-the-transformed-data-as-a-dataframe">
<h4>Viewing the transformed data as a dataframe<a class="headerlink" href="#viewing-the-transformed-data-as-a-dataframe" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>How can we view our transformed data as a dataframe?</p></li>
<li><p>We are adding more columns.</p></li>
<li><p>So the original columns won’t directly map to the transformed data.</p></li>
<li><p>Let’s create column names for the transformed data.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">column_names</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">numeric_feats</span>
    <span class="o">+</span> <span class="n">ct</span><span class="o">.</span><span class="n">named_transformers_</span><span class="p">[</span><span class="s2">&quot;onehotencoder&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">passthrough_feats</span>
<span class="p">)</span>
<span class="n">column_names</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;university_years&#39;,
 &#39;lab1&#39;,
 &#39;lab3&#39;,
 &#39;lab4&#39;,
 &#39;quiz1&#39;,
 &#39;x0_Biology&#39;,
 &#39;x0_Computer Science&#39;,
 &#39;x0_Economics&#39;,
 &#39;x0_Linguistics&#39;,
 &#39;x0_Mathematics&#39;,
 &#39;x0_Mechanical Engineering&#39;,
 &#39;x0_Physics&#39;,
 &#39;x0_Psychology&#39;,
 &#39;ml_experience&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ct</span><span class="o">.</span><span class="n">named_transformers_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;standardscaler&#39;: StandardScaler(),
 &#39;onehotencoder&#39;: OneHotEncoder(),
 &#39;passthrough&#39;: &#39;passthrough&#39;,
 &#39;drop&#39;: &#39;drop&#39;}
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that the order of the columns in the transformed data depends upon the order of the features we pass to the <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code> and can be different than the order of the features in the original dataframe.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">transformed</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">column_names</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>university_years</th>
      <th>lab1</th>
      <th>lab3</th>
      <th>lab4</th>
      <th>quiz1</th>
      <th>x0_Biology</th>
      <th>x0_Computer Science</th>
      <th>x0_Economics</th>
      <th>x0_Linguistics</th>
      <th>x0_Mathematics</th>
      <th>x0_Mechanical Engineering</th>
      <th>x0_Physics</th>
      <th>x0_Psychology</th>
      <th>ml_experience</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.093454</td>
      <td>0.358913</td>
      <td>-0.217334</td>
      <td>0.362700</td>
      <td>0.840028</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-1.074719</td>
      <td>0.590827</td>
      <td>-0.614206</td>
      <td>-0.855972</td>
      <td>0.712198</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.093454</td>
      <td>-1.264480</td>
      <td>-0.316552</td>
      <td>-1.312974</td>
      <td>-0.693936</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.093454</td>
      <td>0.242957</td>
      <td>0.576409</td>
      <td>0.362700</td>
      <td>0.456537</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.887812</td>
      <td>-1.380436</td>
      <td>0.377973</td>
      <td>0.515034</td>
      <td>-0.054784</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1.869077</td>
      <td>-2.192133</td>
      <td>-1.804821</td>
      <td>-2.226978</td>
      <td>-1.844409</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.887812</td>
      <td>-1.032566</td>
      <td>0.278755</td>
      <td>-0.094302</td>
      <td>0.712198</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>-0.093454</td>
      <td>0.706783</td>
      <td>-1.705603</td>
      <td>-1.465308</td>
      <td>-1.333088</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>-1.074719</td>
      <td>0.938697</td>
      <td>0.774844</td>
      <td>-1.008306</td>
      <td>-0.693936</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.887812</td>
      <td>0.706783</td>
      <td>0.774844</td>
      <td>0.819702</td>
      <td>-0.054784</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>-0.093454</td>
      <td>1.054653</td>
      <td>0.874062</td>
      <td>0.972036</td>
      <td>-0.949597</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>-2.055985</td>
      <td>0.706783</td>
      <td>0.675627</td>
      <td>0.515034</td>
      <td>-0.054784</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>-1.074719</td>
      <td>1.054653</td>
      <td>0.973280</td>
      <td>1.581372</td>
      <td>1.862671</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0.887812</td>
      <td>0.706783</td>
      <td>0.973280</td>
      <td>0.972036</td>
      <td>1.862671</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>-0.093454</td>
      <td>0.706783</td>
      <td>0.675627</td>
      <td>0.972036</td>
      <td>-1.972240</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>-0.093454</td>
      <td>0.358913</td>
      <td>-1.904039</td>
      <td>0.819702</td>
      <td>0.840028</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>1.869077</td>
      <td>-1.612349</td>
      <td>0.675627</td>
      <td>-0.398970</td>
      <td>-0.054784</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>-0.093454</td>
      <td>-0.336826</td>
      <td>-2.102474</td>
      <td>-0.398970</td>
      <td>0.200876</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>-1.074719</td>
      <td>0.242957</td>
      <td>0.377973</td>
      <td>-0.094302</td>
      <td>-0.438275</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>19</th>
      <td>-1.074719</td>
      <td>-1.380436</td>
      <td>0.080319</td>
      <td>-1.160640</td>
      <td>0.456537</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>20</th>
      <td>0.887812</td>
      <td>0.822740</td>
      <td>0.576409</td>
      <td>1.124370</td>
      <td>0.200876</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="columntransformer-transformed-data">
<h4><code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code>: Transformed data<a class="headerlink" href="#columntransformer-transformed-data" title="Permalink to this headline">¶</a></h4>
<br>
<a class="reference internal image-reference" href="../_images/column-transformer.png"><img alt="../_images/column-transformer.png" src="../_images/column-transformer.png" style="width: 1500px;" /></a>
<p><a class="reference external" href="https://amueller.github.io/COMS4995-s20/slides/aml-04-preprocessing/#37">Adapted from here.</a></p>
</div>
<div class="section" id="training-models-with-transformed-data">
<h4>Training models with transformed data<a class="headerlink" href="#training-models-with-transformed-data" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>We can now pass the <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code> object as a step in a pipeline.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span> <span class="n">SVC</span><span class="p">())</span>
<span class="n">pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;A+&#39;, &#39;not A+&#39;, &#39;not A+&#39;, &#39;A+&#39;, &#39;A+&#39;, &#39;not A+&#39;, &#39;A+&#39;, &#39;not A+&#39;,
       &#39;not A+&#39;, &#39;A+&#39;, &#39;A+&#39;, &#39;A+&#39;, &#39;A+&#39;, &#39;A+&#39;, &#39;not A+&#39;, &#39;not A+&#39;, &#39;A+&#39;,
       &#39;not A+&#39;, &#39;not A+&#39;, &#39;not A+&#39;, &#39;A+&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="questions-for-you">
<h3>❓❓ Questions for you<a class="headerlink" href="#questions-for-you" title="Permalink to this headline">¶</a></h3>
<div class="section" id="true-false-columntransformer">
<h4>True/False: <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code><a class="headerlink" href="#true-false-columntransformer" title="Permalink to this headline">¶</a></h4>
<ol class="simple">
<li><p>You could carry out cross-validation by passing a <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code> object to <code class="docutils literal notranslate"><span class="pre">cross_validate</span></code>.</p></li>
<li><p>After applying column transformer, the order of the columns in the transformed data has to be the same as the order of the columns in the original data.</p></li>
<li><p>After applying a column transformer, the transformed data is always going to be of different shape than the original data.</p></li>
<li><p>When you call <code class="docutils literal notranslate"><span class="pre">fit_transform</span></code> on a <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code> object, you get a numpy ndarray.</p></li>
</ol>
</div>
<div class="section" id="what-transformations-on-what-columns">
<h4>What transformations on what columns?<a class="headerlink" href="#what-transformations-on-what-columns" title="Permalink to this headline">¶</a></h4>
<p>Consider the feature columns below.</p>
<ul class="simple">
<li><p>What transformations would you apply on each column?</p></li>
</ul>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>colour</p></th>
<th class="head"><p>location</p></th>
<th class="head"><p>shape</p></th>
<th class="head"><p>water_content</p></th>
<th class="head"><p>weight</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>red</p></td>
<td><p>canada</p></td>
<td><p>NaN</p></td>
<td><p>84</p></td>
<td><p>100</p></td>
</tr>
<tr class="row-odd"><td><p>yellow</p></td>
<td><p>mexico</p></td>
<td><p>long</p></td>
<td><p>75</p></td>
<td><p>120</p></td>
</tr>
<tr class="row-even"><td><p>orange</p></td>
<td><p>spain</p></td>
<td><p>NaN</p></td>
<td><p>90</p></td>
<td><p>NaN</p></td>
</tr>
<tr class="row-odd"><td><p>magenta</p></td>
<td><p>china</p></td>
<td><p>round</p></td>
<td><p>NaN</p></td>
<td><p>600</p></td>
</tr>
<tr class="row-even"><td><p>purple</p></td>
<td><p>austria</p></td>
<td><p>NaN</p></td>
<td><p>80</p></td>
<td><p>115</p></td>
</tr>
<tr class="row-odd"><td><p>purple</p></td>
<td><p>turkey</p></td>
<td><p>oval</p></td>
<td><p>78</p></td>
<td><p>340</p></td>
</tr>
<tr class="row-even"><td><p>green</p></td>
<td><p>mexico</p></td>
<td><p>oval</p></td>
<td><p>83</p></td>
<td><p>NaN</p></td>
</tr>
<tr class="row-odd"><td><p>blue</p></td>
<td><p>canada</p></td>
<td><p>round</p></td>
<td><p>73</p></td>
<td><p>535</p></td>
</tr>
<tr class="row-even"><td><p>brown</p></td>
<td><p>china</p></td>
<td><p>NaN</p></td>
<td><p>NaN</p></td>
<td><p>1743</p></td>
</tr>
<tr class="row-odd"><td><p>yellow</p></td>
<td><p>mexico</p></td>
<td><p>oval</p></td>
<td><p>83</p></td>
<td><p>265</p></td>
</tr>
</tbody>
</table>
<p><br><br><br><br></p>
</div>
</div>
</div>
<div class="section" id="more-on-feature-transformations">
<h2>More on feature transformations<a class="headerlink" href="#more-on-feature-transformations" title="Permalink to this headline">¶</a></h2>
<div class="section" id="multiple-transformations-in-a-transformer">
<h3>Multiple transformations in a transformer<a class="headerlink" href="#multiple-transformations-in-a-transformer" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Recall that <code class="docutils literal notranslate"><span class="pre">lab2</span></code> has missing values.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>enjoy_course</th>
      <th>ml_experience</th>
      <th>major</th>
      <th>class_attendance</th>
      <th>university_years</th>
      <th>lab1</th>
      <th>lab2</th>
      <th>lab3</th>
      <th>lab4</th>
      <th>quiz1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>yes</td>
      <td>1</td>
      <td>Computer Science</td>
      <td>Excellent</td>
      <td>3</td>
      <td>92</td>
      <td>93.0</td>
      <td>84</td>
      <td>91</td>
      <td>92</td>
    </tr>
    <tr>
      <th>1</th>
      <td>yes</td>
      <td>1</td>
      <td>Mechanical Engineering</td>
      <td>Average</td>
      <td>2</td>
      <td>94</td>
      <td>90.0</td>
      <td>80</td>
      <td>83</td>
      <td>91</td>
    </tr>
    <tr>
      <th>2</th>
      <td>yes</td>
      <td>0</td>
      <td>Mathematics</td>
      <td>Poor</td>
      <td>3</td>
      <td>78</td>
      <td>85.0</td>
      <td>83</td>
      <td>80</td>
      <td>80</td>
    </tr>
    <tr>
      <th>3</th>
      <td>no</td>
      <td>0</td>
      <td>Mathematics</td>
      <td>Excellent</td>
      <td>3</td>
      <td>91</td>
      <td>NaN</td>
      <td>92</td>
      <td>91</td>
      <td>89</td>
    </tr>
    <tr>
      <th>4</th>
      <td>yes</td>
      <td>0</td>
      <td>Psychology</td>
      <td>Good</td>
      <td>4</td>
      <td>77</td>
      <td>83.0</td>
      <td>90</td>
      <td>92</td>
      <td>85</td>
    </tr>
    <tr>
      <th>5</th>
      <td>no</td>
      <td>1</td>
      <td>Economics</td>
      <td>Good</td>
      <td>5</td>
      <td>70</td>
      <td>73.0</td>
      <td>68</td>
      <td>74</td>
      <td>71</td>
    </tr>
    <tr>
      <th>6</th>
      <td>yes</td>
      <td>1</td>
      <td>Computer Science</td>
      <td>Excellent</td>
      <td>4</td>
      <td>80</td>
      <td>88.0</td>
      <td>89</td>
      <td>88</td>
      <td>91</td>
    </tr>
    <tr>
      <th>7</th>
      <td>no</td>
      <td>0</td>
      <td>Mechanical Engineering</td>
      <td>Poor</td>
      <td>3</td>
      <td>95</td>
      <td>93.0</td>
      <td>69</td>
      <td>79</td>
      <td>75</td>
    </tr>
    <tr>
      <th>8</th>
      <td>no</td>
      <td>0</td>
      <td>Linguistics</td>
      <td>Average</td>
      <td>2</td>
      <td>97</td>
      <td>90.0</td>
      <td>94</td>
      <td>82</td>
      <td>80</td>
    </tr>
    <tr>
      <th>9</th>
      <td>yes</td>
      <td>1</td>
      <td>Mathematics</td>
      <td>Average</td>
      <td>4</td>
      <td>95</td>
      <td>82.0</td>
      <td>94</td>
      <td>94</td>
      <td>85</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>So we would like to apply more than one transformations on it: imputation and scaling.</p></li>
<li><p>We can treat <code class="docutils literal notranslate"><span class="pre">lab2</span></code> separately, but we can also include it into <code class="docutils literal notranslate"><span class="pre">numeric_feats</span></code> and apply both transformations on all numeric columns.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numeric_feats</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;university_years&quot;</span><span class="p">,</span>
    <span class="s2">&quot;lab1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;lab2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;lab3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;lab4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;quiz1&quot;</span><span class="p">,</span>
<span class="p">]</span>  <span class="c1"># apply scaling</span>
<span class="n">categorical_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;major&quot;</span><span class="p">]</span>  <span class="c1"># apply one-hot encoding</span>
<span class="n">passthrough_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ml_experience&quot;</span><span class="p">]</span>  <span class="c1"># do not apply any transformation</span>
<span class="n">drop_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;class_attendance&quot;</span><span class="p">,</span> <span class="s2">&quot;enjoy_course&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>To apply more than one transformations we can define a pipeline inside a column transformer to chain different transformations.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ct</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span>
        <span class="n">make_pipeline</span><span class="p">(</span><span class="n">SimpleImputer</span><span class="p">(),</span> <span class="n">StandardScaler</span><span class="p">()),</span>
        <span class="n">numeric_feats</span><span class="p">,</span>
    <span class="p">),</span>  <span class="c1"># scaling on numeric features</span>
    <span class="p">(</span><span class="n">OneHotEncoder</span><span class="p">(),</span> <span class="n">categorical_feats</span><span class="p">),</span>  <span class="c1"># OHE on categorical features</span>
    <span class="p">(</span><span class="s2">&quot;passthrough&quot;</span><span class="p">,</span> <span class="n">passthrough_feats</span><span class="p">),</span>  <span class="c1"># no transformations on the binary features</span>
    <span class="p">(</span><span class="s2">&quot;drop&quot;</span><span class="p">,</span> <span class="n">drop_feats</span><span class="p">),</span>  <span class="c1"># drop the drop features</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_transformed</span> <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">column_names</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">numeric_feats</span>
    <span class="o">+</span> <span class="n">ct</span><span class="o">.</span><span class="n">named_transformers_</span><span class="p">[</span><span class="s2">&quot;onehotencoder&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">passthrough_feats</span>
<span class="p">)</span>
<span class="n">column_names</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;university_years&#39;,
 &#39;lab1&#39;,
 &#39;lab2&#39;,
 &#39;lab3&#39;,
 &#39;lab4&#39;,
 &#39;quiz1&#39;,
 &#39;x0_Biology&#39;,
 &#39;x0_Computer Science&#39;,
 &#39;x0_Economics&#39;,
 &#39;x0_Linguistics&#39;,
 &#39;x0_Mathematics&#39;,
 &#39;x0_Mechanical Engineering&#39;,
 &#39;x0_Physics&#39;,
 &#39;x0_Psychology&#39;,
 &#39;ml_experience&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_transformed</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">column_names</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>university_years</th>
      <th>lab1</th>
      <th>lab2</th>
      <th>lab3</th>
      <th>lab4</th>
      <th>quiz1</th>
      <th>x0_Biology</th>
      <th>x0_Computer Science</th>
      <th>x0_Economics</th>
      <th>x0_Linguistics</th>
      <th>x0_Mathematics</th>
      <th>x0_Mechanical Engineering</th>
      <th>x0_Physics</th>
      <th>x0_Psychology</th>
      <th>ml_experience</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.093454</td>
      <td>0.358913</td>
      <td>0.893260</td>
      <td>-0.217334</td>
      <td>0.362700</td>
      <td>0.840028</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-1.074719</td>
      <td>0.590827</td>
      <td>0.294251</td>
      <td>-0.614206</td>
      <td>-0.855972</td>
      <td>0.712198</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.093454</td>
      <td>-1.264480</td>
      <td>-0.704099</td>
      <td>-0.316552</td>
      <td>-1.312974</td>
      <td>-0.693936</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.093454</td>
      <td>0.242957</td>
      <td>0.000000</td>
      <td>0.576409</td>
      <td>0.362700</td>
      <td>0.456537</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.887812</td>
      <td>-1.380436</td>
      <td>-1.103439</td>
      <td>0.377973</td>
      <td>0.515034</td>
      <td>-0.054784</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1.869077</td>
      <td>-2.192133</td>
      <td>-3.100139</td>
      <td>-1.804821</td>
      <td>-2.226978</td>
      <td>-1.844409</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.887812</td>
      <td>-1.032566</td>
      <td>-0.105089</td>
      <td>0.278755</td>
      <td>-0.094302</td>
      <td>0.712198</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>-0.093454</td>
      <td>0.706783</td>
      <td>0.893260</td>
      <td>-1.705603</td>
      <td>-1.465308</td>
      <td>-1.333088</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>-1.074719</td>
      <td>0.938697</td>
      <td>0.294251</td>
      <td>0.774844</td>
      <td>-1.008306</td>
      <td>-0.693936</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.887812</td>
      <td>0.706783</td>
      <td>-1.303109</td>
      <td>0.774844</td>
      <td>0.819702</td>
      <td>-0.054784</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>-0.093454</td>
      <td>1.054653</td>
      <td>-0.504429</td>
      <td>0.874062</td>
      <td>0.972036</td>
      <td>-0.949597</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>-2.055985</td>
      <td>0.706783</td>
      <td>-0.105089</td>
      <td>0.675627</td>
      <td>0.515034</td>
      <td>-0.054784</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>-1.074719</td>
      <td>1.054653</td>
      <td>1.492270</td>
      <td>0.973280</td>
      <td>1.581372</td>
      <td>1.862671</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0.887812</td>
      <td>0.706783</td>
      <td>1.092930</td>
      <td>0.973280</td>
      <td>0.972036</td>
      <td>1.862671</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>-0.093454</td>
      <td>0.706783</td>
      <td>0.294251</td>
      <td>0.675627</td>
      <td>0.972036</td>
      <td>-1.972240</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>-0.093454</td>
      <td>0.358913</td>
      <td>-0.704099</td>
      <td>-1.904039</td>
      <td>0.819702</td>
      <td>0.840028</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>1.869077</td>
      <td>-1.612349</td>
      <td>0.493921</td>
      <td>0.675627</td>
      <td>-0.398970</td>
      <td>-0.054784</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>-0.093454</td>
      <td>-0.336826</td>
      <td>0.094581</td>
      <td>-2.102474</td>
      <td>-0.398970</td>
      <td>0.200876</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>-1.074719</td>
      <td>0.242957</td>
      <td>0.000000</td>
      <td>0.377973</td>
      <td>-0.094302</td>
      <td>-0.438275</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>19</th>
      <td>-1.074719</td>
      <td>-1.380436</td>
      <td>1.092930</td>
      <td>0.080319</td>
      <td>-1.160640</td>
      <td>0.456537</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>20</th>
      <td>0.887812</td>
      <td>0.822740</td>
      <td>0.693590</td>
      <td>0.576409</td>
      <td>1.124370</td>
      <td>0.200876</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><br><br></p>
</div>
<div class="section" id="sklearn-set-config">
<h3><code class="docutils literal notranslate"><span class="pre">sklearn</span></code> <code class="docutils literal notranslate"><span class="pre">set_config</span></code><a class="headerlink" href="#sklearn-set-config" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>With multiple transformations in a column transformer, it can get tricky to keep track of everything happening inside it.</p></li>
<li><p>We can use <code class="docutils literal notranslate"><span class="pre">set_config</span></code> to display a diagram of this.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">set_config</span>

<span class="n">set_config</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="s2">&quot;diagram&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ct</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-9de213fe-8e8b-4aae-b3eb-68b6b97341b1 {color: black;background-color: white;}#sk-9de213fe-8e8b-4aae-b3eb-68b6b97341b1 pre{padding: 0;}#sk-9de213fe-8e8b-4aae-b3eb-68b6b97341b1 div.sk-toggleable {background-color: white;}#sk-9de213fe-8e8b-4aae-b3eb-68b6b97341b1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}#sk-9de213fe-8e8b-4aae-b3eb-68b6b97341b1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-9de213fe-8e8b-4aae-b3eb-68b6b97341b1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-9de213fe-8e8b-4aae-b3eb-68b6b97341b1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-9de213fe-8e8b-4aae-b3eb-68b6b97341b1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-9de213fe-8e8b-4aae-b3eb-68b6b97341b1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-9de213fe-8e8b-4aae-b3eb-68b6b97341b1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-9de213fe-8e8b-4aae-b3eb-68b6b97341b1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}#sk-9de213fe-8e8b-4aae-b3eb-68b6b97341b1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-9de213fe-8e8b-4aae-b3eb-68b6b97341b1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-9de213fe-8e8b-4aae-b3eb-68b6b97341b1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-9de213fe-8e8b-4aae-b3eb-68b6b97341b1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-9de213fe-8e8b-4aae-b3eb-68b6b97341b1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}#sk-9de213fe-8e8b-4aae-b3eb-68b6b97341b1 div.sk-item {z-index: 1;}#sk-9de213fe-8e8b-4aae-b3eb-68b6b97341b1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-9de213fe-8e8b-4aae-b3eb-68b6b97341b1 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-9de213fe-8e8b-4aae-b3eb-68b6b97341b1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-9de213fe-8e8b-4aae-b3eb-68b6b97341b1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-9de213fe-8e8b-4aae-b3eb-68b6b97341b1 div.sk-parallel-item:only-child::after {width: 0;}#sk-9de213fe-8e8b-4aae-b3eb-68b6b97341b1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}#sk-9de213fe-8e8b-4aae-b3eb-68b6b97341b1 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-9de213fe-8e8b-4aae-b3eb-68b6b97341b1 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-9de213fe-8e8b-4aae-b3eb-68b6b97341b1 div.sk-container {display: inline-block;position: relative;}</style><div id="sk-9de213fe-8e8b-4aae-b3eb-68b6b97341b1" class"sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="e6627167-40f3-4854-8080-5a01c38b241a" type="checkbox" ><label class="sk-toggleable__label" for="e6627167-40f3-4854-8080-5a01c38b241a">ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer()),
                                                 ('standardscaler',
                                                  StandardScaler())]),
                                 ['university_years', 'lab1', 'lab2', 'lab3',
                                  'lab4', 'quiz1']),
                                ('onehotencoder', OneHotEncoder(), ['major']),
                                ('passthrough', 'passthrough',
                                 ['ml_experience']),
                                ('drop', 'drop',
                                 ['class_attendance', 'enjoy_course'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="0b23423c-cb73-47e5-beee-e7a0a144595e" type="checkbox" ><label class="sk-toggleable__label" for="0b23423c-cb73-47e5-beee-e7a0a144595e">pipeline</label><div class="sk-toggleable__content"><pre>['university_years', 'lab1', 'lab2', 'lab3', 'lab4', 'quiz1']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6b56c710-bbea-40a8-b6c6-6b93b2aae2d9" type="checkbox" ><label class="sk-toggleable__label" for="6b56c710-bbea-40a8-b6c6-6b93b2aae2d9">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="e56acec1-b10f-4017-83cf-bcded1dcc223" type="checkbox" ><label class="sk-toggleable__label" for="e56acec1-b10f-4017-83cf-bcded1dcc223">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="2a3056bb-592c-4ebe-a80d-3ab18f0d3f20" type="checkbox" ><label class="sk-toggleable__label" for="2a3056bb-592c-4ebe-a80d-3ab18f0d3f20">onehotencoder</label><div class="sk-toggleable__content"><pre>['major']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d416f4e5-3c0e-4e66-a930-3dcc507ec361" type="checkbox" ><label class="sk-toggleable__label" for="d416f4e5-3c0e-4e66-a930-3dcc507ec361">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="eef7615b-6288-4dea-8051-fc99ccb9fd82" type="checkbox" ><label class="sk-toggleable__label" for="eef7615b-6288-4dea-8051-fc99ccb9fd82">passthrough</label><div class="sk-toggleable__content"><pre>['ml_experience']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="41975264-cdb3-445f-a6c2-291dc7215b4c" type="checkbox" ><label class="sk-toggleable__label" for="41975264-cdb3-445f-a6c2-291dc7215b4c">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="74f0cc93-e53c-4e97-abea-efb2be54b54c" type="checkbox" ><label class="sk-toggleable__label" for="74f0cc93-e53c-4e97-abea-efb2be54b54c">drop</label><div class="sk-toggleable__content"><pre>['class_attendance', 'enjoy_course']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="e1d83315-3e92-4af8-a270-c47b428489b6" type="checkbox" ><label class="sk-toggleable__label" for="e1d83315-3e92-4af8-a270-c47b428489b6">drop</label><div class="sk-toggleable__content"><pre>drop</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ColumnTransformer(transformers=[(&#39;pipeline&#39;,
                                 Pipeline(steps=[(&#39;simpleimputer&#39;,
                                                  SimpleImputer()),
                                                 (&#39;standardscaler&#39;,
                                                  StandardScaler())]),
                                 [&#39;university_years&#39;, &#39;lab1&#39;, &#39;lab2&#39;, &#39;lab3&#39;,
                                  &#39;lab4&#39;, &#39;quiz1&#39;]),
                                (&#39;onehotencoder&#39;, OneHotEncoder(), [&#39;major&#39;]),
                                (&#39;passthrough&#39;, &#39;passthrough&#39;,
                                 [&#39;ml_experience&#39;]),
                                (&#39;drop&#39;, &#39;drop&#39;,
                                 [&#39;class_attendance&#39;, &#39;enjoy_course&#39;])])
</pre></div>
</div>
</div>
</div>
<p><br><br></p>
</div>
<div class="section" id="incorporating-ordinal-feature-class-attendance">
<h3>Incorporating ordinal feature <code class="docutils literal notranslate"><span class="pre">class_attendance</span></code><a class="headerlink" href="#incorporating-ordinal-feature-class-attendance" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">class_attendance</span></code> column is different than the <code class="docutils literal notranslate"><span class="pre">major</span></code> column in that there is some ordering of the values.</p>
<ul>
<li><p>Excellent &gt; Good &gt; Average &gt; poor</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>enjoy_course</th>
      <th>ml_experience</th>
      <th>major</th>
      <th>class_attendance</th>
      <th>university_years</th>
      <th>lab1</th>
      <th>lab2</th>
      <th>lab3</th>
      <th>lab4</th>
      <th>quiz1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>yes</td>
      <td>1</td>
      <td>Computer Science</td>
      <td>Excellent</td>
      <td>3</td>
      <td>92</td>
      <td>93.0</td>
      <td>84</td>
      <td>91</td>
      <td>92</td>
    </tr>
    <tr>
      <th>1</th>
      <td>yes</td>
      <td>1</td>
      <td>Mechanical Engineering</td>
      <td>Average</td>
      <td>2</td>
      <td>94</td>
      <td>90.0</td>
      <td>80</td>
      <td>83</td>
      <td>91</td>
    </tr>
    <tr>
      <th>2</th>
      <td>yes</td>
      <td>0</td>
      <td>Mathematics</td>
      <td>Poor</td>
      <td>3</td>
      <td>78</td>
      <td>85.0</td>
      <td>83</td>
      <td>80</td>
      <td>80</td>
    </tr>
    <tr>
      <th>3</th>
      <td>no</td>
      <td>0</td>
      <td>Mathematics</td>
      <td>Excellent</td>
      <td>3</td>
      <td>91</td>
      <td>NaN</td>
      <td>92</td>
      <td>91</td>
      <td>89</td>
    </tr>
    <tr>
      <th>4</th>
      <td>yes</td>
      <td>0</td>
      <td>Psychology</td>
      <td>Good</td>
      <td>4</td>
      <td>77</td>
      <td>83.0</td>
      <td>90</td>
      <td>92</td>
      <td>85</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s try applying <code class="docutils literal notranslate"><span class="pre">OrdinalEncoder</span></code> on this column.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_toy</span> <span class="o">=</span> <span class="n">X</span><span class="p">[[</span><span class="s2">&quot;class_attendance&quot;</span><span class="p">]]</span>
<span class="n">enc</span> <span class="o">=</span> <span class="n">OrdinalEncoder</span><span class="p">()</span>
<span class="n">enc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_toy</span><span class="p">)</span>
<span class="n">X_toy_ord</span> <span class="o">=</span> <span class="n">enc</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_toy</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">X_toy_ord</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;class_attendance_enc&quot;</span><span class="p">],</span>
    <span class="n">index</span><span class="o">=</span><span class="n">X_toy</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X_toy</span><span class="p">,</span> <span class="n">df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>class_attendance</th>
      <th>class_attendance_enc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Excellent</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Average</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Poor</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Excellent</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Good</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Good</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Excellent</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Poor</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Average</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Average</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>What’s the problem here?</p>
<ul>
<li><p>The encoder doesn’t know the order.</p></li>
</ul>
</li>
<li><p>We can examine unique categories manually, order them based on our intuitions, and then provide this human knowledge to the transformer.</p></li>
</ul>
<p>What are the unique categories of <code class="docutils literal notranslate"><span class="pre">class_attendance</span></code>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_toy</span><span class="p">[</span><span class="s2">&quot;class_attendance&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;Excellent&#39;, &#39;Average&#39;, &#39;Poor&#39;, &#39;Good&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<p>Let’s order them manually.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">class_attendance_levels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Poor&quot;</span><span class="p">,</span> <span class="s2">&quot;Average&quot;</span><span class="p">,</span> <span class="s2">&quot;Good&quot;</span><span class="p">,</span> <span class="s2">&quot;Excellent&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that if you use the reverse order of the categories, it wouldn’t matter.</p>
</div>
<p>Let’s make sure that we have included all categories in our manual ordering.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">class_attendance_levels</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">X_toy</span><span class="p">[</span><span class="s2">&quot;class_attendance&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">oe</span> <span class="o">=</span> <span class="n">OrdinalEncoder</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="n">class_attendance_levels</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">oe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_toy</span><span class="p">[[</span><span class="s2">&quot;class_attendance&quot;</span><span class="p">]])</span>
<span class="n">ca_transformed</span> <span class="o">=</span> <span class="n">oe</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_toy</span><span class="p">[[</span><span class="s2">&quot;class_attendance&quot;</span><span class="p">]])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">ca_transformed</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;class_attendance_enc&quot;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">X_toy</span><span class="o">.</span><span class="n">index</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">oe</span><span class="o">.</span><span class="n">categories_</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X_toy</span><span class="p">,</span> <span class="n">df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[array([&#39;Poor&#39;, &#39;Average&#39;, &#39;Good&#39;, &#39;Excellent&#39;], dtype=object)]
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>class_attendance</th>
      <th>class_attendance_enc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Excellent</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Average</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Poor</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Excellent</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Good</td>
      <td>2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Good</td>
      <td>2</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Excellent</td>
      <td>3</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Poor</td>
      <td>0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Average</td>
      <td>1</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Average</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The encoded categories are looking better now!</p>
<div class="section" id="more-than-one-ordinal-columns">
<h4>More than one ordinal columns?<a class="headerlink" href="#more-than-one-ordinal-columns" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>We can pass the manually ordered categories when we create an <code class="docutils literal notranslate"><span class="pre">OrdinalEncoder</span></code> object as a list of lists.</p></li>
<li><p>If you have more than one ordinal columns</p>
<ul>
<li><p>manually create a list of ordered categories for each column</p></li>
<li><p>pass a list of lists to <code class="docutils literal notranslate"><span class="pre">OrdinalEncoder</span></code>, where each inner list corresponds to manually created list of ordered categories for a corresponding ordinal column.</p></li>
</ul>
</li>
</ul>
<p>Now let’s incorporate ordinal encoding of <code class="docutils literal notranslate"><span class="pre">class_attendance</span></code> in our column transformer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numeric_feats</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;university_years&quot;</span><span class="p">,</span>
    <span class="s2">&quot;lab1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;lab2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;lab3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;lab4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;quiz1&quot;</span><span class="p">,</span>
<span class="p">]</span>  <span class="c1"># apply scaling</span>
<span class="n">categorical_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;major&quot;</span><span class="p">]</span>  <span class="c1"># apply one-hot encoding</span>
<span class="n">ordinal_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;class_attendance&quot;</span><span class="p">]</span>  <span class="c1"># apply ordinal encoding</span>
<span class="n">passthrough_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ml_experience&quot;</span><span class="p">]</span>  <span class="c1"># do not apply any transformation</span>
<span class="n">drop_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;enjoy_course&quot;</span><span class="p">]</span>  <span class="c1"># do not include these features</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ct</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span>
        <span class="n">make_pipeline</span><span class="p">(</span><span class="n">SimpleImputer</span><span class="p">(),</span> <span class="n">StandardScaler</span><span class="p">()),</span>
        <span class="n">numeric_feats</span><span class="p">,</span>
    <span class="p">),</span>  <span class="c1"># scaling on numeric features</span>
    <span class="p">(</span><span class="n">OneHotEncoder</span><span class="p">(),</span> <span class="n">categorical_feats</span><span class="p">),</span>  <span class="c1"># OHE on categorical features</span>
    <span class="p">(</span>
        <span class="n">OrdinalEncoder</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="n">class_attendance_levels</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
        <span class="n">ordinal_feats</span><span class="p">,</span>
    <span class="p">),</span>  <span class="c1"># Ordinal encoding on ordinal features</span>
    <span class="p">(</span><span class="s2">&quot;passthrough&quot;</span><span class="p">,</span> <span class="n">passthrough_feats</span><span class="p">),</span>  <span class="c1"># no transformations on the binary features</span>
    <span class="p">(</span><span class="s2">&quot;drop&quot;</span><span class="p">,</span> <span class="n">drop_feats</span><span class="p">),</span>  <span class="c1"># drop the drop features</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ct</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-ca516d83-e9af-47c1-96b2-840a0528ca49 {color: black;background-color: white;}#sk-ca516d83-e9af-47c1-96b2-840a0528ca49 pre{padding: 0;}#sk-ca516d83-e9af-47c1-96b2-840a0528ca49 div.sk-toggleable {background-color: white;}#sk-ca516d83-e9af-47c1-96b2-840a0528ca49 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}#sk-ca516d83-e9af-47c1-96b2-840a0528ca49 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-ca516d83-e9af-47c1-96b2-840a0528ca49 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-ca516d83-e9af-47c1-96b2-840a0528ca49 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-ca516d83-e9af-47c1-96b2-840a0528ca49 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-ca516d83-e9af-47c1-96b2-840a0528ca49 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-ca516d83-e9af-47c1-96b2-840a0528ca49 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-ca516d83-e9af-47c1-96b2-840a0528ca49 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}#sk-ca516d83-e9af-47c1-96b2-840a0528ca49 div.sk-estimator:hover {background-color: #d4ebff;}#sk-ca516d83-e9af-47c1-96b2-840a0528ca49 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-ca516d83-e9af-47c1-96b2-840a0528ca49 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-ca516d83-e9af-47c1-96b2-840a0528ca49 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-ca516d83-e9af-47c1-96b2-840a0528ca49 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}#sk-ca516d83-e9af-47c1-96b2-840a0528ca49 div.sk-item {z-index: 1;}#sk-ca516d83-e9af-47c1-96b2-840a0528ca49 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-ca516d83-e9af-47c1-96b2-840a0528ca49 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-ca516d83-e9af-47c1-96b2-840a0528ca49 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-ca516d83-e9af-47c1-96b2-840a0528ca49 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-ca516d83-e9af-47c1-96b2-840a0528ca49 div.sk-parallel-item:only-child::after {width: 0;}#sk-ca516d83-e9af-47c1-96b2-840a0528ca49 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}#sk-ca516d83-e9af-47c1-96b2-840a0528ca49 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-ca516d83-e9af-47c1-96b2-840a0528ca49 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-ca516d83-e9af-47c1-96b2-840a0528ca49 div.sk-container {display: inline-block;position: relative;}</style><div id="sk-ca516d83-e9af-47c1-96b2-840a0528ca49" class"sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d7e02a3c-b10b-41a9-b4b9-127bfbfc6b68" type="checkbox" ><label class="sk-toggleable__label" for="d7e02a3c-b10b-41a9-b4b9-127bfbfc6b68">ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer()),
                                                 ('standardscaler',
                                                  StandardScaler())]),
                                 ['university_years', 'lab1', 'lab2', 'lab3',
                                  'lab4', 'quiz1']),
                                ('onehotencoder', OneHotEncoder(), ['major']),
                                ('ordinalencoder',
                                 OrdinalEncoder(categories=[['Poor', 'Average',
                                                             'Good',
                                                             'Excellent']],
                                                dtype=<class 'int'>),
                                 ['class_attendance']),
                                ('passthrough', 'passthrough',
                                 ['ml_experience']),
                                ('drop', 'drop', ['enjoy_course'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8368fdf9-b590-4c97-bd29-40f0c498e333" type="checkbox" ><label class="sk-toggleable__label" for="8368fdf9-b590-4c97-bd29-40f0c498e333">pipeline</label><div class="sk-toggleable__content"><pre>['university_years', 'lab1', 'lab2', 'lab3', 'lab4', 'quiz1']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="2e5de50a-e06a-42b2-a2ad-12e7f482ca16" type="checkbox" ><label class="sk-toggleable__label" for="2e5de50a-e06a-42b2-a2ad-12e7f482ca16">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="1a8a5b1b-e98c-4452-b3bc-a74ea86e3c8d" type="checkbox" ><label class="sk-toggleable__label" for="1a8a5b1b-e98c-4452-b3bc-a74ea86e3c8d">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="19744175-0498-45a0-ab42-5316255d321b" type="checkbox" ><label class="sk-toggleable__label" for="19744175-0498-45a0-ab42-5316255d321b">onehotencoder</label><div class="sk-toggleable__content"><pre>['major']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="5e5148cf-3e09-464c-b487-a6bd7d42d429" type="checkbox" ><label class="sk-toggleable__label" for="5e5148cf-3e09-464c-b487-a6bd7d42d429">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="33fb46a2-89ae-4aea-9b95-7f29fad81c76" type="checkbox" ><label class="sk-toggleable__label" for="33fb46a2-89ae-4aea-9b95-7f29fad81c76">ordinalencoder</label><div class="sk-toggleable__content"><pre>['class_attendance']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="4ea8aa58-be2c-45c7-a0d1-564db7a19b82" type="checkbox" ><label class="sk-toggleable__label" for="4ea8aa58-be2c-45c7-a0d1-564db7a19b82">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(categories=[['Poor', 'Average', 'Good', 'Excellent']],
               dtype=<class 'int'>)</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6e0fc96d-f545-47dd-85df-d89ef02ece64" type="checkbox" ><label class="sk-toggleable__label" for="6e0fc96d-f545-47dd-85df-d89ef02ece64">passthrough</label><div class="sk-toggleable__content"><pre>['ml_experience']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="2c379cb8-8aa1-421f-ab1c-5c38cafea693" type="checkbox" ><label class="sk-toggleable__label" for="2c379cb8-8aa1-421f-ab1c-5c38cafea693">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="50193157-993d-44a2-969a-5d974c7d0b7b" type="checkbox" ><label class="sk-toggleable__label" for="50193157-993d-44a2-969a-5d974c7d0b7b">drop</label><div class="sk-toggleable__content"><pre>['enjoy_course']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c397df66-1f00-46e7-88f7-2fe517524f5e" type="checkbox" ><label class="sk-toggleable__label" for="c397df66-1f00-46e7-88f7-2fe517524f5e">drop</label><div class="sk-toggleable__content"><pre>drop</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_transformed</span> <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">column_names</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">numeric_feats</span>
    <span class="o">+</span> <span class="n">ct</span><span class="o">.</span><span class="n">named_transformers_</span><span class="p">[</span><span class="s2">&quot;onehotencoder&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">ordinal_feats</span>
    <span class="o">+</span> <span class="n">passthrough_feats</span>
<span class="p">)</span>
<span class="n">column_names</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;university_years&#39;,
 &#39;lab1&#39;,
 &#39;lab2&#39;,
 &#39;lab3&#39;,
 &#39;lab4&#39;,
 &#39;quiz1&#39;,
 &#39;x0_Biology&#39;,
 &#39;x0_Computer Science&#39;,
 &#39;x0_Economics&#39;,
 &#39;x0_Linguistics&#39;,
 &#39;x0_Mathematics&#39;,
 &#39;x0_Mechanical Engineering&#39;,
 &#39;x0_Physics&#39;,
 &#39;x0_Psychology&#39;,
 &#39;class_attendance&#39;,
 &#39;ml_experience&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_transformed</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">column_names</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>university_years</th>
      <th>lab1</th>
      <th>lab2</th>
      <th>lab3</th>
      <th>lab4</th>
      <th>quiz1</th>
      <th>x0_Biology</th>
      <th>x0_Computer Science</th>
      <th>x0_Economics</th>
      <th>x0_Linguistics</th>
      <th>x0_Mathematics</th>
      <th>x0_Mechanical Engineering</th>
      <th>x0_Physics</th>
      <th>x0_Psychology</th>
      <th>class_attendance</th>
      <th>ml_experience</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.093454</td>
      <td>0.358913</td>
      <td>0.893260</td>
      <td>-0.217334</td>
      <td>0.362700</td>
      <td>0.840028</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-1.074719</td>
      <td>0.590827</td>
      <td>0.294251</td>
      <td>-0.614206</td>
      <td>-0.855972</td>
      <td>0.712198</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.093454</td>
      <td>-1.264480</td>
      <td>-0.704099</td>
      <td>-0.316552</td>
      <td>-1.312974</td>
      <td>-0.693936</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.093454</td>
      <td>0.242957</td>
      <td>0.000000</td>
      <td>0.576409</td>
      <td>0.362700</td>
      <td>0.456537</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.887812</td>
      <td>-1.380436</td>
      <td>-1.103439</td>
      <td>0.377973</td>
      <td>0.515034</td>
      <td>-0.054784</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1.869077</td>
      <td>-2.192133</td>
      <td>-3.100139</td>
      <td>-1.804821</td>
      <td>-2.226978</td>
      <td>-1.844409</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.887812</td>
      <td>-1.032566</td>
      <td>-0.105089</td>
      <td>0.278755</td>
      <td>-0.094302</td>
      <td>0.712198</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>-0.093454</td>
      <td>0.706783</td>
      <td>0.893260</td>
      <td>-1.705603</td>
      <td>-1.465308</td>
      <td>-1.333088</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>-1.074719</td>
      <td>0.938697</td>
      <td>0.294251</td>
      <td>0.774844</td>
      <td>-1.008306</td>
      <td>-0.693936</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.887812</td>
      <td>0.706783</td>
      <td>-1.303109</td>
      <td>0.774844</td>
      <td>0.819702</td>
      <td>-0.054784</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>-0.093454</td>
      <td>1.054653</td>
      <td>-0.504429</td>
      <td>0.874062</td>
      <td>0.972036</td>
      <td>-0.949597</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>-2.055985</td>
      <td>0.706783</td>
      <td>-0.105089</td>
      <td>0.675627</td>
      <td>0.515034</td>
      <td>-0.054784</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>-1.074719</td>
      <td>1.054653</td>
      <td>1.492270</td>
      <td>0.973280</td>
      <td>1.581372</td>
      <td>1.862671</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0.887812</td>
      <td>0.706783</td>
      <td>1.092930</td>
      <td>0.973280</td>
      <td>0.972036</td>
      <td>1.862671</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>-0.093454</td>
      <td>0.706783</td>
      <td>0.294251</td>
      <td>0.675627</td>
      <td>0.972036</td>
      <td>-1.972240</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>-0.093454</td>
      <td>0.358913</td>
      <td>-0.704099</td>
      <td>-1.904039</td>
      <td>0.819702</td>
      <td>0.840028</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>1.869077</td>
      <td>-1.612349</td>
      <td>0.493921</td>
      <td>0.675627</td>
      <td>-0.398970</td>
      <td>-0.054784</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>-0.093454</td>
      <td>-0.336826</td>
      <td>0.094581</td>
      <td>-2.102474</td>
      <td>-0.398970</td>
      <td>0.200876</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>-1.074719</td>
      <td>0.242957</td>
      <td>0.000000</td>
      <td>0.377973</td>
      <td>-0.094302</td>
      <td>-0.438275</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>19</th>
      <td>-1.074719</td>
      <td>-1.380436</td>
      <td>1.092930</td>
      <td>0.080319</td>
      <td>-1.160640</td>
      <td>0.456537</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>20</th>
      <td>0.887812</td>
      <td>0.822740</td>
      <td>0.693590</td>
      <td>0.576409</td>
      <td>1.124370</td>
      <td>0.200876</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><br><br></p>
</div>
</div>
<div class="section" id="dealing-with-unknown-categories">
<h3>Dealing with unknown categories<a class="headerlink" href="#dealing-with-unknown-categories" title="Permalink to this headline">¶</a></h3>
<p>Let’s create a pipeline with the column transformer and pass it to <code class="docutils literal notranslate"><span class="pre">cross_validate</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span> <span class="n">SVC</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/kvarada/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/model_selection/_validation.py:696: UserWarning: Scoring failed. The score on this train-test partition for these parameters will be set to nan. Details: 
Traceback (most recent call last):
  File &quot;/Users/kvarada/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/model_selection/_validation.py&quot;, line 687, in _score
    scores = scorer(estimator, X_test, y_test)
  File &quot;/Users/kvarada/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/metrics/_scorer.py&quot;, line 397, in _passthrough_scorer
    return estimator.score(*args, **kwargs)
  File &quot;/Users/kvarada/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/utils/metaestimators.py&quot;, line 120, in &lt;lambda&gt;
    out = lambda *args, **kwargs: self.fn(obj, *args, **kwargs)
  File &quot;/Users/kvarada/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/pipeline.py&quot;, line 618, in score
    Xt = transform.transform(Xt)
  File &quot;/Users/kvarada/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/compose/_column_transformer.py&quot;, line 564, in transform
    Xs = self._fit_transform(X, None, _transform_one, fitted=True)
  File &quot;/Users/kvarada/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/compose/_column_transformer.py&quot;, line 434, in _fit_transform
    return Parallel(n_jobs=self.n_jobs)(
  File &quot;/Users/kvarada/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/joblib/parallel.py&quot;, line 1046, in __call__
    while self.dispatch_one_batch(iterator):
  File &quot;/Users/kvarada/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/joblib/parallel.py&quot;, line 861, in dispatch_one_batch
    self._dispatch(tasks)
  File &quot;/Users/kvarada/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/joblib/parallel.py&quot;, line 779, in _dispatch
    job = self._backend.apply_async(batch, callback=cb)
  File &quot;/Users/kvarada/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/joblib/_parallel_backends.py&quot;, line 208, in apply_async
    result = ImmediateResult(func)
  File &quot;/Users/kvarada/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/joblib/_parallel_backends.py&quot;, line 572, in __init__
    self.results = batch()
  File &quot;/Users/kvarada/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/joblib/parallel.py&quot;, line 262, in __call__
    return [func(*args, **kwargs)
  File &quot;/Users/kvarada/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/joblib/parallel.py&quot;, line 262, in &lt;listcomp&gt;
    return [func(*args, **kwargs)
  File &quot;/Users/kvarada/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/utils/fixes.py&quot;, line 222, in __call__
    return self.function(*args, **kwargs)
  File &quot;/Users/kvarada/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/pipeline.py&quot;, line 733, in _transform_one
    res = transformer.transform(X)
  File &quot;/Users/kvarada/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/preprocessing/_encoders.py&quot;, line 471, in transform
    X_int, X_mask = self._transform(X, handle_unknown=self.handle_unknown,
  File &quot;/Users/kvarada/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/preprocessing/_encoders.py&quot;, line 136, in _transform
    raise ValueError(msg)
ValueError: Found unknown categories [&#39;Biology&#39;] in column 0 during transform

  warnings.warn(
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.006223</td>
      <td>0.003133</td>
      <td>1.00</td>
      <td>0.937500</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.005612</td>
      <td>0.003095</td>
      <td>1.00</td>
      <td>0.941176</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.005613</td>
      <td>0.003207</td>
      <td>0.50</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.005528</td>
      <td>0.003073</td>
      <td>0.75</td>
      <td>0.941176</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.005532</td>
      <td>0.014994</td>
      <td>NaN</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>What’s going on here??</p></li>
<li><p>Let’s look at the error message:
<code class="docutils literal notranslate"><span class="pre">ValueError:</span> <span class="pre">Found</span> <span class="pre">unknown</span> <span class="pre">categories</span> <span class="pre">['Biology']</span> <span class="pre">in</span> <span class="pre">column</span> <span class="pre">0</span> <span class="pre">during</span> <span class="pre">transform</span> </code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;major&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computer Science          4
Mathematics               4
Mechanical Engineering    3
Psychology                3
Economics                 2
Linguistics               2
Physics                   2
Biology                   1
Name: major, dtype: int64
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>There is only one instance of Biology.</p></li>
<li><p>During cross-validation, this is getting put into the validation split.</p></li>
<li><p>By default, <code class="docutils literal notranslate"><span class="pre">OneHotEncoder</span></code> throws an error because you might want to know about this.</p></li>
</ul>
<p>Simplest fix:</p>
<ul class="simple">
<li><p>Pass <code class="docutils literal notranslate"><span class="pre">handle_unknown=&quot;ignore&quot;</span></code> argument to <code class="docutils literal notranslate"><span class="pre">OneHotEncoder</span></code></p></li>
<li><p>It creates a row with all zeros.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ct</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span>
        <span class="n">make_pipeline</span><span class="p">(</span><span class="n">SimpleImputer</span><span class="p">(),</span> <span class="n">StandardScaler</span><span class="p">()),</span>
        <span class="n">numeric_feats</span><span class="p">,</span>
    <span class="p">),</span>  <span class="c1"># scaling on numeric features</span>
    <span class="p">(</span>
        <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">),</span>
        <span class="n">categorical_feats</span><span class="p">,</span>
    <span class="p">),</span>  <span class="c1"># OHE on categorical features</span>
    <span class="p">(</span>
        <span class="n">OrdinalEncoder</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="n">class_attendance_levels</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
        <span class="n">ordinal_feats</span><span class="p">,</span>
    <span class="p">),</span>  <span class="c1"># Ordinal encoding on ordinal features</span>
    <span class="p">(</span><span class="s2">&quot;passthrough&quot;</span><span class="p">,</span> <span class="n">passthrough_feats</span><span class="p">),</span>  <span class="c1"># no transformations on the binary features</span>
    <span class="p">(</span><span class="s2">&quot;drop&quot;</span><span class="p">,</span> <span class="n">drop_feats</span><span class="p">),</span>  <span class="c1"># drop the drop features</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ct</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-53146cbe-0efc-4df6-8820-43fdab88668e {color: black;background-color: white;}#sk-53146cbe-0efc-4df6-8820-43fdab88668e pre{padding: 0;}#sk-53146cbe-0efc-4df6-8820-43fdab88668e div.sk-toggleable {background-color: white;}#sk-53146cbe-0efc-4df6-8820-43fdab88668e label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}#sk-53146cbe-0efc-4df6-8820-43fdab88668e div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-53146cbe-0efc-4df6-8820-43fdab88668e div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-53146cbe-0efc-4df6-8820-43fdab88668e input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-53146cbe-0efc-4df6-8820-43fdab88668e div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-53146cbe-0efc-4df6-8820-43fdab88668e div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-53146cbe-0efc-4df6-8820-43fdab88668e input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-53146cbe-0efc-4df6-8820-43fdab88668e div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}#sk-53146cbe-0efc-4df6-8820-43fdab88668e div.sk-estimator:hover {background-color: #d4ebff;}#sk-53146cbe-0efc-4df6-8820-43fdab88668e div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-53146cbe-0efc-4df6-8820-43fdab88668e div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-53146cbe-0efc-4df6-8820-43fdab88668e div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-53146cbe-0efc-4df6-8820-43fdab88668e div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}#sk-53146cbe-0efc-4df6-8820-43fdab88668e div.sk-item {z-index: 1;}#sk-53146cbe-0efc-4df6-8820-43fdab88668e div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-53146cbe-0efc-4df6-8820-43fdab88668e div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-53146cbe-0efc-4df6-8820-43fdab88668e div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-53146cbe-0efc-4df6-8820-43fdab88668e div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-53146cbe-0efc-4df6-8820-43fdab88668e div.sk-parallel-item:only-child::after {width: 0;}#sk-53146cbe-0efc-4df6-8820-43fdab88668e div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}#sk-53146cbe-0efc-4df6-8820-43fdab88668e div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-53146cbe-0efc-4df6-8820-43fdab88668e div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-53146cbe-0efc-4df6-8820-43fdab88668e div.sk-container {display: inline-block;position: relative;}</style><div id="sk-53146cbe-0efc-4df6-8820-43fdab88668e" class"sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6719a2ac-c918-4269-b1e6-506ba72c54c5" type="checkbox" ><label class="sk-toggleable__label" for="6719a2ac-c918-4269-b1e6-506ba72c54c5">ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer()),
                                                 ('standardscaler',
                                                  StandardScaler())]),
                                 ['university_years', 'lab1', 'lab2', 'lab3',
                                  'lab4', 'quiz1']),
                                ('onehotencoder',
                                 OneHotEncoder(handle_unknown='ignore'),
                                 ['major']),
                                ('ordinalencoder',
                                 OrdinalEncoder(categories=[['Poor', 'Average',
                                                             'Good',
                                                             'Excellent']],
                                                dtype=<class 'int'>),
                                 ['class_attendance']),
                                ('passthrough', 'passthrough',
                                 ['ml_experience']),
                                ('drop', 'drop', ['enjoy_course'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ada2bc19-179e-47ca-b19f-980f342a6ee8" type="checkbox" ><label class="sk-toggleable__label" for="ada2bc19-179e-47ca-b19f-980f342a6ee8">pipeline</label><div class="sk-toggleable__content"><pre>['university_years', 'lab1', 'lab2', 'lab3', 'lab4', 'quiz1']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="524a7c70-8706-422a-9413-2d760362d7f5" type="checkbox" ><label class="sk-toggleable__label" for="524a7c70-8706-422a-9413-2d760362d7f5">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="86937c81-9fc2-4c2f-9977-7f1f78e4060e" type="checkbox" ><label class="sk-toggleable__label" for="86937c81-9fc2-4c2f-9977-7f1f78e4060e">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="3f4c152d-3f1f-427d-a0f8-5a3cad71197b" type="checkbox" ><label class="sk-toggleable__label" for="3f4c152d-3f1f-427d-a0f8-5a3cad71197b">onehotencoder</label><div class="sk-toggleable__content"><pre>['major']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c9586e72-2ca5-4a59-971c-9ac9aedeea6b" type="checkbox" ><label class="sk-toggleable__label" for="c9586e72-2ca5-4a59-971c-9ac9aedeea6b">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown='ignore')</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="39ad393f-8291-493f-9730-721e4b0d9bb1" type="checkbox" ><label class="sk-toggleable__label" for="39ad393f-8291-493f-9730-721e4b0d9bb1">ordinalencoder</label><div class="sk-toggleable__content"><pre>['class_attendance']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="e492e396-da62-4138-9639-73d9446fa12e" type="checkbox" ><label class="sk-toggleable__label" for="e492e396-da62-4138-9639-73d9446fa12e">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(categories=[['Poor', 'Average', 'Good', 'Excellent']],
               dtype=<class 'int'>)</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f79621fa-5275-4c51-b4a4-5dcbd69d2d7b" type="checkbox" ><label class="sk-toggleable__label" for="f79621fa-5275-4c51-b4a4-5dcbd69d2d7b">passthrough</label><div class="sk-toggleable__content"><pre>['ml_experience']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="7cb84835-3d45-4615-b9bd-a926e55b0727" type="checkbox" ><label class="sk-toggleable__label" for="7cb84835-3d45-4615-b9bd-a926e55b0727">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a0d68552-cd79-4a50-9aa5-14476e5fce13" type="checkbox" ><label class="sk-toggleable__label" for="a0d68552-cd79-4a50-9aa5-14476e5fce13">drop</label><div class="sk-toggleable__content"><pre>['enjoy_course']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="50b994cb-a5f9-4feb-86f6-ecc8c06c76e7" type="checkbox" ><label class="sk-toggleable__label" for="50b994cb-a5f9-4feb-86f6-ecc8c06c76e7">drop</label><div class="sk-toggleable__content"><pre>drop</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span> <span class="n">SVC</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.006554</td>
      <td>0.003576</td>
      <td>1.00</td>
      <td>0.937500</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.006054</td>
      <td>0.003314</td>
      <td>1.00</td>
      <td>0.941176</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.005770</td>
      <td>0.003188</td>
      <td>0.50</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.005668</td>
      <td>0.003268</td>
      <td>0.75</td>
      <td>0.941176</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.005826</td>
      <td>0.003251</td>
      <td>0.75</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>With this approach, all unknown categories will be represented with all zeros and cross-validation is running OK now.</p></li>
</ul>
<p>Ask yourself the following questions when you work with categorical variables</p>
<ul class="simple">
<li><p>Do you want this behaviour?</p></li>
<li><p>Are you expecting to get many unknown categories? Do you want to be able to distinguish between them?</p></li>
</ul>
<div class="section" id="cases-where-it-s-ok-to-break-the-golden-rule">
<h4>Cases where it’s OK to break the golden rule<a class="headerlink" href="#cases-where-it-s-ok-to-break-the-golden-rule" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>If it’s some fix number of categories. For example, if it’s something like provinces in Canada or majors taught at UBC. We know the categories in advance and this is one of the cases where it might be OK to violate the golden rule and get a list of all possible values for the categorical variable.</p></li>
</ul>
<p><br><br></p>
</div>
</div>
<div class="section" id="categorical-features-with-only-two-possible-categories">
<h3>Categorical features with only two possible categories<a class="headerlink" href="#categorical-features-with-only-two-possible-categories" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Sometimes you have features with only two possible categories.</p></li>
<li><p>If we apply <code class="docutils literal notranslate"><span class="pre">OheHotEncoder</span></code> on such columns, it’ll create two columns, which seems wasteful, as we could represent all information in the column in just one column with say 0’s and 1’s with presence of absence of one of one of the categories.</p></li>
<li><p>You can pass <code class="docutils literal notranslate"><span class="pre">drop=&quot;if_binary&quot;</span></code> argument to <code class="docutils literal notranslate"><span class="pre">OneHotEncoder</span></code> in order to create only one column in such scenario.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;enjoy_course&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    yes
1    yes
2    yes
3     no
4    yes
Name: enjoy_course, dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ohe_enc</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="s2">&quot;if_binary&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ohe_enc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">[[</span><span class="s2">&quot;enjoy_course&quot;</span><span class="p">]])</span>
<span class="n">transformed</span> <span class="o">=</span> <span class="n">ohe_enc</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">[[</span><span class="s2">&quot;enjoy_course&quot;</span><span class="p">]])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">transformed</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;enjoy_course_enc&quot;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X</span><span class="p">[[</span><span class="s2">&quot;enjoy_course&quot;</span><span class="p">]],</span> <span class="n">df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>enjoy_course</th>
      <th>enjoy_course_enc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>yes</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>yes</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>yes</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>no</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>yes</td>
      <td>1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>no</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>yes</td>
      <td>1</td>
    </tr>
    <tr>
      <th>7</th>
      <td>no</td>
      <td>0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>no</td>
      <td>0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>yes</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numeric_feats</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;university_years&quot;</span><span class="p">,</span>
    <span class="s2">&quot;lab1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;lab2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;lab3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;lab4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;quiz1&quot;</span><span class="p">,</span>
<span class="p">]</span>  <span class="c1"># apply scaling</span>
<span class="n">categorical_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;major&quot;</span><span class="p">]</span>  <span class="c1"># apply one-hot encoding</span>
<span class="n">ordinal_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;class_attendance&quot;</span><span class="p">]</span>  <span class="c1"># apply ordinal encoding</span>
<span class="n">binary_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;enjoy_course&quot;</span><span class="p">]</span>  <span class="c1"># apply one-hot encoding with drop=&quot;if_binary&quot;</span>
<span class="n">passthrough_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ml_experience&quot;</span><span class="p">]</span>  <span class="c1"># do not apply any transformation</span>
<span class="n">drop_feats</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ct</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span>
        <span class="n">make_pipeline</span><span class="p">(</span><span class="n">SimpleImputer</span><span class="p">(),</span> <span class="n">StandardScaler</span><span class="p">()),</span>
        <span class="n">numeric_feats</span><span class="p">,</span>
    <span class="p">),</span>  <span class="c1"># scaling on numeric features</span>
    <span class="p">(</span>
        <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">),</span>
        <span class="n">categorical_feats</span><span class="p">,</span>
    <span class="p">),</span>  <span class="c1"># OHE on categorical features</span>
    <span class="p">(</span>
        <span class="n">OrdinalEncoder</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="n">class_attendance_levels</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
        <span class="n">ordinal_feats</span><span class="p">,</span>
    <span class="p">),</span>  <span class="c1"># Ordinal encoding on ordinal features</span>
    <span class="p">(</span>
        <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="s2">&quot;if_binary&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
        <span class="n">binary_feats</span><span class="p">,</span>
    <span class="p">),</span>  <span class="c1"># OHE on categorical features</span>
    <span class="p">(</span><span class="s2">&quot;passthrough&quot;</span><span class="p">,</span> <span class="n">passthrough_feats</span><span class="p">),</span>  <span class="c1"># no transformations on the binary features</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ct</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-80037fa8-c4d6-48dd-9f89-b0c7a448ae7d {color: black;background-color: white;}#sk-80037fa8-c4d6-48dd-9f89-b0c7a448ae7d pre{padding: 0;}#sk-80037fa8-c4d6-48dd-9f89-b0c7a448ae7d div.sk-toggleable {background-color: white;}#sk-80037fa8-c4d6-48dd-9f89-b0c7a448ae7d label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}#sk-80037fa8-c4d6-48dd-9f89-b0c7a448ae7d div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-80037fa8-c4d6-48dd-9f89-b0c7a448ae7d div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-80037fa8-c4d6-48dd-9f89-b0c7a448ae7d input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-80037fa8-c4d6-48dd-9f89-b0c7a448ae7d div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-80037fa8-c4d6-48dd-9f89-b0c7a448ae7d div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-80037fa8-c4d6-48dd-9f89-b0c7a448ae7d input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-80037fa8-c4d6-48dd-9f89-b0c7a448ae7d div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}#sk-80037fa8-c4d6-48dd-9f89-b0c7a448ae7d div.sk-estimator:hover {background-color: #d4ebff;}#sk-80037fa8-c4d6-48dd-9f89-b0c7a448ae7d div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-80037fa8-c4d6-48dd-9f89-b0c7a448ae7d div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-80037fa8-c4d6-48dd-9f89-b0c7a448ae7d div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-80037fa8-c4d6-48dd-9f89-b0c7a448ae7d div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}#sk-80037fa8-c4d6-48dd-9f89-b0c7a448ae7d div.sk-item {z-index: 1;}#sk-80037fa8-c4d6-48dd-9f89-b0c7a448ae7d div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-80037fa8-c4d6-48dd-9f89-b0c7a448ae7d div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-80037fa8-c4d6-48dd-9f89-b0c7a448ae7d div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-80037fa8-c4d6-48dd-9f89-b0c7a448ae7d div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-80037fa8-c4d6-48dd-9f89-b0c7a448ae7d div.sk-parallel-item:only-child::after {width: 0;}#sk-80037fa8-c4d6-48dd-9f89-b0c7a448ae7d div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}#sk-80037fa8-c4d6-48dd-9f89-b0c7a448ae7d div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-80037fa8-c4d6-48dd-9f89-b0c7a448ae7d div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-80037fa8-c4d6-48dd-9f89-b0c7a448ae7d div.sk-container {display: inline-block;position: relative;}</style><div id="sk-80037fa8-c4d6-48dd-9f89-b0c7a448ae7d" class"sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="e5d5a7bf-c6ce-4944-90aa-321fcc89982e" type="checkbox" ><label class="sk-toggleable__label" for="e5d5a7bf-c6ce-4944-90aa-321fcc89982e">ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer()),
                                                 ('standardscaler',
                                                  StandardScaler())]),
                                 ['university_years', 'lab1', 'lab2', 'lab3',
                                  'lab4', 'quiz1']),
                                ('onehotencoder-1',
                                 OneHotEncoder(handle_unknown='ignore'),
                                 ['major']),
                                ('ordinalencoder',
                                 OrdinalEncoder(categories=[['Poor', 'Average',
                                                             'Good',
                                                             'Excellent']],
                                                dtype=<class 'int'>),
                                 ['class_attendance']),
                                ('onehotencoder-2',
                                 OneHotEncoder(drop='if_binary',
                                               dtype=<class 'int'>),
                                 ['enjoy_course']),
                                ('passthrough', 'passthrough',
                                 ['ml_experience'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="50a94b7c-005e-4d7e-96d1-efc6f24f7c34" type="checkbox" ><label class="sk-toggleable__label" for="50a94b7c-005e-4d7e-96d1-efc6f24f7c34">pipeline</label><div class="sk-toggleable__content"><pre>['university_years', 'lab1', 'lab2', 'lab3', 'lab4', 'quiz1']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="331efecd-5407-4dd3-bd19-bd052cd6d01c" type="checkbox" ><label class="sk-toggleable__label" for="331efecd-5407-4dd3-bd19-bd052cd6d01c">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="5c8eb4df-9a25-42a2-8f53-7bf53bf9fe20" type="checkbox" ><label class="sk-toggleable__label" for="5c8eb4df-9a25-42a2-8f53-7bf53bf9fe20">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="abf0721d-f8c1-48bc-9063-c0168e412242" type="checkbox" ><label class="sk-toggleable__label" for="abf0721d-f8c1-48bc-9063-c0168e412242">onehotencoder-1</label><div class="sk-toggleable__content"><pre>['major']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="5aee0225-95f8-4185-8a0e-ffcff01c76c6" type="checkbox" ><label class="sk-toggleable__label" for="5aee0225-95f8-4185-8a0e-ffcff01c76c6">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown='ignore')</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="82a8d488-ddee-47f8-af37-35fd9e59ca82" type="checkbox" ><label class="sk-toggleable__label" for="82a8d488-ddee-47f8-af37-35fd9e59ca82">ordinalencoder</label><div class="sk-toggleable__content"><pre>['class_attendance']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b90bf0e8-df2c-4e06-96c3-89a06d0a0841" type="checkbox" ><label class="sk-toggleable__label" for="b90bf0e8-df2c-4e06-96c3-89a06d0a0841">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(categories=[['Poor', 'Average', 'Good', 'Excellent']],
               dtype=<class 'int'>)</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="757471fa-32b4-4a11-878b-5db47ddd95d2" type="checkbox" ><label class="sk-toggleable__label" for="757471fa-32b4-4a11-878b-5db47ddd95d2">onehotencoder-2</label><div class="sk-toggleable__content"><pre>['enjoy_course']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="24afb318-af43-4c5d-87a4-e85f59dd8d99" type="checkbox" ><label class="sk-toggleable__label" for="24afb318-af43-4c5d-87a4-e85f59dd8d99">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(drop='if_binary', dtype=<class 'int'>)</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="4cbb38cf-4a4b-4765-922f-057108d37fc1" type="checkbox" ><label class="sk-toggleable__label" for="4cbb38cf-4a4b-4765-922f-057108d37fc1">passthrough</label><div class="sk-toggleable__content"><pre>['ml_experience']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="69287b9d-22ee-4aca-9c26-eadd6600513e" type="checkbox" ><label class="sk-toggleable__label" for="69287b9d-22ee-4aca-9c26-eadd6600513e">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span> <span class="n">SVC</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.007486</td>
      <td>0.003797</td>
      <td>1.00</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.006879</td>
      <td>0.003729</td>
      <td>1.00</td>
      <td>0.941176</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.006338</td>
      <td>0.003737</td>
      <td>0.50</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.006804</td>
      <td>0.003845</td>
      <td>1.00</td>
      <td>0.941176</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.006563</td>
      <td>0.003851</td>
      <td>0.75</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Do not read too much into the scores, as we are running cross-validation on a very small dataset with 21 examples. The main point here is to show you how can we use <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code> to apply different transformations on different columns.</p>
</div>
</div>
</div>
<div class="section" id="break-5-min">
<h2>Break (5 min)<a class="headerlink" href="#break-5-min" title="Permalink to this headline">¶</a></h2>
<p><img alt="" src="../_images/eva-coffee.png" /></p>
<p><br><br><br><br></p>
</div>
<div class="section" id="columntransformer-on-the-california-housing-dataset">
<h2><code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code> on the California housing dataset<a class="headerlink" href="#columntransformer-on-the-california-housing-dataset" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">housing_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/housing.csv&quot;</span><span class="p">)</span>
<span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">housing_df</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>

<span class="n">train_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>total_rooms</th>
      <th>total_bedrooms</th>
      <th>population</th>
      <th>households</th>
      <th>median_income</th>
      <th>median_house_value</th>
      <th>ocean_proximity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6051</th>
      <td>-117.75</td>
      <td>34.04</td>
      <td>22.0</td>
      <td>2948.0</td>
      <td>636.0</td>
      <td>2600.0</td>
      <td>602.0</td>
      <td>3.1250</td>
      <td>113600.0</td>
      <td>INLAND</td>
    </tr>
    <tr>
      <th>20113</th>
      <td>-119.57</td>
      <td>37.94</td>
      <td>17.0</td>
      <td>346.0</td>
      <td>130.0</td>
      <td>51.0</td>
      <td>20.0</td>
      <td>3.4861</td>
      <td>137500.0</td>
      <td>INLAND</td>
    </tr>
    <tr>
      <th>14289</th>
      <td>-117.13</td>
      <td>32.74</td>
      <td>46.0</td>
      <td>3355.0</td>
      <td>768.0</td>
      <td>1457.0</td>
      <td>708.0</td>
      <td>2.6604</td>
      <td>170100.0</td>
      <td>NEAR OCEAN</td>
    </tr>
    <tr>
      <th>13665</th>
      <td>-117.31</td>
      <td>34.02</td>
      <td>18.0</td>
      <td>1634.0</td>
      <td>274.0</td>
      <td>899.0</td>
      <td>285.0</td>
      <td>5.2139</td>
      <td>129300.0</td>
      <td>INLAND</td>
    </tr>
    <tr>
      <th>14471</th>
      <td>-117.23</td>
      <td>32.88</td>
      <td>18.0</td>
      <td>5566.0</td>
      <td>1465.0</td>
      <td>6303.0</td>
      <td>1458.0</td>
      <td>1.8580</td>
      <td>205000.0</td>
      <td>NEAR OCEAN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Some column values are mean/median but some are not.</p>
<p>Let’s add some new features to the dataset which could help predicting the target: <code class="docutils literal notranslate"><span class="pre">median_house_value</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
    <span class="n">rooms_per_household</span><span class="o">=</span><span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;total_rooms&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;households&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">test_df</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
    <span class="n">rooms_per_household</span><span class="o">=</span><span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;total_rooms&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;households&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
    <span class="n">bedrooms_per_household</span><span class="o">=</span><span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;total_bedrooms&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;households&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">test_df</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
    <span class="n">bedrooms_per_household</span><span class="o">=</span><span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;total_bedrooms&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;households&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
    <span class="n">population_per_household</span><span class="o">=</span><span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;population&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;households&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">test_df</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
    <span class="n">population_per_household</span><span class="o">=</span><span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;population&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;households&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>total_rooms</th>
      <th>total_bedrooms</th>
      <th>population</th>
      <th>households</th>
      <th>median_income</th>
      <th>median_house_value</th>
      <th>ocean_proximity</th>
      <th>rooms_per_household</th>
      <th>bedrooms_per_household</th>
      <th>population_per_household</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6051</th>
      <td>-117.75</td>
      <td>34.04</td>
      <td>22.0</td>
      <td>2948.0</td>
      <td>636.0</td>
      <td>2600.0</td>
      <td>602.0</td>
      <td>3.1250</td>
      <td>113600.0</td>
      <td>INLAND</td>
      <td>4.897010</td>
      <td>1.056478</td>
      <td>4.318937</td>
    </tr>
    <tr>
      <th>20113</th>
      <td>-119.57</td>
      <td>37.94</td>
      <td>17.0</td>
      <td>346.0</td>
      <td>130.0</td>
      <td>51.0</td>
      <td>20.0</td>
      <td>3.4861</td>
      <td>137500.0</td>
      <td>INLAND</td>
      <td>17.300000</td>
      <td>6.500000</td>
      <td>2.550000</td>
    </tr>
    <tr>
      <th>14289</th>
      <td>-117.13</td>
      <td>32.74</td>
      <td>46.0</td>
      <td>3355.0</td>
      <td>768.0</td>
      <td>1457.0</td>
      <td>708.0</td>
      <td>2.6604</td>
      <td>170100.0</td>
      <td>NEAR OCEAN</td>
      <td>4.738701</td>
      <td>1.084746</td>
      <td>2.057910</td>
    </tr>
    <tr>
      <th>13665</th>
      <td>-117.31</td>
      <td>34.02</td>
      <td>18.0</td>
      <td>1634.0</td>
      <td>274.0</td>
      <td>899.0</td>
      <td>285.0</td>
      <td>5.2139</td>
      <td>129300.0</td>
      <td>INLAND</td>
      <td>5.733333</td>
      <td>0.961404</td>
      <td>3.154386</td>
    </tr>
    <tr>
      <th>14471</th>
      <td>-117.23</td>
      <td>32.88</td>
      <td>18.0</td>
      <td>5566.0</td>
      <td>1465.0</td>
      <td>6303.0</td>
      <td>1458.0</td>
      <td>1.8580</td>
      <td>205000.0</td>
      <td>NEAR OCEAN</td>
      <td>3.817558</td>
      <td>1.004801</td>
      <td>4.323045</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s keep both numeric and categorical columns in the data.</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">])</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">]</span>

<span class="n">X_test</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">])</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span><span class="p">,</span> <span class="n">make_column_transformer</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>total_rooms</th>
      <th>total_bedrooms</th>
      <th>population</th>
      <th>households</th>
      <th>median_income</th>
      <th>ocean_proximity</th>
      <th>rooms_per_household</th>
      <th>bedrooms_per_household</th>
      <th>population_per_household</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6051</th>
      <td>-117.75</td>
      <td>34.04</td>
      <td>22.0</td>
      <td>2948.0</td>
      <td>636.0</td>
      <td>2600.0</td>
      <td>602.0</td>
      <td>3.1250</td>
      <td>INLAND</td>
      <td>4.897010</td>
      <td>1.056478</td>
      <td>4.318937</td>
    </tr>
    <tr>
      <th>20113</th>
      <td>-119.57</td>
      <td>37.94</td>
      <td>17.0</td>
      <td>346.0</td>
      <td>130.0</td>
      <td>51.0</td>
      <td>20.0</td>
      <td>3.4861</td>
      <td>INLAND</td>
      <td>17.300000</td>
      <td>6.500000</td>
      <td>2.550000</td>
    </tr>
    <tr>
      <th>14289</th>
      <td>-117.13</td>
      <td>32.74</td>
      <td>46.0</td>
      <td>3355.0</td>
      <td>768.0</td>
      <td>1457.0</td>
      <td>708.0</td>
      <td>2.6604</td>
      <td>NEAR OCEAN</td>
      <td>4.738701</td>
      <td>1.084746</td>
      <td>2.057910</td>
    </tr>
    <tr>
      <th>13665</th>
      <td>-117.31</td>
      <td>34.02</td>
      <td>18.0</td>
      <td>1634.0</td>
      <td>274.0</td>
      <td>899.0</td>
      <td>285.0</td>
      <td>5.2139</td>
      <td>INLAND</td>
      <td>5.733333</td>
      <td>0.961404</td>
      <td>3.154386</td>
    </tr>
    <tr>
      <th>14471</th>
      <td>-117.23</td>
      <td>32.88</td>
      <td>18.0</td>
      <td>5566.0</td>
      <td>1465.0</td>
      <td>6303.0</td>
      <td>1458.0</td>
      <td>1.8580</td>
      <td>NEAR OCEAN</td>
      <td>3.817558</td>
      <td>1.004801</td>
      <td>4.323045</td>
    </tr>
    <tr>
      <th>9730</th>
      <td>-121.74</td>
      <td>36.79</td>
      <td>16.0</td>
      <td>3841.0</td>
      <td>620.0</td>
      <td>1799.0</td>
      <td>611.0</td>
      <td>4.3814</td>
      <td>&lt;1H OCEAN</td>
      <td>6.286416</td>
      <td>1.014730</td>
      <td>2.944354</td>
    </tr>
    <tr>
      <th>14690</th>
      <td>-117.09</td>
      <td>32.80</td>
      <td>36.0</td>
      <td>2163.0</td>
      <td>367.0</td>
      <td>915.0</td>
      <td>360.0</td>
      <td>4.7188</td>
      <td>NEAR OCEAN</td>
      <td>6.008333</td>
      <td>1.019444</td>
      <td>2.541667</td>
    </tr>
    <tr>
      <th>7938</th>
      <td>-118.11</td>
      <td>33.86</td>
      <td>33.0</td>
      <td>2389.0</td>
      <td>410.0</td>
      <td>1229.0</td>
      <td>393.0</td>
      <td>5.3889</td>
      <td>&lt;1H OCEAN</td>
      <td>6.078880</td>
      <td>1.043257</td>
      <td>3.127226</td>
    </tr>
    <tr>
      <th>18365</th>
      <td>-122.12</td>
      <td>37.28</td>
      <td>21.0</td>
      <td>349.0</td>
      <td>64.0</td>
      <td>149.0</td>
      <td>56.0</td>
      <td>5.8691</td>
      <td>&lt;1H OCEAN</td>
      <td>6.232143</td>
      <td>1.142857</td>
      <td>2.660714</td>
    </tr>
    <tr>
      <th>10931</th>
      <td>-117.91</td>
      <td>33.74</td>
      <td>25.0</td>
      <td>4273.0</td>
      <td>965.0</td>
      <td>2946.0</td>
      <td>922.0</td>
      <td>2.9926</td>
      <td>&lt;1H OCEAN</td>
      <td>4.634490</td>
      <td>1.046638</td>
      <td>3.195228</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;longitude&#39;, &#39;latitude&#39;, &#39;housing_median_age&#39;, &#39;total_rooms&#39;,
       &#39;total_bedrooms&#39;, &#39;population&#39;, &#39;households&#39;, &#39;median_income&#39;,
       &#39;ocean_proximity&#39;, &#39;rooms_per_household&#39;, &#39;bedrooms_per_household&#39;,
       &#39;population_per_household&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Identify the categorical and numeric columns</span>
<span class="n">numeric_features</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;longitude&quot;</span><span class="p">,</span>
    <span class="s2">&quot;latitude&quot;</span><span class="p">,</span>
    <span class="s2">&quot;housing_median_age&quot;</span><span class="p">,</span>
    <span class="s2">&quot;total_rooms&quot;</span><span class="p">,</span>
    <span class="s2">&quot;total_bedrooms&quot;</span><span class="p">,</span>
    <span class="s2">&quot;population&quot;</span><span class="p">,</span>
    <span class="s2">&quot;households&quot;</span><span class="p">,</span>
    <span class="s2">&quot;median_income&quot;</span><span class="p">,</span>
    <span class="s2">&quot;rooms_per_household&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bedrooms_per_household&quot;</span><span class="p">,</span>
    <span class="s2">&quot;population_per_household&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">categorical_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ocean_proximity&quot;</span><span class="p">]</span>
<span class="n">target</span> <span class="o">=</span> <span class="s2">&quot;median_income&quot;</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Let’s create a <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code> for our dataset.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 18576 entries, 6051 to 19966
Data columns (total 12 columns):
 #   Column                    Non-Null Count  Dtype  
---  ------                    --------------  -----  
 0   longitude                 18576 non-null  float64
 1   latitude                  18576 non-null  float64
 2   housing_median_age        18576 non-null  float64
 3   total_rooms               18576 non-null  float64
 4   total_bedrooms            18391 non-null  float64
 5   population                18576 non-null  float64
 6   households                18576 non-null  float64
 7   median_income             18576 non-null  float64
 8   ocean_proximity           18576 non-null  object 
 9   rooms_per_household       18576 non-null  float64
 10  bedrooms_per_household    18391 non-null  float64
 11  population_per_household  18576 non-null  float64
dtypes: float64(11), object(1)
memory usage: 1.8+ MB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;ocean_proximity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;1H OCEAN     8221
INLAND        5915
NEAR OCEAN    2389
NEAR BAY      2046
ISLAND           5
Name: ocean_proximity, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numeric_transformer</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">),</span> <span class="n">StandardScaler</span><span class="p">())</span>
<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span><span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">numeric_features</span><span class="p">),</span>
    <span class="p">(</span><span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessor</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-b61a466a-9a16-4dec-bb27-b38f73747ab4 {color: black;background-color: white;}#sk-b61a466a-9a16-4dec-bb27-b38f73747ab4 pre{padding: 0;}#sk-b61a466a-9a16-4dec-bb27-b38f73747ab4 div.sk-toggleable {background-color: white;}#sk-b61a466a-9a16-4dec-bb27-b38f73747ab4 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}#sk-b61a466a-9a16-4dec-bb27-b38f73747ab4 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-b61a466a-9a16-4dec-bb27-b38f73747ab4 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-b61a466a-9a16-4dec-bb27-b38f73747ab4 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-b61a466a-9a16-4dec-bb27-b38f73747ab4 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-b61a466a-9a16-4dec-bb27-b38f73747ab4 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-b61a466a-9a16-4dec-bb27-b38f73747ab4 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-b61a466a-9a16-4dec-bb27-b38f73747ab4 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}#sk-b61a466a-9a16-4dec-bb27-b38f73747ab4 div.sk-estimator:hover {background-color: #d4ebff;}#sk-b61a466a-9a16-4dec-bb27-b38f73747ab4 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-b61a466a-9a16-4dec-bb27-b38f73747ab4 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-b61a466a-9a16-4dec-bb27-b38f73747ab4 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-b61a466a-9a16-4dec-bb27-b38f73747ab4 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}#sk-b61a466a-9a16-4dec-bb27-b38f73747ab4 div.sk-item {z-index: 1;}#sk-b61a466a-9a16-4dec-bb27-b38f73747ab4 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-b61a466a-9a16-4dec-bb27-b38f73747ab4 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-b61a466a-9a16-4dec-bb27-b38f73747ab4 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-b61a466a-9a16-4dec-bb27-b38f73747ab4 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-b61a466a-9a16-4dec-bb27-b38f73747ab4 div.sk-parallel-item:only-child::after {width: 0;}#sk-b61a466a-9a16-4dec-bb27-b38f73747ab4 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}#sk-b61a466a-9a16-4dec-bb27-b38f73747ab4 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-b61a466a-9a16-4dec-bb27-b38f73747ab4 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-b61a466a-9a16-4dec-bb27-b38f73747ab4 div.sk-container {display: inline-block;position: relative;}</style><div id="sk-b61a466a-9a16-4dec-bb27-b38f73747ab4" class"sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="fe27cf37-1d8a-4f0f-8c6c-4488eb622af8" type="checkbox" ><label class="sk-toggleable__label" for="fe27cf37-1d8a-4f0f-8c6c-4488eb622af8">ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(strategy='median')),
                                                 ('standardscaler',
                                                  StandardScaler())]),
                                 ['longitude', 'latitude', 'housing_median_age',
                                  'total_rooms', 'total_bedrooms', 'population',
                                  'households', 'median_income',
                                  'rooms_per_household',
                                  'bedrooms_per_household',
                                  'population_per_household']),
                                ('onehotencoder',
                                 OneHotEncoder(handle_unknown='ignore'),
                                 ['ocean_proximity'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="e1a2f350-8710-4bad-9963-7f8303477024" type="checkbox" ><label class="sk-toggleable__label" for="e1a2f350-8710-4bad-9963-7f8303477024">pipeline</label><div class="sk-toggleable__content"><pre>['longitude', 'latitude', 'housing_median_age', 'total_rooms', 'total_bedrooms', 'population', 'households', 'median_income', 'rooms_per_household', 'bedrooms_per_household', 'population_per_household']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="679e8ccf-c79e-4d15-a3a1-bb2e65bd8d72" type="checkbox" ><label class="sk-toggleable__label" for="679e8ccf-c79e-4d15-a3a1-bb2e65bd8d72">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy='median')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="57999a74-419a-46dd-9ff1-2f2db748eea3" type="checkbox" ><label class="sk-toggleable__label" for="57999a74-419a-46dd-9ff1-2f2db748eea3">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="66ff05ca-9399-4212-b83c-7861933286e3" type="checkbox" ><label class="sk-toggleable__label" for="66ff05ca-9399-4212-b83c-7861933286e3">onehotencoder</label><div class="sk-toggleable__content"><pre>['ocean_proximity']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="80649425-7bd9-489f-9b93-e0856b685d25" type="checkbox" ><label class="sk-toggleable__label" for="80649425-7bd9-489f-9b93-e0856b685d25">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown='ignore')</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train_pp</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>When we <code class="docutils literal notranslate"><span class="pre">fit</span></code> the preprocessor, it calls <code class="docutils literal notranslate"><span class="pre">fit</span></code> on <em>all</em> the transformers</p></li>
<li><p>When we <code class="docutils literal notranslate"><span class="pre">transform</span></code> the preprocessor, it calls <code class="docutils literal notranslate"><span class="pre">transform</span></code> on <em>all</em> the transformers.</p></li>
</ul>
<p>We can get the new names of the columns that were generated by the one-hot encoding:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessor</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-ed1e0077-c27b-4ed4-a2a4-f8151d1dae66 {color: black;background-color: white;}#sk-ed1e0077-c27b-4ed4-a2a4-f8151d1dae66 pre{padding: 0;}#sk-ed1e0077-c27b-4ed4-a2a4-f8151d1dae66 div.sk-toggleable {background-color: white;}#sk-ed1e0077-c27b-4ed4-a2a4-f8151d1dae66 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}#sk-ed1e0077-c27b-4ed4-a2a4-f8151d1dae66 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-ed1e0077-c27b-4ed4-a2a4-f8151d1dae66 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-ed1e0077-c27b-4ed4-a2a4-f8151d1dae66 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-ed1e0077-c27b-4ed4-a2a4-f8151d1dae66 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-ed1e0077-c27b-4ed4-a2a4-f8151d1dae66 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-ed1e0077-c27b-4ed4-a2a4-f8151d1dae66 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-ed1e0077-c27b-4ed4-a2a4-f8151d1dae66 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}#sk-ed1e0077-c27b-4ed4-a2a4-f8151d1dae66 div.sk-estimator:hover {background-color: #d4ebff;}#sk-ed1e0077-c27b-4ed4-a2a4-f8151d1dae66 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-ed1e0077-c27b-4ed4-a2a4-f8151d1dae66 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-ed1e0077-c27b-4ed4-a2a4-f8151d1dae66 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-ed1e0077-c27b-4ed4-a2a4-f8151d1dae66 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}#sk-ed1e0077-c27b-4ed4-a2a4-f8151d1dae66 div.sk-item {z-index: 1;}#sk-ed1e0077-c27b-4ed4-a2a4-f8151d1dae66 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-ed1e0077-c27b-4ed4-a2a4-f8151d1dae66 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-ed1e0077-c27b-4ed4-a2a4-f8151d1dae66 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-ed1e0077-c27b-4ed4-a2a4-f8151d1dae66 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-ed1e0077-c27b-4ed4-a2a4-f8151d1dae66 div.sk-parallel-item:only-child::after {width: 0;}#sk-ed1e0077-c27b-4ed4-a2a4-f8151d1dae66 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}#sk-ed1e0077-c27b-4ed4-a2a4-f8151d1dae66 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-ed1e0077-c27b-4ed4-a2a4-f8151d1dae66 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-ed1e0077-c27b-4ed4-a2a4-f8151d1dae66 div.sk-container {display: inline-block;position: relative;}</style><div id="sk-ed1e0077-c27b-4ed4-a2a4-f8151d1dae66" class"sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a4b95aff-ecb9-4b5f-81ca-65ccdf0ec019" type="checkbox" ><label class="sk-toggleable__label" for="a4b95aff-ecb9-4b5f-81ca-65ccdf0ec019">ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(strategy='median')),
                                                 ('standardscaler',
                                                  StandardScaler())]),
                                 ['longitude', 'latitude', 'housing_median_age',
                                  'total_rooms', 'total_bedrooms', 'population',
                                  'households', 'median_income',
                                  'rooms_per_household',
                                  'bedrooms_per_household',
                                  'population_per_household']),
                                ('onehotencoder',
                                 OneHotEncoder(handle_unknown='ignore'),
                                 ['ocean_proximity'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8b4e8c20-e4fd-48b7-8ffb-8fd66a71bac1" type="checkbox" ><label class="sk-toggleable__label" for="8b4e8c20-e4fd-48b7-8ffb-8fd66a71bac1">pipeline</label><div class="sk-toggleable__content"><pre>['longitude', 'latitude', 'housing_median_age', 'total_rooms', 'total_bedrooms', 'population', 'households', 'median_income', 'rooms_per_household', 'bedrooms_per_household', 'population_per_household']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="33a09041-a4a8-4db4-bf77-5ad4b7f41791" type="checkbox" ><label class="sk-toggleable__label" for="33a09041-a4a8-4db4-bf77-5ad4b7f41791">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy='median')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="957e731a-e7b6-4c9a-9458-8aefb86ddd5b" type="checkbox" ><label class="sk-toggleable__label" for="957e731a-e7b6-4c9a-9458-8aefb86ddd5b">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b3e13113-9590-4a68-96b5-78b3aaf09428" type="checkbox" ><label class="sk-toggleable__label" for="b3e13113-9590-4a68-96b5-78b3aaf09428">onehotencoder</label><div class="sk-toggleable__content"><pre>['ocean_proximity']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a739655d-4eb6-4a6d-951f-c36d27da07ee" type="checkbox" ><label class="sk-toggleable__label" for="a739655d-4eb6-4a6d-951f-c36d27da07ee">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown='ignore')</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessor</span><span class="o">.</span><span class="n">named_transformers_</span><span class="p">[</span><span class="s2">&quot;onehotencoder&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">(</span>
    <span class="n">categorical_features</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;ocean_proximity_&lt;1H OCEAN&#39;, &#39;ocean_proximity_INLAND&#39;,
       &#39;ocean_proximity_ISLAND&#39;, &#39;ocean_proximity_NEAR BAY&#39;,
       &#39;ocean_proximity_NEAR OCEAN&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<p>Combining this with the numeric feature names gives us all the column names:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">column_names</span> <span class="o">=</span> <span class="n">numeric_features</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="o">.</span><span class="n">named_transformers_</span><span class="p">[</span><span class="s2">&quot;onehotencoder&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">(</span>
        <span class="n">categorical_features</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">column_names</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;longitude&#39;,
 &#39;latitude&#39;,
 &#39;housing_median_age&#39;,
 &#39;total_rooms&#39;,
 &#39;total_bedrooms&#39;,
 &#39;population&#39;,
 &#39;households&#39;,
 &#39;median_income&#39;,
 &#39;rooms_per_household&#39;,
 &#39;bedrooms_per_household&#39;,
 &#39;population_per_household&#39;,
 &#39;ocean_proximity_&lt;1H OCEAN&#39;,
 &#39;ocean_proximity_INLAND&#39;,
 &#39;ocean_proximity_ISLAND&#39;,
 &#39;ocean_proximity_NEAR BAY&#39;,
 &#39;ocean_proximity_NEAR OCEAN&#39;]
</pre></div>
</div>
</div>
</div>
<p>Let’s visualize the preprocessed training data as a dataframe.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_train_pp</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">column_names</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>total_rooms</th>
      <th>total_bedrooms</th>
      <th>population</th>
      <th>households</th>
      <th>median_income</th>
      <th>rooms_per_household</th>
      <th>bedrooms_per_household</th>
      <th>population_per_household</th>
      <th>ocean_proximity_&lt;1H OCEAN</th>
      <th>ocean_proximity_INLAND</th>
      <th>ocean_proximity_ISLAND</th>
      <th>ocean_proximity_NEAR BAY</th>
      <th>ocean_proximity_NEAR OCEAN</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.908140</td>
      <td>-0.743917</td>
      <td>-0.526078</td>
      <td>0.143120</td>
      <td>0.235339</td>
      <td>1.026092</td>
      <td>0.266135</td>
      <td>-0.389736</td>
      <td>-0.210591</td>
      <td>-0.083813</td>
      <td>0.126398</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.002057</td>
      <td>1.083123</td>
      <td>-0.923283</td>
      <td>-1.049510</td>
      <td>-0.969959</td>
      <td>-1.206672</td>
      <td>-1.253312</td>
      <td>-0.198924</td>
      <td>4.726412</td>
      <td>11.166631</td>
      <td>-0.050132</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.218207</td>
      <td>-1.352930</td>
      <td>1.380504</td>
      <td>0.329670</td>
      <td>0.549764</td>
      <td>0.024896</td>
      <td>0.542873</td>
      <td>-0.635239</td>
      <td>-0.273606</td>
      <td>-0.025391</td>
      <td>-0.099240</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.128188</td>
      <td>-0.753286</td>
      <td>-0.843842</td>
      <td>-0.459154</td>
      <td>-0.626949</td>
      <td>-0.463877</td>
      <td>-0.561467</td>
      <td>0.714077</td>
      <td>0.122307</td>
      <td>-0.280310</td>
      <td>0.010183</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.168196</td>
      <td>-1.287344</td>
      <td>-0.843842</td>
      <td>1.343085</td>
      <td>2.210026</td>
      <td>4.269688</td>
      <td>2.500924</td>
      <td>-1.059242</td>
      <td>-0.640266</td>
      <td>-0.190617</td>
      <td>0.126808</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>18571</th>
      <td>0.733102</td>
      <td>-0.804818</td>
      <td>0.586095</td>
      <td>-0.875337</td>
      <td>-0.243446</td>
      <td>-0.822136</td>
      <td>-0.966131</td>
      <td>-0.118182</td>
      <td>0.063110</td>
      <td>-0.099558</td>
      <td>0.071541</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>18572</th>
      <td>1.163195</td>
      <td>-1.057793</td>
      <td>-1.161606</td>
      <td>0.940194</td>
      <td>0.609314</td>
      <td>0.882438</td>
      <td>0.728235</td>
      <td>0.357500</td>
      <td>0.235096</td>
      <td>-0.163397</td>
      <td>0.007458</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>18573</th>
      <td>-1.097293</td>
      <td>0.797355</td>
      <td>-1.876574</td>
      <td>0.695434</td>
      <td>0.433046</td>
      <td>0.881563</td>
      <td>0.514155</td>
      <td>0.934269</td>
      <td>0.211892</td>
      <td>-0.135305</td>
      <td>0.044029</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>18574</th>
      <td>-1.437367</td>
      <td>1.008167</td>
      <td>1.221622</td>
      <td>-0.499947</td>
      <td>-0.484029</td>
      <td>-0.759944</td>
      <td>-0.454427</td>
      <td>0.006578</td>
      <td>-0.273382</td>
      <td>-0.149822</td>
      <td>-0.132875</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>18575</th>
      <td>0.242996</td>
      <td>0.272667</td>
      <td>-0.684960</td>
      <td>-0.332190</td>
      <td>-0.353018</td>
      <td>-0.164307</td>
      <td>-0.396991</td>
      <td>-0.711754</td>
      <td>0.025998</td>
      <td>0.042957</td>
      <td>0.051269</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>18576 rows × 16 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">dummy</span> <span class="o">=</span> <span class="n">DummyRegressor</span><span class="p">()</span>
<span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;dummy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">dummy</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_dict</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>dummy</th>
      <td>0.001 (+/- 0.000)</td>
      <td>0.000 (+/- 0.000)</td>
      <td>-0.001 (+/- 0.001)</td>
      <td>0.000 (+/- 0.000)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVR</span>

<span class="n">knn_pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">KNeighborsRegressor</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">knn_pipe</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-a78db03d-a480-429d-a551-00138dddabff {color: black;background-color: white;}#sk-a78db03d-a480-429d-a551-00138dddabff pre{padding: 0;}#sk-a78db03d-a480-429d-a551-00138dddabff div.sk-toggleable {background-color: white;}#sk-a78db03d-a480-429d-a551-00138dddabff label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}#sk-a78db03d-a480-429d-a551-00138dddabff div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-a78db03d-a480-429d-a551-00138dddabff div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-a78db03d-a480-429d-a551-00138dddabff input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-a78db03d-a480-429d-a551-00138dddabff div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-a78db03d-a480-429d-a551-00138dddabff div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-a78db03d-a480-429d-a551-00138dddabff input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-a78db03d-a480-429d-a551-00138dddabff div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}#sk-a78db03d-a480-429d-a551-00138dddabff div.sk-estimator:hover {background-color: #d4ebff;}#sk-a78db03d-a480-429d-a551-00138dddabff div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-a78db03d-a480-429d-a551-00138dddabff div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-a78db03d-a480-429d-a551-00138dddabff div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-a78db03d-a480-429d-a551-00138dddabff div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}#sk-a78db03d-a480-429d-a551-00138dddabff div.sk-item {z-index: 1;}#sk-a78db03d-a480-429d-a551-00138dddabff div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-a78db03d-a480-429d-a551-00138dddabff div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-a78db03d-a480-429d-a551-00138dddabff div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-a78db03d-a480-429d-a551-00138dddabff div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-a78db03d-a480-429d-a551-00138dddabff div.sk-parallel-item:only-child::after {width: 0;}#sk-a78db03d-a480-429d-a551-00138dddabff div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}#sk-a78db03d-a480-429d-a551-00138dddabff div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-a78db03d-a480-429d-a551-00138dddabff div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-a78db03d-a480-429d-a551-00138dddabff div.sk-container {display: inline-block;position: relative;}</style><div id="sk-a78db03d-a480-429d-a551-00138dddabff" class"sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="114dece3-3d52-4353-b264-1cc1a50b106c" type="checkbox" ><label class="sk-toggleable__label" for="114dece3-3d52-4353-b264-1cc1a50b106c">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('columntransformer',
                 ColumnTransformer(transformers=[('pipeline',
                                                  Pipeline(steps=[('simpleimputer',
                                                                   SimpleImputer(strategy='median')),
                                                                  ('standardscaler',
                                                                   StandardScaler())]),
                                                  ['longitude', 'latitude',
                                                   'housing_median_age',
                                                   'total_rooms',
                                                   'total_bedrooms',
                                                   'population', 'households',
                                                   'median_income',
                                                   'rooms_per_household',
                                                   'bedrooms_per_household',
                                                   'population_per_household']),
                                                 ('onehotencoder',
                                                  OneHotEncoder(handle_unknown='ignore'),
                                                  ['ocean_proximity'])])),
                ('kneighborsregressor', KNeighborsRegressor())])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="bb7e385a-456e-4a54-8d7e-71cd8d3aeeac" type="checkbox" ><label class="sk-toggleable__label" for="bb7e385a-456e-4a54-8d7e-71cd8d3aeeac">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(strategy='median')),
                                                 ('standardscaler',
                                                  StandardScaler())]),
                                 ['longitude', 'latitude', 'housing_median_age',
                                  'total_rooms', 'total_bedrooms', 'population',
                                  'households', 'median_income',
                                  'rooms_per_household',
                                  'bedrooms_per_household',
                                  'population_per_household']),
                                ('onehotencoder',
                                 OneHotEncoder(handle_unknown='ignore'),
                                 ['ocean_proximity'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="2fd5194a-6216-4536-b6a0-cd9948677f07" type="checkbox" ><label class="sk-toggleable__label" for="2fd5194a-6216-4536-b6a0-cd9948677f07">pipeline</label><div class="sk-toggleable__content"><pre>['longitude', 'latitude', 'housing_median_age', 'total_rooms', 'total_bedrooms', 'population', 'households', 'median_income', 'rooms_per_household', 'bedrooms_per_household', 'population_per_household']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="4f4d0e53-58e2-4711-a019-a0ce734d733a" type="checkbox" ><label class="sk-toggleable__label" for="4f4d0e53-58e2-4711-a019-a0ce734d733a">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy='median')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b62ba293-4827-4653-96a4-1284b4464699" type="checkbox" ><label class="sk-toggleable__label" for="b62ba293-4827-4653-96a4-1284b4464699">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8399f86e-f036-49c0-896a-ef15b52b91c8" type="checkbox" ><label class="sk-toggleable__label" for="8399f86e-f036-49c0-896a-ef15b52b91c8">onehotencoder</label><div class="sk-toggleable__content"><pre>['ocean_proximity']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f95da6ad-49b4-4d86-a178-eb0994834ca7" type="checkbox" ><label class="sk-toggleable__label" for="f95da6ad-49b4-4d86-a178-eb0994834ca7">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown='ignore')</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ef80b7a9-3cd0-44ab-989f-c0dc020a0322" type="checkbox" ><label class="sk-toggleable__label" for="ef80b7a9-3cd0-44ab-989f-c0dc020a0322">KNeighborsRegressor</label><div class="sk-toggleable__content"><pre>KNeighborsRegressor()</pre></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;imp + scaling + ohe + KNN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">knn_pipe</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_dict</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>dummy</th>
      <td>0.001 (+/- 0.000)</td>
      <td>0.000 (+/- 0.000)</td>
      <td>-0.001 (+/- 0.001)</td>
      <td>0.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>imp + scaling + ohe + KNN</th>
      <td>0.020 (+/- 0.001)</td>
      <td>0.712 (+/- 0.023)</td>
      <td>0.721 (+/- 0.012)</td>
      <td>0.816 (+/- 0.006)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">svr_pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">SVR</span><span class="p">())</span>
<span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;imp + scaling + ohe + SVR (default)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">svr_pipe</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">80</span><span class="o">/</span><span class="n">kr9rkqfj4w78h49djkz8yy9r0000gp</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_15718</span><span class="o">/</span><span class="mf">2113108640.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">svr_pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">SVR</span><span class="p">())</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;imp + scaling + ohe + SVR (default)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">svr_pipe</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="p">)</span>

<span class="nn">~/CS/2021-22/330/cpsc330/lectures/code/./utils.py</span> in <span class="ni">mean_std_cross_val_scores</span><span class="nt">(model, X_train, y_train, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">112</span>     <span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">113</span><span class="sd"> </span>
<span class="ne">--&gt; </span><span class="mi">114</span><span class="sd">     scores = cross_validate(model, X_train, y_train, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">115</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">116</span><span class="sd">     mean_scores = pd.DataFrame(scores).mean()</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/utils/validation.py</span> in <span class="ni">inner_f</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">61</span><span class="sd">             extra_args = len(args) - len(all_args)</span>
<span class="g g-Whitespace">     </span><span class="mi">62</span><span class="sd">             if extra_args &lt;= 0:</span>
<span class="ne">---&gt; </span><span class="mi">63</span><span class="sd">                 return f(*args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">64</span><span class="sd"> </span>
<span class="g g-Whitespace">     </span><span class="mi">65</span><span class="sd">             # extra_args &gt; 0</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/model_selection/_validation.py</span> in <span class="ni">cross_validate</span><span class="nt">(estimator, X, y, groups, scoring, cv, n_jobs, verbose, fit_params, pre_dispatch, return_train_score, return_estimator, error_score)</span>
<span class="g g-Whitespace">    </span><span class="mi">248</span><span class="sd">     parallel = Parallel(n_jobs=n_jobs, verbose=verbose,</span>
<span class="g g-Whitespace">    </span><span class="mi">249</span><span class="sd">                         pre_dispatch=pre_dispatch)</span>
<span class="ne">--&gt; </span><span class="mi">250</span><span class="sd">     results = parallel(</span>
<span class="g g-Whitespace">    </span><span class="mi">251</span><span class="sd">         delayed(_fit_and_score)(</span>
<span class="g g-Whitespace">    </span><span class="mi">252</span><span class="sd">             clone(estimator), X, y, scorers, train, test, verbose, None,</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/joblib/parallel.py</span> in <span class="ni">__call__</span><span class="nt">(self, iterable)</span>
<span class="g g-Whitespace">   </span><span class="mi">1041</span><span class="sd">             # remaining jobs.</span>
<span class="g g-Whitespace">   </span><span class="mi">1042</span><span class="sd">             self._iterating = False</span>
<span class="ne">-&gt; </span><span class="mi">1043</span><span class="sd">             if self.dispatch_one_batch(iterator):</span>
<span class="g g-Whitespace">   </span><span class="mi">1044</span><span class="sd">                 self._iterating = self._original_iterator is not None</span>
<span class="g g-Whitespace">   </span><span class="mi">1045</span><span class="sd"> </span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/joblib/parallel.py</span> in <span class="ni">dispatch_one_batch</span><span class="nt">(self, iterator)</span>
<span class="g g-Whitespace">    </span><span class="mi">859</span><span class="sd">                 return False</span>
<span class="g g-Whitespace">    </span><span class="mi">860</span><span class="sd">             else:</span>
<span class="ne">--&gt; </span><span class="mi">861</span><span class="sd">                 self._dispatch(tasks)</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span><span class="sd">                 return True</span>
<span class="g g-Whitespace">    </span><span class="mi">863</span><span class="sd"> </span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/joblib/parallel.py</span> in <span class="ni">_dispatch</span><span class="nt">(self, batch)</span>
<span class="g g-Whitespace">    </span><span class="mi">777</span><span class="sd">         with self._lock:</span>
<span class="g g-Whitespace">    </span><span class="mi">778</span><span class="sd">             job_idx = len(self._jobs)</span>
<span class="ne">--&gt; </span><span class="mi">779</span><span class="sd">             job = self._backend.apply_async(batch, callback=cb)</span>
<span class="g g-Whitespace">    </span><span class="mi">780</span><span class="sd">             # A job can complete so quickly than its callback is</span>
<span class="g g-Whitespace">    </span><span class="mi">781</span><span class="sd">             # called before we get here, causing self._jobs to</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/joblib/_parallel_backends.py</span> in <span class="ni">apply_async</span><span class="nt">(self, func, callback)</span>
<span class="g g-Whitespace">    </span><span class="mi">206</span><span class="sd">     def apply_async(self, func, callback=None):</span>
<span class="g g-Whitespace">    </span><span class="mi">207</span><span class="sd">         &quot;&quot;&quot;</span><span class="n">Schedule</span> <span class="n">a</span> <span class="n">func</span> <span class="n">to</span> <span class="n">be</span> <span class="n">run</span><span class="s2">&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">208</span><span class="s2">         result = ImmediateResult(func)</span>
<span class="g g-Whitespace">    </span><span class="mi">209</span><span class="s2">         if callback:</span>
<span class="g g-Whitespace">    </span><span class="mi">210</span><span class="s2">             callback(result)</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/joblib/_parallel_backends.py</span> in <span class="ni">__init__</span><span class="nt">(self, batch)</span>
<span class="g g-Whitespace">    </span><span class="mi">570</span><span class="s2">         # Don&#39;t delay the application, to avoid keeping the input</span>
<span class="g g-Whitespace">    </span><span class="mi">571</span><span class="s2">         # arguments in memory</span>
<span class="ne">--&gt; </span><span class="mi">572</span><span class="s2">         self.results = batch()</span>
<span class="g g-Whitespace">    </span><span class="mi">573</span><span class="s2"> </span>
<span class="g g-Whitespace">    </span><span class="mi">574</span><span class="s2">     def get(self):</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/joblib/parallel.py</span> in <span class="ni">__call__</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">260</span><span class="s2">         # change the default number of processes to -1</span>
<span class="g g-Whitespace">    </span><span class="mi">261</span><span class="s2">         with parallel_backend(self._backend, n_jobs=self._n_jobs):</span>
<span class="ne">--&gt; </span><span class="mi">262</span><span class="s2">             return [func(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">263</span><span class="s2">                     for func, args, kwargs in self.items]</span>
<span class="g g-Whitespace">    </span><span class="mi">264</span><span class="s2"> </span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/joblib/parallel.py</span> in <span class="ni">&lt;listcomp&gt;</span><span class="nt">(.0)</span>
<span class="g g-Whitespace">    </span><span class="mi">260</span><span class="s2">         # change the default number of processes to -1</span>
<span class="g g-Whitespace">    </span><span class="mi">261</span><span class="s2">         with parallel_backend(self._backend, n_jobs=self._n_jobs):</span>
<span class="ne">--&gt; </span><span class="mi">262</span><span class="s2">             return [func(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">263</span><span class="s2">                     for func, args, kwargs in self.items]</span>
<span class="g g-Whitespace">    </span><span class="mi">264</span><span class="s2"> </span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/utils/fixes.py</span> in <span class="ni">__call__</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">220</span><span class="s2">     def __call__(self, *args, **kwargs):</span>
<span class="g g-Whitespace">    </span><span class="mi">221</span><span class="s2">         with config_context(**self.config):</span>
<span class="ne">--&gt; </span><span class="mi">222</span><span class="s2">             return self.function(*args, **kwargs)</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/model_selection/_validation.py</span> in <span class="ni">_fit_and_score</span><span class="nt">(estimator, X, y, scorer, train, test, verbose, parameters, fit_params, return_train_score, return_parameters, return_n_test_samples, return_times, return_estimator, split_progress, candidate_progress, error_score)</span>
<span class="g g-Whitespace">    </span><span class="mi">626</span><span class="s2">         score_time = time.time() - start_time - fit_time</span>
<span class="g g-Whitespace">    </span><span class="mi">627</span><span class="s2">         if return_train_score:</span>
<span class="ne">--&gt; </span><span class="mi">628</span><span class="s2">             train_scores = _score(</span>
<span class="g g-Whitespace">    </span><span class="mi">629</span><span class="s2">                 estimator, X_train, y_train, scorer, error_score</span>
<span class="g g-Whitespace">    </span><span class="mi">630</span><span class="s2">             )</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/model_selection/_validation.py</span> in <span class="ni">_score</span><span class="nt">(estimator, X_test, y_test, scorer, error_score)</span>
<span class="g g-Whitespace">    </span><span class="mi">685</span><span class="s2">             scores = scorer(estimator, X_test)</span>
<span class="g g-Whitespace">    </span><span class="mi">686</span><span class="s2">         else:</span>
<span class="ne">--&gt; </span><span class="mi">687</span><span class="s2">             scores = scorer(estimator, X_test, y_test)</span>
<span class="g g-Whitespace">    </span><span class="mi">688</span><span class="s2">     except Exception:</span>
<span class="g g-Whitespace">    </span><span class="mi">689</span><span class="s2">         if error_score == &#39;raise&#39;:</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/metrics/_scorer.py</span> in <span class="ni">_passthrough_scorer</span><span class="nt">(estimator, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">395</span><span class="s2"> def _passthrough_scorer(estimator, *args, **kwargs):</span>
<span class="g g-Whitespace">    </span><span class="mi">396</span><span class="s2">     &quot;&quot;&quot;</span><span class="n">Function</span> <span class="n">that</span> <span class="n">wraps</span> <span class="n">estimator</span><span class="o">.</span><span class="n">score</span><span class="s2">&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">397</span><span class="s2">     return estimator.score(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">398</span><span class="s2"> </span>
<span class="g g-Whitespace">    </span><span class="mi">399</span><span class="s2"> </span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/utils/metaestimators.py</span> in <span class="ni">&lt;lambda&gt;</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">118</span><span class="s2"> </span>
<span class="g g-Whitespace">    </span><span class="mi">119</span><span class="s2">         # lambda, but not partial, allows help() to work with update_wrapper</span>
<span class="ne">--&gt; </span><span class="mi">120</span><span class="s2">         out = lambda *args, **kwargs: self.fn(obj, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">121</span><span class="s2">         # update the docstring of the returned function</span>
<span class="g g-Whitespace">    </span><span class="mi">122</span><span class="s2">         update_wrapper(out, self.fn)</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/pipeline.py</span> in <span class="ni">score</span><span class="nt">(self, X, y, sample_weight)</span>
<span class="g g-Whitespace">    </span><span class="mi">620</span><span class="s2">         if sample_weight is not None:</span>
<span class="g g-Whitespace">    </span><span class="mi">621</span><span class="s2">             score_params[&#39;sample_weight&#39;] = sample_weight</span>
<span class="ne">--&gt; </span><span class="mi">622</span><span class="s2">         return self.steps[-1][-1].score(Xt, y, **score_params)</span>
<span class="g g-Whitespace">    </span><span class="mi">623</span><span class="s2"> </span>
<span class="g g-Whitespace">    </span><span class="mi">624</span><span class="s2">     @property</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/base.py</span> in <span class="ni">score</span><span class="nt">(self, X, y, sample_weight)</span>
<span class="g g-Whitespace">    </span><span class="mi">551</span><span class="s2"> </span>
<span class="g g-Whitespace">    </span><span class="mi">552</span><span class="s2">         from .metrics import r2_score</span>
<span class="ne">--&gt; </span><span class="mi">553</span><span class="s2">         y_pred = self.predict(X)</span>
<span class="g g-Whitespace">    </span><span class="mi">554</span><span class="s2">         return r2_score(y, y_pred, sample_weight=sample_weight)</span>
<span class="g g-Whitespace">    </span><span class="mi">555</span><span class="s2"> </span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/svm/_base.py</span> in <span class="ni">predict</span><span class="nt">(self, X)</span>
<span class="g g-Whitespace">    </span><span class="mi">342</span><span class="s2">         X = self._validate_for_predict(X)</span>
<span class="g g-Whitespace">    </span><span class="mi">343</span><span class="s2">         predict = self._sparse_predict if self._sparse else self._dense_predict</span>
<span class="ne">--&gt; </span><span class="mi">344</span><span class="s2">         return predict(X)</span>
<span class="g g-Whitespace">    </span><span class="mi">345</span><span class="s2"> </span>
<span class="g g-Whitespace">    </span><span class="mi">346</span><span class="s2">     def _dense_predict(self, X):</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/sklearn/svm/_base.py</span> in <span class="ni">_dense_predict</span><span class="nt">(self, X)</span>
<span class="g g-Whitespace">    </span><span class="mi">359</span><span class="s2">         svm_type = LIBSVM_IMPL.index(self._impl)</span>
<span class="g g-Whitespace">    </span><span class="mi">360</span><span class="s2"> </span>
<span class="ne">--&gt; </span><span class="mi">361</span><span class="s2">         return libsvm.predict(</span>
<span class="g g-Whitespace">    </span><span class="mi">362</span><span class="s2">             X, self.support_, self.support_vectors_, self._n_support,</span>
<span class="g g-Whitespace">    </span><span class="mi">363</span><span class="s2">             self._dual_coef_, self._intercept_,</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_dict</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>dummy</th>
      <td>0.001 (+/- 0.000)</td>
      <td>0.000 (+/- 0.000)</td>
      <td>-0.001 (+/- 0.001)</td>
      <td>0.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>imp + scaling + ohe + KNN</th>
      <td>0.021 (+/- 0.001)</td>
      <td>0.765 (+/- 0.072)</td>
      <td>0.721 (+/- 0.012)</td>
      <td>0.816 (+/- 0.006)</td>
    </tr>
    <tr>
      <th>imp + scaling + ohe + SVR (default)</th>
      <td>8.218 (+/- 0.029)</td>
      <td>4.313 (+/- 0.041)</td>
      <td>-0.049 (+/- 0.012)</td>
      <td>-0.049 (+/- 0.001)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The results with <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>’s default SVR hyperparameters are pretty bad.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">svr_C_pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">SVR</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="mi">10000</span><span class="p">))</span>
<span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;imp + scaling + ohe + SVR (C=10000)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">svr_C_pipe</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_dict</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>dummy</th>
      <td>0.001 (+/- 0.000)</td>
      <td>0.000 (+/- 0.000)</td>
      <td>-0.001 (+/- 0.001)</td>
      <td>0.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>imp + scaling + ohe + KNN</th>
      <td>0.021 (+/- 0.001)</td>
      <td>0.765 (+/- 0.072)</td>
      <td>0.721 (+/- 0.012)</td>
      <td>0.816 (+/- 0.006)</td>
    </tr>
    <tr>
      <th>imp + scaling + ohe + SVR (default)</th>
      <td>8.218 (+/- 0.029)</td>
      <td>4.313 (+/- 0.041)</td>
      <td>-0.049 (+/- 0.012)</td>
      <td>-0.049 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>imp + scaling + ohe + SVR (C=10000)</th>
      <td>7.581 (+/- 0.049)</td>
      <td>4.332 (+/- 0.011)</td>
      <td>0.721 (+/- 0.007)</td>
      <td>0.726 (+/- 0.007)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>With a bigger value for <code class="docutils literal notranslate"><span class="pre">C</span></code> the results are much better. We need to carry out systematic hyperparameter optimization to get better results. (Coming up next week.)</p>
<ul class="simple">
<li><p>Note that categorical features are different than free text features. Sometimes there are columns containing free text information and we we’ll look at ways to deal with them in the later part of this lecture.</p></li>
</ul>
<div class="section" id="ohe-with-many-categories">
<h3>OHE with many categories<a class="headerlink" href="#ohe-with-many-categories" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Do we have enough data for rare categories to learn anything meaningful?</p></li>
<li><p>How about grouping them into bigger categories?</p>
<ul>
<li><p>Example: country names into continents such as “South America” or “Asia”</p></li>
</ul>
</li>
<li><p>Or having “other” category for rare cases?</p></li>
</ul>
</div>
<div class="section" id="do-we-actually-want-to-use-certain-features-for-prediction">
<h3>Do we actually want to use certain features for prediction?<a class="headerlink" href="#do-we-actually-want-to-use-certain-features-for-prediction" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Do you want to use certain features such as <strong>gender</strong> or <strong>race</strong> in prediction?</p></li>
<li><p>Remember that the systems you build are going to be used in some applications.</p></li>
<li><p>It’s extremely important to be mindful of the consequences of including certain features in your predictive model.</p></li>
</ul>
</div>
<div class="section" id="preprocessing-the-targets">
<h3>Preprocessing the targets?<a class="headerlink" href="#preprocessing-the-targets" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Generally no need for this when doing classification.</p></li>
<li><p>In regression it makes sense in some cases. More on this later.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sklearn</span></code> is fine with categorical labels (<span class="math notranslate nohighlight">\(y\)</span>-values) for classification problems.</p></li>
</ul>
</div>
<div class="section" id="id1">
<h3>❓❓ Questions for you<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="section" id="true-false-categorical-features">
<h4>True/False: Categorical features<a class="headerlink" href="#true-false-categorical-features" title="Permalink to this headline">¶</a></h4>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">handle_unknown=&quot;ignore&quot;</span></code> would treat all unknown categories equally.</p></li>
<li><p>Creating groups of rarely occurring categories might overfit the model.</p></li>
</ol>
<p><br><br><br><br></p>
</div>
</div>
</div>
<div class="section" id="encoding-text-data">
<h2>Encoding text data<a class="headerlink" href="#encoding-text-data" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">toy_spam</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span>
        <span class="s2">&quot;URGENT!! As a valued network customer you have been selected to receive a £900 prize reward!&quot;</span><span class="p">,</span>
        <span class="s2">&quot;spam&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;Lol you are always so convincing.&quot;</span><span class="p">,</span> <span class="s2">&quot;non spam&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;Nah I don&#39;t think he goes to usf, he lives around here though&quot;</span><span class="p">,</span> <span class="s2">&quot;non spam&quot;</span><span class="p">],</span>
    <span class="p">[</span>
        <span class="s2">&quot;URGENT! You have won a 1 week FREE membership in our £100000 prize Jackpot!&quot;</span><span class="p">,</span>
        <span class="s2">&quot;spam&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="p">[</span>
        <span class="s2">&quot;Had your mobile 11 months or more? U R entitled to Update to the latest colour mobiles with camera for Free! Call The Mobile Update Co FREE on 08002986030&quot;</span><span class="p">,</span>
        <span class="s2">&quot;spam&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;Congrats! I can&#39;t wait to see you!!&quot;</span><span class="p">,</span> <span class="s2">&quot;non spam&quot;</span><span class="p">],</span>
<span class="p">]</span>
<span class="n">toy_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">toy_spam</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sms&quot;</span><span class="p">,</span> <span class="s2">&quot;target&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="spam-non-spam-toy-example">
<h3>Spam/non spam toy example<a class="headerlink" href="#spam-non-spam-toy-example" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>What if the feature is in the form of raw text?</p></li>
<li><p>The feature <code class="docutils literal notranslate"><span class="pre">sms</span></code> below is neither categorical nor ordinal.</p></li>
<li><p>How can we encode it so that we can pass it to the machine learning algorithms we have seen so far?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">toy_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sms</th>
      <th>target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>URGENT!! As a valued network customer you have been selected to receive a £900 prize reward!</td>
      <td>spam</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Lol you are always so convincing.</td>
      <td>non spam</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Nah I don't think he goes to usf, he lives around here though</td>
      <td>non spam</td>
    </tr>
    <tr>
      <th>3</th>
      <td>URGENT! You have won a 1 week FREE membership in our £100000 prize Jackpot!</td>
      <td>spam</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Had your mobile 11 months or more? U R entitled to Update to the latest colour mobiles with camera for Free! Call The Mobile Update Co FREE on 08002986030</td>
      <td>spam</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Congrats! I can't wait to see you!!</td>
      <td>non spam</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="what-if-we-apply-ohe">
<h3>What if we apply OHE?<a class="headerlink" href="#what-if-we-apply-ohe" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### DO NOT DO THIS.</span>
<span class="n">enc</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">transformed</span> <span class="o">=</span> <span class="n">enc</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">toy_df</span><span class="p">[[</span><span class="s2">&quot;sms&quot;</span><span class="p">]])</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">transformed</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">enc</span><span class="o">.</span><span class="n">categories_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>Congrats! I can't wait to see you!!</th>
      <th>Had your mobile 11 months or more? U R entitled to Update to the latest colour mobiles with camera for Free! Call The Mobile Update Co FREE on 08002986030</th>
      <th>Lol you are always so convincing.</th>
      <th>Nah I don't think he goes to usf, he lives around here though</th>
      <th>URGENT! You have won a 1 week FREE membership in our £100000 prize Jackpot!</th>
      <th>URGENT!! As a valued network customer you have been selected to receive a £900 prize reward!</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>We do not have a fixed number of categories here.</p></li>
<li><p>Each “category” (feature value) is likely to occur only once in the training data and we won’t learn anything meaningful if we apply one-hot encoding or ordinal encoding on this feature.</p></li>
</ul>
<ul class="simple">
<li><p>How can we encode or represent raw text data into fixed number of features so that we can learn some useful patterns from it?</p></li>
<li><p>This is a well studied problem in the field of Natural Language Processing (NLP), which is concerned with giving computers the ability to understand written and spoken language.</p></li>
<li><p>Some popular representations of raw text include:</p>
<ul>
<li><p><strong>Bag of words</strong></p></li>
<li><p>TF-IDF</p></li>
<li><p>Embedding representations</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="bag-of-words-bow-representation">
<h3>Bag of words (BOW) representation<a class="headerlink" href="#bag-of-words-bow-representation" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>One of the most popular representation of raw text</p></li>
<li><p>Ignores the syntax and word order</p></li>
<li><p>It has two components:</p>
<ul>
<li><p>The vocabulary (all unique words in all documents)</p></li>
<li><p>A value indicating either the presence or absence or the count of each word in the document.</p></li>
</ul>
</li>
</ul>
<center>
<img src='./img/bag-of-words.png' width="600">
</center>
<p><a class="reference external" href="https://web.stanford.edu/~jurafsky/slp3/4.pdf">Source</a></p>
</div>
<div class="section" id="extracting-bow-features-using-scikit-learn">
<h3>Extracting BOW features using <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code><a class="headerlink" href="#extracting-bow-features-using-scikit-learn" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CountVectorizer</span></code></p>
<ul>
<li><p>Converts a collection of text documents to a matrix of word counts.</p></li>
<li><p>Each row represents a “document” (e.g., a text message in our example).</p></li>
<li><p>Each column represents a word in the vocabulary (the set of unique words) in the training data.</p></li>
<li><p>Each cell represents how often the word occurs in the document.</p></li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the Natural Language Processing (NLP) community text data  is referred to as a <strong>corpus</strong> (plural: corpora). ```</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>

<span class="n">vec</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">()</span>
<span class="n">X_counts</span> <span class="o">=</span> <span class="n">vec</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">toy_df</span><span class="p">[</span><span class="s2">&quot;sms&quot;</span><span class="p">])</span>
<span class="n">bow_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">X_counts</span><span class="o">.</span><span class="n">toarray</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="n">vec</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">toy_df</span><span class="p">[</span><span class="s2">&quot;sms&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">bow_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>08002986030</th>
      <th>100000</th>
      <th>11</th>
      <th>900</th>
      <th>always</th>
      <th>are</th>
      <th>around</th>
      <th>as</th>
      <th>been</th>
      <th>call</th>
      <th>...</th>
      <th>update</th>
      <th>urgent</th>
      <th>usf</th>
      <th>valued</th>
      <th>wait</th>
      <th>week</th>
      <th>with</th>
      <th>won</th>
      <th>you</th>
      <th>your</th>
    </tr>
    <tr>
      <th>sms</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>URGENT!! As a valued network customer you have been selected to receive a £900 prize reward!</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Lol you are always so convincing.</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Nah I don't think he goes to usf, he lives around here though</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>URGENT! You have won a 1 week FREE membership in our £100000 prize Jackpot!</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Had your mobile 11 months or more? U R entitled to Update to the latest colour mobiles with camera for Free! Call The Mobile Update Co FREE on 08002986030</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>Congrats! I can't wait to see you!!</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>6 rows × 61 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">toy_df</span><span class="p">[</span><span class="s2">&quot;sms&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pandas.core.series.Series
</pre></div>
</div>
</div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Note that unlike other transformers we are passing a <code class="docutils literal notranslate"><span class="pre">Series</span></code> object to <code class="docutils literal notranslate"><span class="pre">fit_transform</span></code>. For other transformers, you can define one transformer for more than one columns. But with <code class="docutils literal notranslate"><span class="pre">CountVectorizer</span></code> you need to define separate <code class="docutils literal notranslate"><span class="pre">CountVectorizer</span></code> transformers for each text column, if you have more than one text columns.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_counts</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;6x61 sparse matrix of type &#39;&lt;class &#39;numpy.int64&#39;&gt;&#39;
	with 71 stored elements in Compressed Sparse Row format&gt;
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="why-sparse-matrices">
<h3>Why sparse matrices?<a class="headerlink" href="#why-sparse-matrices" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Most words do not appear in a given document.</p></li>
<li><p>We get massive computational savings if we only store the nonzero elements.</p></li>
<li><p>There is a bit of overhead, because we also need to store the locations:</p>
<ul>
<li><p>e.g. “location (3,27): 1”.</p></li>
</ul>
</li>
<li><p>However, if the fraction of nonzero is small, this is a huge win.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The total number of elements: &quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">X_counts</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The number of non-zero elements: &quot;</span><span class="p">,</span> <span class="n">X_counts</span><span class="o">.</span><span class="n">nnz</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Proportion of non-zero elements: </span><span class="si">%0.4f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">X_counts</span><span class="o">.</span><span class="n">nnz</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">X_counts</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;The value at cell 3,</span><span class="si">%d</span><span class="s2"> is: </span><span class="si">%d</span><span class="s2">&quot;</span>
    <span class="o">%</span> <span class="p">(</span><span class="n">vec</span><span class="o">.</span><span class="n">vocabulary_</span><span class="p">[</span><span class="s2">&quot;jackpot&quot;</span><span class="p">],</span> <span class="n">X_counts</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="n">vec</span><span class="o">.</span><span class="n">vocabulary_</span><span class="p">[</span><span class="s2">&quot;jackpot&quot;</span><span class="p">]])</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The total number of elements:  366
The number of non-zero elements:  71
Proportion of non-zero elements: 0.1940
The value at cell 3,27 is: 1
</pre></div>
</div>
</div>
</div>
<p>Question for you</p>
<ul class="simple">
<li><p>What would happen if you apply <code class="docutils literal notranslate"><span class="pre">StandardScaler</span></code> on sparse data?</p></li>
</ul>
</div>
<div class="section" id="onehotencoder-and-sparse-features">
<h3><code class="docutils literal notranslate"><span class="pre">OneHotEncoder</span></code> and sparse features<a class="headerlink" href="#onehotencoder-and-sparse-features" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>By default, <code class="docutils literal notranslate"><span class="pre">OneHotEncoder</span></code> also creates sparse features.</p></li>
<li><p>You could set <code class="docutils literal notranslate"><span class="pre">sparse=False</span></code> to get a regular <code class="docutils literal notranslate"><span class="pre">numpy</span></code> array.</p></li>
<li><p>If there are a huge number of categories, it may be beneficial to keep them sparse.</p></li>
<li><p>For smaller number of categories, it doesn’t matter much.</p></li>
</ul>
</div>
<div class="section" id="important-hyperparameters-of-countvectorizer">
<h3>Important hyperparameters of <code class="docutils literal notranslate"><span class="pre">CountVectorizer</span></code><a class="headerlink" href="#important-hyperparameters-of-countvectorizer" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">binary</span></code></p>
<ul>
<li><p>whether to use absence/presence feature values or counts</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_features</span></code></p>
<ul>
<li><p>only consider top <code class="docutils literal notranslate"><span class="pre">max_features</span></code> ordered by frequency in the corpus</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_df</span></code></p>
<ul>
<li><p>ignore features which occur in more than <code class="docutils literal notranslate"><span class="pre">max_df</span></code> documents</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">min_df</span></code></p>
<ul>
<li><p>ignore features which occur in less than <code class="docutils literal notranslate"><span class="pre">min_df</span></code> documents</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ngram_range</span></code></p>
<ul>
<li><p>consider word sequences in the given range</p></li>
</ul>
</li>
</ul>
<p>Let’s look at all features, i.e., words (along with their frequencies).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vec</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">()</span>
<span class="n">X_counts</span> <span class="o">=</span> <span class="n">vec</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">toy_df</span><span class="p">[</span><span class="s2">&quot;sms&quot;</span><span class="p">])</span>
<span class="n">bow_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">X_counts</span><span class="o">.</span><span class="n">toarray</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="n">vec</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">toy_df</span><span class="p">[</span><span class="s2">&quot;sms&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">bow_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>08002986030</th>
      <th>100000</th>
      <th>11</th>
      <th>900</th>
      <th>always</th>
      <th>are</th>
      <th>around</th>
      <th>as</th>
      <th>been</th>
      <th>call</th>
      <th>...</th>
      <th>update</th>
      <th>urgent</th>
      <th>usf</th>
      <th>valued</th>
      <th>wait</th>
      <th>week</th>
      <th>with</th>
      <th>won</th>
      <th>you</th>
      <th>your</th>
    </tr>
    <tr>
      <th>sms</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>URGENT!! As a valued network customer you have been selected to receive a £900 prize reward!</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Lol you are always so convincing.</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Nah I don't think he goes to usf, he lives around here though</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>URGENT! You have won a 1 week FREE membership in our £100000 prize Jackpot!</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Had your mobile 11 months or more? U R entitled to Update to the latest colour mobiles with camera for Free! Call The Mobile Update Co FREE on 08002986030</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>Congrats! I can't wait to see you!!</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>6 rows × 61 columns</p>
</div></div></div>
</div>
<p>When we use <code class="docutils literal notranslate"><span class="pre">binary=True</span></code>, the representation uses presence/absence of words instead of word counts.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vec_binary</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">binary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">X_counts</span> <span class="o">=</span> <span class="n">vec_binary</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">toy_df</span><span class="p">[</span><span class="s2">&quot;sms&quot;</span><span class="p">])</span>
<span class="n">bow_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">X_counts</span><span class="o">.</span><span class="n">toarray</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="n">vec_binary</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">toy_df</span><span class="p">[</span><span class="s2">&quot;sms&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">bow_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>08002986030</th>
      <th>100000</th>
      <th>11</th>
      <th>900</th>
      <th>always</th>
      <th>are</th>
      <th>around</th>
      <th>as</th>
      <th>been</th>
      <th>call</th>
      <th>...</th>
      <th>update</th>
      <th>urgent</th>
      <th>usf</th>
      <th>valued</th>
      <th>wait</th>
      <th>week</th>
      <th>with</th>
      <th>won</th>
      <th>you</th>
      <th>your</th>
    </tr>
    <tr>
      <th>sms</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>URGENT!! As a valued network customer you have been selected to receive a £900 prize reward!</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Lol you are always so convincing.</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Nah I don't think he goes to usf, he lives around here though</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>URGENT! You have won a 1 week FREE membership in our £100000 prize Jackpot!</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Had your mobile 11 months or more? U R entitled to Update to the latest colour mobiles with camera for Free! Call The Mobile Update Co FREE on 08002986030</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>Congrats! I can't wait to see you!!</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>6 rows × 61 columns</p>
</div></div></div>
</div>
<p>We can control the size of X (the number of features) using <code class="docutils literal notranslate"><span class="pre">max_features</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vec8</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">max_features</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">X_counts</span> <span class="o">=</span> <span class="n">vec8</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">toy_df</span><span class="p">[</span><span class="s2">&quot;sms&quot;</span><span class="p">])</span>
<span class="n">bow_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">X_counts</span><span class="o">.</span><span class="n">toarray</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="n">vec8</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">toy_df</span><span class="p">[</span><span class="s2">&quot;sms&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">bow_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>free</th>
      <th>have</th>
      <th>mobile</th>
      <th>the</th>
      <th>to</th>
      <th>update</th>
      <th>urgent</th>
      <th>you</th>
    </tr>
    <tr>
      <th>sms</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>URGENT!! As a valued network customer you have been selected to receive a £900 prize reward!</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>Lol you are always so convincing.</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>Nah I don't think he goes to usf, he lives around here though</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>URGENT! You have won a 1 week FREE membership in our £100000 prize Jackpot!</th>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>Had your mobile 11 months or more? U R entitled to Update to the latest colour mobiles with camera for Free! Call The Mobile Update Co FREE on 08002986030</th>
      <td>2</td>
      <td>0</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Congrats! I can't wait to see you!!</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Notice that <code class="docutils literal notranslate"><span class="pre">vec8</span></code> and <code class="docutils literal notranslate"><span class="pre">vec8_binary</span></code> have different vocabularies, which is kind of unexpected behaviour and doesn’t match the documentation of <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>.</p>
<p><a class="reference external" href="https://github.com/scikit-learn/scikit-learn/blob/master/sklearn/feature_extraction/text.py#L1206-L1225">Here</a> is the code for <code class="docutils literal notranslate"><span class="pre">binary=True</span></code> condition in <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>. As we can see, the binarization is done before limiting the features to <code class="docutils literal notranslate"><span class="pre">max_features</span></code>, and so now we are actually looking at the document counts (in how many documents it occurs) rather than term count. This is not explained anywhere in the documentation.</p>
<p>The ties in counts between different words makes it even more confusing. I don’t think it’ll have a big impact on the results but this is good to know! Remember that <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code> developers are also humans who are prone to make mistakes. So it’s always a good habit to question whatever tools we use every now and then.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vec8</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">max_features</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">X_counts</span> <span class="o">=</span> <span class="n">vec8</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">toy_df</span><span class="p">[</span><span class="s2">&quot;sms&quot;</span><span class="p">])</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">X_counts</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">index</span><span class="o">=</span><span class="n">vec8</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">(),</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;counts&quot;</span><span class="p">],</span>
<span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;counts&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>counts</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>to</th>
      <td>5</td>
    </tr>
    <tr>
      <th>you</th>
      <td>4</td>
    </tr>
    <tr>
      <th>free</th>
      <td>3</td>
    </tr>
    <tr>
      <th>have</th>
      <td>2</td>
    </tr>
    <tr>
      <th>mobile</th>
      <td>2</td>
    </tr>
    <tr>
      <th>the</th>
      <td>2</td>
    </tr>
    <tr>
      <th>update</th>
      <td>2</td>
    </tr>
    <tr>
      <th>urgent</th>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vec8_binary</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">binary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">X_counts</span> <span class="o">=</span> <span class="n">vec8_binary</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">toy_df</span><span class="p">[</span><span class="s2">&quot;sms&quot;</span><span class="p">])</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">X_counts</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">index</span><span class="o">=</span><span class="n">vec8_binary</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">(),</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;counts&quot;</span><span class="p">],</span>
<span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;counts&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>counts</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>to</th>
      <td>4</td>
    </tr>
    <tr>
      <th>you</th>
      <td>4</td>
    </tr>
    <tr>
      <th>free</th>
      <td>2</td>
    </tr>
    <tr>
      <th>have</th>
      <td>2</td>
    </tr>
    <tr>
      <th>prize</th>
      <td>2</td>
    </tr>
    <tr>
      <th>urgent</th>
      <td>2</td>
    </tr>
    <tr>
      <th>mobiles</th>
      <td>1</td>
    </tr>
    <tr>
      <th>months</th>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="preprocessing">
<h3>Preprocessing<a class="headerlink" href="#preprocessing" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Note that <code class="docutils literal notranslate"><span class="pre">CountVectorizer</span></code> is carrying out some preprocessing such as because of the default argument values</p>
<ul>
<li><p>Converting words to lowercase (<code class="docutils literal notranslate"><span class="pre">lowercase=True</span></code>)</p></li>
<li><p>getting rid of punctuation and special characters (<code class="docutils literal notranslate"><span class="pre">token_pattern</span> <span class="pre">='(?u)\\b\\w\\w+\\b'</span></code>)</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">CountVectorizer</span><span class="p">(),</span> <span class="n">SVC</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">toy_df</span><span class="p">[</span><span class="s2">&quot;sms&quot;</span><span class="p">],</span> <span class="n">toy_df</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-10221f93-aa41-41c5-95a8-b55672ccb2a4 {color: black;background-color: white;}#sk-10221f93-aa41-41c5-95a8-b55672ccb2a4 pre{padding: 0;}#sk-10221f93-aa41-41c5-95a8-b55672ccb2a4 div.sk-toggleable {background-color: white;}#sk-10221f93-aa41-41c5-95a8-b55672ccb2a4 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}#sk-10221f93-aa41-41c5-95a8-b55672ccb2a4 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-10221f93-aa41-41c5-95a8-b55672ccb2a4 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-10221f93-aa41-41c5-95a8-b55672ccb2a4 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-10221f93-aa41-41c5-95a8-b55672ccb2a4 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-10221f93-aa41-41c5-95a8-b55672ccb2a4 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-10221f93-aa41-41c5-95a8-b55672ccb2a4 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-10221f93-aa41-41c5-95a8-b55672ccb2a4 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}#sk-10221f93-aa41-41c5-95a8-b55672ccb2a4 div.sk-estimator:hover {background-color: #d4ebff;}#sk-10221f93-aa41-41c5-95a8-b55672ccb2a4 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-10221f93-aa41-41c5-95a8-b55672ccb2a4 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-10221f93-aa41-41c5-95a8-b55672ccb2a4 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-10221f93-aa41-41c5-95a8-b55672ccb2a4 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}#sk-10221f93-aa41-41c5-95a8-b55672ccb2a4 div.sk-item {z-index: 1;}#sk-10221f93-aa41-41c5-95a8-b55672ccb2a4 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-10221f93-aa41-41c5-95a8-b55672ccb2a4 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-10221f93-aa41-41c5-95a8-b55672ccb2a4 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-10221f93-aa41-41c5-95a8-b55672ccb2a4 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-10221f93-aa41-41c5-95a8-b55672ccb2a4 div.sk-parallel-item:only-child::after {width: 0;}#sk-10221f93-aa41-41c5-95a8-b55672ccb2a4 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}#sk-10221f93-aa41-41c5-95a8-b55672ccb2a4 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-10221f93-aa41-41c5-95a8-b55672ccb2a4 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-10221f93-aa41-41c5-95a8-b55672ccb2a4 div.sk-container {display: inline-block;position: relative;}</style><div id="sk-10221f93-aa41-41c5-95a8-b55672ccb2a4" class"sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="3b3bb630-2c0e-4d2c-a788-901b1467dd35" type="checkbox" ><label class="sk-toggleable__label" for="3b3bb630-2c0e-4d2c-a788-901b1467dd35">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('countvectorizer', CountVectorizer()), ('svc', SVC())])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="25d6190a-9a25-4ec2-88ca-8dcb0bf87226" type="checkbox" ><label class="sk-toggleable__label" for="25d6190a-9a25-4ec2-88ca-8dcb0bf87226">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="1fd55e6f-a4da-49d7-9675-5b873db773b5" type="checkbox" ><label class="sk-toggleable__label" for="1fd55e6f-a4da-49d7-9675-5b873db773b5">SVC</label><div class="sk-toggleable__content"><pre>SVC()</pre></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">toy_df</span><span class="p">[</span><span class="s2">&quot;sms&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;spam&#39;, &#39;non spam&#39;, &#39;non spam&#39;, &#39;spam&#39;, &#39;spam&#39;, &#39;non spam&#39;],
      dtype=object)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="is-this-a-realistic-representation-of-text-data">
<h3>Is this a realistic representation of text data?<a class="headerlink" href="#is-this-a-realistic-representation-of-text-data" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Of course this is not a great representation of language</p>
<ul>
<li><p>We are throwing out everything we know about language and losing a lot of information.</p></li>
<li><p>It assumes that there is no syntax and compositional meaning in language.</p></li>
</ul>
</li>
<li><p>But it works surprisingly well for many tasks.</p></li>
<li><p>We will learn more expressive representations in the coming weeks.</p></li>
</ul>
<p><br><br></p>
</div>
<div class="section" id="id2">
<h3>❓❓ Questions for you<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="section" id="countvectorizer-true-or-false">
<h4><code class="docutils literal notranslate"><span class="pre">CountVectorizer</span></code>: True or False<a class="headerlink" href="#countvectorizer-true-or-false" title="Permalink to this headline">¶</a></h4>
<ol class="simple">
<li><p>As you increase the value for <code class="docutils literal notranslate"><span class="pre">max_features</span></code> hyperparameter of <code class="docutils literal notranslate"><span class="pre">CountVectorizer</span></code> the training score is likely to go up.</p></li>
<li><p>Suppose you are encoding text data using <code class="docutils literal notranslate"><span class="pre">CountVectorizer</span></code>. If you encounter a word in the validation or the test split that’s not available in the training data, we’ll get an error.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_df</span></code> hyperparameter of <code class="docutils literal notranslate"><span class="pre">CountVectorizer</span></code> can be used to get rid of most frequently occurring words from the dictionary.</p></li>
<li><p>In the code below, inside <code class="docutils literal notranslate"><span class="pre">cross_validate</span></code>, each fold might have slightly different number of features (columns) in the fold.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="p">(</span><span class="n">CountVectorizer</span><span class="p">(),</span> <span class="n">SVC</span><span class="p">())</span>
<span class="n">cross_validate</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="identify-column-transformations">
<h4>Identify column transformations<a class="headerlink" href="#identify-column-transformations" title="Permalink to this headline">¶</a></h4>
<p>Consider the restaurant data from the survey you did a few weeks ago.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">restaurant_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/cleaned_restaurant_data.csv&quot;</span><span class="p">)</span>
<span class="n">restaurant_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>north_america</th>
      <th>eat_out_freq</th>
      <th>age</th>
      <th>n_people</th>
      <th>price</th>
      <th>food_type</th>
      <th>noise_level</th>
      <th>good_server</th>
      <th>comments</th>
      <th>restaurant_name</th>
      <th>target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Yes</td>
      <td>3.0</td>
      <td>29</td>
      <td>20</td>
      <td>10</td>
      <td>Other</td>
      <td>no music</td>
      <td>Yes</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>like</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Yes</td>
      <td>2.0</td>
      <td>23</td>
      <td>10</td>
      <td>20</td>
      <td>Chinese</td>
      <td>low</td>
      <td>Yes</td>
      <td>food tastes good</td>
      <td>Midam</td>
      <td>like</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Yes</td>
      <td>2.0</td>
      <td>21</td>
      <td>10</td>
      <td>40</td>
      <td>Other</td>
      <td>low</td>
      <td>Yes</td>
      <td>good food</td>
      <td>pear tree</td>
      <td>like</td>
    </tr>
    <tr>
      <th>3</th>
      <td>No</td>
      <td>2.0</td>
      <td>24</td>
      <td>15</td>
      <td>40</td>
      <td>Other</td>
      <td>medium</td>
      <td>Yes</td>
      <td>My love for Korean food</td>
      <td>Dami</td>
      <td>like</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Yes</td>
      <td>5.0</td>
      <td>23</td>
      <td>20</td>
      <td>10</td>
      <td>Canadian/American</td>
      <td>low</td>
      <td>Yes</td>
      <td>Good food</td>
      <td>NaN</td>
      <td>like</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Yes</td>
      <td>2.0</td>
      <td>22</td>
      <td>60</td>
      <td>20</td>
      <td>Chinese</td>
      <td>medium</td>
      <td>Yes</td>
      <td>food tasted great!</td>
      <td>NaN</td>
      <td>like</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Yes</td>
      <td>2.0</td>
      <td>23</td>
      <td>10000000</td>
      <td>1000000</td>
      <td>Canadian/American</td>
      <td>crazy loud</td>
      <td>Yes</td>
      <td>NaN</td>
      <td>CACTUS CLUB CAFE</td>
      <td>like</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Yes</td>
      <td>4.0</td>
      <td>20</td>
      <td>20</td>
      <td>40</td>
      <td>Chinese</td>
      <td>high</td>
      <td>Yes</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>like</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Yes</td>
      <td>1.0</td>
      <td>21</td>
      <td>40</td>
      <td>60</td>
      <td>Italian</td>
      <td>high</td>
      <td>Yes</td>
      <td>NaN</td>
      <td>Frankie’s</td>
      <td>like</td>
    </tr>
    <tr>
      <th>9</th>
      <td>No</td>
      <td>2.0</td>
      <td>20</td>
      <td>50</td>
      <td>45</td>
      <td>Canadian/American</td>
      <td>medium</td>
      <td>Yes</td>
      <td>Steak was good, ambiance was nice and server was helpful.</td>
      <td>Hy's steakhouse</td>
      <td>like</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>What all feature transformations you would apply on this dataset?</p>
<p><br><br><br><br></p>
</div>
</div>
</div>
<div class="section" id="what-did-we-learn-today">
<h2>What did we learn today?<a class="headerlink" href="#what-did-we-learn-today" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Motivation to use <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code> syntax</p></li>
<li><p>Defining transformers with multiple transformations</p></li>
<li><p>How to visualize transformed features in a dataframe</p></li>
<li><p>More on ordinal features</p></li>
<li><p>Different arguments <code class="docutils literal notranslate"><span class="pre">OneHotEncoder</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">handle_unknow=&quot;ignore&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">if_binary</span></code></p></li>
</ul>
</li>
<li><p>Dealing with text features</p>
<ul>
<li><p>Bag of words representation: <code class="docutils literal notranslate"><span class="pre">CountVectorizer</span></code></p></li>
</ul>
</li>
</ul>
<p><img alt="" src="../_images/eva-talksoon.png" /></p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "conda-env-cpsc330-py"
        },
        kernelOptions: {
            kernelName: "conda-env-cpsc330-py",
            path: "./lectures"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'conda-env-cpsc330-py'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="05_preprocessing-pipelines.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Lecture 5: Preprocessing and <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> pipelines</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="07_linear-models.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Lecture 7: Linear Models</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Varada Kolhatkar<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>