
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lecture 22: Deployment and conclusion &#8212; CPSC 330 Applied Machine Learning</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Attributions" href="../attribution.html" />
    <link rel="prev" title="Lecture 21: Communication" href="21_communication.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/UBC-CS-logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">CPSC 330 Applied Machine Learning</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Things you should know
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../docs/README.html">
   CPSC 330 Documents
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Lectures
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01_intro.html">
   Lecture 1: Course Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_decision-trees.html">
   Lecture 2: Terminology, Baselines, Decision Trees
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_ml-fundamentals.html">
   Lecture 3: Machine Learning Fundamentals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_kNNs-SVM-RBF.html">
   Lecture 4:
   <span class="math notranslate nohighlight">
    \(k\)
   </span>
   -Nearest Neighbours and SVM RBFs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_preprocessing-pipelines.html">
   Lecture 5: Preprocessing and
   <code class="docutils literal notranslate">
    <span class="pre">
     sklearn
    </span>
   </code>
   pipelines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_column-transformer-text-feats.html">
   Lecture 6:
   <code class="docutils literal notranslate">
    <span class="pre">
     sklearn
    </span>
   </code>
   <code class="docutils literal notranslate">
    <span class="pre">
     ColumnTransformer
    </span>
   </code>
   and Text Features
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_linear-models.html">
   Lecture 7: Linear Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08_hyperparameter-optimization.html">
   Lecture 8: Hyperparameter Optimization and Optimization Bias
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_classification-metrics.html">
   Lecture 9: Classification Metrics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="10_regression-metrics.html">
   Lecture 10: Regression Evaluation Metrics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="11_ensembles.html">
   Lecture 11: Ensembles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="12_feat-importances.html">
   Lecture 12: Feature importances
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="13_feature-engineering-selection.html">
   Lecture 13: Feature engineering and feature selection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="14_k-means-clustering.html">
   Lecture 14: Clustering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="15_recommender-systems.html">
   Lecture 15: DBSCAN and Recommender Systems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="16_natural-language-processing.html">
   Lecture 16: Introduction to natural language processing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="17_intro_to_computer-vision.html">
   Lecture 17: Multi-class classification and introduction to computer vision
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="18_time-series.html">
   Lecture 18: Time series
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="19_survival-analysis.html">
   Lecture 19: Survival analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="20_ethics.html">
   Lecture 20: Ethics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="21_communication.html">
   Lecture 21: Communication
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Lecture 22: Deployment and conclusion
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Attribution
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../attribution.html">
   Attributions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../LICENSE.html">
   LICENSE
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Varada Kolhatkar, CPSC 330 2021-22<br>Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/lectures/22_deployment-conclusion.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/UBC-CS/cpsc330/master?urlpath=tree/lectures/22_deployment-conclusion.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports">
   Imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lecture-outline">
   Lecture outline
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#learning-objectives">
   Learning objectives
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#announcements">
   Announcements
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#final-exam">
     Final exam
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-deployment-30-min">
   Model deployment (30 min)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#attribution">
     Attribution
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#try-out-this-moment-predictor">
     Try out this moment predictor
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#what-is-deployment">
       What is deployment?
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#requirements-i-already-did-these">
       Requirements (I already did these)
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#demo-deploying-moment-classification-model">
   Demo: Deploying moment classification model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#building-a-model">
     Building a model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#training-on-the-full-corpus">
     Training on the full corpus
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#saving-the-model">
     Saving the model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#loading-our-saved-model">
     Loading our saved model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optional-setting-up-a-directory-structure-and-environment">
     (Optional) Setting up a directory structure and environment
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-deployment">
     Model deployment
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#building-and-deploying-a-web-app">
     Building and deploying a web app
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#web-app-on-local-server">
     Web app on local server
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#web-app-on-a-real-server">
     Web app on a real server
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#heroku-set-up-i-already-did-these">
     Heroku set-up (I already did these):
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#testing-the-web-application">
     Testing the web application
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#api-on-the-localhost">
     API on the localhost
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sending-a-request-to-the-api">
     Sending a request to the API
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#deploying-the-api-on-a-server">
     Deploying the API on a server
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-the-api-on-heroku">
     Using the API on Heroku
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#discussion">
     Discussion
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#break-10-min">
   Break (10 min)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#course-review-conclusion-20-min">
   Course review / conclusion (20 min)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Learning objectives
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-did-we-cover">
     What did we cover?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#some-key-takeaways">
     Some key takeaways
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#recipe-to-approach-a-supervised-learning-problem-with-tabular-data">
     Recipe to approach a supervised learning problem with tabular data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-would-i-do-differently">
     What would I do differently?
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#vs-340">
       330 vs. 340
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion-farewell">
   Conclusion &amp; farewell
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Lecture 22: Deployment and conclusion</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports">
   Imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lecture-outline">
   Lecture outline
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#learning-objectives">
   Learning objectives
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#announcements">
   Announcements
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#final-exam">
     Final exam
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-deployment-30-min">
   Model deployment (30 min)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#attribution">
     Attribution
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#try-out-this-moment-predictor">
     Try out this moment predictor
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#what-is-deployment">
       What is deployment?
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#requirements-i-already-did-these">
       Requirements (I already did these)
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#demo-deploying-moment-classification-model">
   Demo: Deploying moment classification model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#building-a-model">
     Building a model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#training-on-the-full-corpus">
     Training on the full corpus
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#saving-the-model">
     Saving the model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#loading-our-saved-model">
     Loading our saved model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optional-setting-up-a-directory-structure-and-environment">
     (Optional) Setting up a directory structure and environment
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-deployment">
     Model deployment
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#building-and-deploying-a-web-app">
     Building and deploying a web app
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#web-app-on-local-server">
     Web app on local server
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#web-app-on-a-real-server">
     Web app on a real server
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#heroku-set-up-i-already-did-these">
     Heroku set-up (I already did these):
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#testing-the-web-application">
     Testing the web application
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#api-on-the-localhost">
     API on the localhost
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sending-a-request-to-the-api">
     Sending a request to the API
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#deploying-the-api-on-a-server">
     Deploying the API on a server
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-the-api-on-heroku">
     Using the API on Heroku
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#discussion">
     Discussion
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#break-10-min">
   Break (10 min)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#course-review-conclusion-20-min">
   Course review / conclusion (20 min)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Learning objectives
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-did-we-cover">
     What did we cover?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#some-key-takeaways">
     Some key takeaways
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#recipe-to-approach-a-supervised-learning-problem-with-tabular-data">
     Recipe to approach a supervised learning problem with tabular data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-would-i-do-differently">
     What would I do differently?
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#vs-340">
       330 vs. 340
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion-farewell">
   Conclusion &amp; farewell
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <p><img alt="" src="../_images/330-banner.png" /></p>
<div class="tex2jax_ignore mathjax_ignore section" id="lecture-22-deployment-and-conclusion">
<h1>Lecture 22: Deployment and conclusion<a class="headerlink" href="#lecture-22-deployment-and-conclusion" title="Permalink to this headline">¶</a></h1>
<p>UBC 2020-21</p>
<p>Instructor: Varada Kolhatkar</p>
<div class="section" id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">joblib</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span><span class="p">,</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span><span class="p">,</span> <span class="n">make_pipeline</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="lecture-outline">
<h2>Lecture outline<a class="headerlink" href="#lecture-outline" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Announcements</p></li>
<li><p>Model deployment (30 min)</p></li>
<li><p>Instructor/TA evaluations + Break (10 min)</p></li>
<li><p>Review / conclusion (20 min)</p></li>
</ul>
</div>
<div class="section" id="learning-objectives">
<h2>Learning objectives<a class="headerlink" href="#learning-objectives" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Describe the goals and challenges of model deployment.</p></li>
</ul>
</div>
<div class="section" id="announcements">
<h2>Announcements<a class="headerlink" href="#announcements" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Last lecture today!</p></li>
<li><p>hw8 is due tonight</p></li>
<li><p>We will take time for formal course evaluations in this lecture.</p></li>
</ul>
<div class="section" id="final-exam">
<h3>Final exam<a class="headerlink" href="#final-exam" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Our final exam is on <strong>Dec. 19th at noon at PHRM 1101</strong>.</p></li>
<li><p>Cummulative</p></li>
<li><p>Open book. You can refer to the notes.</p></li>
<li><p>Please bring your computer and charger. All of it is going to be on Canvas.</p></li>
<li><p>A combination of: Multiple choice questions, short answer questions, simple coding questions</p></li>
<li><p>No communication/collaboration</p></li>
<li><p>No public Piazza posts</p></li>
<li><p>More details will be posted on Piazza.</p></li>
</ul>
</div>
</div>
<div class="section" id="model-deployment-30-min">
<h2>Model deployment (30 min)<a class="headerlink" href="#model-deployment-30-min" title="Permalink to this headline">¶</a></h2>
<div class="section" id="attribution">
<h3>Attribution<a class="headerlink" href="#attribution" title="Permalink to this headline">¶</a></h3>
<p>This material adapted from the <a class="reference external" href="https://github.com/TomasBeuzen/machine-learning-tutorials/blob/master/ml-deploy-model/deploy-with-flask.ipynb">model deployment tutorial</a> by <a class="reference external" href="https://www.tomasbeuzen.com/">Tomas Beuzen</a>.</p>
</div>
<div class="section" id="try-out-this-moment-predictor">
<h3>Try out this moment predictor<a class="headerlink" href="#try-out-this-moment-predictor" title="Permalink to this headline">¶</a></h3>
<p>https://moment-type-predictor.herokuapp.com/</p>
<ul class="simple">
<li><p>In this lecture I will show you how to set up/develop this.</p></li>
</ul>
<div class="section" id="what-is-deployment">
<h4>What is deployment?<a class="headerlink" href="#what-is-deployment" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>After we train a model, we want to use it!</p></li>
<li><p>The user likely does not want to install your Python stack, train your model.</p></li>
<li><p>You don’t necessarily want to share your dataset.</p></li>
<li><p>So we need to do two things:</p></li>
</ul>
<ol class="simple">
<li><p>Save/store your model for later use.</p></li>
<li><p>Make the saved model conveniently accessible.</p></li>
</ol>
<p>We will use <a class="reference external" href="https://joblib.readthedocs.io/">Joblib</a> for (1) and <a class="reference external" href="https://flask.palletsprojects.com/">Flask</a> &amp; <a class="reference external" href="https://www.heroku.com/">Heroku</a> for (2).</p>
</div>
<div class="section" id="requirements-i-already-did-these">
<h4>Requirements (I already did these)<a class="headerlink" href="#requirements-i-already-did-these" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Heroku account. Register <a class="reference external" href="https://www.heroku.com/">here</a>.</p></li>
<li><p>Heroku CLI. Download <a class="reference external" href="https://devcenter.heroku.com/categories/command-line">here</a>.</p></li>
</ul>
<p>More python installations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">Flask</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">Flask</span><span class="o">-</span><span class="n">WTF</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">joblib</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="demo-deploying-moment-classification-model">
<h2>Demo: Deploying moment classification model<a class="headerlink" href="#demo-deploying-moment-classification-model" title="Permalink to this headline">¶</a></h2>
<div class="section" id="building-a-model">
<h3>Building a model<a class="headerlink" href="#building-a-model" title="Permalink to this headline">¶</a></h3>
<p>Recall the multi-class classification problem using the <a class="reference external" href="https://www.kaggle.com/ritresearch/happydb">HappyDB</a> corpus.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/cleaned_hm.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">sample_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">sample_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">sample_df</span> <span class="o">=</span> <span class="n">sample_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;cleaned_hm&quot;</span><span class="p">:</span> <span class="s2">&quot;moment&quot;</span><span class="p">,</span> <span class="s2">&quot;ground_truth_category&quot;</span><span class="p">:</span> <span class="s2">&quot;target&quot;</span><span class="p">}</span>
<span class="p">)</span>
<span class="n">sample_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>wid</th>
      <th>reflection_period</th>
      <th>original_hm</th>
      <th>moment</th>
      <th>modified</th>
      <th>num_sentence</th>
      <th>target</th>
      <th>predicted_category</th>
    </tr>
    <tr>
      <th>hmid</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>27676</th>
      <td>206</td>
      <td>24h</td>
      <td>We had a serious talk with some friends of our...</td>
      <td>We had a serious talk with some friends of our...</td>
      <td>True</td>
      <td>2</td>
      <td>bonding</td>
      <td>bonding</td>
    </tr>
    <tr>
      <th>27678</th>
      <td>45</td>
      <td>24h</td>
      <td>I meditated last night.</td>
      <td>I meditated last night.</td>
      <td>True</td>
      <td>1</td>
      <td>leisure</td>
      <td>leisure</td>
    </tr>
    <tr>
      <th>27697</th>
      <td>498</td>
      <td>24h</td>
      <td>My grandmother start to walk from the bed afte...</td>
      <td>My grandmother start to walk from the bed afte...</td>
      <td>True</td>
      <td>1</td>
      <td>affection</td>
      <td>affection</td>
    </tr>
    <tr>
      <th>27705</th>
      <td>5732</td>
      <td>24h</td>
      <td>I picked my daughter up from the airport and w...</td>
      <td>I picked my daughter up from the airport and w...</td>
      <td>True</td>
      <td>1</td>
      <td>bonding</td>
      <td>affection</td>
    </tr>
    <tr>
      <th>27715</th>
      <td>2272</td>
      <td>24h</td>
      <td>when i received flowers from my best friend</td>
      <td>when i received flowers from my best friend</td>
      <td>True</td>
      <td>1</td>
      <td>bonding</td>
      <td>bonding</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_df</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>affection           4810
achievement         4276
bonding             1750
enjoy_the_moment    1514
leisure             1306
nature               252
exercise             217
Name: target, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>It’s a multiclass classification problem!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">sample_df</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="n">X_train_happy</span><span class="p">,</span> <span class="n">y_train_happy</span> <span class="o">=</span> <span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;moment&quot;</span><span class="p">],</span> <span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span>
<span class="n">X_test_happy</span><span class="p">,</span> <span class="n">y_test_happy</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;moment&quot;</span><span class="p">],</span> <span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_lr</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">stop_words</span><span class="o">=</span><span class="s2">&quot;english&quot;</span><span class="p">),</span>
    <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">2000</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_happy</span><span class="p">,</span> <span class="n">y_train_happy</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_lr</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train_happy</span><span class="p">,</span> <span class="n">y_train_happy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9528318584070796
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_lr</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test_happy</span><span class="p">,</span> <span class="n">y_test_happy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.8169911504424778
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="training-on-the-full-corpus">
<h3>Training on the full corpus<a class="headerlink" href="#training-on-the-full-corpus" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Ideally, you’ll try all different models, fine tune the most promising models and deploy the best performing model.</p></li>
<li><p>Sometimes before deploying a model people train it on the full dataset.</p>
<ul>
<li><p>This is probably a good idea, because more data is better.</p></li>
<li><p>It’s also a little scary, because we can’t test this new model.</p></li>
</ul>
</li>
<li><p>Here I’m just deploying the model trained on the training set.</p></li>
</ul>
</div>
<div class="section" id="saving-the-model">
<h3>Saving the model<a class="headerlink" href="#saving-the-model" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>If we want to deploy a model, we need to save it.</p></li>
<li><p>we are using <code class="docutils literal notranslate"><span class="pre">joblib</span></code> for that.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;web_api/moment_predictor.joblib&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pipe_lr</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;web_application/moment_predictor.joblib&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pipe_lr</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We’ll define a function that accepts input data as a dictionary and returns a prediction:</p>
</div>
<div class="section" id="loading-our-saved-model">
<h3>Loading our saved model<a class="headerlink" href="#loading-our-saved-model" title="Permalink to this headline">¶</a></h3>
<p>Let’s write a function to get predictions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">return_prediction</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">([</span><span class="n">text</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">prediction</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;web_api/moment_predictor.joblib&quot;</span><span class="p">)</span>
<span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;I love my students!&quot;</span>
<span class="n">return_prediction</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;affection&#39;
</pre></div>
</div>
</div>
</div>
<p>This function appears in the <code class="docutils literal notranslate"><span class="pre">app.py</span></code> that we’ll be using shortly.</p>
</div>
<div class="section" id="optional-setting-up-a-directory-structure-and-environment">
<h3>(Optional) Setting up a directory structure and environment<a class="headerlink" href="#optional-setting-up-a-directory-structure-and-environment" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>We need a specific directory structure to help us easily deploy our machine learning model.</p></li>
<li><p>This is already set up in this repo.</p></li>
</ul>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>lectures
├── web_api
│   └── moment_predictor.joblib  <span class="c1"># this is the machine learning model we have built locally</span>
│   └── app.py  <span class="c1"># the file that defines our flask API</span>
│   └── Procfile  <span class="c1"># required by Heroku to help start flask app</span>
│   └── requirements.txt  <span class="c1"># file containing required packages</span>
│   
└── web_application
    └── moment_predictor.joblib  <span class="c1"># this is the machine learning model we have built locally</span>
    └── app.py  <span class="c1"># the file that defines our flask API</span>
    └── Procfile  <span class="c1"># required by Heroku to help start flask app</span>
    └── requirements.txt  <span class="c1"># file containing required packages</span>
    └── templates  <span class="c1"># this subdirectory contains HTML templates to help us build the web application</span>
    │   └── style.css  <span class="c1"># css template to be used in web application</span>
    └── static  <span class="c1"># this subdirectory contains CSS style sheets</span>
        └── home.html  <span class="c1"># html template to be used in web application</span>
        └── prediction.html  <span class="c1"># html template to be used in web application</span>
</pre></div>
</div>
</div>
<div class="section" id="model-deployment">
<h3>Model deployment<a class="headerlink" href="#model-deployment" title="Permalink to this headline">¶</a></h3>
<p>We have two options for deploying our moment prediction model. We can:</p>
<ol class="simple">
<li><p>Build a web application (app) with a HTML user-interface that interacts directly with our model.</p></li>
<li><p>Develop a RESTful (REST stands for REpresentational State Transfer) web API that accepts HTTP requests in the form of input data and returns a prediction.</p></li>
</ol>
<p>We’ll explore both options below.</p>
</div>
<div class="section" id="building-and-deploying-a-web-app">
<h3>Building and deploying a web app<a class="headerlink" href="#building-and-deploying-a-web-app" title="Permalink to this headline">¶</a></h3>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>on localhost (my laptop)</p></th>
<th class="head"><p>on server (the interwebs)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>app</p></td>
<td><p>❓</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>API</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>Flask can create entire web applications.</p></li>
<li><p>We need to link our code to some html and css to create our web application.</p></li>
<li><p>We will use Flask to create a html form, accept data submitted to the form, and return a prediction using the submitted data.</p></li>
<li><p>Again, I won’t go into too much detail here, but we can open up <code class="docutils literal notranslate"><span class="pre">web_application/</span></code> and take a quick look.</p></li>
</ul>
<ul class="simple">
<li><p>We won’t go into details here. If you want to learn more about Flask, see:</p>
<ul>
<li><p><a class="reference external" href="https://www.youtube.com/playlist?list=PL-osiE80TeTs4UjLw5MM6OjgkjFeUxCYH">Flask tutorial video series by Corey Schafer</a></p></li>
<li><p><a class="reference external" href="https://flask.palletsprojects.com/en/1.1.x/">Flask docs</a></p></li>
<li><p><a class="reference external" href="https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-i-hello-world">Flask tutorial by Miguel Grinberg</a></p></li>
</ul>
</li>
</ul>
<ul class="simple">
<li><p>Let’s try <code class="docutils literal notranslate"><span class="pre">web_application/app.py</span></code> that handles this part.</p></li>
<li><p>We can open it up here in Jupyter and take a look.</p></li>
<li><p>If we run <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">app.py</span></code> we’ll bring it to life.</p></li>
</ul>
</div>
<div class="section" id="web-app-on-local-server">
<h3>Web app on local server<a class="headerlink" href="#web-app-on-local-server" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p>Go to the terminal.</p></li>
<li><p>Navigate to the <code class="docutils literal notranslate"><span class="pre">web_application</span></code> directory.</p></li>
<li><p>Run the following to make the app alive: <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">app.py</span></code>.</p>
<ul class="simple">
<li><p>If you get an error, you may need to install those extra packages and make sure you have the environment loaded.</p></li>
</ul>
</li>
<li><p>Now you should be able to access the app at: <code class="docutils literal notranslate"><span class="pre">http://127.0.0.1:5000/</span></code> or <code class="docutils literal notranslate"><span class="pre">http://localhost:5000/</span></code>.</p></li>
</ol>
</div>
<div class="section" id="web-app-on-a-real-server">
<h3>Web app on a real server<a class="headerlink" href="#web-app-on-a-real-server" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>If you want people to use your app/model, you would probably want to put it on a real server and not your laptop so that it’s live all the time.</p></li>
</ul>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>on localhost (my laptop)</p></th>
<th class="head"><p>on server (the interwebs)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>app</p></td>
<td><p>✅</p></td>
<td><p>❓</p></td>
</tr>
<tr class="row-odd"><td><p>API</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>We’ll use <a class="reference external" href="https://dashboard.heroku.com/">Heroku</a> for this.</p></li>
</ul>
</div>
<div class="section" id="heroku-set-up-i-already-did-these">
<h3>Heroku set-up (I already did these):<a class="headerlink" href="#heroku-set-up-i-already-did-these" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p>Go to <a class="reference external" href="https://dashboard.heroku.com/">Heroku</a>, log-in, and click “Create new app”.</p></li>
<li><p>Choose a unique name for your app. (I chose cpsc330-test-app.)</p></li>
<li><p>Create app.</p></li>
</ol>
<a class="reference internal image-reference" href="../_images/heroku-app.png"><img alt="../_images/heroku-app.png" src="../_images/heroku-app.png" style="width: 600px;" /></a>
<ul class="simple">
<li><p>We will be using the Heroku CLI to deploy our model.</p></li>
<li><p>We’ll open up another terminal.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">heroku</span> <span class="n">login</span>
<span class="n">cd</span> <span class="n">web_application</span><span class="o">/</span>
<span class="n">git</span> <span class="n">init</span>
<span class="n">heroku</span> <span class="n">git</span><span class="p">:</span><span class="n">remote</span> <span class="o">-</span><span class="n">a</span> <span class="n">moment</span><span class="o">-</span><span class="nb">type</span><span class="o">-</span><span class="n">predictor</span>
<span class="n">git</span> <span class="n">add</span> <span class="o">.</span>
<span class="n">git</span> <span class="n">commit</span> <span class="o">-</span><span class="n">am</span> <span class="s2">&quot;Initial commit&quot;</span>
<span class="n">git</span> <span class="n">push</span> <span class="n">heroku</span> <span class="n">master</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>I recommend copying web_application folder somewhere outside the CPSC330 repo and run the above command there. Otherwise there will be a different <code class="docutils literal notranslate"><span class="pre">git</span></code> repository inside your CPSC330 repository.</p>
</div>
</div>
<div class="section" id="testing-the-web-application">
<h3>Testing the web application<a class="headerlink" href="#testing-the-web-application" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>I already have done this and our app should be live at this link!</p></li>
</ul>
<blockquote>
<div><p>https://moment-type-predictor.herokuapp.com/</p>
</div></blockquote>
<ul class="simple">
<li><p>Try it out!</p></li>
<li><p>This is nice! If you develop a model and you want your friends to try it out without installing anything on their local computers, you can do this.</p></li>
</ul>
</div>
<div class="section" id="api-on-the-localhost">
<h3>API on the localhost<a class="headerlink" href="#api-on-the-localhost" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Often you want other people to be able to use your models in their applications.</p></li>
<li><p>We can do this by creating an <strong>API</strong>.</p></li>
<li><p>If you don’t know what an API is, that’s OK.</p>
<ul>
<li><p>For our purposes, it’s something that exists at a particular address, that can accept information and return information.</p></li>
<li><p>Sort of like a function but not Python-specific and potentially accessible by anyone on the internet.</p></li>
</ul>
</li>
</ul>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>on localhost (my laptop)</p></th>
<th class="head"><p>on server (the interwebs)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>app</p></td>
<td><p>✅</p></td>
<td><p>✅</p></td>
</tr>
<tr class="row-odd"><td><p>API</p></td>
<td><p>❓</p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>Go to the terminal.</p></li>
<li><p>Navigate to <code class="docutils literal notranslate"><span class="pre">web_api</span></code> folder in this repo.</p></li>
<li><p>Run the following to make the api alive: <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">app.py</span></code></p></li>
</ul>
<p>(Note that for more complex applications, you may choose to containerize everything in a Docker container to deploy to Heroku).</p>
</div>
<div class="section" id="sending-a-request-to-the-api">
<h3>Sending a request to the API<a class="headerlink" href="#sending-a-request-to-the-api" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>We have a RESTful (REST stands for REpresentational State Transfer) web API that accepts HTTP requests in the form of input data and returns a prediction.</p></li>
<li><p>Now you can send requests to the API and get predictions.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>!curl -d &#39;{&quot;text&quot;:&quot;I went for a run!&quot;}&#39; \
      -H &quot;Content-Type: application/json&quot; \
      -X POST http://localhost:5000/predict
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>curl: (7) Failed to connect to localhost port 5000: Connection refused
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">curl</span></code> (stands for client URL) is a tool for transferring data using various network protocols.</p></li>
<li><p>Okay, so we have a working API running on localhost, but we don’t want to host this service on my laptop!</p></li>
</ul>
</div>
<div class="section" id="deploying-the-api-on-a-server">
<h3>Deploying the API on a server<a class="headerlink" href="#deploying-the-api-on-a-server" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>We now want to deploy it on a “real” server so others can send it requests.</p></li>
<li><p>We will use Heroku to deploy our app but you could also use other services such as AWS.</p></li>
</ul>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>on localhost (my laptop)</p></th>
<th class="head"><p>on server (the interwebs)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>app</p></td>
<td><p>✅</p></td>
<td><p>✅</p></td>
</tr>
<tr class="row-odd"><td><p>API</p></td>
<td><p>✅</p></td>
<td><p>❓</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>Now the same commands:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">heroku</span> <span class="n">login</span>
<span class="n">cd</span> <span class="n">web_api</span><span class="o">/</span>
<span class="n">git</span> <span class="n">init</span>
<span class="n">heroku</span> <span class="n">git</span><span class="p">:</span><span class="n">remote</span> <span class="o">-</span><span class="n">a</span> <span class="n">moment</span><span class="o">-</span><span class="nb">type</span><span class="o">-</span><span class="n">predictor</span><span class="o">-</span><span class="n">api</span>
<span class="n">git</span> <span class="n">add</span> <span class="o">.</span>
<span class="n">git</span> <span class="n">commit</span> <span class="o">-</span><span class="n">am</span> <span class="s2">&quot;Initial commit&quot;</span>
<span class="n">git</span> <span class="n">push</span> <span class="n">heroku</span> <span class="n">master</span>
</pre></div>
</div>
</div>
<div class="section" id="using-the-api-on-heroku">
<h3>Using the API on Heroku<a class="headerlink" href="#using-the-api-on-heroku" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>This is the process but I had trouble getting this working. I’ll try to fix this and post updated notes soon.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># !curl -d &#39;{&quot;text&quot;:&quot;I love my students!&quot;}&#39; \</span>
<span class="c1">#       -H &quot;Content-Type: application/json&quot; \</span>
<span class="c1">#       -X POST https://moment-type-predictor-api.herokuapp.com/predict</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>OK so what this means is that anyone can do this.</p></li>
<li><p>In fact, you all have your laptops - give it a try!</p></li>
<li><p>You can also do the <code class="docutils literal notranslate"><span class="pre">curl</span></code> from a terminal:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!curl -d &#39;{&quot;text&quot;:&quot;I love my students!&quot;}&#39; \
      -H &quot;Content-Type: application/json&quot; \
      -X POST https://cpsc330-test-app.herokuapp.com/predict
</pre></div>
</div>
<p>That’s it for the API approach.</p>
</div>
<div class="section" id="discussion">
<h3>Discussion<a class="headerlink" href="#discussion" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>There are many ways to deploy a model; a RESTful API is very common and convenient.</p></li>
<li><p>As you can see, a simple deployment is fairly straightward.</p></li>
<li><p>However, there may be other considerations such as:</p>
<ul>
<li><p>Privacy/security</p></li>
<li><p>Scaling</p></li>
<li><p>Error handling</p></li>
<li><p>Real-time / speed</p></li>
<li><p>Low-resource environments (e.g. edge computing)</p></li>
<li><p>etc.</p></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="break-10-min">
<h2>Break (10 min)<a class="headerlink" href="#break-10-min" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>We’ll take a longer break today.</p></li>
<li><p>Consider taking this time to fill out the instructor/TA evaluations if you haven’t already.</p>
<ul>
<li><p>Evaluation link: https://canvas.ubc.ca/courses/78046/external_tools/4732</p></li>
</ul>
</li>
</ul>
<p><img alt="" src="../_images/eva-coffee.png" /></p>
<ul class="simple">
<li><p>Here is <a class="reference external" href="https://www.reddit.com/r/UBC/comments/k18qj7/teaching_evaluations_the_good_the_bad_and_the_ugly/">Mike’s post on these evaluations</a>.</p></li>
</ul>
</div>
<div class="section" id="course-review-conclusion-20-min">
<h2>Course review / conclusion (20 min)<a class="headerlink" href="#course-review-conclusion-20-min" title="Permalink to this headline">¶</a></h2>
<p><img alt="" src="../_images/ml-workflow.png" /></p>
<div class="section" id="id1">
<h3>Learning objectives<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Here are the course learning outcomes:</p>
<ol class="simple">
<li><p>Identify problems that may be addressed with machine learning.</p></li>
<li><p>Select the appropriate machine learning tool for a problem.</p></li>
<li><p>Transform data of various types into usable features.</p></li>
<li><p>Apply standard tools implementing supervised and unsupervised learning techniques.</p></li>
<li><p>Describe core differences between training, validation, and testing regimes.</p></li>
<li><p>Effectively communicate the results of a machine learning pipeline.</p></li>
<li><p>Be realistic about the limitations of individual approaches and machine learning as a whole.</p></li>
<li><p>Identify and avoid scenarios in which training and testing data are accidentally mixed (the “Golden Rule”).</p></li>
<li><p>Employ good habits for applying ML, such as starting an analysis with a baseline estimator.</p></li>
<li><p>Create reproducible workflows and pipelines.</p></li>
</ol>
<ul class="simple">
<li><p>How did we do?</p></li>
<li><p>Hopefully OK, except we skipped the last point (that will likely be its own new course).</p></li>
</ul>
</div>
<div class="section" id="what-did-we-cover">
<h3>What did we cover?<a class="headerlink" href="#what-did-we-cover" title="Permalink to this headline">¶</a></h3>
<p>I see the course roughly like this (not in order):</p>
<p>Part 1: Supervised learning on tabular data</p>
<ul class="simple">
<li><p>Overfitting, train/validation/test/deployment, cross-validation</p></li>
<li><p>Feature preprocessing, pipelines, imputation, OHE, etc</p></li>
<li><p>The Golden Rule, various ways to accidentally violate it</p></li>
<li><p>Classification metrics: confusion matrix, precision/recall, ROC, AUC</p></li>
<li><p>Regression metrics: MSE, MAPE</p></li>
<li><p>Feature importances, feature selection</p></li>
<li><p>Hyperparameter optimization</p></li>
</ul>
<ul class="simple">
<li><p>A bunch of models:</p>
<ul>
<li><p>baselines</p></li>
<li><p>linear models (ridge, logistic regression)</p></li>
<li><p>KNNs and RBF SVMs</p></li>
<li><p>tree-based models (random forest, gradient boosted trees)</p></li>
<li><p>Ensembles</p></li>
</ul>
</li>
</ul>
<p>Part 2: Other data types (non-tabular)</p>
<ul class="simple">
<li><p>Clustering: K-Means, DBSCAN</p></li>
<li><p>Recommender systems</p></li>
<li><p>Computer vision with pre-trained deep learning models (high level)</p></li>
<li><p>Language data, text preprocessing, embeddings, topic modeling</p></li>
<li><p>Time series</p></li>
<li><p>Right-censored data / survival analysis</p></li>
</ul>
<p>Part 3: Communication and Ethics</p>
<ul class="simple">
<li><p>Ethics for ML</p></li>
<li><p>Communicating your results</p></li>
<li><p>ML skepticism</p></li>
</ul>
</div>
<div class="section" id="some-key-takeaways">
<h3>Some key takeaways<a class="headerlink" href="#some-key-takeaways" title="Permalink to this headline">¶</a></h3>
<p>Some useful guidelines:</p>
<ul class="simple">
<li><p>Do train-test split right away and only once</p></li>
<li><p>Don’t look at the test set until the end</p></li>
<li><p>Don’t call <code class="docutils literal notranslate"><span class="pre">fit</span></code> on test/validation data</p></li>
<li><p>Use pipelines</p></li>
<li><p>Use baselines</p></li>
</ul>
</div>
<div class="section" id="recipe-to-approach-a-supervised-learning-problem-with-tabular-data">
<h3>Recipe to approach a supervised learning problem with tabular data<a class="headerlink" href="#recipe-to-approach-a-supervised-learning-problem-with-tabular-data" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p>Have a long conversation with the stakeholder(s) who will be using your pipeline.</p></li>
<li><p>Have a long conversation with the person(s) who collected the data.</p></li>
<li><p>Think about the ethical implications - are you sure you want to do this project? If so, should ethics guide your approach?</p></li>
<li><p>Random train-test split with fixed random seed; do not touch the test data until Step 16.</p></li>
<li><p>Exploratory data analysis, outlier detection.</p></li>
<li><p>Choose a scoring metric –&gt; higher values should make you and your stakeholder happier.</p></li>
<li><p>Fit a baseline model, e.g., <code class="docutils literal notranslate"><span class="pre">DummyClassifier</span></code> or <code class="docutils literal notranslate"><span class="pre">DummyRegressor</span></code>.</p></li>
<li><p>Create a preporcessing pipeline. This may involve feature engineering. (This is usually a time-consuming step.)</p></li>
<li><p>Try a linear model. For example, <code class="docutils literal notranslate"><span class="pre">LogisticRegression</span></code> or <code class="docutils literal notranslate"><span class="pre">Ridge</span></code>; tune hyperparameters with CV.</p></li>
<li><p>Try other sensible models(s), e.g., <code class="docutils literal notranslate"><span class="pre">LightGBM</span></code>; tune hyperparameters with CV.</p></li>
<li><p>For each model, look at sub-scores from the folds of cross-validation to get a sense of “error bars” on the scores.</p></li>
<li><p>Pick a promising model. Best CV score is a reasonable metric, though you may choose to favour simpler models.</p></li>
<li><p>Look at feature importances.</p></li>
<li><p>(optional) Perform some more diagnostics like confusion matrix for classification or “predicted vs. true” scatterplots for regression.</p></li>
<li><p>(optional) Try to calibrate the uncertainty or confidence outputted by your model.</p></li>
<li><p>Test set evaluation.</p></li>
<li><p>Question everything again: validity of results, bias/fairness of trained model, etc.</p></li>
<li><p>Discuss your results with stakeholders.</p></li>
<li><p>(optional) Retrain on all your data.</p></li>
<li><p>Deployment and integration.</p></li>
<li><p>Profit?</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The order of steps is approximate, and some steps may need to be repeated during prototyping, experimentation, and as needed over time.</p>
</div>
<p><br><br></p>
</div>
<div class="section" id="what-would-i-do-differently">
<h3>What would I do differently?<a class="headerlink" href="#what-would-i-do-differently" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Lots of room for improvement.</p></li>
<li><p>Add more interactive components in the lectures.</p></li>
<li><p>Probably more pre-lecture videos.</p></li>
<li><p>Cover outliers material.</p></li>
<li><p>Some material on data collection.</p></li>
<li><p>Allocate two lectures to time series data.</p></li>
<li><p>Improve computer vision lecture material.</p></li>
<li><p>Allocate one more lecture for ethics and communication.</p></li>
</ul>
<p>I’m sure you have other suggestions - feel free to drop me an email or drop them in the course evaluations.</p>
<div class="section" id="vs-340">
<h4>330 vs. 340<a class="headerlink" href="#vs-340" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>I am hoping lots of people will take both courses.</p></li>
<li><p>There is some overlap but not a crazy amount.</p></li>
<li><p>If you want to learn how these methods work under the hood, CPSC 340 will give you a lot of that, such as:</p>
<ul>
<li><p>Implementing <code class="docutils literal notranslate"><span class="pre">Ridge.fit()</span></code> from scratch</p></li>
<li><p>Mathematically speaking, what is <code class="docutils literal notranslate"><span class="pre">C</span></code> in <code class="docutils literal notranslate"><span class="pre">LogisticRegression</span></code>?</p></li>
<li><p>How fast do these algorithms run in terms of the number of rows and columns of your dataset?</p></li>
<li><p>Etc.</p></li>
</ul>
</li>
<li><p>There are also a bunch of other methods covered.</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="conclusion-farewell">
<h2>Conclusion &amp; farewell<a class="headerlink" href="#conclusion-farewell" title="Permalink to this headline">¶</a></h2>
<p>That’s all, folks. We made it!</p>
<p><img alt="" src="../_images/eva-well-done1.png" /></p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "conda-env-cpsc330-py"
        },
        kernelOptions: {
            kernelName: "conda-env-cpsc330-py",
            path: "./lectures"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'conda-env-cpsc330-py'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="21_communication.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Lecture 21: Communication</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../attribution.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Attributions</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Varada Kolhatkar<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>