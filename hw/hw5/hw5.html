
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CPSC 330 - Applied Machine Learning &#8212; CPSC 330 Applied Machine Learning</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/UBC-CS-logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">CPSC 330 Applied Machine Learning</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p class="caption">
 <span class="caption-text">
  Things you should know
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../docs/README.html">
   CPSC 330 Documents
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Lectures
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/01_intro.html">
   Lecture 1: Course Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/02_decision-trees.html">
   Lecture 2: Terminology, Baselines, Decision Trees
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/03_ml-fundamentals.html">
   Lecture 3: Machine Learning Fundamentals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/04_kNNs-SVM-RBF.html">
   Lecture 4:
   <span class="math notranslate nohighlight">
    \(k\)
   </span>
   -Nearest Neighbours and SVM RBFs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/05_preprocessing-pipelines.html">
   Lecture 5: Preprocessing and
   <code class="docutils literal notranslate">
    <span class="pre">
     sklearn
    </span>
   </code>
   pipelines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/06_column-transformer-text-feats.html">
   Lecture 6:
   <code class="docutils literal notranslate">
    <span class="pre">
     sklearn
    </span>
   </code>
   <code class="docutils literal notranslate">
    <span class="pre">
     ColumnTransformer
    </span>
   </code>
   and Text Features
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/07_linear-models.html">
   Lecture 7: Linear Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/08_hyperparameter-optimization.html">
   Lecture 8: Hyperparameter Optimization and Optimization Bias
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/09_classification-metrics.html">
   Lecture 9: Classification Metrics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/10_regression-metrics.html">
   Lecture 10: Regression Evaluation Metrics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/11_ensembles.html">
   Lecture 11: Ensembles
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Attribution
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../attribution.html">
   Attributions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../LICENSE.html">
   LICENSE
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Varada Kolhatkar, CPSC 330 2021-22<br>Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/hw/hw5/hw5.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/UBC-CS/cpsc330/master?urlpath=tree/hw/hw5/hw5.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#homework-5-evaluation-metrics">
   Homework 5: Evaluation metrics
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#associated-lectures-lectures-9-10">
     Associated lectures: Lectures 9, 10
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports">
   Imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#instructions">
   Instructions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercise-1-precision-recall-and-f1-score-by-hand-a-name-1-a">
   Exercise 1: Precision, recall, and f1 score by hand
   <a name="1">
   </a>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#positive-vs-negative-class">
     1.1 Positive vs. negative class
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#accuracy">
     1.2 Accuracy
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#which-model-would-you-pick">
     1.3 Which model would you pick?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#precision-recall-f1-score">
     1.4 Precision, recall, f1-score
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#discussion">
     1.5 Discussion
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optional-1-6">
     (Optional) 1.6
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-2-classification-evaluation-metrics-using-sklearn-a-name-2-a">
     Exercise 2: Classification evaluation metrics using
     <code class="docutils literal notranslate">
      <span class="pre">
       sklearn
      </span>
     </code>
     <a name="2">
     </a>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#distribution-of-target-values">
     2.1 Distribution of target values
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optional-2-2-eda">
     (Optional) 2.2 EDA
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#column-transformer">
     2.3 Column transformer
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualizing-the-transformed-data">
     2.4 Visualizing the transformed data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#area-code-feature">
     2.5 area code feature
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dummy-classifier">
     2.6 Dummy classifier
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#logistic-regression">
     2.7 Logistic regression
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#logistic-regression-with-class-weight">
     2.8 Logistic regression with
     <code class="docutils literal notranslate">
      <span class="pre">
       class_weight
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hyperparameter-optimization">
     2.9 Hyperparameter optimization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-results">
     2.10 Test results
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-3-regression-metrics-a-name-3-a">
     Exercise 3: Regression metrics
     <a name="3">
     </a>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-spitting-and-exploration">
     3.1: Data spitting and exploration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#baseline-dummyregressor">
     3.2 Baseline: DummyRegressor
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#different-regressors">
     3.3 Different regressors
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optional-3-4-hyperparameter-optimization">
     (Optional) 3.4 Hyperparameter optimization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     3.5 Test results
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-interpretation">
     3.6 Model interpretation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#submission-instructions">
   Submission instructions
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="cpsc-330-applied-machine-learning">
<h1>CPSC 330 - Applied Machine Learning<a class="headerlink" href="#cpsc-330-applied-machine-learning" title="Permalink to this headline">¶</a></h1>
<div class="section" id="homework-5-evaluation-metrics">
<h2>Homework 5: Evaluation metrics<a class="headerlink" href="#homework-5-evaluation-metrics" title="Permalink to this headline">¶</a></h2>
<div class="section" id="associated-lectures-lectures-9-10">
<h3>Associated lectures: <a class="reference external" href="https://ubc-cs.github.io/cpsc330/README.html">Lectures 9, 10</a><a class="headerlink" href="#associated-lectures-lectures-9-10" title="Permalink to this headline">¶</a></h3>
<p><strong>Due date: Wednesday, ~~Oct 25, 2021 at 11:59pm~~ Oct 27, 2021 at 11:59pm</strong></p>
</div>
</div>
<div class="section" id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">hashlib</span> <span class="kn">import</span> <span class="n">sha1</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">tests_hw5</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">make_column_transformer</span>
<span class="kn">from</span> <span class="nn">sklearn.dummy</span> <span class="kn">import</span> <span class="n">DummyClassifier</span><span class="p">,</span> <span class="n">DummyRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span><span class="p">,</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span><span class="p">,</span> <span class="n">Ridge</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">accuracy_score</span><span class="p">,</span>
    <span class="n">classification_report</span><span class="p">,</span>
    <span class="n">confusion_matrix</span><span class="p">,</span>
    <span class="n">f1_score</span><span class="p">,</span>
    <span class="n">make_scorer</span><span class="p">,</span>
    <span class="n">precision_score</span><span class="p">,</span>
    <span class="n">recall_score</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">GridSearchCV</span><span class="p">,</span>
    <span class="n">RandomizedSearchCV</span><span class="p">,</span>
    <span class="n">cross_val_score</span><span class="p">,</span>
    <span class="n">cross_validate</span><span class="p">,</span>
    <span class="n">train_test_split</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span><span class="p">,</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">OrdinalEncoder</span><span class="p">,</span> <span class="n">StandardScaler</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="instructions">
<h2>Instructions<a class="headerlink" href="#instructions" title="Permalink to this headline">¶</a></h2>
<hr>
rubric={points:3}
<p>Follow the <a class="reference external" href="https://github.com/UBC-CS/cpsc330/blob/master/docs/homework_instructions.md">homework submission instructions</a>.</p>
<p><strong>You may work with a partner on this homework and submit your assignment as a group.</strong> Below are some instructions on working as a group.</p>
<ul class="simple">
<li><p>The maximum group size is 2.</p></li>
<li><p>Use group work as an opportunity to collaborate and learn new things from each other.</p></li>
<li><p>Be respectful to each other and make sure you understand all the concepts in the assignment well.</p></li>
<li><p>It’s your responsibility to make sure that the assignment is submitted by one of the group members before the deadline.</p></li>
<li><p>You can find the instructions on how to do group submission on Gradescope <a class="reference external" href="https://help.gradescope.com/article/m5qz2xsnjy-student-add-group-members">here</a>.</p></li>
</ul>
<p><br><br></p>
</div>
<div class="section" id="exercise-1-precision-recall-and-f1-score-by-hand-a-name-1-a">
<h2>Exercise 1: Precision, recall, and f1 score by hand <a name="1"></a><a class="headerlink" href="#exercise-1-precision-recall-and-f1-score-by-hand-a-name-1-a" title="Permalink to this headline">¶</a></h2>
<hr><p>Consider the problem of predicting whether a patient has a disease or not. Below are confusion matrices of two machine learning models: Model A and Model B.</p>
<ul class="simple">
<li><p>Model A</p></li>
</ul>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Actual/Predicted</p></th>
<th class="text-align:right head"><p>Predicted disease</p></th>
<th class="text-align:right head"><p>Predicted no disease</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p><strong>Actual disease</strong></p></td>
<td class="text-align:right"><p>2</p></td>
<td class="text-align:right"><p>8</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><strong>Actual no disease</strong></p></td>
<td class="text-align:right"><p>0</p></td>
<td class="text-align:right"><p>100</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>Model B</p></li>
</ul>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Actual/Predicted</p></th>
<th class="text-align:right head"><p>Predicted disease</p></th>
<th class="text-align:right head"><p>Predicted no disease</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p><strong>Actual disease</strong></p></td>
<td class="text-align:right"><p>6</p></td>
<td class="text-align:right"><p>4</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><strong>Actual no disease</strong></p></td>
<td class="text-align:right"><p>10</p></td>
<td class="text-align:right"><p>90</p></td>
</tr>
</tbody>
</table>
<div class="section" id="positive-vs-negative-class">
<h3>1.1 Positive vs. negative class<a class="headerlink" href="#positive-vs-negative-class" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:2}</p>
<p><strong>Your tasks:</strong></p>
<p>Precision, recall, and f1 score depend upon which class is considered “positive”, that is the thing you wish to find. In the example above, which class is likely to be the “positive” class? Why?</p>
<p><br><br></p>
</div>
<div class="section" id="accuracy">
<h3>1.2 Accuracy<a class="headerlink" href="#accuracy" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:2}</p>
<p><strong>Your tasks:</strong></p>
<p>Calculate accuracies for Model A and Model B.</p>
<p>We’ll store all metrics associated with Model A and Model B in the <code class="docutils literal notranslate"><span class="pre">results_dict</span></code> below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="p">{}}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">][</span><span class="s2">&quot;accuracy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">][</span><span class="s2">&quot;accuracy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">tests_hw5</span><span class="o">.</span><span class="n">ex1_2_1</span><span class="p">(</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">][</span><span class="s2">&quot;accuracy&quot;</span><span class="p">]</span>
<span class="p">),</span> <span class="s2">&quot;Your answer is incorrect, see traceback above.&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Success&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AssertionError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">80</span><span class="o">/</span><span class="n">kr9rkqfj4w78h49djkz8yy9r0000gp</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_15638</span><span class="o">/</span><span class="mf">3913283802.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="k">assert</span> <span class="n">tests_hw5</span><span class="o">.</span><span class="n">ex1_2_1</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">][</span><span class="s2">&quot;accuracy&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="p">),</span> <span class="s2">&quot;Your answer is incorrect, see traceback above.&quot;</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Success&quot;</span><span class="p">)</span>

<span class="ne">AssertionError</span>: Your answer is incorrect, see traceback above.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">tests_hw5</span><span class="o">.</span><span class="n">ex1_2_2</span><span class="p">(</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">][</span><span class="s2">&quot;accuracy&quot;</span><span class="p">]</span>
<span class="p">),</span> <span class="s2">&quot;Your answer is incorrect, see traceback above.&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Success&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><br><br></p>
</div>
<div class="section" id="which-model-would-you-pick">
<h3>1.3 Which model would you pick?<a class="headerlink" href="#which-model-would-you-pick" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:1}</p>
<p><strong>Your tasks:</strong></p>
<p>Which model would you pick simply based on the accuracy metric?</p>
<p><br><br></p>
</div>
<div class="section" id="precision-recall-f1-score">
<h3>1.4 Precision, recall, f1-score<a class="headerlink" href="#precision-recall-f1-score" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:6}</p>
<p><strong>Your tasks:</strong></p>
<ol class="simple">
<li><p>Calculate precision, recall, f1-score for Model A and Model B manually, without using <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code> tools.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">][</span><span class="s2">&quot;precision&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">][</span><span class="s2">&quot;precision&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">][</span><span class="s2">&quot;recall&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">][</span><span class="s2">&quot;recall&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">][</span><span class="s2">&quot;f1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">][</span><span class="s2">&quot;f1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">tests_hw5</span><span class="o">.</span><span class="n">ex1_4_1</span><span class="p">(</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">][</span><span class="s2">&quot;precision&quot;</span><span class="p">]</span>
<span class="p">),</span> <span class="s2">&quot;Your answer is incorrect, see traceback above.&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Success&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">tests_hw5</span><span class="o">.</span><span class="n">ex1_4_2</span><span class="p">(</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">][</span><span class="s2">&quot;precision&quot;</span><span class="p">]</span>
<span class="p">),</span> <span class="s2">&quot;Your answer is incorrect, see traceback above.&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Success&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">tests_hw5</span><span class="o">.</span><span class="n">ex1_4_3</span><span class="p">(</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">][</span><span class="s2">&quot;recall&quot;</span><span class="p">]</span>
<span class="p">),</span> <span class="s2">&quot;Your answer is incorrect, see traceback above.&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Success&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">tests_hw5</span><span class="o">.</span><span class="n">ex1_4_4</span><span class="p">(</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">][</span><span class="s2">&quot;recall&quot;</span><span class="p">]</span>
<span class="p">),</span> <span class="s2">&quot;Your answer is incorrect, see traceback above.&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Success&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">tests_hw5</span><span class="o">.</span><span class="n">ex1_4_5</span><span class="p">(</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">][</span><span class="s2">&quot;f1&quot;</span><span class="p">]</span>
<span class="p">),</span> <span class="s2">&quot;Your answer is incorrect, see traceback above.&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Success&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">tests_hw5</span><span class="o">.</span><span class="n">ex1_4_6</span><span class="p">(</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">][</span><span class="s2">&quot;f1&quot;</span><span class="p">]</span>
<span class="p">),</span> <span class="s2">&quot;Your answer is incorrect, see traceback above.&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Success&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Show the dataframe with all results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><br><br></p>
</div>
<div class="section" id="discussion">
<h3>1.5 Discussion<a class="headerlink" href="#discussion" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:4}</p>
<p><strong>Your tasks:</strong></p>
<ol class="simple">
<li><p>Which metric is more informative in this problem? Why?</p></li>
<li><p>Which model would you pick based on this information?</p></li>
</ol>
<p><br><br></p>
</div>
<div class="section" id="optional-1-6">
<h3>(Optional) 1.6<a class="headerlink" href="#optional-1-6" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:1}</p>
<p><strong>Your tasks:</strong></p>
<p>Provide 4 to 5 example classification datasets (with links) where accuracy metric would be misleading. Discuss which evaluation metric would be more appropriate for each dataset. You may consider datasets we have used in this course so far. You could also look up datasets on Kaggle.</p>
<p><br><br><br><br></p>
</div>
<div class="section" id="exercise-2-classification-evaluation-metrics-using-sklearn-a-name-2-a">
<h3>Exercise 2: Classification evaluation metrics using <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> <a name="2"></a><a class="headerlink" href="#exercise-2-classification-evaluation-metrics-using-sklearn-a-name-2-a" title="Permalink to this headline">¶</a></h3>
<hr>
<p>In general, when a dataset is imbalanced, accuracy does not provide the whole story. In class, we looked at credit card fraud dataset which is a classic example of an imbalanced dataset.</p>
<p>Another example is customer churn datasets. <a class="reference external" href="https://en.wikipedia.org/wiki/Customer_attrition">Customer churn</a> refers to the notion of customers leaving a subscription service like Netflix. In this exercise, we will try to predict customer churn in a dataset where most of the customers stay with the service and a small minority cancel their subscription. To start, please download the <a class="reference external" href="https://www.kaggle.com/becksddf/churn-in-telecoms-dataset">Kaggle telecom customer churn dataset</a>. Once you have the data, you should be able to run the following code:</p>
<p>The starter code below reads the data CSV as a pandas dataframe and splits it into 70% train and 30% test.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">churn</span></code> column in the dataset is the target. “True” means the customer left the subscription (churned) and “False” means they stayed.</p>
<blockquote>
<div><p>Note that for this kind of problem a more appropriate technique is something called survival analysis and we’ll be talking about it later in the course. For now, we’ll just treat it as a binary classification problem.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;bigml_59c28831336c6604c800002a.csv&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
<span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="n">train_df</span>
</pre></div>
</div>
</div>
</div>
<p><br><br></p>
</div>
<div class="section" id="distribution-of-target-values">
<h3>2.1 Distribution of target values<a class="headerlink" href="#distribution-of-target-values" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:4}</p>
<p><strong>Your tasks:</strong></p>
<p>Examine the distribution of target values in the train split. Do you see class imbalance? If yes, do we need to deal with it? Why or why not?</p>
<p><br><br></p>
</div>
<div class="section" id="optional-2-2-eda">
<h3>(Optional) 2.2 EDA<a class="headerlink" href="#optional-2-2-eda" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:1}</p>
<p><strong>Your tasks:</strong></p>
<p>Come up with <strong>two</strong> exploratory questions you would like to answer and explore those. Briefly discuss your results in 1-3 sentences.</p>
<p>You are welcome to use <code class="docutils literal notranslate"><span class="pre">pandas_profiling</span></code> (see Lecture 10) but you don’t have to.</p>
<p><br><br></p>
</div>
<div class="section" id="column-transformer">
<h3>2.3 Column transformer<a class="headerlink" href="#column-transformer" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:10}</p>
<p>The code below creates <code class="docutils literal notranslate"><span class="pre">X_train</span></code>, <code class="docutils literal notranslate"><span class="pre">y_train</span></code>, <code class="docutils literal notranslate"><span class="pre">X_test</span></code>, <code class="docutils literal notranslate"><span class="pre">y_test</span></code> for you.
In preparation for building a classifier, set up a <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code> that performs whatever feature transformations you deem sensible. This can include dropping features if you think they are not helpful. Remember that by default <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code> will drop any columns that aren’t accounted for when it’s created.</p>
<p>In each case, briefly explain your rationale with 1-2 sentences. You do not need an explanation for every feature, but for every group of features that are being transformed the same way. For example, “I am doing transformation X to the following categorical features: <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code>, <code class="docutils literal notranslate"><span class="pre">c</span></code> because of reason Y,” etc.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;churn&quot;</span><span class="p">])</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;churn&quot;</span><span class="p">])</span>

<span class="n">y_train</span> <span class="o">=</span> <span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;churn&quot;</span><span class="p">]</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;churn&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p><br><br></p>
</div>
<div class="section" id="visualizing-the-transformed-data">
<h3>2.4 Visualizing the transformed data<a class="headerlink" href="#visualizing-the-transformed-data" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:4}</p>
<p>Fit and transform your <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code> on your training set. Print the first 5 rows of the transformed data as a dataframe (not numpy array). See lecture 10 for code that can get you the new column names after transforming.</p>
<p><br><br></p>
</div>
<div class="section" id="area-code-feature">
<h3>2.5 area code feature<a class="headerlink" href="#area-code-feature" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:4}</p>
<p>The original dataset had a feature called <code class="docutils literal notranslate"><span class="pre">area</span> <span class="pre">code</span></code>. Let’s assume we encoded this feature with one-hot encoding.</p>
<ol class="simple">
<li><p>The area codes were numbers to begin with. Why do we want to use one-hot encoding on this feature?</p></li>
<li><p>What were the possible values of <code class="docutils literal notranslate"><span class="pre">area</span> <span class="pre">code</span></code>?</p></li>
<li><p>What new feature(s) were created to replace <code class="docutils literal notranslate"><span class="pre">area</span> <span class="pre">code</span></code>?</p></li>
</ol>
<p><br><br></p>
</div>
<div class="section" id="dummy-classifier">
<h3>2.6 Dummy classifier<a class="headerlink" href="#dummy-classifier" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:4}</p>
<p><strong>Your tasks:</strong></p>
<p>Create a <code class="docutils literal notranslate"><span class="pre">DummyClassifier</span></code>. Report the following scoring metrics via cross-validation: accuracy, precision, recall, f1-score. Briefly comment on your results, including any warnings the code produces (2 sentences max).</p>
<p><br><br></p>
</div>
<div class="section" id="logistic-regression">
<h3>2.7 Logistic regression<a class="headerlink" href="#logistic-regression" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:8}</p>
<p><strong>Your tasks:</strong></p>
<ol class="simple">
<li><p>Train and score a logistic regression classifier on the dataset.</p></li>
<li><p>Report the same metrics as in the previous part.</p></li>
<li><p>Are you satisfied with the results? Use your <code class="docutils literal notranslate"><span class="pre">DummyClassifier</span></code> results as a reference point. Discuss in a few sentences.</p></li>
</ol>
<p><br><br></p>
</div>
<div class="section" id="logistic-regression-with-class-weight">
<h3>2.8 Logistic regression with <code class="docutils literal notranslate"><span class="pre">class_weight</span></code><a class="headerlink" href="#logistic-regression-with-class-weight" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:6}</p>
<p><strong>Your tasks:</strong></p>
<ol class="simple">
<li><p>Set the <code class="docutils literal notranslate"><span class="pre">class_weight</span></code> parameter of your logistic regression model to <code class="docutils literal notranslate"><span class="pre">'balanced'</span></code> and report the same metrics as in the previous part.</p></li>
<li><p>Do you prefer this model to the one in the previous part? Discuss your results in a few sentences.</p></li>
</ol>
<p><br><br></p>
</div>
<div class="section" id="hyperparameter-optimization">
<h3>2.9 Hyperparameter optimization<a class="headerlink" href="#hyperparameter-optimization" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:10}</p>
<p>Now let’s tune the hyperparameters of our <code class="docutils literal notranslate"><span class="pre">LogisticRegression</span></code> using <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> to maximize cross-validation f1 score.</p>
<p><strong>Your tasks:</strong></p>
<ol class="simple">
<li><p>Jointly optimize <code class="docutils literal notranslate"><span class="pre">C</span></code> (choose some reasonable values) and <code class="docutils literal notranslate"><span class="pre">class_weight</span></code> (<code class="docutils literal notranslate"><span class="pre">None</span></code> vs. <code class="docutils literal notranslate"><span class="pre">'balanced'</span></code>) with <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> and <code class="docutils literal notranslate"><span class="pre">scoring=&quot;f1&quot;</span></code>.</p></li>
<li><p>What values of <code class="docutils literal notranslate"><span class="pre">C</span></code> and <code class="docutils literal notranslate"><span class="pre">class_weight</span></code> are chosen and what is the best cross-validation f1 score?</p></li>
</ol>
<p><br><br></p>
</div>
<div class="section" id="test-results">
<h3>2.10 Test results<a class="headerlink" href="#test-results" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:10}</p>
<p><strong>Your tasks</strong></p>
<ol class="simple">
<li><p>Evaluate the best model on the test set. In particular show each of the following on the test set:</p>
<ul class="simple">
<li><p>Confusion matrix.</p></li>
<li><p>Classification report.</p></li>
<li><p>Precision-recall curve with average precision score.</p></li>
<li><p>ROC curve with AUC.</p></li>
</ul>
</li>
<li><p>Comment on the results.</p></li>
</ol>
<blockquote>
<div><p>Note that we are not doing it here but in real life, you would also plot confusion matrix, precision-recall curve, and ROC curve on validation data to examine errors and to choose a threshold which works for your operating point.</p>
</div></blockquote>
<p><br><br><br><br></p>
</div>
<div class="section" id="exercise-3-regression-metrics-a-name-3-a">
<h3>Exercise 3: Regression metrics <a name="3"></a><a class="headerlink" href="#exercise-3-regression-metrics-a-name-3-a" title="Permalink to this headline">¶</a></h3>
<hr> 
<p>For this exercise, we’ll use <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.datasets.fetch_california_housing.html">California housing dataset</a> from <code class="docutils literal notranslate"><span class="pre">sklearn</span> <span class="pre">datasets</span></code>. The code below loads the dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_california_housing</span>

<span class="n">housing_df</span> <span class="o">=</span> <span class="n">fetch_california_housing</span><span class="p">(</span><span class="n">as_frame</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">frame</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="data-spitting-and-exploration">
<h3>3.1: Data spitting and exploration<a class="headerlink" href="#data-spitting-and-exploration" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:4}</p>
<p><strong>Your tasks:</strong></p>
<ol class="simple">
<li><p>Split the data into train (80%) and test (20%) splits.</p></li>
<li><p>Explore the train split. Do you need to apply any transformations on the data? If yes, create a preprocessor with the appropriate transformations.</p></li>
<li><p>Separate <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> in train and test splits.</p></li>
</ol>
<p><br><br></p>
</div>
<div class="section" id="baseline-dummyregressor">
<h3>3.2 Baseline: DummyRegressor<a class="headerlink" href="#baseline-dummyregressor" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:2}</p>
<p><strong>Your tasks:</strong></p>
<ol class="simple">
<li><p>Carry out cross-validation using <code class="docutils literal notranslate"><span class="pre">DummyRegressor</span></code> with default scoring.</p></li>
<li><p>What metric is used for scoring by default?</p></li>
</ol>
<p><br><br></p>
</div>
<div class="section" id="different-regressors">
<h3>3.3 Different regressors<a class="headerlink" href="#different-regressors" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:8}</p>
<p>In this exercise, we are going to use <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestRegressor.html"><code class="docutils literal notranslate"><span class="pre">RandomForestRegressor</span></code></a> model which we haven’t looked into yet. At this point you should feel comfortable using models with our usual ML workflow even if you don’t know the details. We’ll talk about <code class="docutils literal notranslate"><span class="pre">RandomForestRegressor</span></code> later in the course.</p>
<p>The code below defines a custom scorer called <code class="docutils literal notranslate"><span class="pre">mape_scorer</span></code> and creates dictionaries for different regressors (<code class="docutils literal notranslate"><span class="pre">models</span></code>) and different scoring metrics (<code class="docutils literal notranslate"><span class="pre">score_types_reg</span></code>).</p>
<p><strong>Your tasks:</strong></p>
<ol class="simple">
<li><p>Using the <code class="docutils literal notranslate"><span class="pre">models</span></code> and the evaluation metrics <code class="docutils literal notranslate"><span class="pre">score_types_reg</span></code> in the code below, carry out cross-validation with each model, by passing the evaluation metrics to <code class="docutils literal notranslate"><span class="pre">scoring</span></code> argument of <code class="docutils literal notranslate"><span class="pre">cross_validate</span></code>. Use a pipeline with the model as an estimator if you are applying any transformations.</p></li>
<li><p>Show results as a dataframe.</p></li>
<li><p>Interpret the results. How do the models compare to the baseline? Which model seems to be performing well with different metrics?</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mape</span><span class="p">(</span><span class="n">true</span><span class="p">,</span> <span class="n">pred</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">100.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">pred</span> <span class="o">-</span> <span class="n">true</span><span class="p">)</span> <span class="o">/</span> <span class="n">true</span><span class="p">))</span>


<span class="c1"># make a scorer function that we can pass into cross-validation</span>
<span class="n">mape_scorer</span> <span class="o">=</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">mape</span><span class="p">,</span> <span class="n">greater_is_better</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Ridge&quot;</span><span class="p">:</span> <span class="n">Ridge</span><span class="p">(),</span>
    <span class="s2">&quot;Random Forest&quot;</span><span class="p">:</span> <span class="n">RandomForestRegressor</span><span class="p">(),</span>
<span class="p">}</span>

<span class="n">score_types_reg</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;neg_mean_squared_error&quot;</span><span class="p">:</span> <span class="s2">&quot;neg_mean_squared_error&quot;</span><span class="p">,</span>
    <span class="s2">&quot;neg_root_mean_squared_error&quot;</span><span class="p">:</span> <span class="s2">&quot;neg_root_mean_squared_error&quot;</span><span class="p">,</span>
    <span class="s2">&quot;neg_mean_absolute_error&quot;</span><span class="p">:</span> <span class="s2">&quot;neg_mean_absolute_error&quot;</span><span class="p">,</span>
    <span class="s2">&quot;r2&quot;</span><span class="p">:</span> <span class="s2">&quot;r2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mape_scorer&quot;</span><span class="p">:</span> <span class="n">mape_scorer</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p><br><br></p>
</div>
<div class="section" id="optional-3-4-hyperparameter-optimization">
<h3>(Optional) 3.4 Hyperparameter optimization<a class="headerlink" href="#optional-3-4-hyperparameter-optimization" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:1}</p>
<p><strong>Your tasks:</strong></p>
<ol class="simple">
<li><p>Carry out hyperparameter optimization using <code class="docutils literal notranslate"><span class="pre">RandomizedSearchCV</span></code> and <code class="docutils literal notranslate"><span class="pre">Ridge</span></code> with the following <code class="docutils literal notranslate"><span class="pre">param_dist</span></code>. The <code class="docutils literal notranslate"><span class="pre">alpha</span></code> hyperparameter of <code class="docutils literal notranslate"><span class="pre">Ridge</span></code> controls the fundamental tradeoff. Choose the metric of your choice for hyperparameter optimization.</p></li>
<li><p>Are you getting better scores compared to the default values?</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">loguniform</span>

<span class="n">param_dist</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ridge__alpha&quot;</span><span class="p">:</span> <span class="n">loguniform</span><span class="p">(</span><span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e3</span><span class="p">)}</span>
</pre></div>
</div>
</div>
</div>
<p><br><br></p>
</div>
<div class="section" id="id1">
<h3>3.5 Test results<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:4}</p>
<p><strong>Your tasks:</strong></p>
<ol class="simple">
<li><p>Try the best model on the test set.</p></li>
<li><p>Briefly comment on the results. (1 to 2 sentences)</p></li>
</ol>
<p><br><br></p>
</div>
<div class="section" id="model-interpretation">
<h3>3.6 Model interpretation<a class="headerlink" href="#model-interpretation" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:4}</p>
<p>Ridge is a linear model and it learns coefficients associated with each feature during <code class="docutils literal notranslate"><span class="pre">fit()</span></code>.</p>
<p><strong>Your tasks:</strong></p>
<ol class="simple">
<li><p>Visualize coefficients learned by the <code class="docutils literal notranslate"><span class="pre">Ridge</span></code> model above as a pandas dataframe with two columns: features and coefficients. If you attempted 3.4, use the <code class="docutils literal notranslate"><span class="pre">Ridge</span></code> model with best hyperparameters. Otherwise use the <code class="docutils literal notranslate"><span class="pre">Ridge</span></code> model with default hyperparameters.</p></li>
<li><p>Increasing which feature values would result in higher housing price?</p></li>
</ol>
<p><br><br></p>
</div>
</div>
<div class="section" id="submission-instructions">
<h2>Submission instructions<a class="headerlink" href="#submission-instructions" title="Permalink to this headline">¶</a></h2>
<p><strong>PLEASE READ:</strong> When you are ready to submit your assignment do the following:</p>
<ol class="simple">
<li><p>Run all cells in your notebook to make sure there are no errors by doing <code class="docutils literal notranslate"><span class="pre">Kernel</span> <span class="pre">-&gt;</span> <span class="pre">Restart</span> <span class="pre">Kernel</span> <span class="pre">and</span> <span class="pre">Clear</span> <span class="pre">All</span> <span class="pre">Outputs</span></code> and then <code class="docutils literal notranslate"><span class="pre">Run</span> <span class="pre">-&gt;</span> <span class="pre">Run</span> <span class="pre">All</span> <span class="pre">Cells</span></code>.</p></li>
<li><p>Notebooks with cell execution numbers out of order or not starting from “1” will have marks deducted. Notebooks without the output displayed may not be graded at all (because we need to see the output in order to grade your work).</p></li>
<li><p>Upload the assignment using Gradescope’s drag and drop tool. Check out this <a class="reference external" href="https://lthub.ubc.ca/guides/gradescope-student-guide/">Gradescope Student Guide</a> if you need help with Gradescope submission.</p></li>
</ol>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "conda-env-571-py"
        },
        kernelOptions: {
            kernelName: "conda-env-571-py",
            path: "./hw/hw5"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'conda-env-571-py'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Varada Kolhatkar<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>