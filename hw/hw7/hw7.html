
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CPSC 330 - Applied Machine Learning &#8212; CPSC 330 Applied Machine Learning</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.e8e5499552300ddf5d7adccae7cc3b70.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      <img src="../../_static/UBC-CS-logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">CPSC 330 Applied Machine Learning</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <p class="caption">
 <span class="caption-text">
  Things you should know
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../docs/README.html">
   CPSC 330 Documents
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Lectures
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/01_intro.html">
   Lecture 1: Course Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/02_decision-trees.html">
   Lecture 2: Terminology, Baselines, Decision Trees
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/03_ml-fundamentals.html">
   Lecture 3: Machine Learning Fundamentals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/04_kNNs-SVM-RBF.html">
   Lecture 4:
   <span class="math notranslate nohighlight">
    \(k\)
   </span>
   -Nearest Neighbours and SVM RBFs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/05_preprocessing-pipelines.html">
   Lecture 5: Preprocessing and
   <code class="docutils literal notranslate">
    <span class="pre">
     sklearn
    </span>
   </code>
   pipelines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/06_column-transformer-text-feats.html">
   Lecture 6:
   <code class="docutils literal notranslate">
    <span class="pre">
     sklearn
    </span>
   </code>
   <code class="docutils literal notranslate">
    <span class="pre">
     ColumnTransformer
    </span>
   </code>
   and Text Features
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/07_linear-models.html">
   Lecture 7: Linear Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/08_hyperparameter-optimization.html">
   Lecture 8: Hyperparameter Optimization and Optimization Bias
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/09_classification-metrics.html">
   Lecture 9: Classification Metrics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/10_regression-metrics.html">
   Lecture 10: Regression Evaluation Metrics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/11_ensembles.html">
   Lecture 11: Ensembles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/13_feature-engineering-selection.html">
   Lecture 13: Feature engineering and feature selection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/14_k-means-clustering.html">
   Lecture 14: Clustering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/15_recommender-systems.html">
   Lecture 15: DBSCAN and Recommender Systems
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Attribution
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../attribution.html">
   Attributions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../LICENSE.html">
   LICENSE
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Varada Kolhatkar, CPSC 330 2021-22<br>Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/hw/hw7/hw7.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/UBC-CS/cpsc330/master?urlpath=tree/hw/hw7/hw7.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#homework-7-clustering-and-recommender-systems">
   Homework 7: Clustering and recommender systems
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#associated-lectures-lectures-14-and-15">
     Associated lectures: Lectures 14 and 15
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#instructions">
   Instructions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercise-1-document-clustering-toy-example-a-name-1-a">
   Exercise 1: Document clustering toy example
   <a name="1">
   </a>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sample-sentences-from-wikipedia-articles">
     1.1 Sample sentences from Wikipedia articles
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#kmeans-with-bag-of-words-representation">
     1.2
     <code class="docutils literal notranslate">
      <span class="pre">
       KMeans
      </span>
     </code>
     with bag-of-words representation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sentence-embedding-representation">
     1.3 Sentence embedding representation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dbscan-with-cosine-distance">
     1.4 DBSCAN with cosine distance
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualizing-clusters">
     1.5 Visualizing clusters
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercise-2-movie-recommendations">
   Exercise 2: Movie recommendations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#terminology">
     2.1 Terminology
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#splitting-the-data">
     2.2 Splitting the data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#utility-matrix">
     2.3 Utility matrix
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#evaluation-and-baseline">
     2.4 Evaluation and baseline
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optional-2-5-k-nearest-neighbours-imputation">
     (Optional) 2.5
     <span class="math notranslate nohighlight">
      \(k\)
     </span>
     -nearest neighbours imputation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#use-collaborative-filtering-with-the-surprise-package">
     2.6 Use collaborative filtering with the
     <code class="docutils literal notranslate">
      <span class="pre">
       surprise
      </span>
     </code>
     package
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercise-3-short-answer-questions">
   Exercise 3: Short answer questions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#submission-instructions">
   Submission instructions
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="cpsc-330-applied-machine-learning">
<h1>CPSC 330 - Applied Machine Learning<a class="headerlink" href="#cpsc-330-applied-machine-learning" title="Permalink to this headline">¶</a></h1>
<div class="section" id="homework-7-clustering-and-recommender-systems">
<h2>Homework 7: Clustering and recommender systems<a class="headerlink" href="#homework-7-clustering-and-recommender-systems" title="Permalink to this headline">¶</a></h2>
<div class="section" id="associated-lectures-lectures-14-and-15">
<h3>Associated lectures: Lectures 14 and 15<a class="headerlink" href="#associated-lectures-lectures-14-and-15" title="Permalink to this headline">¶</a></h3>
<p><strong>Due date: Monday, November 15, 2021 at 11:59pm</strong></p>
<blockquote>
<div><p>Note that this homework is much shorter and simpler than the usual homework assignments because homework 6 is also due on November 15th.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">DBSCAN</span><span class="p">,</span> <span class="n">KMeans</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>

<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_colwidth&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><br><br><br><br></p>
</div>
</div>
<div class="section" id="instructions">
<h2>Instructions<a class="headerlink" href="#instructions" title="Permalink to this headline">¶</a></h2>
<hr>
rubric={points:2}
<p>Follow the <a class="reference external" href="https://github.com/UBC-CS/cpsc330/blob/master/docs/homework_instructions.md">homework submission instructions</a>.</p>
<p><strong>You may work on this homework in a group and submit your assignment as a group.</strong> Below are some instructions on working as a group.</p>
<ul class="simple">
<li><p>The maximum group size is 3.</p></li>
<li><p>Use group work as an opportunity to collaborate and learn new things from each other.</p></li>
<li><p>Be respectful to each other and make sure you understand all the concepts in the assignment well.</p></li>
<li><p>It’s your responsibility to make sure that the assignment is submitted by one of the group members before the deadline.</p></li>
<li><p>You can find the instructions on how to do group submission on Gradescope <a class="reference external" href="https://help.gradescope.com/article/m5qz2xsnjy-student-add-group-members">here</a>.</p></li>
</ul>
<p><br><br><br><br></p>
</div>
<div class="section" id="exercise-1-document-clustering-toy-example-a-name-1-a">
<h2>Exercise 1: Document clustering toy example <a name="1"></a><a class="headerlink" href="#exercise-1-document-clustering-toy-example-a-name-1-a" title="Permalink to this headline">¶</a></h2>
<hr>
<p>In lecture 14, we looked at a popular application of clustering: customer segmentation. In this homework, we will work on a toy example of another popular application: <a class="reference external" href="https://en.wikipedia.org/wiki/Document_clustering"><strong>document clustering</strong></a>. A large amount of unlabeled text data is available out there (e.g., news, recipes, online Q&amp;A), and clustering is a commonly used technique to organize this data in a meaningful way.</p>
<p>In this exercise, we will create a toy dataset with sentences from Wikipedia articles and cluster these sentences.</p>
<div class="section" id="sample-sentences-from-wikipedia-articles">
<h3>1.1 Sample sentences from Wikipedia articles<a class="headerlink" href="#sample-sentences-from-wikipedia-articles" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:2}</p>
<p>The code below extracts first sentences of Wikipedia articles on a set of queries. You will need the <code class="docutils literal notranslate"><span class="pre">wikipedia</span></code> package installed in the course environment to run the code below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">activate</span> <span class="n">cpsc330</span>
<span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">wikipedia</span>
</pre></div>
</div>
<p>You also need <code class="docutils literal notranslate"><span class="pre">nltk</span></code> library in the course environment.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">anaconda</span> <span class="n">nltk</span> 
</pre></div>
</div>
<p><strong>Your tasks:</strong></p>
<p>Run the code below and answer the following question.</p>
<ol class="simple">
<li><p>Given this dataset, how many clusters would you expect a clustering algorithm to identify? How would you manually label these clusters?</p></li>
</ol>
<blockquote>
<div><p><em>Note 2: Feel free to experiment with queries of your choice. But stick to the provided list for the final submission so that it’s easier for the TAs when they grade your submission.</em></p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">nltk</span>
<span class="kn">from</span> <span class="nn">nltk.tokenize</span> <span class="kn">import</span> <span class="n">sent_tokenize</span><span class="p">,</span> <span class="n">word_tokenize</span>
<span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s2">&quot;punkt&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[nltk_data] Downloading package punkt to /Users/kvarada/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">wikipedia</span>

<span class="n">queries</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;mango_fruit&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pastry&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Julia language&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Python language&quot;</span><span class="p">,</span>
    <span class="s2">&quot;hockey&quot;</span><span class="p">,</span>
    <span class="s2">&quot;football&quot;</span><span class="p">,</span>
    <span class="s2">&quot;supervised learning&quot;</span><span class="p">,</span>
    <span class="s2">&quot;unsupervised learning&quot;</span>    
<span class="p">]</span>

<span class="n">wiki_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;wiki query&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;n_words&quot;</span><span class="p">:</span> <span class="p">[]}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">queries</span><span class="p">)):</span>
    <span class="n">sent</span> <span class="o">=</span> <span class="n">sent_tokenize</span><span class="p">(</span><span class="n">wikipedia</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">queries</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">content</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">wiki_dict</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sent</span><span class="p">)</span>
    <span class="n">wiki_dict</span><span class="p">[</span><span class="s2">&quot;n_words&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">sent</span><span class="p">)))</span>
    <span class="n">wiki_dict</span><span class="p">[</span><span class="s2">&quot;wiki query&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">queries</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="n">wiki_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">wiki_dict</span><span class="p">)</span>
<span class="n">wiki_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>wiki query</th>
      <th>text</th>
      <th>n_words</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>mango_fruit</td>
      <td>A mango is an edible stone fruit produced by the tropical tree Mangifera indica which is believed to have originated from the region between northwestern Myanmar, Bangladesh, and northeastern India.</td>
      <td>33</td>
    </tr>
    <tr>
      <th>1</th>
      <td>pastry</td>
      <td>Pastry is a dough of flour, water and shortening (solid fats, including butter or lard) that may be savoury or sweetened.</td>
      <td>26</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Julia language</td>
      <td>Julia is a high-level, high-performance, dynamic programming language.</td>
      <td>11</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Python language</td>
      <td>Python is an interpreted high-level general-purpose programming language.</td>
      <td>9</td>
    </tr>
    <tr>
      <th>4</th>
      <td>hockey</td>
      <td>Hockey is a sport in which two teams play against each other by trying to manoeuvre a ball or a puck into the opponent's goal using a hockey stick.</td>
      <td>31</td>
    </tr>
    <tr>
      <th>5</th>
      <td>football</td>
      <td>Football is a family of team sports that involve, to varying degrees, kicking a ball to score a goal.</td>
      <td>22</td>
    </tr>
    <tr>
      <th>6</th>
      <td>supervised learning</td>
      <td>Supervised learning (SL) is the machine learning task of learning a function that maps an input to an output based on example input-output pairs.</td>
      <td>27</td>
    </tr>
    <tr>
      <th>7</th>
      <td>unsupervised learning</td>
      <td>Unsupervised learning is a type of machine learning in which the algorithm is not provided with any pre-assigned labels or scores for the training data.</td>
      <td>26</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><br><br></p>
</div>
<div class="section" id="kmeans-with-bag-of-words-representation">
<h3>1.2 <code class="docutils literal notranslate"><span class="pre">KMeans</span></code> with bag-of-words representation<a class="headerlink" href="#kmeans-with-bag-of-words-representation" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:4}</p>
<p>We have seen that before we pass text to machine learning models, we need to encode it into a numeric representation. So let’s encode our toy dataset above (<code class="docutils literal notranslate"><span class="pre">wiki_df</span></code>) to a numeric representation.</p>
<p>First, let’s try our good old friend: bag-of-words representation. The code below creates dense bag-of-words representation of Wikipedia sentences from 1.1 with <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.feature_extraction.text.CountVectorizer.html"><code class="docutils literal notranslate"><span class="pre">CountVectorizer</span></code></a>.</p>
<p><strong>Your tasks:</strong></p>
<p>Run the code below and answer the following questions.</p>
<ol class="simple">
<li><p>Run <code class="docutils literal notranslate"><span class="pre">KMeans</span></code> clustering on the transformed data (<code class="docutils literal notranslate"><span class="pre">bow_sents</span></code>) with K = the number of clusters you identified in 1.1.</p></li>
<li><p>Examine clustering labels assigned by <code class="docutils literal notranslate"><span class="pre">KMeans</span></code>. Is <code class="docutils literal notranslate"><span class="pre">KMeans</span></code> doing a reasonable job in clustering the sentences?</p></li>
</ol>
<blockquote>
<div><p>You can access cluster label assignments using <code class="docutils literal notranslate"><span class="pre">labels_</span></code> attribute of the clustering object.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vec</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">stop_words</span><span class="o">=</span><span class="s1">&#39;english&#39;</span><span class="p">)</span>
<span class="n">bow_sents</span> <span class="o">=</span> <span class="n">vec</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">wiki_df</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">todense</span><span class="p">()</span>
<span class="n">bow_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">bow_sents</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">vec</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">wiki_df</span><span class="o">.</span><span class="n">index</span>
<span class="p">)</span>
<span class="n">bow_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>algorithm</th>
      <th>assigned</th>
      <th>ball</th>
      <th>bangladesh</th>
      <th>based</th>
      <th>believed</th>
      <th>butter</th>
      <th>data</th>
      <th>degrees</th>
      <th>dough</th>
      <th>...</th>
      <th>teams</th>
      <th>training</th>
      <th>tree</th>
      <th>tropical</th>
      <th>trying</th>
      <th>type</th>
      <th>unsupervised</th>
      <th>using</th>
      <th>varying</th>
      <th>water</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>8 rows × 83 columns</p>
</div></div></div>
</div>
<p><br><br></p>
</div>
<div class="section" id="sentence-embedding-representation">
<h3>1.3 Sentence embedding representation<a class="headerlink" href="#sentence-embedding-representation" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:6}</p>
<p>Clustering is sensitive to what kind of representation we use for the given data.
Bag-of-words representation is limited in that it does not take into account word ordering and context. There are other richer representations of text, and we are going to use one such representation in this exercise.</p>
<p>The code below creates an alternative and a more expressive representation of sentences. We will call it <em>sentence embedding representation</em>. We’ll use <a class="reference external" href="https://www.sbert.net/index.html">sentence transformer</a> to extract these representations. At this point it’s enough to know that this is an alternative representation of text which usually works better than simple bag-of-words representation. We will talk a bit more about embedding representations next week. You need to install <code class="docutils literal notranslate"><span class="pre">sentence-transformers</span></code> in the course conda environment to run the code below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">activate</span> <span class="n">cpsc330</span>
<span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">sentence</span><span class="o">-</span><span class="n">transformers</span>
</pre></div>
</div>
<p><strong>Your tasks:</strong></p>
<p>Run the code below and answer the following questions.</p>
<ol class="simple">
<li><p>How many dimensions (features associated with each example) are present in this representation?</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">KMeans</span></code> clustering with sentence embedding representation of text (<code class="docutils literal notranslate"><span class="pre">emb_sents</span></code>) and examine cluster labels.</p></li>
<li><p>How well the sentences are clustered together?</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sentence_transformers</span> <span class="kn">import</span> <span class="n">SentenceTransformer</span>

<span class="n">embedder</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="s2">&quot;paraphrase-distilroberta-base-v1&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">emb_sents</span> <span class="o">=</span> <span class="n">embedder</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">wiki_df</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>
<span class="n">emb_sent_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">emb_sents</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">wiki_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">emb_sent_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>758</th>
      <th>759</th>
      <th>760</th>
      <th>761</th>
      <th>762</th>
      <th>763</th>
      <th>764</th>
      <th>765</th>
      <th>766</th>
      <th>767</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.056666</td>
      <td>-0.025778</td>
      <td>0.248908</td>
      <td>-0.052198</td>
      <td>-0.046876</td>
      <td>0.202116</td>
      <td>0.235076</td>
      <td>0.322160</td>
      <td>-0.023799</td>
      <td>0.133034</td>
      <td>...</td>
      <td>0.239582</td>
      <td>-0.022871</td>
      <td>0.071446</td>
      <td>0.402666</td>
      <td>-0.134781</td>
      <td>0.177697</td>
      <td>-0.123652</td>
      <td>0.446758</td>
      <td>0.204768</td>
      <td>-0.048541</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.062657</td>
      <td>0.214340</td>
      <td>-0.025160</td>
      <td>0.276731</td>
      <td>0.401149</td>
      <td>0.030864</td>
      <td>-0.089944</td>
      <td>0.331922</td>
      <td>-0.247056</td>
      <td>0.175028</td>
      <td>...</td>
      <td>0.039294</td>
      <td>-0.100197</td>
      <td>0.201217</td>
      <td>0.257111</td>
      <td>0.194594</td>
      <td>0.280075</td>
      <td>0.037366</td>
      <td>0.205146</td>
      <td>0.044872</td>
      <td>-0.078719</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.063674</td>
      <td>0.287056</td>
      <td>0.098705</td>
      <td>0.048766</td>
      <td>0.562877</td>
      <td>-0.015978</td>
      <td>-0.129418</td>
      <td>0.098363</td>
      <td>0.249305</td>
      <td>0.269618</td>
      <td>...</td>
      <td>0.483838</td>
      <td>-0.017338</td>
      <td>0.194521</td>
      <td>0.185484</td>
      <td>0.536236</td>
      <td>0.137246</td>
      <td>0.368983</td>
      <td>-0.028611</td>
      <td>-0.017652</td>
      <td>-0.192852</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.112806</td>
      <td>-0.137214</td>
      <td>0.082946</td>
      <td>-0.066925</td>
      <td>0.558055</td>
      <td>0.197494</td>
      <td>-0.034394</td>
      <td>0.421297</td>
      <td>0.105453</td>
      <td>0.280035</td>
      <td>...</td>
      <td>0.464874</td>
      <td>0.291358</td>
      <td>-0.028042</td>
      <td>0.120064</td>
      <td>0.021189</td>
      <td>0.300265</td>
      <td>0.323036</td>
      <td>0.072128</td>
      <td>0.047298</td>
      <td>-0.076177</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.027003</td>
      <td>-0.244207</td>
      <td>-0.090704</td>
      <td>0.037250</td>
      <td>0.029517</td>
      <td>-0.441170</td>
      <td>0.205250</td>
      <td>0.373760</td>
      <td>-0.046666</td>
      <td>-0.006260</td>
      <td>...</td>
      <td>0.479730</td>
      <td>-0.121558</td>
      <td>0.002595</td>
      <td>-0.147080</td>
      <td>-0.277788</td>
      <td>0.082878</td>
      <td>-0.182319</td>
      <td>0.786005</td>
      <td>0.235606</td>
      <td>-0.125455</td>
    </tr>
    <tr>
      <th>5</th>
      <td>-0.071756</td>
      <td>0.133156</td>
      <td>-0.071762</td>
      <td>0.306060</td>
      <td>0.358961</td>
      <td>-0.061442</td>
      <td>0.167584</td>
      <td>0.364614</td>
      <td>0.323540</td>
      <td>0.141398</td>
      <td>...</td>
      <td>0.404115</td>
      <td>0.000236</td>
      <td>0.177493</td>
      <td>0.016162</td>
      <td>0.232335</td>
      <td>0.260556</td>
      <td>0.168149</td>
      <td>0.483963</td>
      <td>0.121122</td>
      <td>0.196881</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.056006</td>
      <td>-0.111174</td>
      <td>-0.041484</td>
      <td>0.279775</td>
      <td>0.758024</td>
      <td>0.181266</td>
      <td>0.128420</td>
      <td>0.323363</td>
      <td>0.297055</td>
      <td>0.154679</td>
      <td>...</td>
      <td>-0.007967</td>
      <td>-0.061345</td>
      <td>0.352495</td>
      <td>0.011700</td>
      <td>-0.358587</td>
      <td>-0.052314</td>
      <td>0.370847</td>
      <td>-0.276011</td>
      <td>0.105793</td>
      <td>0.175194</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.040102</td>
      <td>-0.104919</td>
      <td>-0.181901</td>
      <td>0.099643</td>
      <td>0.746790</td>
      <td>0.334654</td>
      <td>0.106366</td>
      <td>0.238597</td>
      <td>0.142745</td>
      <td>0.110568</td>
      <td>...</td>
      <td>0.113404</td>
      <td>0.065607</td>
      <td>-0.014091</td>
      <td>-0.047726</td>
      <td>-0.410689</td>
      <td>0.133482</td>
      <td>0.388844</td>
      <td>-0.313182</td>
      <td>0.013006</td>
      <td>-0.074869</td>
    </tr>
  </tbody>
</table>
<p>8 rows × 768 columns</p>
</div></div></div>
</div>
<p><br><br></p>
</div>
<div class="section" id="dbscan-with-cosine-distance">
<h3>1.4 DBSCAN with cosine distance<a class="headerlink" href="#dbscan-with-cosine-distance" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:8}</p>
<p>Let’s try <code class="docutils literal notranslate"><span class="pre">DBSCAN</span></code> on our toy dataset. K-Means is kind of bound to the Euclidean distance because it is based on the notion of means. With <code class="docutils literal notranslate"><span class="pre">DBSCAN</span></code> we can try different distance metrics. In the context of text (sparse data), <a class="reference external" href="https://scikit-learn.org/stable/modules/metrics.html#cosine-similarity">cosine similarities</a> or cosine distances tend to work better. Given vectors <span class="math notranslate nohighlight">\(u\)</span> and <span class="math notranslate nohighlight">\(v\)</span>, the <strong>cosine distance</strong> between the vectors is defined as:</p>
<div class="math notranslate nohighlight">
\[distance_{cosine}(u,v) = 1 - (\frac{u \cdot v}{\left\lVert u\right\rVert_2 \left\lVert v\right\rVert_2})\]</div>
<p>In this exercise, you’ll use DBSCAN with cosine distances.</p>
<p><strong>Your tasks</strong></p>
<ol class="simple">
<li><p>Use DBSCAN to cluster our toy data using sentence embedding representation (<code class="docutils literal notranslate"><span class="pre">emb_sents</span></code>) and <code class="docutils literal notranslate"><span class="pre">metric='cosine'</span></code>.</p></li>
<li><p>Briefly comment on the number of clusters identified and the cluster assignment given by the algorithm.</p></li>
</ol>
<blockquote>
<div><p><em>Note: You will also have to set appropriate values for the hyperparamters <code class="docutils literal notranslate"><span class="pre">eps</span></code> and <code class="docutils literal notranslate"><span class="pre">min_samples</span></code> to get meaningful clusters, as default values for these hyperparameters won’t work on this toy dataset. In order to set appropriate value for <code class="docutils literal notranslate"><span class="pre">eps</span></code>, you may want to examine the distances given by <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.pairwise.cosine_distances.html">sklearn’s <code class="docutils literal notranslate"><span class="pre">cosine_distance</span></code></a>.</em></p>
</div></blockquote>
<p><br><br></p>
</div>
<div class="section" id="visualizing-clusters">
<h3>1.5 Visualizing clusters<a class="headerlink" href="#visualizing-clusters" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:5}</p>
<p>One thing we could do with unlabeled data is visualizing it. That said, our data is high dimensional (each example is represented with 768 dimensions) and high-dimensional data is hard to visualize. One way to visualize high-dimensional data is applying dimensionality reduction to get the most important (2 or 3) components of the dataset and visualizing this low-dimensional data.</p>
<p>Given data as a <code class="docutils literal notranslate"><span class="pre">numpy</span></code> array and cluster assignments, the <code class="docutils literal notranslate"><span class="pre">plot_pca_clusters</span></code> function below transforms the given data by applying dimensionality reduction and plots the transformed data into corresponding clusters.</p>
<blockquote>
<div><p><em>Note: At this point we are using this function only for visualization and you are not expected to understand the PCA part. Feel free to modify the function as you see fit.</em></p>
</div></blockquote>
<p><strong>Your tasks:</strong></p>
<ol class="simple">
<li><p>Call the function <code class="docutils literal notranslate"><span class="pre">plot_pca_clusters</span></code> to visualize the clusters created by the three models above:</p>
<ul class="simple">
<li><p>KMeans with bag-of-words representation</p></li>
<li><p>KMeans with sentence embedding representation</p></li>
<li><p>DBSCAN with sentence embedding representation</p></li>
</ul>
</li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span> <span class="c1"># Obtain the principal components</span>

<span class="k">def</span> <span class="nf">plot_pca_clusters</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">cluster_labels</span><span class="p">,</span>
    <span class="n">raw_sents</span><span class="o">=</span><span class="n">wiki_df</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">],</span>
    <span class="n">show_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;PCA visualization&quot;</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Carry out dimensionality reduction using PCA and plot 2-dimensional clusters.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    data : numpy array</span>
<span class="sd">        data as a numpy array</span>
<span class="sd">    cluster_labels : list</span>
<span class="sd">        cluster labels for each row in the dataset</span>
<span class="sd">    raw_sents : list</span>
<span class="sd">        the original raw sentences for labeling datapoints</span>
<span class="sd">    show_labels : boolean</span>
<span class="sd">        whether you want to show labels for points or not (default: False)</span>
<span class="sd">    size : int</span>
<span class="sd">        size of points in the scatterplot</span>
<span class="sd">    title : str</span>
<span class="sd">        title for the visualization plot</span>

<span class="sd">    Returns</span>
<span class="sd">    -----------</span>
<span class="sd">    None. Shows the clusters.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">principal_comp</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">pca_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">principal_comp</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pca1&quot;</span><span class="p">,</span> <span class="s2">&quot;pca2&quot;</span><span class="p">])</span>
    <span class="n">pca_df</span><span class="p">[</span><span class="s2">&quot;cluster&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cluster_labels</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="s2">&quot;pca1&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;pca2&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;cluster&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">pca_df</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;tab10&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">size</span>
    <span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">pca_df</span><span class="p">[</span><span class="s2">&quot;pca1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">pca_df</span><span class="p">[</span><span class="s2">&quot;pca2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">show_labels</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">txt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">raw_sents</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">10</span><span class="p">]),</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><br><br><br><br></p>
</div>
</div>
<div class="section" id="exercise-2-movie-recommendations">
<h2>Exercise 2: Movie recommendations<a class="headerlink" href="#exercise-2-movie-recommendations" title="Permalink to this headline">¶</a></h2>
<hr>
<p>Let’s build simple movie recommendation systems using the <a class="reference external" href="https://www.kaggle.com/prajitdatta/movielens-100k-dataset/data">MovieLens dataset</a>. The original source of the data is <a class="reference external" href="https://grouplens.org/datasets/movielens/">here</a>, and the structure of the data is described in the <a class="reference external" href="http://files.grouplens.org/datasets/movielens/ml-latest-small-README.html">README</a> that comes with it. The code below reads the data as a CSV assuming that it’s under <code class="docutils literal notranslate"><span class="pre">data/ml-100k/</span></code> directory under your lab folder.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span> <span class="s2">&quot;movie_id&quot;</span><span class="p">,</span> <span class="s2">&quot;rating&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">]</span>
<span class="n">ratings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;ml-100k&quot;</span><span class="p">,</span> <span class="s2">&quot;u.data&quot;</span><span class="p">),</span>
    <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">names</span><span class="o">=</span><span class="n">r_cols</span><span class="p">,</span>
    <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;latin-1&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ratings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">80</span><span class="o">/</span><span class="n">kr9rkqfj4w78h49djkz8yy9r0000gp</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_19245</span><span class="o">/</span><span class="mf">1106690063.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">r_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span> <span class="s2">&quot;movie_id&quot;</span><span class="p">,</span> <span class="s2">&quot;rating&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">]</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">ratings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;ml-100k&quot;</span><span class="p">,</span> <span class="s2">&quot;u.data&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">names</span><span class="o">=</span><span class="n">r_cols</span><span class="p">,</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/pandas/util/_decorators.py</span> in <span class="ni">wrapper</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">309</span>                     <span class="n">stacklevel</span><span class="o">=</span><span class="n">stacklevel</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">310</span>                 <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">311</span>             <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">312</span> 
<span class="g g-Whitespace">    </span><span class="mi">313</span>         <span class="k">return</span> <span class="n">wrapper</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">read_csv</span><span class="nt">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, squeeze, prefix, mangle_dupe_cols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, error_bad_lines, warn_bad_lines, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">584</span>     <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds_defaults</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">585</span> 
<span class="ne">--&gt; </span><span class="mi">586</span>     <span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">587</span> 
<span class="g g-Whitespace">    </span><span class="mi">588</span> 

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">_read</span><span class="nt">(filepath_or_buffer, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">480</span> 
<span class="g g-Whitespace">    </span><span class="mi">481</span>     <span class="c1"># Create the parser.</span>
<span class="ne">--&gt; </span><span class="mi">482</span>     <span class="n">parser</span> <span class="o">=</span> <span class="n">TextFileReader</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">483</span> 
<span class="g g-Whitespace">    </span><span class="mi">484</span>     <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">or</span> <span class="n">iterator</span><span class="p">:</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">__init__</span><span class="nt">(self, f, engine, **kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">809</span>             <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">810</span> 
<span class="ne">--&gt; </span><span class="mi">811</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_engine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">812</span> 
<span class="g g-Whitespace">    </span><span class="mi">813</span>     <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">_make_engine</span><span class="nt">(self, engine)</span>
<span class="g g-Whitespace">   </span><span class="mi">1038</span>             <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1039</span>         <span class="c1"># error: Too many arguments for &quot;ParserBase&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1040</span>         <span class="k">return</span> <span class="n">mapping</span><span class="p">[</span><span class="n">engine</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>  <span class="c1"># type: ignore[call-arg]</span>
<span class="g g-Whitespace">   </span><span class="mi">1041</span> 
<span class="g g-Whitespace">   </span><span class="mi">1042</span>     <span class="k">def</span> <span class="nf">_failover_to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/pandas/io/parsers/c_parser_wrapper.py</span> in <span class="ni">__init__</span><span class="nt">(self, src, **kwds)</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span> 
<span class="g g-Whitespace">     </span><span class="mi">50</span>         <span class="c1"># open handles</span>
<span class="ne">---&gt; </span><span class="mi">51</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_open_handles</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">52</span>         <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">     </span><span class="mi">53</span> 

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/pandas/io/parsers/base_parser.py</span> in <span class="ni">_open_handles</span><span class="nt">(self, src, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">220</span>         <span class="n">Let</span> <span class="n">the</span> <span class="n">readers</span> <span class="nb">open</span> <span class="n">IOHandles</span> <span class="n">after</span> <span class="n">they</span> <span class="n">are</span> <span class="n">done</span> <span class="k">with</span> <span class="n">their</span> <span class="n">potential</span> <span class="n">raises</span><span class="o">.</span>
<span class="g g-Whitespace">    </span><span class="mi">221</span>         <span class="s2">&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">222</span><span class="s2">         self.handles = get_handle(</span>
<span class="g g-Whitespace">    </span><span class="mi">223</span><span class="s2">             src,</span>
<span class="g g-Whitespace">    </span><span class="mi">224</span><span class="s2">             &quot;r&quot;,</span>

<span class="nn">~/opt/miniconda3/envs/cpsc330/lib/python3.9/site-packages/pandas/io/common.py</span> in <span class="ni">get_handle</span><span class="nt">(path_or_buf, mode, encoding, compression, memory_map, is_text, errors, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">699</span><span class="s2">         if ioargs.encoding and &quot;b&quot; not in ioargs.mode:</span>
<span class="g g-Whitespace">    </span><span class="mi">700</span><span class="s2">             # Encoding</span>
<span class="ne">--&gt; </span><span class="mi">701</span><span class="s2">             handle = open(</span>
<span class="g g-Whitespace">    </span><span class="mi">702</span><span class="s2">                 handle,</span>
<span class="g g-Whitespace">    </span><span class="mi">703</span><span class="s2">                 ioargs.mode,</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;data/ml-100k/u.data&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We&#39;ll be using these keys later in the starter code</span>
<span class="n">user_key</span> <span class="o">=</span> <span class="s2">&quot;user_id&quot;</span>
<span class="n">item_key</span> <span class="o">=</span> <span class="s2">&quot;movie_id&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="terminology">
<h3>2.1 Terminology<a class="headerlink" href="#terminology" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:3}</p>
<p>Here is some notation we will be using in this homework.</p>
<p><strong>Constants</strong>:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(N\)</span>: the number of users, indexed by <span class="math notranslate nohighlight">\(n\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(M\)</span>: the number of movies, indexed by <span class="math notranslate nohighlight">\(m\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\mathcal{R}\)</span>: the set of indices <span class="math notranslate nohighlight">\((n,m)\)</span> where we have ratings in the utility matrix <span class="math notranslate nohighlight">\(Y\)</span></p>
<ul>
<li><p>Thus <span class="math notranslate nohighlight">\(|\mathcal{R}|\)</span> is the total number of ratings</p></li>
</ul>
</li>
</ul>
<p><strong>The data</strong>:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(Y\)</span>: the utility matrix containing ratings, with a lot of missing entries</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">train_mat</span></code> and <code class="docutils literal notranslate"><span class="pre">valid_mat</span></code>: Utility matrices for train and validation sets, respectively</p></li>
</ul>
<p><strong>Your tasks:</strong></p>
<ol class="simple">
<li><p>What are the values of <span class="math notranslate nohighlight">\(N\)</span> and <span class="math notranslate nohighlight">\(M\)</span> in movie ratings data?</p></li>
<li><p>What would be the shape of the dense utility matrix <span class="math notranslate nohighlight">\(Y\)</span>?</p></li>
<li><p>What would be the fraction of non missing ratings in the utility matrix <span class="math notranslate nohighlight">\(Y\)</span>?</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">M</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<p><br><br></p>
</div>
<div class="section" id="splitting-the-data">
<h3>2.2 Splitting the data<a class="headerlink" href="#splitting-the-data" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:5}</p>
<p><strong>Your tasks:</strong></p>
<ol class="simple">
<li><p>Split the ratings data with <code class="docutils literal notranslate"><span class="pre">test_size=0.2</span></code> and <code class="docutils literal notranslate"><span class="pre">random_state=42</span></code>.</p></li>
</ol>
<p><br><br></p>
</div>
<div class="section" id="utility-matrix">
<h3>2.3 Utility matrix<a class="headerlink" href="#utility-matrix" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:10}</p>
<p><strong>Your tasks</strong></p>
<ol class="simple">
<li><p>Create utility matrices for train and validation sets (similar to how we did in the class).</p></li>
<li><p>Briefly explain the difference between the train and validation utility matrices.</p></li>
</ol>
<blockquote>
<div><p>You may use the code from lecture notes with appropriate attributions.</p>
</div></blockquote>
<blockquote>
<div><p>You won’t do it in real life but since our dataset is not that big, create a dense utility matrix in this assignment. You are welcome to try sparse matrix but then you may have to change some started code provided in the later exercises.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_mapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="n">user_key</span><span class="p">]),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">))))</span>
<span class="n">item_mapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="n">item_key</span><span class="p">]),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">))))</span>
<span class="n">user_inverse_mapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="n">user_key</span><span class="p">])))</span>
<span class="n">item_inverse_mapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="n">item_key</span><span class="p">])))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_mat</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">valid_mat</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<p><br><br></p>
</div>
<div class="section" id="evaluation-and-baseline">
<h3>2.4 Evaluation and baseline<a class="headerlink" href="#evaluation-and-baseline" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:4}</p>
<p>To compare different models you build in this homework, let’s write a couple of functions for evaluation.</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">error</span></code> function returns RMSE.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">evaluate</span></code> function prints the train and validation RMSEs.</p></li>
</ul>
<p><strong>Your task:</strong></p>
<ol class="simple">
<li><p>Briefly explain what exactly we are comparing to evaluate recommender systems.</p></li>
<li><p>Implement the global average baseline, where you predict everything as the global average rating. What’s the RMSE of the global average baseline?</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="n">Y1</span><span class="p">,</span> <span class="n">Y2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the root mean squared error (RMSE).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">((</span><span class="n">Y1</span> <span class="o">-</span> <span class="n">Y2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="n">pred_Y</span><span class="p">,</span> <span class="n">train_mat</span><span class="p">,</span> <span class="n">valid_mat</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;Global average&quot;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> train RMSE: </span><span class="si">%0.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">error</span><span class="p">(</span><span class="n">pred_Y</span><span class="p">,</span> <span class="n">train_mat</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> valid RMSE: </span><span class="si">%0.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">error</span><span class="p">(</span><span class="n">pred_Y</span><span class="p">,</span> <span class="n">valid_mat</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p><br><br></p>
</div>
<div class="section" id="optional-2-5-k-nearest-neighbours-imputation">
<h3>(Optional) 2.5 <span class="math notranslate nohighlight">\(k\)</span>-nearest neighbours imputation<a class="headerlink" href="#optional-2-5-k-nearest-neighbours-imputation" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:1}</p>
<p><strong>Your tasks:</strong></p>
<p>Try <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.impute.KNNImputer.html">KNNImputer</a> to fill in the missing entries. Discuss your observations.</p>
<p><br><br></p>
</div>
<div class="section" id="use-collaborative-filtering-with-the-surprise-package">
<h3>2.6 Use collaborative filtering with the <code class="docutils literal notranslate"><span class="pre">surprise</span></code> package<a class="headerlink" href="#use-collaborative-filtering-with-the-surprise-package" title="Permalink to this headline">¶</a></h3>
<p>rubric={points:6}</p>
<p>Use the <a class="reference external" href="https://surprise.readthedocs.io/en/stable/"><code class="docutils literal notranslate"><span class="pre">surprise</span></code></a> package which has implementation of SVD algorithm for collaborative filtering. You can install it as follows in your conda environment.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">conda</span> <span class="n">activate</span> <span class="n">cpsc330</span>
<span class="o">&gt;&gt;</span> <span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">scikit</span><span class="o">-</span><span class="n">surprise</span>
<span class="ow">or</span> 
<span class="o">&gt;&gt;</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">scikit</span><span class="o">-</span><span class="n">surprise</span>
</pre></div>
</div>
<p><strong>Your tasks:</strong></p>
<ol class="simple">
<li><p>Carry out cross-validation using SVD algorithm in the package, similar to how we did it in the lecture on Jester dataset. Report mean RMSE and compare it with global baseline.</p></li>
</ol>
<p><br><br><br><br></p>
</div>
</div>
<div class="section" id="exercise-3-short-answer-questions">
<h2>Exercise 3: Short answer questions<a class="headerlink" href="#exercise-3-short-answer-questions" title="Permalink to this headline">¶</a></h2>
<hr>
<p>rubric={points:5}</p>
<p>Answer the following short-answer questions:</p>
<ol class="simple">
<li><p>What’s the main difference between unsupervised and supervised learning?</p></li>
<li><p>When choosing <span class="math notranslate nohighlight">\(k\)</span> in K-Means, why not just choose the <span class="math notranslate nohighlight">\(k\)</span> that leads to the smallest inertia (sum of squared distances within clusters)?</p></li>
<li><p>You decide to use clustering for <em>outlier detection</em>; that is, to detect instances that are very atypical compared to all the rest. How might you do this with <span class="math notranslate nohighlight">\(k\)</span>-means?</p></li>
<li><p>You decide to use clustering for <em>outlier detection</em>; that is, to detect instances that are very atypical compared to all the rest. How might you do this with DBSCAN?</p></li>
<li><p>How might you apply clustering to recommendation systems?</p></li>
</ol>
<p><br><br><br><br></p>
</div>
<div class="section" id="submission-instructions">
<h2>Submission instructions<a class="headerlink" href="#submission-instructions" title="Permalink to this headline">¶</a></h2>
<p><strong>PLEASE READ:</strong> When you are ready to submit your assignment do the following:</p>
<ol class="simple">
<li><p>Run all cells in your notebook to make sure there are no errors by doing <code class="docutils literal notranslate"><span class="pre">Kernel</span> <span class="pre">-&gt;</span> <span class="pre">Restart</span> <span class="pre">Kernel</span> <span class="pre">and</span> <span class="pre">Clear</span> <span class="pre">All</span> <span class="pre">Outputs</span></code> and then <code class="docutils literal notranslate"><span class="pre">Run</span> <span class="pre">-&gt;</span> <span class="pre">Run</span> <span class="pre">All</span> <span class="pre">Cells</span></code>.</p></li>
<li><p>Notebooks with cell execution numbers out of order or not starting from “1” will have marks deducted. Notebooks without the output displayed may not be graded at all (because we need to see the output in order to grade your work).</p></li>
<li><p>Upload the assignment using Gradescope’s drag and drop tool. Check out this <a class="reference external" href="https://lthub.ubc.ca/guides/gradescope-student-guide/">Gradescope Student Guide</a> if you need help with Gradescope submission.</p></li>
</ol>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "conda-env-cpsc330-py"
        },
        kernelOptions: {
            kernelName: "conda-env-cpsc330-py",
            path: "./hw/hw7"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'conda-env-cpsc330-py'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Varada Kolhatkar<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>